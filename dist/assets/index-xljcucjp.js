const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-BTwRV4U-.js","assets/dnd-7mlNwzRc.js","assets/vendor-Rh7fhQc2.js","assets/jszip.min-2X8rbmn9.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,a as r}from"./dnd-7mlNwzRc.js";import{a,g as s}from"./vendor-Rh7fhQc2.js";import{C as o,X as n,a as i,S as l,B as c,V as d,F as m,b as p,P as h,c as u,d as g,H as y,M as x,G as f,e as b,f as v,U as w,D as j,L as N,Z as k,g as C,h as S,i as A,j as I,k as P,T,l as E,m as D,A as $,n as M,o as O,p as L,q as F,r as z,s as R,t as U,u as W,v as _,E as B,w as H,x as q,y as G,z as V,R as J,I as K,J as Y,K as Q,N as X,W as Z,O as ee,Q as te,Y as re,_ as ae,$ as se,a0 as oe,a1 as ne,a2 as ie,a3 as le,a4 as ce,a5 as de,a6 as me,a7 as pe,a8 as he,a9 as ue,aa as ge,ab as ye,ac as xe,ad as fe,ae as be,af as ve,ag as we,ah as je,ai as Ne,aj as ke,ak as Ce,al as Se,am as Ae}from"./ui-C_MPAbMB.js";import{O as Ie}from"./ai-Bh8ckaFx.js";import{_ as Pe}from"./pdf-BTwRV4U-.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Te,Ee={};const De=s(function(){if(Te)return Ee;Te=1;var e=a();return Ee.createRoot=e.createRoot,Ee.hydrateRoot=e.hydrateRoot,Ee}());var $e=Object.defineProperty,Me=(e,t,r)=>((e,t,r)=>t in e?$e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const Oe={PROJECTS:"storyboard_projects",CURRENT_PROJECT:"storyboard_current_project",SETTINGS:"storyboard_settings",AI_CONVERSATIONS:"storyboard_ai_conversations"},Le="StoryboardAI",Fe="images",ze="videos",Re=class e{constructor(){Me(this,"db",null),this.initDB()}static getInstance(){return e.instance||(e.instance=new e),e.instance}async initDB(){try{const e=indexedDB.open(Le,2);e.onerror=()=>{console.error("Failed to open IndexedDB:",e.error)},e.onsuccess=()=>{this.db=e.result,console.log("✅ IndexedDB initialized successfully")},e.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(Fe)){t.createObjectStore(Fe,{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),console.log("📦 IndexedDB image store created")}if(!t.objectStoreNames.contains(ze)){t.createObjectStore(ze,{keyPath:"id"}).createIndex("createdAt","createdAt",{unique:!1}),console.log("🎬 IndexedDB video store created")}}}catch(e){console.error("Failed to initialize IndexedDB:",e)}}async saveImageToDB(e,t){const r=indexedDB.open("StoryboardAI",1);return r.onupgradeneeded=()=>{const e=r.result;e.objectStoreNames.contains("images")||e.createObjectStore("images",{keyPath:"id"})},new Promise(((a,s)=>{r.onsuccess=()=>{const o=r.result.transaction(["images"],"readwrite");o.objectStore("images").put({id:e,data:t}),o.oncomplete=()=>a(),o.onerror=()=>s(o.error)},r.onerror=()=>s(r.error)}))}async getImageFromDB(e){const t=indexedDB.open("StoryboardAI",1);return new Promise(((r,a)=>{t.onsuccess=()=>{const a=t.result;if(!a.objectStoreNames.contains("images"))return void r(null);const s=a.transaction(["images"],"readonly").objectStore("images").get(e);s.onsuccess=()=>{const e=s.result;r(e?e.data:null)},s.onerror=()=>r(null)},t.onerror=()=>r(null)}))}async deleteImageFromDB(e){return new Promise((t=>{if(!this.db){try{localStorage.removeItem(`storyboard_image_${e}`)}catch(a){console.warn("Failed to delete image from localStorage:",a)}return void t()}const r=this.db.transaction([Fe],"readwrite").objectStore(Fe).delete(e);r.onsuccess=()=>t(),r.onerror=()=>{console.warn("Failed to delete image from IndexedDB:",r.error),t()}}))}async saveVideoToDB(e,t){return new Promise(((r,a)=>{try{if(!this.db){console.warn("IndexedDB not ready, using localStorage fallback for video");try{localStorage.setItem(`storyboard_video_${e}`,"video-too-large-for-storage"),r()}catch(s){a(new Error("Could not save video - storage is full"))}return}if(!this.db.objectStoreNames.contains(ze))return console.warn("Videos store not found, cannot save video. DB needs upgrade."),void a(new Error("Database schema outdated - please reload the app"));const o=this.db.transaction([ze],"readwrite");o.objectStore(ze).put({id:e,data:t,createdAt:new Date}),o.oncomplete=()=>{console.log(`🎬 Video saved successfully: ${e}`),r()},o.onerror=e=>{console.error("Failed to save video to IndexedDB:",o.error),a(o.error)}}catch(o){console.error("Error in saveVideoToDB:",o),a(o)}}))}async getVideoFromDB(e){return new Promise((t=>{try{if("video-too-large-for-storage"===localStorage.getItem(`storyboard_video_${e}`))return console.warn(`⚠️ Video ${e} was too large to store and only has a placeholder`),void t(null);if(!this.db)return console.warn("IndexedDB not initialized, cannot retrieve video"),void t(null);if(!this.db.objectStoreNames.contains(ze))return console.warn("Videos store not found, cannot retrieve video"),void t(null);const r=this.db.transaction([ze],"readonly"),a=r.objectStore(ze).get(e);a.onsuccess=()=>{const e=a.result;t(e?e.data:null)},a.onerror=()=>{console.error("Failed to retrieve video from IndexedDB:",a.error),t(null)}}catch(r){console.error("Error in getVideoFromDB:",r),t(null)}}))}async deleteVideoFromDB(e){return new Promise((t=>{if(!this.db)return void t();const r=this.db.transaction([ze],"readwrite").objectStore(ze).delete(e);r.onsuccess=()=>t(),r.onerror=()=>{console.warn("Failed to delete video from IndexedDB:",r.error),t()}}))}async saveProject(e){try{console.log("💾 Saving project with enhanced storage...");try{const e=await this.getStorageUsage();e.percentage>75&&(console.warn(`⚠️ Storage usage high (${Math.round(e.percentage)}%), attempting cleanup...`),await this.cleanupStorage())}catch(t){console.warn("Could not check storage usage before saving",t)}const r=JSON.parse(JSON.stringify(e)),a=[];r.panels=await Promise.all(e.panels.map((async e=>{const t={...e};if(e.imageUrl&&e.imageUrl.startsWith("data:image/")){const r=`panel_${e.id}_${Date.now()}`;a.push(this.saveImageToDB(r,e.imageUrl)),t.imageUrl=`stored:${r}`,console.log(`📸 Storing large image separately: ${r}`)}if(e.videoUrl&&e.videoUrl.startsWith("data:video/")){const r=`video_${e.id}_${Date.now()}`;a.push(this.saveVideoToDB(r,e.videoUrl)),t.videoUrl=`stored:${r}`,console.log(`🎬 Storing large video separately: ${r}`)}return t}))),await Promise.all(a);const s=await this.getAllProjects(),o=s.findIndex((t=>t.id===e.id)),n={...r,updatedAt:new Date};o>=0?s[o]=n:s.push(n),localStorage.setItem(Oe.PROJECTS,JSON.stringify(s)),localStorage.setItem(Oe.CURRENT_PROJECT,JSON.stringify(n)),console.log("✅ Project saved successfully with separated media storage")}catch(r){if(console.error("Failed to save project:",r),!(r instanceof DOMException&&"QuotaExceededError"===r.name))throw new Error("Failed to save project to browser storage");console.warn("🚨 Storage quota exceeded, attempting emergency cleanup...");try{await this.cleanupStorage(!0);const t=this.createLightweightProjectCopy(e);await this.saveEssentialProjectData(t),alert("Storage space is limited. Some media files were removed to save your project. Consider exporting your project.")}catch(a){throw console.error("Failed to save even after cleanup:",a),new Error("Storage quota exceeded. Please delete some projects or export your work.")}}}createLightweightProjectCopy(e){const t=JSON.parse(JSON.stringify(e));return t.panels=t.panels.map((e=>{const t={...e};return t.imageUrl&&t.imageUrl.startsWith("data:")&&(t.imageUrl=void 0),t.videoUrl&&t.videoUrl.startsWith("data:")&&(t.videoUrl=void 0),t})),t}async saveEssentialProjectData(e){const t=await this.getAllProjects(),r=t.findIndex((t=>t.id===e.id)),a={...e,updatedAt:new Date};r>=0?t[r]=a:t.push(a),localStorage.setItem(Oe.PROJECTS,JSON.stringify(t)),localStorage.setItem(Oe.CURRENT_PROJECT,JSON.stringify(a)),console.log("✅ Essential project data saved after cleanup")}async getCurrentProject(){try{const e=localStorage.getItem(Oe.CURRENT_PROJECT);if(!e)return null;const t=JSON.parse(e);return{...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt),lastOpened:t.lastOpened?new Date(t.lastOpened):void 0,panels:await Promise.all(t.panels.map((async e=>{const t={...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)};if("object"==typeof t.description&&null!==t.description){console.warn(`🩹 Fixing corrupted panel description for panel ID: ${t.id}`);const e=t.description;t.description=`Lighting: ${e.lighting||"N/A"}. Performance: ${e.performance||"N/A"}. Camera Movement: ${e.cameraMovement||"N/A"}. Composition: ${e.composition||"N/A"}. Sound: ${e.sound||"N/A"}.`}if(e.imageUrl&&e.imageUrl.startsWith("stored:")){const r=e.imageUrl.replace("stored:",""),a=await this.getImageFromDB(r);a?(t.imageUrl=a,console.log(`📸 Restored image: ${r}`)):console.warn(`⚠️ Could not restore image: ${r}`)}if(e.videoUrl&&e.videoUrl.startsWith("stored:")){const r=e.videoUrl.replace("stored:",""),a=await this.getVideoFromDB(r);a?(t.videoUrl=a,console.log(`🎬 Restored video: ${r}`)):console.warn(`⚠️ Could not restore video: ${r}`)}return t})))}}catch(e){return console.error("Failed to get current project:",e),null}}async getAllProjects(){try{const e=localStorage.getItem(Oe.PROJECTS);if(!e)return[];return JSON.parse(e).map((e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),lastOpened:e.lastOpened?new Date(e.lastOpened):void 0,panels:e.panels.map((e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),imageUrl:e.imageUrl&&e.imageUrl.startsWith("stored:")?null:e.imageUrl})))})))}catch(e){return console.error("Failed to load projects:",e),[]}}async deleteProject(e){try{const t=await this.getAllProjects(),r=t.find((t=>t.id===e));if(r){const e=r.panels.filter((e=>e.imageUrl&&e.imageUrl.startsWith("stored:"))).map((e=>{const t=e.imageUrl.replace("stored:","");return this.deleteImageFromDB(t)}));await Promise.all(e),console.log("🗑️ Deleted associated images")}const a=t.filter((t=>t.id!==e));localStorage.setItem(Oe.PROJECTS,JSON.stringify(a));const s=await this.getCurrentProject();s&&s.id===e&&localStorage.removeItem(Oe.CURRENT_PROJECT)}catch(t){throw console.error("Failed to delete project:",t),new Error("Failed to delete project from browser storage")}}getSettings(){try{const e=localStorage.getItem(Oe.SETTINGS);if(!e)return{darkMode:!1,autoSave:!0,lastUsed:new Date};const t=JSON.parse(e);return{...t,lastUsed:new Date(t.lastUsed)}}catch(e){return console.error("Failed to load settings:",e),{darkMode:!1,autoSave:!0,lastUsed:new Date}}}saveSettings(e){try{const t={...this.getSettings(),...e,lastUsed:new Date};localStorage.setItem(Oe.SETTINGS,JSON.stringify(t))}catch(t){throw console.error("Failed to save settings:",t),new Error("Failed to save settings to browser storage")}}saveConversation(e,t){try{const r=this.getConversations();r[e]={messages:t,updatedAt:(new Date).toISOString()},localStorage.setItem(Oe.AI_CONVERSATIONS,JSON.stringify(r))}catch(r){console.error("Failed to save conversation:",r)}}getConversations(){try{const e=localStorage.getItem(Oe.AI_CONVERSATIONS);return e?JSON.parse(e):{}}catch(e){return console.error("Failed to load conversations:",e),{}}}async exportData(){try{const e=await this.getAllProjects(),t={projects:await Promise.all(e.map((async e=>({...e,panels:await Promise.all(e.panels.map((async e=>{if(e.imageUrl&&e.imageUrl.startsWith("stored:")){const t=e.imageUrl.replace("stored:",""),r=await this.getImageFromDB(t);return{...e,imageUrl:r}}return e})))})))),settings:this.getSettings(),conversations:this.getConversations(),exportedAt:(new Date).toISOString(),version:"1.0.0"};return JSON.stringify(t,null,2)}catch(e){throw console.error("Failed to export data:",e),new Error("Failed to export data")}}async importData(e){try{const s=JSON.parse(e);let o=0,n=!1,i=!1;if(!s||"object"!=typeof s)throw new Error("Invalid import data structure");if(s.projects&&Array.isArray(s.projects)){console.log(`📦 Importing ${s.projects.length} projects...`);for(const e of s.projects)try{if(!e.id||!e.title||!Array.isArray(e.panels)){console.warn("⚠️ Skipping invalid project:",e.title||"Unnamed");continue}const t={...e,id:e.id||`imported-${Date.now()}-${Math.random()}`,title:e.title||"Imported Project",description:e.description||"",createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date,panels:e.panels.map(((e,t)=>({id:e.id||`imported-panel-${Date.now()}-${t}`,title:e.title||`Panel ${t+1}`,description:e.description||"",imageUrl:e.imageUrl,videoUrl:e.videoUrl,videoPrompt:e.videoPrompt||e.aiGeneratedPrompt,aiGeneratedPrompt:e.aiGeneratedPrompt||e.videoPrompt,shotType:e.shotType||"medium-shot",cameraAngle:e.cameraAngle||"eye-level",notes:e.notes||"",duration:"number"==typeof e.duration?e.duration:3,order:t,createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date})))};await this.saveProject(t),o++,console.log(`✅ Imported project: ${t.title}`)}catch(t){console.error(`❌ Failed to import project ${e.title||"Unknown"}:`,t)}}else if(s.project){console.log("📦 Importing single project...");try{const e=s.project;if(!(e.id&&e.title&&Array.isArray(e.panels)))throw new Error("Invalid project structure in import data");await this.saveProject(e),o=1,console.log(`✅ Imported project: ${e.title}`)}catch(t){console.error("❌ Failed to import project:",t)}}else if(s.id&&s.title&&Array.isArray(s.panels)){console.log("📦 Importing direct project format...");try{await this.saveProject(s),o=1,console.log(`✅ Imported project: ${s.title}`)}catch(t){console.error("❌ Failed to import project:",t)}}if(s.settings&&"object"==typeof s.settings)try{const e={...s.settings,lastUsed:new Date};delete e.openaiApiKey,localStorage.setItem(Oe.SETTINGS,JSON.stringify(e)),n=!0,console.log("✅ Imported settings")}catch(r){console.error("❌ Failed to import settings:",r)}if(s.conversations&&"object"==typeof s.conversations)try{localStorage.setItem(Oe.AI_CONVERSATIONS,JSON.stringify(s.conversations)),i=!0,console.log("✅ Imported AI conversations")}catch(a){console.error("❌ Failed to import conversations:",a)}return console.log(`📈 Import summary: ${o} projects, settings: ${n}, conversations: ${i}`),{projects:o,settings:n,conversations:i}}catch(s){throw console.error("Failed to import data:",s),s instanceof SyntaxError?new Error("Invalid JSON format - please check your import file"):s instanceof Error?new Error(`Import failed: ${s.message}`):new Error("Failed to import data - unknown error")}}clearAllData(){try{if(Object.values(Oe).forEach((e=>{localStorage.removeItem(e)})),this.db){const e=this.db.transaction([Fe],"readwrite");e.objectStore(Fe).clear()}}catch(e){throw console.error("Failed to clear data:",e),new Error("Failed to clear browser storage")}}async getStorageUsage(){try{let e=0;for(let o in localStorage)localStorage.hasOwnProperty(o)&&(e+=localStorage[o].length+o.length);let t=0;this.db&&(t=await this.estimateIndexedDBSize());const r=e+t,a=52428800,s=r/a*100;return{used:r,available:a-r,percentage:Math.min(s,100),breakdown:{localStorage:e,indexedDB:t}}}catch(e){return console.error("Failed to calculate storage usage:",e),{used:0,available:0,percentage:0,breakdown:{}}}}async estimateIndexedDBSize(){return new Promise((e=>{if(this.db)try{const t=this.db.transaction([Fe],"readonly"),r=t.objectStore(Fe).getAll();r.onsuccess=()=>{const t=r.result.reduce(((e,t)=>e+t.data.length),0);e(t)},r.onerror=()=>e(0)}catch(t){e(0)}else e(0)}))}async cleanupStorage(e=!1){console.log(`🧹 ${e?"Emergency":"Routine"} storage cleanup started...`);try{if(!this.db)return void console.warn("IndexedDB not initialized, skipping cleanup");const t=await this.getAllProjects(),r=new Set;t.forEach((e=>{e.panels.forEach((e=>{e.imageUrl&&"string"==typeof e.imageUrl&&e.imageUrl.startsWith("stored:")&&r.add(e.imageUrl.replace("stored:","")),e.videoUrl&&"string"==typeof e.videoUrl&&e.videoUrl.startsWith("stored:")&&r.add(e.videoUrl.replace("stored:",""))}))})),await this.cleanupStore(Fe,r,e),this.db.objectStoreNames.contains(ze)?await this.cleanupStore(ze,r,e):console.log("📝 Videos store not yet created, skipping video cleanup"),console.log("🧹 Storage cleanup completed")}catch(t){console.error("Error during storage cleanup:",t)}}async cleanupStore(e,t,r){return new Promise((a=>{if(this.db)try{if(!this.db.objectStoreNames.contains(e))return console.log(`⚠️ Object store ${e} not found, skipping cleanup`),void a();const s=this.db.transaction([e],"readwrite").objectStore(e),o=s.index("createdAt"),n=r?s.openCursor():o.openCursor();n.onsuccess=s=>{const o=s.target.result;if(o){const a=o.value;(!t.has(a.id)||r&&t.size>10)&&(console.log(`🗑️ Removing unused ${e} item: ${a.id}`),o.delete()),o.continue()}else a()},n.onerror=()=>{console.warn(`Failed to clean up ${e}:`,n.error),a()}}catch(s){console.error(`Error cleaning up ${e}:`,s),a()}else a()}))}async resetDatabase(){return new Promise(((e,t)=>{this.db&&(this.db.close(),this.db=null);const r=indexedDB.deleteDatabase(Le);r.onsuccess=()=>{console.log("🗑️ Database deleted successfully"),localStorage.removeItem(Oe.CURRENT_PROJECT),localStorage.removeItem(Oe.PROJECTS),console.log("🧹 Local storage keys cleared"),this.initDB(),e(!0)},r.onerror=()=>{console.error("❌ Could not delete database:",r.error),t(new Error("Could not delete database"))},r.onblocked=()=>{console.warn("⚠️ Database deletion was blocked - close other tabs that might be using it"),t(new Error("Database deletion was blocked"))}}))}};Me(Re,"instance");const Ue=Re.getInstance();const We=[{id:"1",title:"Opening Shot",description:"Wide establishing shot of the cityscape at dawn",shotType:"wide-shot",cameraAngle:"high-angle",notes:"Golden hour lighting, peaceful atmosphere",duration:5,order:0,createdAt:new Date,updatedAt:new Date},{id:"2",title:"Character Introduction",description:"Close-up of protagonist waking up",shotType:"close-up",cameraAngle:"eye-level",notes:"Focus on facial expression, natural lighting",duration:3,order:1,createdAt:new Date,updatedAt:new Date},{id:"3",title:"Daily Routine",description:"Medium shot of character preparing coffee",shotType:"medium-shot",cameraAngle:"eye-level",notes:"Show character's morning routine, warm tones",duration:4,order:2,createdAt:new Date,updatedAt:new Date}];function _e(e,t){let r;switch(t.type){case"SET_PROJECT":return r={...e,currentProject:t.payload,panels:t.payload.panels},Ue.saveProject(t.payload).catch(console.error),r;case"ADD_PANEL":const a=[...e.panels,t.payload];if(r={...e,panels:a},e.currentProject){const t={...e.currentProject,panels:a,updatedAt:new Date};Ue.saveProject(t).catch(console.error),r.currentProject=t}return r;case"UPDATE_PANEL":const s=e.panels.map((e=>e.id===t.payload.id?{...e,...t.payload.updates,updatedAt:new Date}:e));if(r={...e,panels:s},e.currentProject){const t={...e.currentProject,panels:s,updatedAt:new Date};Ue.saveProject(t).catch(console.error),r.currentProject=t}return r;case"DELETE_PANEL":const o=e.panels.filter((e=>e.id!==t.payload));if(r={...e,panels:o,selectedPanel:e.selectedPanel===t.payload?null:e.selectedPanel},e.currentProject){const t={...e.currentProject,panels:o,updatedAt:new Date};Ue.saveProject(t).catch(console.error),r.currentProject=t}return r;case"REORDER_PANELS":console.log("🔄 Processing REORDER_PANELS action:",t.payload),console.log("📋 Original panels:",e.panels.map((e=>({id:e.id,order:e.order}))));const n=[...e.panels],[i]=n.splice(t.payload.fromIndex,1);n.splice(t.payload.toIndex,0,i);const l=n.map(((e,t)=>({...e,order:t})));if(console.log("📋 Reordered panels:",l.map((e=>({id:e.id,order:e.order})))),r={...e,panels:l},e.currentProject){const t={...e.currentProject,panels:l,updatedAt:new Date};Ue.saveProject(t).catch(console.error),r.currentProject=t}return r;case"SELECT_PANEL":return{...e,selectedPanel:t.payload};case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload};case"SET_PANELS":const c=t.payload;if(r={...e,panels:c},e.currentProject){const t={...e.currentProject,panels:c,updatedAt:new Date};Ue.saveProject(t).catch(console.error),r.currentProject=t}return r;default:return e}}const Be=e.createContext(null);function He({children:r}){const[a,s]=e.useReducer(_e,{currentProject:null,panels:[],selectedPanel:null,isLoading:!0,error:null});return e.useEffect((()=>{(async()=>{try{const e=await Ue.getCurrentProject();if(e)s({type:"SET_PROJECT",payload:e}),s({type:"SET_LOADING",payload:!1});else{const e={id:"sample-project",title:"My First Storyboard",description:"A sample storyboard project to get you started",panels:We,createdAt:new Date,updatedAt:new Date};await Ue.saveProject(e),s({type:"SET_PROJECT",payload:e}),s({type:"SET_LOADING",payload:!1})}}catch(e){console.error("Failed to initialize from storage:",e),s({type:"SET_ERROR",payload:"Failed to load project data"}),s({type:"SET_LOADING",payload:!1})}})()}),[]),e.useEffect((()=>{if(Ue.getSettings().autoSave&&a.currentProject){const e=setTimeout((()=>{Ue.saveProject(a.currentProject).catch(console.error)}),1e3);return()=>clearTimeout(e)}}),[a.panels,a.currentProject]),t.jsx(Be.Provider,{value:{state:a,dispatch:s},children:r})}function qe(){const t=e.useContext(Be);if(!t)throw new Error("useStoryboard must be used within a StoryboardProvider");return t}const Ge=e=>({status:{success:{background:(e.id,"#10b981"),text:"#ffffff",border:(e.id,"#059669"),light:"dark"===e.id?"#10b98120":"#f0fdf4",hover:(e.id,"#059669")},warning:{background:(e.id,"#f59e0b"),text:"#ffffff",border:(e.id,"#d97706"),light:"dark"===e.id?"#f59e0b20":"#fffbeb",hover:(e.id,"#d97706")},error:{background:(e.id,"#ef4444"),text:"#ffffff",border:(e.id,"#dc2626"),light:"dark"===e.id?"#ef444420":"#fef2f2",hover:(e.id,"#dc2626")},info:{background:e.colors.primary[500],text:"#ffffff",border:e.colors.primary[600],light:"dark"===e.id?`${e.colors.primary[500]}20`:e.colors.primary[50],hover:e.colors.primary[600]}},text:{primary:{color:"dark"===e.id?"#ffffff":"#0f172a",opacity:1},secondary:{color:"dark"===e.id?"#e2e8f0":"#374151",opacity:.9},tertiary:{color:"dark"===e.id?"#cbd5e1":"#4b5563",opacity:.8},muted:{color:"dark"===e.id?"#94a3b8":"#6b7280",opacity:.7}},interactive:{primary:{background:e.colors.primary[500],hover:e.colors.primary[600],active:e.colors.primary[700],text:"#ffffff",disabled:e.colors.primary[300]},secondary:{background:e.colors.background.secondary,hover:"dark"===e.id?e.colors.secondary[700]:e.colors.secondary[100],active:"dark"===e.id?e.colors.secondary[600]:e.colors.secondary[200],text:"dark"===e.id?"#ffffff":"#0f172a",border:e.colors.border.primary}},project:{blue:{background:"#3b82f6",text:"#ffffff",light:"#dbeafe"},purple:{background:"#8b5cf6",text:"#ffffff",light:"#e9d5ff"},green:{background:"#10b981",text:"#ffffff",light:"#d1fae5"},red:{background:"#ef4444",text:"#ffffff",light:"#fee2e2"},orange:{background:"#f59e0b",text:"#ffffff",light:"#fef3c7"},pink:{background:"#ec4899",text:"#ffffff",light:"#fce7f3"},indigo:{background:"#6366f1",text:"#ffffff",light:"#e0e7ff"},gray:{background:"#6b7280",text:"#ffffff",light:"#f3f4f6"},yellow:{background:"#eab308",text:"#ffffff",light:"#fefce8"},teal:{background:"#14b8a6",text:"#ffffff",light:"#f0fdfa"}},window:{controls:{close:{background:"#ef4444",hover:"#dc2626"},minimize:{background:"#f59e0b",hover:"#d97706"},maximize:{background:"#10b981",hover:"#059669"}}},overlay:{backdrop:"dark"===e.id?"rgba(0, 0, 0, 0.9)":"rgba(0, 0, 0, 0.6)",modal:"dark"===e.id?"rgba(255, 255, 255, 0.05)":"rgba(255, 255, 255, 0.95)",dropdown:"dark"===e.id?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.9)"},shadows:{sm:"dark"===e.id?"0 1px 2px rgba(0,0,0,0.3)":"0 1px 2px rgba(0,0,0,0.05)",md:"dark"===e.id?"0 4px 8px rgba(0,0,0,0.3)":"0 4px 8px rgba(0,0,0,0.1)",lg:"dark"===e.id?"0 10px 30px rgba(0,0,0,0.4)":"0 10px 30px rgba(0,0,0,0.1)",xl:"dark"===e.id?"0 20px 40px rgba(0,0,0,0.5)":"0 20px 40px rgba(0,0,0,0.15)"}}),Ve={light:{id:"light",name:"Light",colors:{primary:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#f9fafb",tertiary:"#f3f4f6"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#e5e7eb",secondary:"#d1d5db"}}},dark:{id:"dark",name:"Dark",colors:{primary:{50:"#1e293b",100:"#334155",200:"#475569",300:"#64748b",400:"#94a3b8",500:"#cbd5e1",600:"#e2e8f0",700:"#f1f5f9",800:"#f8fafc",900:"#ffffff"},secondary:{50:"#0f172a",100:"#1e293b",200:"#334155",300:"#475569",400:"#64748b",500:"#94a3b8",600:"#cbd5e1",700:"#e2e8f0",800:"#f1f5f9",900:"#f8fafc"},background:{primary:"#0f172a",secondary:"#1e293b",tertiary:"#334155"},text:{primary:"#f8fafc",secondary:"#cbd5e1",tertiary:"#94a3b8"},border:{primary:"#334155",secondary:"#475569"}}},purple:{id:"purple",name:"Purple",colors:{primary:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7c3aed",800:"#6b21a8",900:"#581c87"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#faf5ff",tertiary:"#f3e8ff"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#e9d5ff",secondary:"#d8b4fe"}}},blue:{id:"blue",name:"Ocean Blue",colors:{primary:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a"},secondary:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},background:{primary:"#ffffff",secondary:"#eff6ff",tertiary:"#dbeafe"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#bfdbfe",secondary:"#93c5fd"}}},green:{id:"green",name:"Forest Green",colors:{primary:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d"},secondary:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},background:{primary:"#ffffff",secondary:"#f0fdf4",tertiary:"#dcfce7"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#bbf7d0",secondary:"#86efac"}}},orange:{id:"orange",name:"Sunset Orange",colors:{primary:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12"},secondary:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d"},background:{primary:"#ffffff",secondary:"#fff7ed",tertiary:"#ffedd5"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#fed7aa",secondary:"#fdba74"}}},rose:{id:"rose",name:"Rose",colors:{primary:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#fff1f2",tertiary:"#ffe4e6"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#fecdd3",secondary:"#fda4af"}}},emerald:{id:"emerald",name:"Emerald",colors:{primary:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b"},secondary:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e"},background:{primary:"#ffffff",secondary:"#ecfdf5",tertiary:"#d1fae5"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#a7f3d0",secondary:"#6ee7b7"}}},teal:{id:"teal",name:"Teal",colors:{primary:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#f0fdfa",tertiary:"#ccfbf1"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#99f6e4",secondary:"#5eead4"}}},amber:{id:"amber",name:"Amber",colors:{primary:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#fffbeb",tertiary:"#fef3c7"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#fde68a",secondary:"#fcd34d"}}},violet:{id:"violet",name:"Violet",colors:{primary:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#f5f3ff",tertiary:"#ede9fe"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#ddd6fe",secondary:"#c4b5fd"}}},slate:{id:"slate",name:"Slate",colors:{primary:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a"},secondary:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827"},background:{primary:"#ffffff",secondary:"#f8fafc",tertiary:"#f1f5f9"},text:{primary:"#111827",secondary:"#4b5563",tertiary:"#6b7280"},border:{primary:"#e2e8f0",secondary:"#cbd5e1"}}}},Je=()=>{let e="light";if("undefined"!=typeof window)try{const t=localStorage.getItem("storyboard-theme");t&&Ve[t]&&(e=t)}catch(t){console.warn("Could not access localStorage to get initial theme.")}return{currentTheme:e,theme:Ve[e]||Ve.light}};function Ke(e,t){if("SET_THEME"===t.type){const a=Ve[t.payload];if(!a)return e;try{localStorage.setItem("storyboard-theme",t.payload)}catch(r){console.warn("Could not save theme to localStorage.")}return{currentTheme:t.payload,theme:a}}return e}const Ye=e.createContext(null);function Qe({children:r}){const[a,s]=e.useReducer(Ke,void 0,Je);e.useEffect((()=>{!function(e){const t=document.documentElement;t.style.setProperty("--primary-50",e.colors.primary[50]),t.style.setProperty("--primary-100",e.colors.primary[100]),t.style.setProperty("--primary-200",e.colors.primary[200]),t.style.setProperty("--primary-300",e.colors.primary[300]),t.style.setProperty("--primary-400",e.colors.primary[400]),t.style.setProperty("--primary-500",e.colors.primary[500]),t.style.setProperty("--primary-600",e.colors.primary[600]),t.style.setProperty("--primary-700",e.colors.primary[700]),t.style.setProperty("--primary-800",e.colors.primary[800]),t.style.setProperty("--primary-900",e.colors.primary[900]),t.style.setProperty("--bg-primary",e.colors.background.primary),t.style.setProperty("--bg-secondary",e.colors.background.secondary),t.style.setProperty("--bg-tertiary",e.colors.background.tertiary),t.style.setProperty("--text-primary",e.colors.text.primary),t.style.setProperty("--text-secondary",e.colors.text.secondary),t.style.setProperty("--text-tertiary",e.colors.text.tertiary),t.style.setProperty("--border-primary",e.colors.border.primary),t.style.setProperty("--border-secondary",e.colors.border.secondary),t.setAttribute("data-theme",e.id),"dark"===e.id?(t.style.setProperty("--scrollbar-track","rgba(255, 255, 255, 0.05)"),t.style.setProperty("--scrollbar-thumb","rgba(255, 255, 255, 0.2)"),t.style.setProperty("--scrollbar-thumb-hover","rgba(255, 255, 255, 0.3)")):(t.style.setProperty("--scrollbar-track","rgba(0, 0, 0, 0.05)"),t.style.setProperty("--scrollbar-thumb","rgba(0, 0, 0, 0.2)"),t.style.setProperty("--scrollbar-thumb-hover","rgba(0, 0, 0, 0.3)"))}(a.theme),(e=>{const t=Ge(e),r=document.documentElement;r.style.setProperty("--color-success",t.status.success.background),r.style.setProperty("--color-success-hover",t.status.success.hover),r.style.setProperty("--color-success-light",t.status.success.light),r.style.setProperty("--color-warning",t.status.warning.background),r.style.setProperty("--color-warning-hover",t.status.warning.hover),r.style.setProperty("--color-warning-light",t.status.warning.light),r.style.setProperty("--color-error",t.status.error.background),r.style.setProperty("--color-error-hover",t.status.error.hover),r.style.setProperty("--color-error-light",t.status.error.light),r.style.setProperty("--color-interactive-hover",t.interactive.secondary.hover),r.style.setProperty("--color-interactive-active",t.interactive.secondary.active),r.style.setProperty("--color-backdrop",t.overlay.backdrop),r.style.setProperty("--color-modal",t.overlay.modal)})(a.theme)}),[a.theme]);return t.jsx(Ye.Provider,{value:{state:a,dispatch:s,setTheme:e=>{s({type:"SET_THEME",payload:e})}},children:r})}function Xe(){const t=e.useContext(Ye);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t}const Ze=[{id:"ai-assistant",label:"AI Assistant",icon:t.jsx(c,{className:"w-5 h-5"}),description:"Intelligent creative companion",action:"toggleAI",color:"text-purple-600",gradient:"from-purple-500 to-blue-500"},{id:"video-prompts",label:"Video Prompts",icon:t.jsx(d,{className:"w-5 h-5"}),description:"Generate video content ideas",action:"openVideoPrompts",color:"text-green-600",gradient:"from-green-500 to-emerald-500"},{id:"projects",label:"Project Manager",icon:t.jsx(m,{className:"w-5 h-5"}),description:"Manage your projects",action:"openProjectManager",color:"text-blue-600",gradient:"from-blue-500 to-cyan-500"},{id:"templates",label:"Templates",icon:t.jsx(p,{className:"w-5 h-5"}),description:"Browse project templates",action:"openTemplates",color:"text-orange-600",gradient:"from-orange-500 to-amber-500"},{id:"new-project",label:"New Project",icon:t.jsx(h,{className:"w-5 h-5"}),description:"Start fresh storyboard",action:"newProject",color:"text-green-600",gradient:"from-green-500 to-teal-500"},{id:"themes",label:"Theme Settings",icon:t.jsx(u,{className:"w-5 h-5"}),description:"Customize appearance",action:"openThemeSettings",color:"text-pink-600",gradient:"from-pink-500 to-rose-500"},{id:"settings",label:"Settings",icon:t.jsx(g,{className:"w-5 h-5"}),description:"App preferences",action:"openSettings",color:"text-gray-600",gradient:"from-gray-500 to-slate-500"},{id:"user-guide",label:"User Guide",icon:t.jsx(y,{className:"w-5 h-5"}),description:"Learn how to use the app",action:"openUserGuide",color:"text-indigo-600",gradient:"from-indigo-500 to-purple-500"}];function et({isOpen:r,onClose:a,onNavigate:s,currentSection:c}){const[d,m]=e.useState(!1),[p,h]=e.useState(-1),{state:u}=Xe(),g=e.useRef(null),y=e.useRef(null);e.useEffect((()=>{if(!r)return;const e=e=>{"Escape"===e.key?x():"ArrowDown"===e.key?(e.preventDefault(),h((e=>(e+1)%Ze.length))):"ArrowUp"===e.key?(e.preventDefault(),h((e=>e<=0?Ze.length-1:e-1))):"Enter"===e.key&&p>=0&&(e.preventDefault(),f(Ze[p].action))},t=e=>{g.current&&!g.current.contains(e.target)&&x()};return document.addEventListener("keydown",e),document.addEventListener("mousedown",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("mousedown",t)}}),[r,p]),e.useEffect((()=>{r&&g.current&&(g.current.focus(),h(-1))}),[r]);const x=()=>{m(!0),setTimeout((()=>{a(),m(!1),h(-1)}),200)},f=e=>{s(e),x()};return r||d?t.jsxs("div",{className:"fixed inset-0 z-50 hidden md:block",children:[t.jsx("div",{ref:y,className:"absolute inset-0 transition-all duration-200 animate-nav-backdrop-fade "+(r&&!d?"bg-black/30 backdrop-blur-sm":"bg-black/0 backdrop-blur-none"),onClick:x}),t.jsxs("div",{ref:g,tabIndex:-1,className:"absolute top-16 left-6 w-80 max-h-[calc(100vh-80px)] rounded-xl shadow-2xl border transform transition-all duration-200 ease-out animate-nav-slide-in "+(r&&!d?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95"),style:{backgroundColor:u.theme.colors.background.primary,borderColor:u.theme.colors.border.primary,boxShadow:`0 20px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px ${u.theme.colors.border.primary}`},children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b rounded-t-xl",style:{background:`linear-gradient(135deg, ${u.theme.colors.primary[600]}, ${u.theme.colors.primary[700]})`,borderColor:u.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"rgba(255, 255, 255, 0.2)"},children:t.jsx(o,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-bold text-lg text-white",children:"Navigation"}),t.jsx("p",{className:"text-white/80 text-sm",children:"Quick access menu"})]})]}),t.jsx("button",{onClick:x,className:"w-10 h-10 rounded-lg flex items-center justify-center transition-colors hover:bg-white/20 text-white",style:{backgroundColor:"rgba(255, 255, 255, 0.1)"},"aria-label":"Close navigation menu",children:t.jsx(n,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto scrollable",children:[t.jsx("div",{className:"p-4 space-y-2",children:Ze.map(((e,r)=>t.jsxs("button",{onClick:()=>f(e.action),onMouseEnter:()=>h(r),onMouseLeave:()=>h(-1),className:`w-full flex items-center space-x-4 p-4 rounded-xl transition-all duration-200 border-2 group animate-menu-item-entrance transform-gpu ${p===r?"transform scale-105 shadow-lg":"hover:transform hover:scale-102 hover:shadow-md"} ${c===e.id?"shadow-lg":"border-transparent"}`,style:{animationDelay:30*r+"ms",backgroundColor:p===r||c===e.id?`${u.theme.colors.primary[100]}`:u.theme.colors.background.secondary,borderColor:p===r||c===e.id?u.theme.colors.primary[300]:"transparent"},"aria-label":`${e.label}: ${e.description}`,children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-sm transition-all duration-200",style:{background:p===r||c===e.id?`linear-gradient(135deg, ${u.theme.colors.primary[500]}, ${u.theme.colors.primary[600]})`:u.theme.colors.background.primary,color:p===r||c===e.id?"white":u.theme.colors.text.secondary},children:e.icon}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("h3",{className:"font-semibold text-sm",style:{color:p===r||c===e.id?u.theme.colors.primary[700]:u.theme.colors.text.primary},children:e.label}),t.jsx("p",{className:"text-xs",style:{color:u.theme.colors.text.tertiary},children:e.description})]}),t.jsx(i,{className:"w-4 h-4 transition-all duration-200 "+(p===r?"translate-x-1 opacity-100":"opacity-40"),style:{color:p===r||c===e.id?u.theme.colors.primary[600]:u.theme.colors.text.tertiary}}),c===e.id&&t.jsx("div",{className:"absolute right-2 w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:u.theme.colors.primary[500]}})]},e.id)))}),t.jsx("div",{className:"p-4 mt-4 border-t",style:{borderColor:u.theme.colors.border.primary},children:t.jsxs("div",{className:"rounded-xl p-4 text-center",style:{backgroundColor:`${u.theme.colors.primary[50]}`,border:`1px solid ${u.theme.colors.primary[200]}`},children:[t.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[t.jsx(l,{className:"w-4 h-4",style:{color:u.theme.colors.primary[600]}}),t.jsx("span",{className:"font-medium text-sm",style:{color:u.theme.colors.primary[800]},children:"Pro Tip"})]}),t.jsx("p",{className:"text-xs",style:{color:u.theme.colors.primary[700]},children:"Use keyboard arrows and Enter to navigate, or Escape to close"})]})})]})]})]}):null}function tt({onToggleAI:r,isAIOpen:a,viewMode:s="grid",onViewModeChange:o,onOpenTemplates:n,onOpenProjectManager:i,onOpenThemeSettings:d,onOpenSettings:p,onOpenUserGuide:C,onOpenExportDialog:S,currentSection:A,onToggleMobileDrawer:I,isMobileDrawerOpen:P}){const{state:T,dispatch:E}=qe(),{state:D}=Xe(),[$,M]=e.useState(!1),O=()=>{confirm("Create a new project? This will clear your current storyboard.")&&E({type:"SET_PROJECT",payload:{id:"new-project-"+Date.now(),title:"New Storyboard Project",description:"A fresh start for your story",panels:[],createdAt:new Date,updatedAt:new Date}})};return t.jsxs("header",{className:"h-14 sm:h-16 border-b flex items-center justify-between px-3 sm:px-6 animate-slide-in",style:{backgroundColor:D.theme.colors.background.primary,borderColor:D.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-6",children:[t.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[t.jsx("button",{onClick:()=>{window.innerWidth<768?null==I||I():M(!$),navigator.vibrate&&navigator.vibrate(50)},className:"hamburger-menu-button w-10 h-10 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center transition-all duration-300 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 transform-gpu "+($||P?"active bg-primary-500 text-white shadow-lg animate-hamburger-active-glow":"hover:bg-secondary text-secondary-theme hover:shadow-md"),style:{backgroundColor:$||P?D.theme.colors.primary[500]:"transparent",color:$||P?"#ffffff":D.theme.colors.text.secondary},title:"Navigation Menu","aria-label":"Toggle navigation menu","aria-expanded":$||P,children:t.jsx(x,{className:"w-5 sm:w-6 h-5 sm:h-6 transition-all duration-300 transform-gpu "+($||P?"rotate-90 scale-110":"rotate-0 scale-100")})}),t.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[t.jsxs("h1",{className:"text-base sm:text-xl font-bold text-high-contrast hover:text-secondary-theme transition-colors duration-300",style:{color:D.theme.colors.text.primary},children:[t.jsx("span",{className:"hidden xs:inline",children:"Storyboard"})," AI"]}),t.jsx(l,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-pulse",style:{color:D.theme.colors.primary[500]}}),($||P)&&t.jsxs("div",{className:"hidden md:flex items-center space-x-1 px-2 py-1 rounded-md bg-primary-100 text-primary-700 text-xs font-medium animate-fade-in",children:[t.jsx("span",{children:"Menu Open"}),t.jsx("kbd",{className:"px-1 py-0.5 bg-white rounded text-xs",children:"ESC"})]})]})]}),o&&t.jsxs("div",{className:"hidden md:flex items-center bg-secondary rounded-lg p-1",children:[t.jsxs("button",{onClick:()=>o("grid"),className:"flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 "+("grid"===s?"bg-primary text-primary shadow-md":"text-secondary hover:text-primary"),children:[t.jsx(f,{className:"w-5 h-5"}),t.jsx("span",{className:"hidden lg:inline",children:"Grid"})]}),t.jsxs("button",{onClick:()=>o("timeline"),className:"flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium transition-all duration-300 "+("timeline"===s?"bg-primary text-primary shadow-md":"text-secondary hover:text-primary"),children:[t.jsx(b,{className:"w-5 h-5"}),t.jsx("span",{className:"hidden lg:inline",children:"Timeline"})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-1 bg-secondary rounded-lg p-1 sm:p-1",children:[t.jsx("button",{id:"quick-save-btn",onClick:async()=>{if(!T.currentProject)return void alert("No project to save");const e=document.getElementById("quick-save-btn");e&&e.classList.add("animate-pulse");try{const t={...T.currentProject,panels:T.panels,updatedAt:new Date};if(E({type:"SET_PROJECT",payload:t}),e){e.classList.remove("animate-pulse"),e.classList.add("animate-wiggle");const t=e.innerHTML;e.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',setTimeout((()=>{e.innerHTML=t,e.classList.remove("animate-wiggle")}),2e3)}console.log("✅ Quick save successful:",t.title)}catch(t){console.error("❌ Quick save failed:",t),e&&(e.classList.remove("animate-pulse"),e.classList.add("animate-bounce"),setTimeout((()=>{e.classList.remove("animate-bounce")}),1e3)),alert("Failed to save project. Please try again.")}},className:"btn-secondary p-2 sm:p-2 hover:bg-green-100 hover:text-green-700 transition-all duration-300",title:"Quick save",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(v,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),t.jsx("button",{id:"quick-import-btn",onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];if(!r)return;const a=document.getElementById("quick-import-btn");try{a&&a.classList.add("animate-pulse");const e=new FileReader;e.onload=async e=>{var t;try{const r=null==(t=e.target)?void 0:t.result,s=JSON.parse(r);let o=null;if(s.project)o=s.project;else{if(!(s.id&&s.title&&s.panels))throw new Error("Invalid project file format");o=s}if(!o.id||!o.title||!Array.isArray(o.panels))throw new Error("Project file is missing required fields (id, title, panels)");if(o.createdAt=o.createdAt?new Date(o.createdAt):new Date,o.updatedAt=o.updatedAt?new Date(o.updatedAt):new Date,o.panels=o.panels.map(((e,t)=>({id:e.id||`imported-panel-${Date.now()}-${t}`,title:e.title||`Imported Panel ${t+1}`,description:e.description||"",imageUrl:e.imageUrl,videoUrl:e.videoUrl,videoPrompt:e.videoPrompt||e.aiGeneratedPrompt,aiGeneratedPrompt:e.aiGeneratedPrompt||e.videoPrompt,shotType:e.shotType||"medium-shot",cameraAngle:e.cameraAngle||"eye-level",notes:e.notes||"",duration:"number"==typeof e.duration?e.duration:3,order:t,createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:e.updatedAt?new Date(e.updatedAt):new Date}))),E({type:"SET_PROJECT",payload:o}),a){a.classList.remove("animate-pulse"),a.classList.add("animate-glow");const e=a.innerHTML;a.innerHTML='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',setTimeout((()=>{a.innerHTML=e,a.classList.remove("animate-glow")}),2e3)}console.log("✅ Project imported successfully:",o.title)}catch(r){console.error("❌ Import failed:",r),a&&(a.classList.remove("animate-pulse"),a.classList.add("animate-bounce"),setTimeout((()=>{a.classList.remove("animate-bounce")}),1e3)),alert(`Error importing project: ${r instanceof Error?r.message:"Invalid file format"}`)}},e.onerror=()=>{a&&a.classList.remove("animate-pulse"),alert("Error reading file. Please try again.")},e.readAsText(r)}catch(s){console.error("❌ Import setup failed:",s),a&&a.classList.remove("animate-pulse"),alert("Error setting up import. Please try again.")}},e.click()},className:"btn-secondary p-2 sm:p-2 hover:bg-purple-100 hover:text-purple-700 transition-all duration-300",title:"Import project",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(w,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),t.jsx("button",{id:"quick-export-btn",onClick:S,className:"btn-secondary p-2 sm:p-2 hover:bg-blue-100 hover:text-blue-700 transition-all duration-300",title:"Export project",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(j,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}),t.jsxs("div",{className:"hidden md:flex items-center space-x-1 bg-secondary rounded-lg p-1",children:[t.jsx("button",{onClick:i,className:"btn-secondary p-2 hover:bg-blue-100 hover:text-blue-700 transition-all duration-300",title:"Project Manager",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(m,{className:"w-5 h-5"})}),t.jsx("button",{onClick:n,className:"btn-secondary p-2 hover:bg-purple-100 hover:text-purple-700 transition-all duration-300",title:"Templates",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(N,{className:"w-5 h-5"})}),t.jsx("button",{onClick:O,className:"btn-secondary p-2 hover:bg-green-100 hover:text-green-700 transition-all duration-300",title:"New Project",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(h,{className:"w-5 h-5"})}),t.jsx("button",{onClick:C,className:"btn-secondary p-2 hover:bg-indigo-100 hover:text-indigo-700 transition-all duration-300",title:"User Guide",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(y,{className:"w-5 h-5"})}),t.jsx("button",{onClick:d,className:"btn-secondary p-2 hover:bg-pink-100 hover:text-pink-700 transition-all duration-300",title:"Theme Settings",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(u,{className:"w-5 h-5"})}),t.jsx("button",{onClick:p,className:"btn-secondary p-2 hover:bg-gray-100 hover:text-gray-700 transition-all duration-300",title:"Settings",style:{backgroundColor:D.theme.colors.background.tertiary,color:D.theme.colors.text.secondary},children:t.jsx(g,{className:"w-5 h-5"})})]}),t.jsxs("button",{onClick:r,className:"relative flex items-center space-x-1 sm:space-x-2 px-3 sm:px-4 py-2 sm:py-2 rounded-lg font-medium transition-all duration-300 "+(a?"bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg":"bg-secondary text-secondary hover:bg-tertiary hover:text-primary"),style:{background:a?`linear-gradient(to right, ${D.theme.colors.primary[600]}, ${D.theme.colors.primary[700]})`:D.theme.colors.background.tertiary,color:a?"#ffffff":D.theme.colors.text.secondary},children:[t.jsx(k,{className:"w-4 h-4 sm:w-5 sm:h-5"}),t.jsx(c,{className:"w-4 h-4 sm:w-5 sm:h-5"}),t.jsx("span",{className:"hidden sm:inline",children:"AI Assistant"}),t.jsx("span",{className:"text-xs sm:hidden",children:"AI"}),a&&t.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-ping",style:{backgroundColor:D.theme.colors.primary[400]}})]})]}),t.jsx(et,{isOpen:$,onClose:()=>M(!1),onNavigate:e=>{switch(e){case"openTemplates":null==n||n();break;case"openProjectManager":null==i||i();break;case"openThemeSettings":null==d||d();break;case"openSettings":null==p||p();break;case"openUserGuide":null==C||C();break;case"toggleAI":r();break;case"newProject":O();break;default:console.log("Unknown navigation action:",e)}},currentSection:A})]})}function rt({onNewProject:r,onOpenTemplates:a,onToggleAI:s,onGenerateVideoPrompts:o,onOpenProjectManager:n,onOpenSettings:i}){const{state:c,dispatch:p}=qe(),{state:u}=Xe(),[y,x]=e.useState("current"),[f,w]=e.useState([]),[j,E]=e.useState(!1),[D,$]=e.useState(""),[M,O]=e.useState({}),[L,F]=e.useState(null);e.useEffect((()=>{(async()=>{try{const e=await Ue.getAllProjects();w(e)}catch(e){console.error("Error loading projects:",e),w([])}})()}),[]),e.useEffect((()=>{(async()=>{try{const e=await Ue.getAllProjects();w(e)}catch(e){console.error("Error refreshing projects:",e)}})()}),[c.currentProject]),e.useEffect((()=>{c.currentProject&&($(c.currentProject.directorNotes||""),O(c.currentProject.videoStyle||{}))}),[c.currentProject]);const z=e=>{x(y===e?"":e)},R=f.sort(((e,t)=>{try{const r=e.lastOpened?new Date(e.lastOpened):new Date(e.updatedAt);return(t.lastOpened?new Date(t.lastOpened):new Date(t.updatedAt)).getTime()-r.getTime()}catch(r){return console.error("Error sorting projects:",r),0}})).slice(0,5);return f.filter((e=>e.isFavorite)),t.jsxs("aside",{className:"w-80 border-r flex flex-col h-full max-h-screen overflow-hidden",style:{backgroundColor:u.theme.colors.background.primary,borderColor:u.theme.colors.border.primary},children:[t.jsxs("div",{className:"p-6 border-b",style:{backgroundColor:u.theme.colors.background.secondary,borderColor:u.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center shadow-lg",style:{background:`linear-gradient(135deg, ${u.theme.colors.primary[600]}, ${u.theme.colors.primary[500]})`},children:t.jsx(N,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-bold text-primary-theme",children:"Project Hub"}),t.jsx("p",{className:"text-sm text-secondary-theme",children:"Manage your stories"})]})]}),t.jsxs("div",{className:"px-4 py-4 flex flex-wrap gap-2",children:[t.jsxs("button",{onClick:r,className:"flex-1 flex flex-col items-center justify-center p-3 rounded-xl transition-all duration-300 transform hover:scale-105",style:{backgroundColor:u.theme.colors.background.secondary,color:u.theme.colors.text.primary,borderWidth:"1px",borderStyle:"solid",borderColor:u.theme.colors.border.primary},children:[t.jsx(h,{className:"w-6 h-6 mb-1",style:{color:u.theme.colors.primary[500]}}),t.jsx("span",{className:"text-xs font-medium",children:"New"})]}),t.jsxs("button",{onClick:a,className:"flex-1 flex flex-col items-center justify-center p-3 rounded-xl transition-all duration-300 transform hover:scale-105",style:{backgroundColor:u.theme.colors.background.secondary,color:u.theme.colors.text.primary,borderWidth:"1px",borderStyle:"solid",borderColor:u.theme.colors.border.primary},children:[t.jsx(N,{className:"w-6 h-6 mb-1",style:{color:u.theme.colors.primary[500]}}),t.jsx("span",{className:"text-xs font-medium",children:"Templates"})]}),t.jsxs("button",{onClick:s,className:"flex-1 flex flex-col items-center justify-center p-3 rounded-xl transition-all duration-300 transform hover:scale-105",style:{backgroundColor:u.theme.colors.background.secondary,color:u.theme.colors.text.primary,borderWidth:"1px",borderStyle:"solid",borderColor:u.theme.colors.border.primary},children:[t.jsx(l,{className:"w-6 h-6 mb-1",style:{color:u.theme.colors.primary[500]}}),t.jsx("span",{className:"text-xs font-medium",children:"AI Help"})]}),t.jsxs("button",{onClick:o,className:"flex-1 flex flex-col items-center justify-center p-3 rounded-xl transition-all duration-300 transform hover:scale-105",style:{backgroundColor:u.theme.colors.background.secondary,color:u.theme.colors.text.primary,borderWidth:"1px",borderStyle:"solid",borderColor:u.theme.colors.border.primary},children:[t.jsx(b,{className:"w-6 h-6 mb-1",style:{color:u.theme.colors.primary[500]}}),t.jsx("span",{className:"text-xs font-medium",children:"Video"})]})]})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto scrollable p-4",children:[t.jsxs("div",{className:"mb-4",children:[t.jsxs("button",{onClick:()=>z("current"),className:"w-full flex items-center justify-between p-3 rounded-lg mb-2",style:{backgroundColor:"current"===y?u.theme.colors.primary[100]:"transparent",color:"current"===y?u.theme.colors.primary[700]:u.theme.colors.text.primary},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(C,{className:"w-5 h-5",style:{color:"current"===y?u.theme.colors.primary[600]:u.theme.colors.text.secondary}}),t.jsx("span",{className:"font-medium",children:"Current Project"})]}),"current"===y?t.jsx(S,{className:"w-5 h-5",style:{color:u.theme.colors.primary[500]}}):t.jsx(A,{className:"w-5 h-5",style:{color:u.theme.colors.text.secondary}})]}),"current"===y&&c.currentProject&&t.jsxs("div",{className:"p-4 rounded-xl border mb-2 transition-all duration-300",style:{backgroundColor:u.theme.colors.background.secondary,borderColor:u.theme.colors.border.primary},children:[t.jsx("h3",{className:"font-medium mb-1",style:{color:u.theme.colors.text.primary},children:c.currentProject.title}),t.jsx("p",{className:"text-sm mb-3",style:{color:u.theme.colors.text.secondary},children:c.currentProject.description||"No description provided"}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{className:"text-xs",style:{color:u.theme.colors.text.tertiary},children:[c.panels.length," panel",1!==c.panels.length?"s":""]}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:n,className:"flex items-center justify-center p-2 rounded-lg transition-all duration-300",style:{backgroundColor:u.theme.colors.background.tertiary,color:u.theme.colors.text.secondary},children:t.jsx(m,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>E(!j),className:"flex items-center justify-center p-2 rounded-lg transition-all duration-300",style:{backgroundColor:j?u.theme.colors.primary[100]:u.theme.colors.background.tertiary,color:j?u.theme.colors.primary[600]:u.theme.colors.text.secondary},children:t.jsx(I,{className:"w-4 h-4"})})]})]})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsxs("button",{onClick:()=>z("recent"),className:"w-full flex items-center justify-between p-3 rounded-lg mb-2",style:{backgroundColor:"recent"===y?u.theme.colors.primary[100]:"transparent",color:"recent"===y?u.theme.colors.primary[700]:u.theme.colors.text.primary},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(P,{className:"w-5 h-5",style:{color:"recent"===y?u.theme.colors.primary[600]:u.theme.colors.text.secondary}}),t.jsx("span",{className:"font-medium",children:"Recent Projects"})]}),"recent"===y?t.jsx(S,{className:"w-5 h-5",style:{color:u.theme.colors.primary[500]}}):t.jsx(A,{className:"w-5 h-5",style:{color:u.theme.colors.text.secondary}})]}),"recent"===y&&R.length>0&&t.jsx("div",{className:"space-y-2",children:R.map((e=>{var r,a,s,o,n;return t.jsxs("div",{className:"p-3 rounded-lg flex items-center justify-between cursor-pointer hover:shadow-sm transition-all duration-300",style:{backgroundColor:(null==(r=c.currentProject)?void 0:r.id)===e.id?u.theme.colors.primary[50]:u.theme.colors.background.secondary,borderLeft:`3px solid ${(null==(a=c.currentProject)?void 0:a.id)===e.id?u.theme.colors.primary[500]:"transparent"}`},onClick:()=>(e=>{const t={...e,lastOpened:new Date};p({type:"SET_PROJECT",payload:t}),Ue.getAllProjects().then(w).catch(console.error)})(e),onMouseEnter:()=>F(e.id),onMouseLeave:()=>F(null),children:[t.jsxs("div",{className:"flex-1 overflow-hidden",children:[t.jsx("h4",{className:"font-medium truncate",style:{color:u.theme.colors.text.primary},children:e.title}),t.jsxs("p",{className:"text-xs truncate",style:{color:u.theme.colors.text.tertiary},children:[(null==(s=e.panels)?void 0:s.length)||0," panel",1!==((null==(o=e.panels)?void 0:o.length)||0)?"s":""," • Last modified ",new Date(e.updatedAt).toLocaleDateString()]})]}),L===e.id&&(null==(n=c.currentProject)?void 0:n.id)!==e.id&&t.jsx("button",{onClick:t=>{t.stopPropagation(),(async e=>{var t;if(confirm("Are you sure you want to delete this project? This action cannot be undone."))try{await Ue.deleteProject(e);const r=await Ue.getAllProjects();if(w(r),(null==(t=c.currentProject)?void 0:t.id)===e){const e={id:"empty-"+Date.now(),title:"New Project",description:"Start creating your story",panels:[],createdAt:new Date,updatedAt:new Date};p({type:"SET_PROJECT",payload:e})}}catch(r){console.error("Error deleting project:",r),alert("Failed to delete project. Please try again.")}})(e.id)},className:"p-2 rounded-full opacity-70 hover:opacity-100 transition-opacity",style:{color:u.theme.colors.text.secondary},children:t.jsx(T,{className:"w-4 h-4"})})]},e.id)}))})]}),c.currentProject&&t.jsxs("div",{className:"mb-4",children:[t.jsxs("button",{onClick:()=>z("notes"),className:"w-full flex items-center justify-between p-3 rounded-lg mb-2",style:{backgroundColor:"notes"===y?u.theme.colors.primary[100]:"transparent",color:"notes"===y?u.theme.colors.primary[700]:u.theme.colors.text.primary},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(I,{className:"w-5 h-5",style:{color:"notes"===y?u.theme.colors.primary[600]:u.theme.colors.text.secondary}}),t.jsx("span",{className:"font-medium",children:"Director's Notes"})]}),"notes"===y?t.jsx(S,{className:"w-5 h-5",style:{color:u.theme.colors.primary[500]}}):t.jsx(A,{className:"w-5 h-5",style:{color:u.theme.colors.text.secondary}})]}),"notes"===y&&t.jsxs("div",{className:"space-y-3 p-3 rounded-lg",style:{backgroundColor:u.theme.colors.background.secondary},children:[t.jsx("textarea",{value:D,onChange:e=>$(e.target.value),placeholder:"Add director's notes, character details, or story guidelines...",className:"w-full h-20 rounded-lg p-2 text-sm",style:{backgroundColor:u.theme.colors.background.primary,borderColor:u.theme.colors.border.primary,color:u.theme.colors.text.primary}}),t.jsxs("button",{onClick:()=>{if(!c.currentProject)return;const e={...c.currentProject,panels:c.panels,directorNotes:D,videoStyle:M,updatedAt:new Date};p({type:"SET_PROJECT",payload:e}),Ue.getAllProjects().then(w).catch(console.error);const t=document.querySelector("[data-save-notes]");if(t){const e=t.textContent;t.textContent="✅ Saved!",t.classList.add("animate-pulse"),t.disabled=!0,setTimeout((()=>{t.textContent=e,t.classList.remove("animate-pulse"),t.disabled=!1}),2e3)}},"data-save-notes":!0,className:"w-full py-2 rounded-lg text-sm font-medium flex items-center justify-center space-x-2",style:{backgroundColor:u.theme.colors.primary[500],color:"#ffffff"},children:[t.jsx(v,{className:"w-4 h-4"}),t.jsx("span",{children:"Save Notes"})]})]})]}),t.jsxs("div",{className:"p-4 animate-fade-in animate-delay-300",children:[t.jsxs("button",{onClick:()=>z("tools"),className:"w-full flex items-center justify-between mb-4 text-primary-theme hover:text-secondary-theme transition-all duration-300 p-2 rounded-lg hover:bg-tertiary/50",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shadow-md",style:{background:`linear-gradient(135deg, ${u.theme.colors.primary[500]}, ${u.theme.colors.primary[700]})`},children:t.jsx(C,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold text-sm",children:"Creative Tools"}),t.jsx("p",{className:"text-xs text-secondary-theme",children:"AI powered features"})]})]}),"tools"===y?t.jsx(S,{className:"w-5 h-5 transition-transform duration-300"}):t.jsx(A,{className:"w-5 h-5 transition-transform duration-300"})]}),"tools"===y&&t.jsxs("div",{className:"space-y-3 animate-slide-in-bottom",children:[t.jsxs("button",{onClick:s,className:"w-full flex items-center space-x-3 card-interactive p-3 text-sm hover:scale-105 animate-fade-in animate-delay-100",style:{background:`linear-gradient(135deg, ${u.theme.colors.background.secondary}, ${u.theme.colors.background.tertiary})`,borderColor:u.theme.colors.border.primary},children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center shadow-md",children:t.jsx(k,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"font-medium text-primary-theme",children:"AI Assistant"}),t.jsx("div",{className:"text-xs text-secondary-theme",children:"Generate content & ideas"})]})]}),t.jsxs("button",{onClick:o,className:"w-full flex items-center space-x-3 card-interactive p-3 text-sm hover:scale-105 animate-fade-in animate-delay-200",style:{background:`linear-gradient(135deg, ${u.theme.colors.background.secondary}, ${u.theme.colors.background.tertiary})`,borderColor:u.theme.colors.border.primary},children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-green-500 to-teal-600 flex items-center justify-center shadow-md",children:t.jsx(d,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"font-medium text-primary-theme",children:"Video Prompts"}),t.jsx("div",{className:"text-xs text-secondary-theme",children:"Generate video descriptions"})]})]}),t.jsxs("button",{onClick:a,className:"w-full flex items-center space-x-3 card-interactive p-3 text-sm hover:scale-105 animate-fade-in animate-delay-300",style:{background:`linear-gradient(135deg, ${u.theme.colors.background.secondary}, ${u.theme.colors.background.tertiary})`,borderColor:u.theme.colors.border.primary},children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-gradient-to-br from-orange-500 to-pink-600 flex items-center justify-center shadow-md",children:t.jsx(I,{className:"w-4 h-4 text-white"})}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("div",{className:"font-medium text-primary-theme",children:"Templates"}),t.jsx("div",{className:"text-xs text-secondary-theme",children:"Pre-built storyboards"})]})]}),t.jsxs("button",{onClick:i,className:"w-full flex items-center space-x-3 btn-secondary text-sm py-3 hover:bg-gradient-to-r hover:from-indigo-100 hover:to-purple-100",children:[t.jsx(g,{className:"w-5 h-5"}),t.jsx("span",{children:"Settings"})]})]})]})]})]})}var at=Object.defineProperty,st=(e,t,r)=>((e,t,r)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const ot=new class{constructor(){st(this,"openai",null),st(this,"isInitialized",!1),st(this,"thinkingStateListeners",[]),st(this,"thinkingState",{active:!1,content:"",stages:[]}),this.initializeOpenAI()}patchURLConstructor(){try{const e=window.URL;window.URL=class extends e{constructor(e,t){try{super(e,t)}catch(r){if("string"!=typeof e||!e.startsWith("/openai-proxy")&&!e.startsWith("/image-proxy"))throw r;console.log("🔧 Fixing relative URL:",e),super(e,window.location.origin)}}},console.log("✅ URL constructor patched for OpenAI SDK compatibility")}catch(e){console.error("❌ Failed to patch URL constructor:",e)}}initializeOpenAI(){this.patchURLConstructor();try{const e=Ue.getSettings();e.openaiApiKey?(this.openai=new Ie({apiKey:e.openaiApiKey,dangerouslyAllowBrowser:!0,timeout:6e4,maxRetries:2,baseURL:"https://api.openai.com",defaultHeaders:{"X-Custom-Header":"Using direct API with proxy"},fetch:async(e,t)=>{const r=e.toString();let a;if(r.includes("/v1/"))a=r.replace("https://api.openai.com",window.location.origin+"/openai-proxy");else if("https://api.openai.com"===r||"https://api.openai.com/"===r)a=window.location.origin+"/openai-proxy/v1";else{const e=r.replace("https://api.openai.com","");a=window.location.origin+"/openai-proxy/v1"+e}return console.log("🔄 Proxying OpenAI request to:",a),fetch(a,t)}}),this.isInitialized=!0,console.log("✅ OpenAI service initialized successfully")):console.warn("⚠️ No OpenAI API key found in settings")}catch(e){console.error("❌ Failed to initialize OpenAI:",e),this.openai=null,this.isInitialized=!1}}setApiKey(e){Ue.saveSettings({openaiApiKey:e}),this.initializeOpenAI()}getApiKey(){return Ue.getSettings().openaiApiKey}setSearchApiKey(e){Ue.saveSettings({searchApiKey:e})}getSearchApiKey(){return Ue.getSettings().searchApiKey}isReady(){return this.isInitialized&&null!==this.openai}addThinkingStateListener(e){this.thinkingStateListeners.push(e)}removeThinkingStateListener(e){this.thinkingStateListeners=this.thinkingStateListeners.filter((t=>t!==e))}updateThinkingState(e){this.thinkingState={...this.thinkingState,...e},this.thinkingStateListeners.forEach((e=>e(this.thinkingState)))}startThinking(){this.updateThinkingState({active:!0,content:"Thinking...\n",stages:["Analyzing request"]})}appendThinking(e){this.updateThinkingState({content:this.thinkingState.content+e+"\n"})}addThinkingStage(e){this.updateThinkingState({stages:[...this.thinkingState.stages,e]})}endThinking(){this.updateThinkingState({active:!1,stages:[...this.thinkingState.stages,"Completed"]}),setTimeout((()=>{this.thinkingState.active||this.updateThinkingState({content:"",stages:[]})}),5e3)}async searchWeb(e,t=5){var r,a;try{if(this.addThinkingStage(`Searching web for: "${e}"`),this.appendThinking(`Running web search for: "${e}"...`),!this.isReady())return this.appendThinking("❌ OpenAI API not initialized"),[];Ue.getSettings();const o="gpt-4o",n=await this.openai.chat.completions.create({model:o,messages:[{role:"system",content:`Search the web for: "${e}". Return the most relevant information as a JSON object with an array of results. Each result should have title, url, and description fields.`},{role:"user",content:`Please search for: "${e}" and return ${t} relevant results.`}],response_format:{type:"json_object"},tools:[{type:"function",function:{name:"web_search",description:"Search the web for real-time information",parameters:{type:"object",properties:{search_query:{type:"string",description:"The search query to look up on the web"}},required:["search_query"]}}}],tool_choice:{type:"function",function:{name:"web_search"}}}),i=[];if(n.choices&&(null==(a=null==(r=n.choices[0])?void 0:r.message)?void 0:a.content))try{const e=n.choices[0].message.content,t=JSON.parse(e);t&&Array.isArray(t.results)&&t.results.forEach((e=>{i.push({title:e.title||"No title",url:e.url||"#",description:e.description||"No description"})}))}catch(s){console.error("Error parsing web search results:",s)}return this.appendThinking(`✅ Found ${i.length} results`),i.length>0&&(this.appendThinking("Search results summary:"),i.slice(0,3).forEach(((e,t)=>{this.appendThinking(`${t+1}. ${e.title}`)})),i.length>3&&this.appendThinking(`...and ${i.length-3} more results`)),i}catch(s){return console.error("Error during web search:",s),this.appendThinking(`❌ Web search error: ${s instanceof Error?s.message:String(s)}`),[]}}createSystemPrompt(e){return`${e.agentPersonality||"You're a friendly, experienced film director and storyboard artist who can actually help create and modify storyboards. You talk like a real person and can take action when users ask for help."}\n\nCurrent project: "${e.projectTitle}" - ${e.projectDescription}\n${e.directorNotes?`Director's vision: "${e.directorNotes}"`:"No director notes yet"}\n\nWhat you're working with:\n${e.allPanels.length>0?`${e.allPanels.length} panels so far:\n`+e.allPanels.slice(0,3).map((e=>`• Panel ${e.number}: ${e.title} - ${e.description}`)).join("\n")+(e.allPanels.length>3?`\n• ...and ${e.allPanels.length-3} more`:""):"No panels yet - blank canvas!"}\n\nCRITICAL: When users ask you to DO something (create, add, edit, generate, modify, change, update, remove, delete, analyze), you MUST include action commands. ALWAYS respond with both conversation AND action!\n\n🚨 BATCH OPERATIONS PRIORITY: When users say words like "ALL", "EVERY", "EVERYTHING", "ENTIRE", "WHOLE", or want to modify multiple panels, USE BATCH ACTIONS!\n\nAction format: [ACTION:action_type:parameters]\n\n📋 SINGLE PANEL ACTIONS:\n• [ACTION:generate_storyboard:story description] - When users want to create/generate/make storyboards\n• [ACTION:add_panel:scene description] - When users want to add/create new scenes/panels  \n• [ACTION:edit_panel:panel X: instructions] - When users want to edit/modify/change ONE specific panel (X is panel number)\n• [ACTION:remove_panel:panel X] - When users want to remove/delete panels (X is panel number)\n• [ACTION:analyze_storyboard] - When users want analysis/feedback on current storyboard\n• [ACTION:generate_video_prompts] - When users want video prompts created\n• [ACTION:update_director_notes:new notes text] - When users want to update project vision\n\n🎬 BATCH/MULTIPLE PANEL ACTIONS (USE THESE FOR "ALL", "EVERY", "WHOLE" REQUESTS):\n• [ACTION:batch_edit:instructions] - Edit ALL panels with same instructions\n• [ACTION:batch_edit_range:start:end:instructions] - Edit specific range (e.g., 2:5:make these panels more dramatic)\n• [ACTION:batch_apply_style:style_type:style_instructions] - Apply consistent style to ALL panels\n• [ACTION:enhance_all_cinematography:instructions] - Enhance cinematography across ALL panels\n• [ACTION:standardize_shot_types:instructions] - Standardize shot progression across ALL panels\n\nPANEL EDITING SPECIFICS:\n• When editing a specific panel, use format: [ACTION:edit_panel:panel 3: make this scene more dramatic]\n• When removing a specific panel, use format: [ACTION:remove_panel:panel 3]\n• For batch range, use format: [ACTION:batch_edit_range:2:5:make these panels more dramatic] (first panel is 1)\n\nBATCH DETECTION KEYWORDS - When you see these, USE BATCH ACTIONS:\n• "all panels", "every panel", "entire storyboard", "whole project" → [ACTION:batch_edit:instructions]\n• "all of them", "everything", "the whole thing" → [ACTION:batch_edit:instructions]\n• "make them all more..." → [ACTION:batch_edit:make all panels more...]\n• "apply X style to everything" → [ACTION:batch_apply_style:X:style instructions]\n• "enhance all", "improve all", "update all" → [ACTION:batch_edit:instructions]\n• "panels 1-3", "first few panels", "panels 2 to 5" → [ACTION:batch_edit_range:1:3:instructions]\n• "better cinematography for all" → [ACTION:enhance_all_cinematography:instructions]\n• "fix the shot types" → [ACTION:standardize_shot_types:instructions]\n\nEXAMPLES OF PROPER BATCH RESPONSES:\nUser: "Make all panels more dramatic"\nResponse: "Absolutely! I'll make every panel in your storyboard more dramatic with intense lighting and dynamic compositions. [ACTION:batch_edit:make all panels more dramatic with intense lighting, dynamic camera angles, and heightened emotional tension]"\n\nUser: "Apply horror movie style to everything"\nResponse: "Perfect! I'll transform your entire storyboard into horror movie style with dark atmosphere and suspenseful elements. [ACTION:batch_apply_style:horror:dark shadows, eerie lighting, suspenseful atmosphere, horror movie cinematography]"\n\nUser: "Make panels 2-4 more action-packed"\nResponse: "Great idea! I'll amp up the action in panels 2 through 4 with dynamic movement and energy. [ACTION:batch_edit_range:2:4:make these panels more action-packed with dynamic movement, fast-paced action, and energetic cinematography]"\n\nUser: "Enhance the cinematography for the whole storyboard"\nResponse: "Excellent! I'll enhance the cinematography across all your panels with professional techniques and visual variety. [ACTION:enhance_all_cinematography:apply professional cinematography techniques with varied shot types and dynamic camera work]"\n\n🎯 SINGLE PANEL EXAMPLES:\nUser: "Edit panel 3 to be more dramatic"\nResponse: "I'll make panel 3 much more dramatic for you! [ACTION:edit_panel:panel 3: make this scene more dramatic with intense lighting and dynamic camera angle]"\n\nUser: "Add a chase scene"\nResponse: "Great idea! I'll add an exciting chase scene to your storyboard. [ACTION:add_panel:thrilling car chase through busy city streets with close-up shots of determined faces]"\n\nUser: "Remove the last panel"\nResponse: "I'll remove the last panel from your storyboard. [ACTION:remove_panel:panel 6]"\n\nUser: "Edit the first panel"\nResponse: "I'll update the first panel for you. [ACTION:edit_panel:panel 1: enhance the opening scene with more dramatic composition]"\n\nIMPORTANT ACTION FORMAT RULES:\n1. ONE ACTION PER COMMAND - Do not combine multiple actions in one tag\n2. Always include the action type and parameters in the correct format\n3. For panel-specific actions, always specify the panel number when possible\n4. For batch operations on specific ranges, use the format start:end:instructions\n5. Always include normal conversational text alongside your action commands\n6. Make sure there's a space before and after your action tags for proper detection\n7. Never modify the [ACTION:type:params] format - it must be EXACTLY this format\n\nREMEMBER: \n- Be conversational AND include actions\n- ALWAYS use batch actions for "all/every/whole" requests\n- The action executes while your message displays\n- Never mix multiple operations in a single action tag\n- Don't be afraid to use batch operations - they're powerful!\n- ACTION TAGS MUST BE PROPERLY FORMATTED - system won't recognize them otherwise\n\n\nCRITICAL INSTRUCTION - ACTION USAGE REQUIRED:\nFor this application to function properly, it is ABSOLUTELY ESSENTIAL that you:\n\n1. ALWAYS format any storyboard modification with action tags [ACTION:type:params]\n2. NEVER respond with just conversation when user requests involve creating, editing, or modifying storyboards\n3. For every editing request, ALWAYS determine if it needs single-panel or batch operations\n4. CLEARLY identify panel numbers when editing specific panels \n5. Keep your action formats precise and correctly structured\n6. ALWAYS put a space between the action tag and surrounding text to ensure proper detection\n7. Use EXACT format [ACTION:type:params] with NO variations\n\n🚨 WITHOUT PROPERLY FORMATTED ACTION TAGS, THE APPLICATION CANNOT PERFORM THE REQUESTED OPERATIONS.\n\nFINAL CHECK: Before sending your response, verify your action tags are properly formatted with:\n- Square brackets: [ACTION:type:params]\n- Correct action type from the provided list\n- Proper parameters for the action type\n- Proper spacing around the action tag\n    `}async sendMessage(e,t,r){var a,s,o,n,i,l,c;if(!this.isReady())return this.generateFallbackResponse((null==(a=e[e.length-1])?void 0:a.content)||"");try{const a=null==(s=null==r?void 0:r.capabilities)?void 0:s.includes("thinking"),m=null==(o=null==r?void 0:r.capabilities)?void 0:o.includes("web_search");let p;if(a&&(this.startThinking(),this.appendThinking(`${r.name} is analyzing your request...`)),console.log("📤 Sending message to OpenAI with conversation length:",e.length),m){const r=(null==(n=e[e.length-1])?void 0:n.content)||"";if(this.messageNeedsSearch(r)){this.addThinkingStage("Identifying search queries");const e=await this.extractSearchQueries(r);if(e.length>0){this.addThinkingStage("Performing web searches");const r=await Promise.all(e.map((e=>this.searchWeb(e))));p=`${this.formatSearchResultsAsContext(e,r)}\n\n${this.createSystemPrompt(t)}`,this.addThinkingStage("Analyzing search results")}}}const h=Ue.getSettings(),u=m&&void 0!==p?"gpt-4o":(null==r?void 0:r.preferredModel)||h.aiModel||"gpt-4o-mini";a&&this.appendThinking(`Using ${u} to generate response...`),console.log("🤖 Using AI model from settings:",u);let g=m&&void 0!==p?p:this.createSystemPrompt(t);if(r&&(g=`${r.prompt}\n\n${g}`),(null==(i=null==r?void 0:r.capabilities)?void 0:i.includes("step_by_step"))&&(this.addThinkingStage("Generating step-by-step reasoning"),g=`${g}\n\nIMPORTANT: Show your step-by-step reasoning process FIRST, then provide your final response. Think carefully through each part of the problem.`),!a){return(await this.openai.chat.completions.create({model:u,messages:[{role:"system",content:g},...e],max_tokens:h.maxTokens||2500,temperature:h.temperature||.7,presence_penalty:.1,frequency_penalty:.2,user:"storyboard-assistant"})).choices[0].message.content||"Sorry, I couldn't generate a response."}if("gpt-4o-mini"!==u){this.addThinkingStage("Generating response (streaming)");const t=await this.openai.chat.completions.create({model:u,messages:[{role:"system",content:g},...e],max_tokens:h.maxTokens||2500,temperature:h.temperature||.7,stream:!0});let r="",a="";for await(const e of t){const t=(null==(c=null==(l=e.choices[0])?void 0:l.delta)?void 0:c.content)||"";t&&(r+=t,a+=t,(a.length>20||t.includes("\n"))&&(this.appendThinking(a),a=""))}return a&&this.appendThinking(a),this.endThinking(),r}{this.addThinkingStage("Generating response (non-streaming)"),this.appendThinking("Using non-streaming mode for gpt-4o-mini...");const t=setInterval((()=>{this.appendThinking(".")}),1e3);try{const r=await this.openai.chat.completions.create({model:u,messages:[{role:"system",content:g},...e],max_tokens:h.maxTokens||2500,temperature:h.temperature||.7,presence_penalty:.1,frequency_penalty:.2,user:"storyboard-assistant"});clearInterval(t);const a=r.choices[0].message.content||"Sorry, I couldn't generate a response.";return this.appendThinking("\nResponse generated successfully!"),this.endThinking(),a}catch(d){throw clearInterval(t),d}}}catch(d){return this.thinkingState.active&&(this.appendThinking(`❌ Error: ${d.message||"Unknown error"}`),this.endThinking()),console.error("❌ OpenAI API Error:",d),401===d.status?"It looks like your OpenAI API key is invalid. Please check your API key in the settings.":`I encountered an error: ${d.message||"Unknown error"}. Please try again or check your settings.`}}async extractSearchQueries(e){if(!this.isReady())return[];try{Ue.getSettings();const r="gpt-4o",a=(await this.openai.chat.completions.create({model:r,messages:[{role:"system",content:"Extract 1-3 search queries from the user message that would help answer their question. Return ONLY the search queries as a JSON array of strings. If no search is needed, return an empty array."},{role:"user",content:e}],response_format:{type:"json_object"}})).choices[0].message.content;if(a)try{const e=JSON.parse(a).queries||[];return this.appendThinking(`Extracted search queries: ${e.map((e=>`"${e}"`)).join(", ")}`),e}catch(t){return console.error("Error parsing search queries JSON:",t),[]}return[]}catch(r){return console.error("Error extracting search queries:",r),[]}}messageNeedsSearch(e){const t=e.toLowerCase(),r=["latest","recent","news","current","update","today","find","search","information about","tell me about","who is","what is","where is","when was","how to","trends","statistics","data on"].some((e=>t.includes(e.toLowerCase())));return r&&this.appendThinking("Message likely requires web search for up-to-date information"),r}formatSearchResultsAsContext(e,t){let r="### WEB SEARCH RESULTS\n\n";return e.forEach(((e,a)=>{const s=t[a]||[];r+=`SEARCH QUERY: "${e}"\n\n`,s.forEach(((e,t)=>{r+=`[${t+1}] ${e.title}\n`,r+=`URL: ${e.url}\n`,r+=`${e.description}\n\n`})),0===s.length&&(r+="No results found for this query.\n\n"),r+="---\n\n"})),r+="INSTRUCTIONS:\n",r+="- Use these search results when they're relevant to the user's request\n",r+="- If the search results don't contain relevant information, rely on your training\n",r+="- Always cite the source number like [1] when referencing information from the search results\n",r}async generateStoryboard(e,t=6,r="drama"){if(!this.isReady())return this.generateFallbackStoryboard(e,t);try{const s=Ue.getSettings(),o=s.aiModel||"gpt-4o-mini";console.log("🤖 Using AI model from settings for storyboard generation:",o);const n=`Create a professional ${t}-panel storyboard for this story idea:\n\n**Story**: ${e}\n**Genre**: ${r}\n**Panels**: ${t}\n\nRequirements for each panel:\n\n1. **TITLE**: Create compelling, specific titles that describe the key action/moment (NOT just "Panel X - Brief Title")\n   - Good: "Hero Discovers Ancient Artifact", "Villain Reveals True Identity", "Final Confrontation Begins"\n   - Bad: "Panel 1 - Scene", "Panel 2 - Action"\n\n2. **DESCRIPTION**: Write detailed 2-3 sentence scene descriptions including:\n   - Character actions and emotions\n   - Setting details and atmosphere\n   - Key story beats or dialogue hints\n\n3. **SHOT TYPES**: Choose from: close-up, medium-shot, wide-shot, extreme-close-up, over-the-shoulder, establishing-shot, two-shot\n   - Vary shots for visual interest\n   - Match shot choice to dramatic intent\n\n4. **CAMERA ANGLES**: Choose from: eye-level, high-angle, low-angle, birds-eye-view, worms-eye-view, dutch-angle\n   - Use angles to enhance mood and power dynamics\n\n5. **DIRECTOR'S NOTES**: Include specific guidance on:\n   - Lighting mood (dramatic, soft, harsh, etc.)\n   - Character performance/emotion\n   - Visual composition elements\n   - Sound/music suggestions\n\n6. **DURATION**: 3-8 seconds based on content complexity\n\n7. **VIDEO PROMPT**: Comprehensive AI video generation prompt optimized for tools like RunwayML, Pika Labs, and Stable Video Diffusion:\n   - Camera movement: static hold, slow push-in, pan left/right, tilt up/down, dolly forward/back, orbit, handheld\n   - Technical specs: 4K resolution, 24fps cinematic, professional color grading\n   - Lighting: natural daylight, golden hour, dramatic shadows, soft diffused, neon/artificial, candlelight\n   - Visual style: photorealistic, cinematic film quality, shallow depth of field, film grain texture\n   - Duration and pacing: smooth motion, appropriate timing for scene content\n   - Environmental details: weather, atmosphere, time of day, location specifics\n\n**Story Structure Guidelines**:\n- Panel 1: Hook/establishing shot\n- Panels 2-4: Rising action/character development  \n- Panel 5: Climax or turning point\n- Panel 6: Resolution or cliffhanger (if applicable)\n\n**JSON Format**:\n[\n  {\n    "title": "Compelling descriptive title here",\n    "description": "Detailed scene description with character actions, setting, and atmosphere. Include emotional beats and visual details that bring the scene to life.",\n    "shotType": "establishing-shot",\n    "cameraAngle": "high-angle", \n    "notes": "Specific director guidance on lighting, performance, composition, and technical execution",\n    "duration": 5,\n    "videoPrompt": "Professional video generation prompt: establishing shot from high angle, 4K cinematic quality, [camera movement], [lighting description], [character actions], [environmental atmosphere], 24fps smooth motion, photorealistic rendering, shallow depth of field, professional color grading"\n  }\n]\n\nCreate a complete narrative arc with visual variety and professional filmmaking techniques. Return ONLY the JSON array without any markdown formatting or code blocks.`,i=(await this.openai.chat.completions.create({model:o,messages:[{role:"system",content:"You are an expert storyboard artist and cinematographer with 20+ years experience in film production. Create professional, detailed storyboard content with compelling titles and complete scene descriptions. Always return valid JSON only without any markdown formatting or code blocks."},{role:"user",content:n}],max_tokens:s.maxTokens||2500,temperature:s.temperature||.7})).choices[0].message.content||"";try{let e=i.trim();e.startsWith("```json")?e=e.replace(/```json\s*/,"").replace(/\s*```\s*$/,""):e.startsWith("```")&&(e=e.replace(/```\s*/,"").replace(/\s*```\s*$/,""));return JSON.parse(e).map(((e,t)=>({id:`panel-${Date.now()}-${t}`,title:e.title||`Panel ${t+1}`,description:e.description||"AI-generated scene",shotType:e.shotType||"medium-shot",cameraAngle:e.cameraAngle||"eye-level",notes:e.notes||"",duration:e.duration||4,order:t,createdAt:new Date,updatedAt:new Date,videoPrompt:e.videoPrompt})))}catch(a){return console.error("Failed to parse AI response:",a),this.generateFallbackStoryboard(e,t)}}catch(s){return console.error("Failed to generate storyboard:",s),this.generateFallbackStoryboard(e,t)}}async generateScene(e,t="medium-shot",r="eye-level",a="neutral"){if(!this.isReady())return this.generateFallbackScene(e,t,r,a);try{const o=Ue.getSettings(),n=o.aiModel||"gpt-4o-mini";console.log("🤖 Using AI model from settings for scene generation:",n);const i=`Create a professional storyboard panel for this scene:\n\n**Scene Description**: ${e}\n**Shot Type**: ${t}\n**Camera Angle**: ${r}\n**Mood**: ${a}\n\nCreate a detailed panel with:\n1. A compelling title that describes the key action\n2. An improved, detailed scene description (2-3 sentences)\n3. Specific director's notes for filming\n4. A comprehensive video generation prompt optimized for AI video tools\n\nReturn ONLY valid JSON that matches this structure exactly:\n{\n  "title": "Compelling title here",\n  "description": "Enhanced description with more detail",\n  "notes": "Director's notes on lighting, composition, etc.",\n  "videoPrompt": "Professional video generation prompt with technical details"\n}\n\nThe videoPrompt should include camera movements, lighting, atmosphere, and technical specifications (4K, framerate, etc.).`,l=(await this.openai.chat.completions.create({model:n,messages:[{role:"system",content:"You are an expert storyboard artist and cinematographer with extensive film production experience. Create detailed, professional panel content with compelling titles and actionable direction. Return only valid JSON without any markdown formatting or code blocks."},{role:"user",content:i}],max_tokens:o.maxTokens||800,temperature:o.temperature||.7})).choices[0].message.content||"";try{let a=l.trim();a.startsWith("```json")?a=a.replace(/```json\s*/,"").replace(/\s*```\s*$/,""):a.startsWith("```")&&(a=a.replace(/```\s*/,"").replace(/\s*```\s*$/,""));const s=JSON.parse(a);return{title:s.title||`Enhanced ${t} Scene`,description:s.description||e,notes:s.notes||"AI-generated scene content",shotType:t,cameraAngle:r,videoPrompt:s.videoPrompt||`Professional video: ${t} ${r} of ${e}, 4K cinematic quality, 24fps smooth motion, professional lighting, photorealistic rendering, shallow depth of field, film grain texture`}}catch(s){console.error("Failed to parse AI scene response:",s),console.log("Raw content:",l);let a=e;const o=l.match(/"description":\s*"([^"]+)"/i);if(o)a=o[1];else{const e=l.split(/[.!?]+/).filter((e=>e.trim().length>10));e.length>0&&(a=e[0].trim()+".")}return{title:`${t} ${r} Scene`,description:a,notes:"AI-generated scene content",shotType:t,cameraAngle:r,videoPrompt:`Professional video: ${t} ${r} of ${e}, 4K cinematic quality, 24fps smooth motion, professional lighting, photorealistic rendering, shallow depth of field, film grain texture`}}}catch(o){return console.error("Scene generation error:",o),this.generateFallbackScene(e,t,r,a)}}async generateImage(e,t={},r=null){var a,s,o,n;if(!this.isReady())throw console.error("🚫 OpenAI service not ready"),new Error("OpenAI service is not ready. Please check your API key.");try{if(null===r){r=Ue.getSettings().imageModel||"dall-e-3",console.log("🤖 Using image model from settings:",r)}const{style:i="cinematic",quality:l="standard",size:c="1024x1024"}=t;console.log("🎨 Generating image with options:",{style:i,quality:l,size:c,model:r}),console.log("📝 Original prompt:",e);let d=e;switch(i){case"cinematic":d=`${e}, cinematic lighting, professional cinematography, film quality, dramatic composition, high production value, 4K resolution`;break;case"realistic":d=`${e}, photorealistic, high detail, natural lighting, professional photography, sharp focus`;break;case"artistic":d=`${e}, artistic interpretation, creative composition, stylized, beautiful artwork, vibrant colors`;break;case"storyboard":d=`${e}, storyboard panel style, clean line art, professional storyboard illustration, clear composition for film production, black and white sketch`}d.length>1e3&&(d=d.substring(0,997)+"..."),console.log("✨ Enhanced prompt:",d);const m=await this.openai.images.generate({model:r,prompt:d,n:1,size:c,quality:l,style:"vivid",response_format:"b64_json"});console.log("📡 OpenAI response received:",{hasData:!!m.data,dataLength:null==(a=m.data)?void 0:a.length,hasBase64:!!(null==(o=null==(s=m.data)?void 0:s[0])?void 0:o.b64_json)});const p=null==(n=m.data)?void 0:n[0];if(!p)throw console.error("❌ No image data in response:",m),new Error("No image data returned from OpenAI");const h=p.b64_json;if(!h)throw console.error("❌ No base64 data in response:",p),new Error("No base64 image data returned from OpenAI");const u=`data:image/png;base64,${h}`;return console.log("✅ Image generated and converted to data URL (self-contained)"),u}catch(i){if(console.error("❌ DALL-E Image Generation Error:",i),401===i.status)throw new Error("Invalid OpenAI API key. Please check your API key settings.");if(429===i.status)throw new Error("Rate limit exceeded. Please wait a moment before generating another image.");if(402===i.status)throw new Error("Insufficient OpenAI credits. Please add credits to your account.");if(400===i.status)throw new Error("The image prompt was rejected by OpenAI content policy. Please try a different description.");throw new Error(`Failed to generate image: ${i.message||"Unknown error"}`)}}async analyzeCinematography(e){if(!this.isReady())return{lighting:"Unable to access OpenAI API",performance:"Unable to access OpenAI API",cameraMovement:"Unable to access OpenAI API",composition:"Unable to access OpenAI API",sound:"Unable to access OpenAI API"};try{const r=Ue.getSettings(),a=r.aiModel||"gpt-4o-mini";console.log("🤖 Using AI model from settings for cinematography analysis:",a);const s=`Analyze the cinematography for the following scene and provide feedback as a valid JSON object. The JSON object must contain these exact keys: "lighting", "performance", "cameraMovement", "composition", and "sound".\n\nScene: "${e}"\n\nReturn ONLY the raw JSON object, without any markdown formatting, comments, or other text.`,o=(await this.openai.chat.completions.create({model:a,messages:[{role:"user",content:s}],temperature:r.temperature||.6,max_tokens:r.maxTokens||250,response_format:{type:"json_object"}})).choices[0].message.content;if(o)try{const e=JSON.parse(o),t=["lighting","performance","cameraMovement","composition","sound"];for(const r of t)"string"!=typeof e[r]&&(e[r]="Analysis incomplete");return e}catch(t){return console.error("Failed to parse cinematography analysis JSON:",t,"Raw content:",o),{lighting:"Error processing AI response",performance:"Error processing AI response",cameraMovement:"Error processing AI response",composition:"Error processing AI response",sound:"Error processing AI response"}}return{lighting:"No analysis returned",performance:"No analysis returned",cameraMovement:"No analysis returned",composition:"No analysis returned",sound:"No analysis returned"}}catch(r){throw console.error("Error analyzing cinematography:",r),new Error(`Failed to analyze cinematography: ${r.message||"Unknown error"}`)}}async generatePanelImage(e,t={}){const r=localStorage.getItem("aiImageSettings");let a=null;if(r)try{a=JSON.parse(r),console.log("🎨 Found AI image settings:",a)}catch(i){console.error("Failed to parse AI image settings:",i)}else console.log("⚠️ No AI image settings found in localStorage");const s=this.createImagePromptFromPanel(e,a);console.log("📝 Enhanced prompt with settings:",s);const o={style:"photorealistic"===(null==a?void 0:a.style)?"realistic":"illustration"===(null==a?void 0:a.style)?"artistic":"sketch"===(null==a?void 0:a.style)?"storyboard":"cinematic",quality:(null==a?void 0:a.quality)||"standard",size:(null==a?void 0:a.size)||"1024x1024",...t};console.log("🎛️ Enhanced generation options:",o);let n=(null==a?void 0:a.model)||null;if(!n){n=Ue.getSettings().imageModel||"dall-e-3",console.log("🤖 Using image model from global settings:",n)}return"dall-e-2"===n&&(console.log("⚠️ DALL-E 2 is discontinued, falling back to DALL-E 3"),n="dall-e-3"),console.log("🤖 Using AI model:",n),await this.generateImage(s,o,n)}createImagePromptFromPanel(e,t=null){let r=`${e.description}, ${{"close-up":"close-up shot focusing on details","medium-shot":"medium shot showing subject from waist up","wide-shot":"wide shot showing full scene and environment","extreme-close-up":"extreme close-up shot with intimate detail","over-the-shoulder":"over-the-shoulder perspective shot","two-shot":"two-shot showing two subjects in frame","establishing-shot":"establishing shot showing location and context"}[e.shotType]||"medium shot"}, ${{"high-angle":"shot from high angle looking down","low-angle":"shot from low angle looking up","eye-level":"shot at eye level","birds-eye-view":"aerial birds eye view shot","worms-eye-view":"worms eye view shot from ground level","dutch-angle":"dutch angle tilted shot for dramatic effect"}[e.cameraAngle]||"eye level"}`;if(e.notes&&(r+=`, ${e.notes}`),e.videoPrompt){r+=`, ${this.sanitizePrompt(e.videoPrompt)}`}if(t){if(t.artStyle&&"cinematic"!==t.artStyle){r+=`, ${{dramatic:"dramatic composition",minimalist:"clean minimalist style",vintage:"vintage aesthetic",modern:"contemporary style",fantasy:"fantasy art style",noir:"film noir aesthetic"}[t.artStyle]||`${t.artStyle} style`}`}if(t.lighting&&"natural"!==t.lighting){r+=`, ${{dramatic:"dramatic lighting",soft:"soft lighting","golden-hour":"warm golden lighting",moody:"atmospheric lighting",bright:"bright illumination","low-light":"subtle lighting"}[t.lighting]||`${t.lighting} lighting`}`}if(t.mood&&"neutral"!==t.mood){r+=`, ${{happy:"uplifting atmosphere",dramatic:"dramatic atmosphere",mysterious:"mysterious atmosphere",peaceful:"serene atmosphere",energetic:"dynamic composition",melancholic:"contemplative mood"}[t.mood]||`${t.mood} atmosphere`}`}if(t.colorScheme&&"full-color"!==t.colorScheme)switch(t.colorScheme){case"monochrome":r+=", black and white photography";break;case"warm-tones":r+=", warm color palette";break;case"cool-tones":r+=", cool color palette";break;case"sepia":r+=", sepia tone";break;case"high-contrast":r+=", high contrast"}t.creativity>=8?r+=", artistic interpretation":t.creativity<=3&&(r+=", precise composition")}return r=this.sanitizePrompt(r),r.length>800&&(r=r.substring(0,800)+"...",console.log("⚠️ Prompt truncated due to length:",r.length)),r}sanitizePrompt(e){const t=["violence","violent","blood","weapon","gun","knife","sword","fight","battle","war","kill","death","dead","sexy","seductive","provocative","nude","naked","intimate","romantic","sensual","explosive","dangerous","harmful","illegal","drug","alcohol"];let r=e.toLowerCase();for(const a of t){const e=new RegExp(`\\b${a}\\b`,"gi");e.test(r)&&(console.log(`⚠️ Sanitizing potentially problematic term: "${a}"`),r=r.replace(e,(e=>{switch(a){case"fight":case"battle":return"action scene";case"weapon":case"gun":case"knife":case"sword":return"prop";case"violence":case"violent":default:return"dramatic";case"blood":return"red liquid";case"sexy":case"seductive":return"elegant";case"romantic":case"intimate":return"emotional";case"dangerous":return"exciting"}})))}return r=r.replace(/,\s*,/g,","),r=r.replace(/\s+/g," "),r=r.trim(),r}createProxyImageUrl(e){if(e.includes("oaidalleapiprodscus.blob.core.windows.net")){const t=e.replace("https://oaidalleapiprodscus.blob.core.windows.net",""),r=t.startsWith("/")?t:`/${t}`;return`${window.location.origin}/image-proxy${r}`}return e}async downloadAndConvertImageWithAuth(e){try{console.log("📥 Attempting authenticated download from:",e);const r=this.createProxyImageUrl(e);if(console.log("🔄 Using proxy URL for authenticated download:",r),!this.isReady())return console.warn("⚠️ OpenAI not initialized, trying without auth"),await this.downloadAndConvertImage(e);const a=this.getApiKey();if(!a)return console.warn("⚠️ No API key available, trying without auth"),await this.downloadAndConvertImage(e);try{console.log("🔐 Trying authenticated fetch with API key...");const e=await fetch(r,{method:"GET",headers:{Authorization:`Bearer ${a}`,Accept:"image/*","User-Agent":"Mozilla/5.0 (compatible; StoryboardAI/1.0)"},mode:"cors"});if(e.ok){const t=await e.blob();return console.log("✅ Authenticated image download successful, size:",t.size,"bytes"),new Promise(((e,r)=>{const a=new FileReader;a.onload=()=>{const t=a.result;console.log("🔄 Image converted to data URL with auth"),e(t)},a.onerror=()=>{console.error("❌ Failed to convert authenticated image to data URL"),r(new Error("Failed to convert image"))},a.readAsDataURL(t)}))}console.warn("⚠️ Authenticated fetch failed with status:",e.status)}catch(t){console.warn("⚠️ Authenticated fetch failed:",t)}return console.log("🔄 Falling back to non-authenticated download..."),await this.downloadAndConvertImage(e)}catch(r){return console.error("❌ Authenticated image download failed:",r),e}}async downloadAndConvertImage(e){try{console.log("📥 Attempting to download image from:",e);const a=this.createProxyImageUrl(e);console.log("🔄 Using proxy URL:",a);try{const e=await fetch(a,{mode:"cors",headers:{Accept:"image/*","User-Agent":"Mozilla/5.0 (compatible; StoryboardAI/1.0)"}});if(e.ok){const t=await e.blob();return console.log("✅ Image downloaded via CORS, size:",t.size,"bytes"),new Promise(((e,r)=>{const a=new FileReader;a.onload=()=>{const t=a.result;console.log("🔄 Image converted to data URL"),e(t)},a.onerror=()=>{console.error("❌ Failed to convert image to data URL"),r(new Error("Failed to convert image"))},a.readAsDataURL(t)}))}}catch(t){console.warn("⚠️ CORS fetch failed, trying alternatives:",t)}try{await fetch(a,{mode:"no-cors"});return console.log("🔄 Attempted no-cors fetch, returning original URL"),e}catch(r){console.warn("⚠️ No-cors fetch failed:",r)}return console.log("🔄 All download attempts failed, returning original URL"),e}catch(a){return console.error("❌ Image download/conversion failed:",a),e}}async generatePanelImageWithDownload(e,t={}){try{const r=await this.generatePanelImage(e,t);return r?(console.log("✅ Image generated as self-contained data URL"),r):null}catch(r){throw console.error("❌ Panel image generation failed:",r),r}}generateFallbackResponse(e){const t=e.toLowerCase();return t.includes("api key")||t.includes("setup")?'🔑 **OpenAI API Setup Required**\n\nTo enable AI features, you\'ll need an OpenAI API key:\n\n1. **Get API Key**: Visit [OpenAI API Keys](https://platform.openai.com/api-keys)\n2. **Create Key**: Click "Create new secret key"\n3. **Copy Key**: It starts with "sk-"\n4. **Add to App**: Use the settings menu to add your key\n\n**Cost**: GPT-4o-mini costs ~$0.15 per 1M input tokens (very affordable!)\n\nOnce set up, I can:\n• Generate complete storyboards\n• Edit existing panels\n• Create video prompts\n• Provide filmmaking advice\n\nWould you like me to walk you through the setup?':t.includes("generate")||t.includes("create")?'🎬 **Ready to Create!**\n\nI\'d love to generate content for you, but I need an OpenAI API key first.\n\n**Quick Setup**:\n1. Get your key from OpenAI\n2. Add it in Settings\n3. Then say things like:\n   • "Generate storyboard for: space adventure"\n   • "Create 6 panels about a love story"\n   • "Add a panel showing dramatic confrontation"\n\n**Manual Alternative**: Use the Templates or create panels manually while we get AI set up!':"🤖 **AI Assistant Available**\n\nI'm your storyboard AI assistant! I can help with:\n\n**✨ AI Features** (requires OpenAI API key):\n• Generate complete storyboards\n• Edit and improve existing panels  \n• Create video generation prompts\n• Provide expert filmmaking advice\n\n**🛠️ Always Available**:\n• Project templates and examples\n• Manual panel editing\n• Story structure guidance\n• Filmmaking best practices\n\nTo unlock AI features, add your OpenAI API key in Settings. Otherwise, I'm here to help with guidance and manual tools!\n\nWhat would you like to work on?"}generateFallbackStoryboard(e,t){const r=[],a=["establishing-shot","medium-shot","close-up","wide-shot","over-the-shoulder","two-shot"],s=["eye-level","high-angle","low-angle","birds-eye-view"],o=e.toLowerCase(),n=o.includes("fight")||o.includes("chase")||o.includes("battle"),i=o.includes("love")||o.includes("romance")||o.includes("relationship"),l=o.includes("horror")||o.includes("scary")||o.includes("monster"),c=o.includes("mystery")||o.includes("detective")||o.includes("crime");for(let d=0;d<t;d++){const o=d+1;let m="",p="",h="";if(1===o)m=`Opening Scene - ${e}`,p="The story begins with an establishing shot that introduces the world and main character. The scene sets the tone and draws the audience into the narrative.",h="Use wide establishing shot to show location and atmosphere. Consider dramatic lighting to set mood.";else if(o===t)m=`Resolution - ${e}`,p="The final panel brings closure to the story arc. Characters reach their destination or complete their journey with satisfying resolution.",h="Choose shot that provides emotional closure. Consider character positioning and lighting for impact.";else if(o===Math.floor(.7*t))m=`Climax - ${e}`,p="The story reaches its peak tension and drama. This is the moment of highest conflict and emotional intensity in the narrative.",h="Use dynamic camera angle and dramatic lighting. Consider close-ups for emotional impact.";else{const t=["Character Development","Rising Action","Plot Development","Tension Builds","Story Unfolds"];m=`${t[d%t.length]} - ${e}`,p="The story continues to develop with character growth and plot advancement. New challenges and obstacles move the narrative forward toward its climax.",h="Vary shot types for visual interest. Focus on character emotions and story progression."}n?h+=" Consider dynamic angles and movement for action sequences.":i?h+=" Use softer lighting and intimate framing for emotional connection.":l?h+=" Employ dramatic shadows and tension-building composition.":c&&(h+=" Use lighting and angles to create suspense and intrigue."),r.push({id:`fallback-panel-${Date.now()}-${d}`,title:m,description:p,shotType:a[d%a.length],cameraAngle:s[d%s.length],notes:h,duration:4+d%3,order:d,createdAt:new Date,updatedAt:new Date,videoPrompt:`Professional video: ${a[d%a.length]} ${s[d%s.length]} showing: ${p.substring(0,80)}..., 4K cinematic quality, 24fps smooth motion, professional color grading, dramatic lighting, photorealistic rendering, ${4+d%3}s duration`})}return r}generateFallbackScene(e,t,r,a){const s=e.split(" ").filter((e=>e.length>3&&!["the","and","with","from","this","that","they","them","their","there","where","when","what","which"].includes(e.toLowerCase()))).slice(0,3).map((e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()));return{title:s.length>0?s.join(" "):`${t} Scene`,description:`${t} ${r} showing: ${e}`,notes:`${a} mood - manually adjust lighting and composition as needed`,shotType:t,cameraAngle:r,videoPrompt:`Professional video: ${t} ${r} of ${e}, ${a} atmosphere, 4K cinematic quality, 24fps smooth motion, professional lighting, photorealistic rendering, shallow depth of field`}}};function nt({panel:r,isSelected:a,onSelect:s,onEdit:n,onDelete:i,onMoveUp:c,onMoveDown:m,canMoveUp:p,canMoveDown:h,onDragStart:u,onDragEnd:g,onTouchStart:y,onTouchMove:x,onTouchEnd:f,isMobile:v=!1,showActions:w=!1}){const{dispatch:j}=qe(),{state:N}=Xe(),C=Ge(N.theme),[I,P]=e.useState(!1),[F,z]=e.useState(!1),[R,U]=e.useState(!1),[W,_]=e.useState(!1),[B,H]=e.useState(!1),[q,G]=e.useState(null),[V,J]=e.useState(!1),[K,Y]=e.useState(!1),[Q,X]=e.useState(!1),[Z,ee]=e.useState(!1);e.useRef(null);const te=e.useRef(null),re=e.useRef(null),ae=e.useRef(null),se=a||I;e.useEffect((()=>{if(r.imageUrl){U(!1);const e=new Image;e.onload=()=>U(!0),e.src=r.imageUrl}}),[r.imageUrl]),e.useEffect((()=>{r.videoUrl&&_(!1)}),[r.videoUrl]),e.useEffect((()=>{if(te.current){const e=te.current.scrollHeight>te.current.clientHeight;X(e)}}),[r.description,K]),e.useEffect((()=>()=>{ae.current&&ae.current.pause()}),[]),e.useEffect((()=>{const e=e=>{re.current&&!re.current.contains(e.target)&&ee(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const oe=async e=>{if(e.preventDefault(),e.stopPropagation(),ot.isReady()){z(!0);try{const e=await ot.generateImage(r.description,{style:"cinematic",quality:"standard"});e&&j({type:"UPDATE_PANEL",payload:{id:r.id,updates:{imageUrl:e,updatedAt:new Date}}})}catch(t){console.error("Error generating image:",t),alert("Error generating image. Please try again.")}finally{z(!1)}}else alert("Please set up your OpenAI API key first in the AI Assistant settings.")},ne=e=>{null==e||e.stopPropagation(),v&&ee(!1),null==n||n()},ie=e=>{null==e||e.preventDefault(),null==e||e.stopPropagation(),v&&ee(!1),null==i||i()},le=e=>{e.stopPropagation(),e.preventDefault(),v&&ee(!1),null==c||c()},ce=e=>{e.stopPropagation(),e.preventDefault(),v&&ee(!1),null==m||m()},de=e=>{e.stopPropagation(),e.preventDefault(),ae.current&&(B?ae.current.pause():ae.current.play().catch((e=>{console.error("Error playing video:",e)})),H(!B))};return t.jsxs("div",{className:"storyboard-panel group relative rounded-2xl transition-all duration-200 cursor-pointer overflow-hidden "+(a?"selected ring-2 shadow-lg":I?"hovered ring-1 shadow-md":"shadow-sm hover:shadow-md border"),style:{backgroundColor:N.theme.colors.background.primary,borderColor:N.theme.colors.border.primary,...a&&{ringColor:N.theme.colors.primary[500],borderColor:N.theme.colors.primary[300]},...I&&!a&&{ringColor:N.theme.colors.primary[200],borderColor:N.theme.colors.primary[200]}},onClick:()=>{s()},onMouseEnter:()=>{v||P(!0)},onMouseLeave:()=>{v||P(!1)},draggable:!v,onDragStart:e=>null==u?void 0:u(e,r.id),onDragEnd:g,onTouchStart:e=>null==y?void 0:y(e,r.id),onTouchMove:x,onTouchEnd:f,children:[a&&t.jsx("div",{className:"absolute top-1 right-1 z-40",children:t.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs shadow-lg",style:{backgroundColor:N.theme.colors.primary[500],color:"#ffffff"},children:"✓"})}),t.jsx("div",{className:"absolute top-3 left-3 z-30",children:t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm transition-all duration-300 "+(a?"shadow-lg ring-2":"shadow-md border-2"),style:{backgroundColor:a?N.theme.colors.primary[500]:N.theme.colors.background.primary,color:a?"white":N.theme.colors.text.primary,borderColor:a?"transparent":N.theme.colors.border.primary},children:r.order+1})}),r.videoUrl&&t.jsx("div",{className:"absolute top-3 right-12 z-30",children:t.jsxs("div",{className:"px-2 py-1 rounded-full flex items-center gap-1 text-xs shadow-md",style:{backgroundColor:C.status.info.background,color:C.status.info.text},children:[t.jsx(d,{className:"w-3 h-3"}),t.jsx("span",{children:"Video"})]})}),v&&t.jsxs("div",{className:"absolute top-3 right-3 z-50",children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),ee((e=>!e))},className:"w-8 h-8 rounded-lg flex items-center justify-center transition-all duration-150 hover:scale-105 shadow-sm hover:shadow-md touch-manipulation mobile-action-button",style:{backgroundColor:C.interactive.primary.background,color:C.interactive.primary.text},title:"Panel Options",children:t.jsx(E,{className:"w-4 h-4"})}),Z&&t.jsx("div",{ref:re,className:"absolute top-10 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-xl z-50 overflow-hidden mobile-popup-menu",style:{backgroundColor:N.theme.colors.background.primary,borderColor:N.theme.colors.border.primary,border:`1px solid ${N.theme.colors.border.primary}`},children:t.jsxs("div",{className:"p-1 w-40",children:[t.jsxs("button",{onClick:ne,className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left text-sm",style:{color:C.status.success.text},children:[t.jsx(D,{className:"w-4 h-4"}),t.jsx("span",{children:"Edit Panel"})]}),p&&t.jsxs("button",{onClick:le,className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left text-sm",style:{color:C.interactive.primary.text},children:[t.jsx($,{className:"w-4 h-4"}),t.jsx("span",{children:"Move Up"})]}),h&&t.jsxs("button",{onClick:ce,className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left text-sm",style:{color:C.interactive.primary.text},children:[t.jsx(M,{className:"w-4 h-4"}),t.jsx("span",{children:"Move Down"})]}),t.jsxs("button",{onClick:oe,disabled:F,className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left text-sm "+(F?"opacity-50 cursor-not-allowed":""),style:{color:C.project.purple.text},children:[F?t.jsx(O,{className:"w-4 h-4 animate-spin"}):t.jsx(k,{className:"w-4 h-4"}),t.jsx("span",{children:"Generate Image"})]}),t.jsxs("button",{onClick:ie,className:"w-full flex items-center gap-2 px-3 py-2 rounded-lg text-left text-sm",style:{color:C.status.error.text},children:[t.jsx(T,{className:"w-4 h-4"}),t.jsx("span",{children:"Delete Panel"})]})]})})]}),!v&&(a||I||w)&&t.jsxs("div",{className:"absolute top-0 right-0 px-2 py-2 flex flex-col gap-2 z-20",style:{background:"linear-gradient(45deg, transparent, rgba(0,0,0,0.05))"},children:[t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("button",{onClick:ne,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center transition-all duration-150 hover:scale-105 shadow-sm hover:shadow-md touch-manipulation",style:{backgroundColor:C.status.success.background,color:C.status.success.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=C.status.success.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=C.status.success.background},title:"Edit Panel",children:t.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),t.jsx("button",{onClick:ie,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center transition-all duration-150 hover:scale-105 shadow-sm hover:shadow-md touch-manipulation",style:{backgroundColor:C.status.error.background,color:C.status.error.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=C.status.error.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=C.status.error.background},title:"Delete Panel",children:t.jsx(T,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),(a||w)&&t.jsxs("div",{className:"flex space-x-1",children:[p&&t.jsx("button",{onClick:le,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center transition-all duration-150 hover:scale-105 shadow-sm hover:shadow-md touch-manipulation",style:{backgroundColor:C.interactive.primary.background,color:C.interactive.primary.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=N.theme.colors.secondary[200]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=C.interactive.primary.background},title:"Move Up",children:t.jsx($,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),h&&t.jsx("button",{onClick:ce,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center transition-all duration-150 hover:scale-105 shadow-sm hover:shadow-md touch-manipulation",style:{backgroundColor:C.interactive.primary.background,color:C.interactive.primary.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=N.theme.colors.secondary[200]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=C.interactive.primary.background},title:"Move Down",children:t.jsx(M,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),t.jsx("div",{className:"flex flex-wrap gap-1 justify-end",children:t.jsx("button",{onClick:oe,disabled:F,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg flex items-center justify-center transition-all duration-150 hover:scale-105 shadow-sm hover:shadow-md touch-manipulation "+(F?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:C.project.purple.background,color:C.project.purple.text},onMouseEnter:e=>{F||(e.currentTarget.style.backgroundColor=N.theme.colors.primary[600])},onMouseLeave:e=>{F||(e.currentTarget.style.backgroundColor=C.project.purple.background)},title:"Generate Image",children:F?t.jsx(O,{className:"w-3 h-3 sm:w-4 sm:h-4 animate-spin"}):t.jsx(k,{className:"w-3 h-3 sm:w-4 sm:h-4"})})})]}),t.jsx("div",{className:"p-4 border-b relative z-10",style:{backgroundColor:a?`${N.theme.colors.primary[50]}90`:N.theme.colors.background.secondary,borderColor:N.theme.colors.border.primary},children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{className:"flex-1 min-w-0 pl-12 pr-3",children:[t.jsx("h3",{className:"text-lg font-semibold leading-tight truncate mb-2",style:{color:N.theme.colors.text.primary,textShadow:se?"0 1px 2px rgba(0,0,0,0.1)":"none"},children:r.title}),t.jsxs("div",{className:"flex items-center flex-wrap gap-2",children:[t.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:{backgroundColor:C.status.info.light,color:C.status.info.background,borderColor:C.status.info.border},children:["📽️ ",r.shotType.replace("-"," ")]}),t.jsxs("span",{className:"px-2 py-1 rounded-full text-xs font-medium border",style:{backgroundColor:C.status.success.light,color:C.status.success.background,borderColor:C.status.success.border},children:["📐 ",r.cameraAngle.replace("-"," ")]})]})]})})}),t.jsx("div",{className:"relative",style:{minHeight:"160px"},children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"p-4",style:{backgroundColor:N.theme.colors.background.primary,color:N.theme.colors.text.primary},children:t.jsxs("div",{className:"relative",children:[t.jsx("p",{ref:te,className:"text-sm leading-relaxed "+(K?"":"line-clamp-3"),style:{color:N.theme.colors.text.secondary},children:r.description}),Q&&t.jsx("button",{onClick:()=>Y(!K),className:`mt-2 flex items-center gap-1 text-xs font-medium transition-all duration-200 hover:scale-105 touch-manipulation ${v?"px-3 py-2":"px-2 py-1"} rounded-full`,style:{backgroundColor:`${N.theme.colors.primary[500]}20`,color:N.theme.colors.primary[600],border:`1px solid ${N.theme.colors.primary[200]}`},children:K?t.jsxs(t.Fragment,{children:[t.jsx(S,{className:"w-3 h-3"}),"Show Less"]}):t.jsxs(t.Fragment,{children:[t.jsx(A,{className:"w-3 h-3"}),"Show More"]})})]})}),t.jsx("div",{className:"relative w-full overflow-hidden",style:{minHeight:"180px",maxHeight:"280px",display:"flex",justifyContent:"center",alignItems:"center"},children:r.videoUrl?t.jsxs("div",{className:"relative w-full h-full",children:[t.jsx("video",{ref:ae,src:r.videoUrl,className:"w-full h-full max-h-[280px] object-contain",onLoadedData:()=>_(!0),onError:()=>{console.error("Error loading video for panel:",r.id),_(!1)},onClick:e=>e.stopPropagation(),onPlay:()=>H(!0),onPause:()=>H(!1),muted:!se,loop:!0,playsInline:!0}),t.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",onClick:de,children:[t.jsx("button",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-black/40 backdrop-blur-sm text-white hover:bg-black/60 transition-all duration-200",onClick:de,children:B?t.jsx(L,{className:"w-5 h-5"}):t.jsx(b,{className:"w-5 h-5 ml-1"})}),t.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[t.jsx(d,{className:"w-3 h-3"}),t.jsx("span",{children:"Video"})]})]}),!W&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-800",children:t.jsx(O,{className:"w-8 h-8 animate-spin",style:{color:N.theme.colors.primary[500]}})})]}):r.imageUrl?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:r.imageUrl,alt:r.title,className:"w-full transition-opacity duration-500 "+(R?"opacity-100":"opacity-0"),onLoad:()=>U(!0),style:{maxHeight:"280px",objectFit:"contain",maxWidth:"100%"}}),!R&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-200 dark:bg-gray-800",children:t.jsx(O,{className:"w-8 h-8 animate-spin",style:{color:N.theme.colors.primary[500]}})})]}):t.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",style:{color:N.theme.colors.text.tertiary,background:`linear-gradient(135deg, ${N.theme.colors.background.secondary}, ${N.theme.colors.background.primary})`},children:[t.jsx("div",{className:"w-24 h-24 rounded-2xl flex items-center justify-center mb-6 animate-float shadow-lg",style:{background:`linear-gradient(135deg, ${N.theme.colors.primary[200]}, ${N.theme.colors.secondary[200]}, ${N.theme.colors.primary[200]})`},children:t.jsx(o,{className:"w-12 h-12",style:{color:N.theme.colors.primary[500]}})}),t.jsx("p",{className:"text-xl font-bold mb-3",style:{color:N.theme.colors.text.primary},children:"No Media Yet"}),t.jsx("p",{className:"text-sm max-w-xs text-center",style:{color:N.theme.colors.text.tertiary},children:"Add a detailed description and use the image generation tool or upload media."})]})}),F&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-80 flex items-center justify-center",children:t.jsxs("div",{className:"rounded-2xl p-8 flex flex-col items-center space-y-6 animate-fade-in shadow-2xl",style:{backgroundColor:N.theme.colors.background.primary},children:[t.jsxs("div",{className:"relative",children:[t.jsx(l,{className:"w-16 h-16 animate-bounce",style:{color:N.theme.colors.primary[500]}}),t.jsx("div",{className:"absolute inset-0 w-16 h-16 border-4 border-t-transparent rounded-full animate-spin",style:{borderColor:N.theme.colors.primary[200]}})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"font-bold text-lg",style:{color:N.theme.colors.text.primary},children:"✨ Creating Magic"}),t.jsx("p",{className:"text-sm",style:{color:N.theme.colors.text.secondary},children:"AI is painting your vision..."}),t.jsx("div",{className:"mt-3 w-32 h-2 rounded-full overflow-hidden",style:{backgroundColor:N.theme.colors.background.tertiary},children:t.jsx("div",{className:"h-full rounded-full",style:{background:`linear-gradient(90deg, ${N.theme.colors.primary[500]}, ${N.theme.colors.secondary[500]})`}})})]})]})})]})})]})}const it=({context:r,className:a=""})=>{const{state:s}=Xe(),{state:o}=qe(),[l,c]=e.useState(0),[d,m]=e.useState(!0),[p,h]=e.useState(!1);e.useEffect((()=>{"true"===localStorage.getItem(`contextual-tips-${r}-dismissed`)&&(h(!0),m(!1))}),[r]);const u=(()=>{switch(r){case"empty":return["👋 Welcome to Storyboard AI! Start by clicking 'New Project' or choose a template.","💡 Try the AI Assistant to generate your first story panels automatically.","🎨 Use the Templates section for quick starts on common story types."];case"first-panel":return["🎉 Great! You created your first panel. Double-click it to add content.","✨ Use the AI Assistant to generate images and refine your story.","📝 Add detailed descriptions, dialogue, and camera notes in the panel editor."];case"ai-assistant":return["🤖 Describe your story concept and let AI generate panel scripts for you.","🎯 Be specific about genres, moods, and visual styles for better results.","🔄 Ask for revisions by describing what you want changed.","⚙️ Check AI Settings to customize image dimensions and style preferences."];case"panel-editing":return["✍️ Write clear, concise scene descriptions for each panel.","🎬 Include camera angles like 'close-up', 'wide shot', or 'bird's eye view'.","🎭 Add dialogue, sound effects, and timing notes for complete scenes.","🔄 Use the timeline view to check story flow and pacing."];default:return["💾 Your work auto-saves, but you can export projects as JSON for backup.","🎨 Switch themes to match your project's mood or reduce eye strain.","⌨️ Press Ctrl/Cmd + N for new panels, Ctrl/Cmd + S to save.","🖱️ Right-click panels for quick actions like duplicate or delete."]}})();return!d||p||0===u.length?null:t.jsxs("div",{className:`bg-opacity-98 rounded-lg border shadow-lg p-4 animate-slide-in-from-bottom glass-effect ${a}`,style:{backgroundColor:s.theme.colors.primary[50],borderColor:s.theme.colors.primary[200],color:s.theme.colors.primary[800]},children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[t.jsx(F,{className:"h-5 w-5 mt-0.5 flex-shrink-0",style:{color:s.theme.colors.primary[600]}}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("p",{className:"text-sm font-medium mb-1",children:["💡 Tip ",l+1," of ",u.length]}),t.jsx("p",{className:"text-sm leading-relaxed",children:u[l]})]})]}),t.jsx("button",{onClick:()=>{m(!1),h(!0),localStorage.setItem(`contextual-tips-${r}-dismissed`,"true")},className:"p-1 rounded-full transition-colors ml-2 flex-shrink-0",style:{color:s.theme.colors.primary[500]},onMouseOver:e=>{e.currentTarget.style.backgroundColor=s.theme.colors.primary[100]},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},title:"Dismiss tips",children:t.jsx(n,{className:"h-4 w-4"})})]}),u.length>1&&t.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t",style:{borderColor:s.theme.colors.primary[200]},children:[t.jsxs("button",{onClick:()=>{c((e=>(e-1+u.length)%u.length))},disabled:u.length<=1,className:"flex items-center space-x-1 px-2 py-1 rounded text-xs font-medium transition-colors disabled:opacity-50",style:{color:s.theme.colors.primary[600]},onMouseOver:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=s.theme.colors.primary[100])},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx(z,{className:"h-3 w-3"}),t.jsx("span",{children:"Previous"})]}),t.jsx("div",{className:"flex space-x-1",children:u.map(((e,r)=>t.jsx("div",{className:"w-2 h-2 rounded-full transition-colors",style:{backgroundColor:r===l?s.theme.colors.primary[500]:s.theme.colors.primary[200]}},r)))}),t.jsxs("button",{onClick:()=>{c((e=>(e+1)%u.length))},disabled:u.length<=1,className:"flex items-center space-x-1 px-2 py-1 rounded text-xs font-medium transition-colors disabled:opacity-50",style:{color:s.theme.colors.primary[600]},onMouseOver:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=s.theme.colors.primary[100])},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx("span",{children:"Next"}),t.jsx(i,{className:"h-3 w-3"})]})]})]})};function lt({selectedPanel:r,onSelectPanel:a,onEditPanel:s}){const{state:n,dispatch:i}=qe(),{state:l}=Xe(),[c,d]=e.useState(null),[m,p]=e.useState(null),[u,g]=e.useState(null),[y,x]=e.useState(!1),[f,b]=e.useState(null),[v,w]=e.useState(null),j=e.useRef(null),[N,k]=e.useState(null);e.useEffect((()=>{const e=()=>{const e=window.innerWidth<=768&&(navigator.maxTouchPoints>0||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));x(e)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e.useEffect((()=>{j.current&&!y&&j.current.focus()}),[n.panels.length,y]),e.useEffect((()=>{const e=e=>{var t,o;const n=document.activeElement;if(!("INPUT"===(null==n?void 0:n.tagName)||"TEXTAREA"===(null==n?void 0:n.tagName)||(null==n?void 0:n.isContentEditable))&&!y)switch((null==(t=j.current)?void 0:t.contains(n))||null==(o=j.current)||o.focus(),e.key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":e.preventDefault(),C(e.key);break;case"Enter":e.preventDefault(),r&&s(r);break;case"Delete":case"Backspace":e.preventDefault(),r&&I(r);break;case"Escape":e.preventDefault(),a(null),d(null)}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[r,n.panels,y]),e.useEffect((()=>{const e=()=>d(null);if(c)return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}),[c]),e.useEffect((()=>{const e=()=>{N&&k(null)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)}),[N]);const C=e=>{var t;const s=r?n.panels.findIndex((e=>e.id===r)):0;let o=s;const i=null==(t=j.current)?void 0:t.querySelector(".storyboard-grid-container");if(!i)return;const l=window.getComputedStyle(i),c=parseFloat(l.gap)||16,d=i.clientWidth,m=Math.floor((d+c)/(280+c));switch(e){case"ArrowUp":o=Math.max(0,s-m);break;case"ArrowDown":o=Math.min(n.panels.length-1,s+m);break;case"ArrowLeft":o=Math.max(0,s-1);break;case"ArrowRight":o=Math.min(n.panels.length-1,s+1)}if(o!==s&&n.panels[o]){const e=n.panels[o].id;a(e)}},S=()=>{const e={id:`panel-${Date.now()}`,title:`Panel ${n.panels.length+1}`,description:"New panel description",shotType:"medium-shot",cameraAngle:"eye-level",duration:4,order:n.panels.length,notes:"",createdAt:new Date,updatedAt:new Date};i({type:"ADD_PANEL",payload:e}),a(e.id)},A=(e,t)=>{const r=n.panels.findIndex((t=>t.id===e));if(-1===r)return;const a="up"===t?r-1:r+1;a<0||a>=n.panels.length||i({type:"REORDER_PANELS",payload:{fromIndex:r,toIndex:a}})},I=e=>{confirm("Are you sure you want to delete this panel?")&&(i({type:"DELETE_PANEL",payload:e}),r===e&&a(null))},P=(e,t)=>{p(t),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t),r!==t&&a(t)},E=()=>{g(null)},D=()=>{p(null),g(null)},O=e=>{if(f&&v){const t=e.touches[0];Math.sqrt(Math.pow(t.clientX-v.x,2)+Math.pow(t.clientY-v.y,2))>10&&(clearTimeout(f),b(null))}},L=()=>{f&&(clearTimeout(f),b(null)),w(null)};return t.jsxs("div",{className:"h-full flex flex-col bg-secondary",ref:j,tabIndex:0,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 md:p-6 border-b border-tertiary",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h2",{className:"text-lg sm:text-xl md:text-2xl font-bold text-primary mb-1 truncate",children:"Storyboard Grid"}),t.jsxs("p",{className:"text-xs sm:text-sm md:text-base text-secondary",children:[n.panels.length," panel",1!==n.panels.length?"s":""]})]}),t.jsx("div",{className:"flex items-center gap-2",children:t.jsxs("button",{onClick:S,className:(y?"px-4 py-3 ml-2":"px-3 py-2 sm:px-4 sm:py-2 md:px-4 md:py-2 ml-2")+" rounded-lg transition-all duration-200 flex items-center gap-2 text-sm md:text-base font-medium shadow-sm hover:shadow-md hover:scale-105 touch-manipulation",style:{backgroundColor:l.theme.colors.primary[500],color:"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=l.theme.colors.primary[600]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=l.theme.colors.primary[500]},children:[t.jsx(h,{className:"w-4 h-4 flex-shrink-0"}),t.jsx("span",{className:""+(y?"":"hidden xs:inline"),children:"Add Panel"}),!y&&t.jsx("span",{className:"xs:hidden",children:"Add"})]})})]}),t.jsxs("div",{ref:j,className:"flex-1 overflow-auto p-3 sm:p-4 md:p-6 relative",tabIndex:0,role:"grid","aria-label":"Storyboard panels grid",style:{outline:"none"},children:[0===n.panels.length&&t.jsx(it,{context:"empty",className:"absolute top-4 right-4 max-w-sm z-10 hidden sm:block"}),1===n.panels.length&&t.jsx(it,{context:"first-panel",className:"absolute top-4 right-4 max-w-sm z-10 hidden sm:block"}),0===n.panels.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center animate-fadeIn",children:[t.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-tertiary rounded-full flex items-center justify-center mb-4",children:t.jsx(o,{className:"w-6 h-6 sm:w-8 sm:h-8 text-secondary"})}),t.jsx("h3",{className:"text-base sm:text-lg font-semibold text-primary mb-2",children:"No panels yet"}),t.jsx("p",{className:"text-secondary mb-6 max-w-md text-sm sm:text-base px-4",children:"Start building your storyboard by adding your first panel. Create scenes, add descriptions, and generate images."}),t.jsxs("button",{onClick:S,className:"px-6 py-3 rounded-lg transition-all duration-200 flex items-center gap-2 hover:scale-105 transform font-medium shadow-md hover:shadow-lg touch-manipulation",style:{backgroundColor:l.theme.colors.primary[500],color:"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=l.theme.colors.primary[600]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=l.theme.colors.primary[500]},children:[t.jsx(h,{className:"w-5 h-5"}),"Create First Panel"]})]}):t.jsx("div",{className:"storyboard-grid-container",children:n.panels.map(((e,o)=>t.jsx("div",{className:`storyboard-grid-item animate-fadeIn ${m===e.id?"opacity-50 scale-95":""} ${u===o?"ring-2 ring-blue-400 ring-opacity-60":""}`,style:{animationDelay:50*o+"ms"},onContextMenu:t=>((e,t)=>{e.preventDefault(),e.stopPropagation(),r!==t&&a(t),d({x:e.clientX,y:e.clientY,panelId:t})})(t,e.id),onDragOver:e=>((e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",g(t)})(e,o),onDragLeave:E,onDrop:e=>((e,t)=>{if(e.preventDefault(),!m)return;const r=n.panels.findIndex((e=>e.id===m));if(-1===r||r===t)return p(null),void g(null);i({type:"REORDER_PANELS",payload:{fromIndex:r,toIndex:t}}),p(null),g(null)})(e,o),children:t.jsx(nt,{panel:e,isSelected:r===e.id,onSelect:()=>{var t;y?(t=e.id,r===t?a(null):(a(t),k(null))):(e=>{a(e),r===e&&s(e)})(e.id)},onEdit:()=>s(e.id),onDelete:()=>I(e.id),onMoveUp:()=>A(e.id,"up"),onMoveDown:()=>A(e.id,"down"),canMoveUp:o>0,canMoveDown:o<n.panels.length-1,onDragStart:P,onDragEnd:D,onTouchStart:t=>((e,t)=>{if(y){const r=e.touches[0];w({x:r.clientX,y:r.clientY});const a=setTimeout((()=>{d({x:r.clientX,y:r.clientY,panelId:t}),navigator.vibrate&&navigator.vibrate(50)}),500);b(a)}})(t,e.id),onTouchMove:O,onTouchEnd:L,isMobile:y,showActions:y?N===e.id||r===e.id:void 0})},e.id)))}),c&&t.jsxs("div",{className:"fixed context-menu rounded-lg py-2 z-50 min-w-48",style:{left:c.x,top:c.y,backgroundColor:l.theme.colors.background.primary,border:`1px solid ${l.theme.colors.border.primary}`,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.2)"},onClick:e=>e.stopPropagation(),children:[t.jsxs("button",{onClick:()=>{s(c.panelId),d(null)},className:"w-full px-4 py-2 text-left context-menu-item flex items-center gap-2 hover:bg-opacity-10",style:{color:l.theme.colors.text.primary,transition:"background-color 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=`${l.theme.colors.primary[500]}20`},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx("div",{className:"w-4 h-4 rounded flex items-center justify-center",style:{backgroundColor:"#10b981"},children:t.jsx("span",{className:"text-xs",style:{color:"#ffffff"},children:"✏️"})}),"Edit Panel"]}),t.jsxs("button",{onClick:()=>{(e=>{const t=n.panels.find((t=>t.id===e));if(!t)return;const r={...t,id:`panel-${Date.now()}-${Math.random()}`,title:`${t.title} (Copy)`,order:n.panels.length,createdAt:new Date,updatedAt:new Date};i({type:"ADD_PANEL",payload:r}),a(r.id)})(c.panelId),d(null)},className:"w-full px-4 py-2 text-left context-menu-item flex items-center gap-2",style:{color:l.theme.colors.text.primary,transition:"background-color 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=`${l.theme.colors.primary[500]}20`},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx(R,{className:"w-4 h-4",style:{color:l.theme.colors.primary[500]}}),"Duplicate Panel"]}),t.jsxs("button",{onClick:()=>{A(c.panelId,"up"),d(null)},className:"w-full px-4 py-2 text-left context-menu-item flex items-center gap-2",disabled:0===n.panels.findIndex((e=>e.id===c.panelId)),style:{color:l.theme.colors.text.primary,transition:"background-color 0.15s ease",opacity:0===n.panels.findIndex((e=>e.id===c.panelId))?.5:1},onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=`${l.theme.colors.primary[500]}20`)},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx($,{className:"w-4 h-4",style:{color:l.theme.colors.primary[500]}}),"Move Up"]}),t.jsxs("button",{onClick:()=>{A(c.panelId,"down"),d(null)},className:"w-full px-4 py-2 text-left context-menu-item flex items-center gap-2",disabled:n.panels.findIndex((e=>e.id===c.panelId))===n.panels.length-1,style:{color:l.theme.colors.text.primary,transition:"background-color 0.15s ease",opacity:n.panels.findIndex((e=>e.id===c.panelId))===n.panels.length-1?.5:1},onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=`${l.theme.colors.primary[500]}20`)},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx(M,{className:"w-4 h-4",style:{color:l.theme.colors.primary[500]}}),"Move Down"]}),t.jsx("hr",{style:{margin:"4px 0",border:"none",height:"1px",backgroundColor:l.theme.colors.border.primary}}),t.jsxs("button",{onClick:()=>{I(c.panelId),d(null)},className:"w-full px-4 py-2 text-left context-menu-item flex items-center gap-2",style:{color:"#ef4444",transition:"background-color 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#ef444420"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsx(T,{className:"w-4 h-4",style:{color:"#ef4444"}}),"Delete Panel"]})]})]})]})}function ct(){const{state:r}=qe(),{state:a}=Xe(),[s,o]=e.useState(!1),[n,i]=e.useState(0),[l,c]=e.useState(1),[d,m]=e.useState(!1),[p,h]=e.useState(1),[u,g]=e.useState(0),[y,x]=e.useState(!1),f=e.useRef(null),v=e.useRef(null),w=e.useRef(null),N=r.panels.reduce(((e,t)=>e+(t.duration||0)),0);e.useEffect((()=>(s?w.current=setInterval((()=>{g((e=>{var t;const a=e+.1*p;return a>=((null==(t=r.panels[n])?void 0:t.duration)||3)?n<r.panels.length-1?(i((e=>e+1)),0):(o(!1),i(0),0):a}))}),100):w.current&&clearInterval(w.current),()=>{w.current&&clearInterval(w.current)})),[s,n,p,r.panels]),e.useEffect((()=>{g(0)}),[n]),e.useEffect((()=>{x(!1)}),[n]),e.useEffect((()=>{(()=>{if(n<r.panels.length-1){const e=r.panels[n+1];if(e.videoUrl){const t=document.createElement("video");t.src=e.videoUrl,t.preload="auto",t.load()}}})()}),[n,r.panels]);return 0===r.panels.length?t.jsxs("div",{className:"p-6 text-center text-secondary",children:[t.jsx(P,{className:"w-8 h-8 mx-auto mb-2"}),t.jsx("p",{children:"No panels to display in timeline"})]}):t.jsxs("div",{ref:v,className:"h-full flex flex-col bg-primary text-primary",children:[t.jsx("div",{className:"p-3 md:p-4 border-b border-primary",children:t.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-2 md:gap-0",children:[t.jsx("h3",{className:"font-semibold text-primary",children:"Timeline Preview"}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-secondary",children:[t.jsx(P,{className:"w-4 h-4"}),t.jsxs("span",{children:[N,"s total"]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("select",{value:p,onChange:e=>{return t=Number(e.target.value),h(t),void(f.current&&(f.current.playbackRate=t));var t},className:"select-modern text-xs px-2 py-1",children:[t.jsx("option",{value:.5,children:"0.5x"}),t.jsx("option",{value:1,children:"1x"}),t.jsx("option",{value:1.5,children:"1.5x"}),t.jsx("option",{value:2,children:"2x"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(U,{className:"w-4 h-4 text-secondary"}),t.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:l,onChange:e=>{return t=Number(e.target.value),c(t),void(f.current&&(f.current.volume=t));var t},className:"w-16 h-1 bg-secondary rounded-lg appearance-none cursor-pointer"})]}),t.jsx("button",{onClick:()=>{var e,t;const a={project:(null==(e=r.currentProject)?void 0:e.title)||"Untitled",totalDuration:N,panels:r.panels.map(((e,t)=>({order:t+1,title:e.title,description:e.description,duration:e.duration,shotType:e.shotType,cameraAngle:e.cameraAngle,notes:e.notes,hasVideo:!!e.videoUrl,hasImage:!!e.imageUrl,videoPrompt:e.videoPrompt||e.aiGeneratedPrompt})))},s=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(s),n=document.createElement("a");n.href=o,n.download=`${(null==(t=r.currentProject)?void 0:t.title)||"storyboard"}-timeline.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},className:"p-1 hover:bg-secondary rounded text-secondary hover:text-primary",title:"Export timeline",children:t.jsx(j,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{!d&&v.current?(v.current.requestFullscreen(),m(!0)):document.fullscreenElement&&(document.exitFullscreen(),m(!1))},className:"p-1 hover:bg-secondary rounded text-secondary hover:text-primary",title:"Fullscreen",children:t.jsx(W,{className:"w-4 h-4"})})]})]})]})}),t.jsx("div",{className:"flex-1 flex items-center justify-center bg-black relative min-h-0",children:r.panels[n]&&t.jsxs(t.Fragment,{children:[r.panels[n].videoUrl?t.jsxs(t.Fragment,{children:[t.jsx("video",{ref:f,src:r.panels[n].videoUrl,className:"max-w-[60%] max-h-[60%] object-contain",controls:!1,muted:0===l,loop:!1,onError:()=>{var e;console.error("Video error occurred on panel:",null==(e=r.panels[n])?void 0:e.id),x(!0),s&&n<r.panels.length-1?(i((e=>e+1)),g(0)):o(!1)},onEnded:()=>{n<r.panels.length-1?(i((e=>e+1)),g(0)):(o(!1),i(0),g(0))}}),y&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsxs("div",{className:"bg-red-600 bg-opacity-80 text-white p-4 rounded-lg text-center max-w-xs",children:[t.jsx(_,{className:"w-10 h-10 mx-auto mb-2"}),t.jsx("p",{className:"font-medium",children:"Video playback error"}),t.jsx("p",{className:"text-sm mt-1",children:"There was a problem playing this video"}),t.jsx("button",{className:"mt-3 bg-white text-red-600 px-3 py-1 rounded text-sm font-medium",onClick:()=>i((e=>Math.min(r.panels.length-1,e+1))),children:"Skip to next panel"})]})})]}):r.panels[n].imageUrl?t.jsx("img",{src:r.panels[n].imageUrl,alt:r.panels[n].title,className:"max-w-[60%] max-h-[60%] object-contain rounded-lg shadow-lg"}):t.jsxs("div",{className:"text-center max-w-md mx-auto",children:[t.jsx(B,{className:"w-16 h-16 mx-auto mb-4",style:{color:a.theme.colors.text.secondary}}),t.jsx("h4",{className:"text-xl font-medium mb-2",style:{color:a.theme.colors.text.primary},children:r.panels[n].title}),t.jsx("p",{style:{color:a.theme.colors.text.secondary},children:r.panels[n].description}),t.jsxs("div",{className:"mt-4 flex justify-center space-x-4 text-sm",children:[t.jsx("span",{className:"px-2 py-1 rounded",style:{backgroundColor:a.theme.colors.background.tertiary,color:a.theme.colors.text.primary},children:r.panels[n].shotType.replace("-"," ")}),t.jsx("span",{className:"px-2 py-1 rounded",style:{backgroundColor:a.theme.colors.background.tertiary,color:a.theme.colors.text.primary},children:r.panels[n].cameraAngle.replace("-"," ")})]})]}),t.jsx("div",{className:"absolute top-4 left-4 rounded-lg p-3",style:{backgroundColor:`${a.theme.colors.background.primary}E6`,backdropFilter:"blur(8px)"},children:t.jsxs("div",{className:"text-sm",children:[t.jsxs("div",{className:"font-medium",style:{color:a.theme.colors.text.primary},children:["Panel ",n+1," of ",r.panels.length]}),t.jsxs("div",{style:{color:a.theme.colors.text.secondary,opacity:.8},children:[u.toFixed(1),"s / ",r.panels[n].duration,"s"]}),r.panels[n].videoUrl&&t.jsx("div",{className:"text-xs text-green-400 mt-1",children:"📹 Video"}),r.panels[n].imageUrl&&!r.panels[n].videoUrl&&t.jsx("div",{className:"text-xs text-blue-400 mt-1",children:"🖼️ Image"})]})}),t.jsx("div",{className:"absolute bottom-4 left-4 right-4",children:t.jsxs("div",{className:"rounded-lg p-2",style:{backgroundColor:`${a.theme.colors.background.primary}CC`,backdropFilter:"blur(8px)"},children:[t.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",style:{color:a.theme.colors.text.primary,opacity:.9},children:[t.jsx("span",{children:r.panels[n].title}),t.jsxs("span",{children:[p,"x"]})]}),t.jsx("div",{className:"w-full rounded-full h-1",style:{backgroundColor:a.theme.colors.background.tertiary},children:t.jsx("div",{className:"bg-primary-500 h-1 rounded-full transition-all duration-100",style:{width:u/(r.panels[n].duration||1)*100+"%"}})})]})})]})}),t.jsxs("div",{className:"p-4 border-t",style:{borderColor:a.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-4",children:[t.jsx("button",{onClick:()=>{i(Math.max(0,n-1)),o(!1)},disabled:0===n,className:"p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{backgroundColor:a.theme.colors.background.tertiary,color:a.theme.colors.text.primary},onMouseOver:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=a.theme.colors.background.secondary)},onMouseOut:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=a.theme.colors.background.tertiary)},children:t.jsx(H,{className:"w-5 h-5"})}),t.jsx("button",{onClick:()=>{o(!s),y||f.current&&(s?f.current.pause():f.current.play().catch((e=>{console.error("Failed to play video:",e),x(!0)})))},className:"p-3 rounded-lg",style:{backgroundColor:a.theme.colors.primary[600],color:a.theme.colors.text.primary},onMouseOver:e=>{e.currentTarget.style.backgroundColor=a.theme.colors.primary[700]},onMouseOut:e=>{e.currentTarget.style.backgroundColor=a.theme.colors.primary[600]},children:s?t.jsx(L,{className:"w-6 h-6"}):t.jsx(b,{className:"w-6 h-6"})}),t.jsx("button",{onClick:()=>{i(Math.min(r.panels.length-1,n+1)),o(!1)},disabled:n===r.panels.length-1,className:"p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed transition-colors",style:{backgroundColor:a.theme.colors.background.tertiary,color:a.theme.colors.text.primary},onMouseOver:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=a.theme.colors.background.secondary)},onMouseOut:e=>{e.currentTarget.disabled||(e.currentTarget.style.backgroundColor=a.theme.colors.background.tertiary)},children:t.jsx(q,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between text-xs",style:{color:a.theme.colors.text.secondary},children:[t.jsx("span",{children:"0s"}),t.jsxs("span",{children:[N,"s"]})]}),t.jsx("div",{className:"relative h-2 rounded-full",style:{backgroundColor:a.theme.colors.background.tertiary},children:t.jsx("div",{className:"absolute top-0 left-0 h-full bg-primary-600 rounded-full transition-all duration-300",style:{width:(n+1)/r.panels.length*100+"%"}})}),t.jsx("div",{className:"flex justify-between",children:r.panels.map(((e,r)=>t.jsx("button",{onClick:()=>{i(r),o(!1)},className:"text-xs px-2 py-1 rounded transition-colors",style:{backgroundColor:r===n?a.theme.colors.primary[600]:a.theme.colors.background.tertiary,color:r===n?a.theme.colors.text.primary:a.theme.colors.text.secondary},onMouseOver:e=>{r!==n&&(e.currentTarget.style.backgroundColor=a.theme.colors.background.secondary)},onMouseOut:e=>{r!==n&&(e.currentTarget.style.backgroundColor=a.theme.colors.background.tertiary)},children:r+1},e.id)))})]})]})]})}var dt=Object.defineProperty,mt=(e,t,r)=>((e,t,r)=>t in e?dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const pt=class e{constructor(){mt(this,"activeWindows",new Map),mt(this,"maxZIndex",9e3)}static getInstance(){return e.instance||(e.instance=new e),e.instance}registerWindow(e,t=9e3,r="",a){const s=Math.max(t,this.maxZIndex+1);return this.activeWindows.set(e,{zIndex:s,isActive:!1,title:r,isOpen:!0,restoreCallback:a}),this.maxZIndex=Math.max(this.maxZIndex,s),s}bringToFront(e){const t=this.activeWindows.get(e);if(!t)return 9e3;this.activeWindows.forEach(((t,r)=>{r!==e&&(t.isActive=!1)}));const r=this.maxZIndex+1;return t.zIndex=r,t.isActive=!0,this.maxZIndex=r,r}unregisterWindow(e){this.activeWindows.delete(e)}getZIndex(e){const t=this.activeWindows.get(e);return(null==t?void 0:t.zIndex)||9e3}isActive(e){const t=this.activeWindows.get(e);return(null==t?void 0:t.isActive)||!1}getSubWindowZIndex(e){const t=this.activeWindows.get(e);return((null==t?void 0:t.zIndex)||9e3)+100}setWindowState(e,t){const r=this.activeWindows.get(e);r&&(r.isOpen=t)}getAllWindows(){return Array.from(this.activeWindows.entries())}restoreWindow(e){const t=this.activeWindows.get(e);if(null==t?void 0:t.restoreCallback)try{return t.restoreCallback(),t.isOpen=!0,!0}catch(r){return console.error("Error restoring window:",e,r),!1}return!1}updateWindowTitle(e,t){const r=this.activeWindows.get(e);r&&(r.title=t)}reset(){this.activeWindows.clear(),this.maxZIndex=9e3}};mt(pt,"instance");let ht=pt;const ut={getFontSize:e=>e<300?"10px":e<350?"11px":e<400?"12px":e<480?"13px":e<600?"14px":e<768?"15px":e<1024?"16px":"17px",getLineHeight:e=>e<300?"1.1":e<400?"1.2":e<500?"1.3":e<650?"1.4":e<800?"1.45":"1.5",getPadding:e=>e<300?"0.25rem":e<400?"0.375rem":e<500?"0.5rem":e<650?"0.625rem":e<800?"0.75rem":"1rem",getGridColumns:e=>e<350?1:e<500||e<650?2:e<800||e<1e3?3:e<1200?4:5,getContentMaxWidth:e=>e<400?"100%":e<600?"95%":e<800?"90%":e<1e3?"85%":"80%",getSpacing(e){const t=e<400?.5:e<600?.75:e<800?.85:e<1e3?1:1.15;return{xs:.25*t+"rem",sm:.5*t+"rem",md:1*t+"rem",lg:1.5*t+"rem",xl:2*t+"rem"}},getIconSize:e=>e<350?14:e<500?16:e<650?18:e<800?20:e<1e3?22:24,getButtonScale:e=>e<350?"0.75":e<500?"0.85":e<650?"0.95":"1",getOptimalWindowSize(e,t){const r=window.innerWidth,a=window.innerHeight,s=(window.devicePixelRatio||1)>1.5?1.1:1,o=r<480;let n,i;o?(n=.98,i=.98):r<768?(n=.96,i=.96):r<=1024?(n=.95,i=.9):r<=1366?(n=.9,i=.85):r<=1920?(n=.85,i=.8):(n=.75,i=.75);const l=Math.floor(r*n*s),c=Math.floor(a*i*s),d=Math.min(o?.95*r:320,.9*r),m=Math.min(o?.95*a:240,.85*a);return o?{width:l,height:c}:{width:Math.max(d,Math.min(e,l)),height:Math.max(m,Math.min(t,c))}},getDisplayScale(){const e=window.devicePixelRatio||1;return e>=3?1.2:e>=2?1.1:1},getOptimalLayout(e,t){const r=this.getGridColumns(e),a=Math.min(r,Math.ceil(Math.sqrt(t))),s=this.getSpacing(e);return{columns:a,itemWidth:`calc((100% - ${s.md} * ${a-1}) / ${a})`,gap:s.md}}};var gt=Object.defineProperty,yt=(e,t,r)=>((e,t,r)=>t in e?gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const xt=class e{constructor(){yt(this,"minimizedWindows",new Map),yt(this,"listeners",new Set)}static getInstance(){return e.instance||(e.instance=new e),e.instance}addMinimizedWindow(e,t,r,a){console.log("MinimizedWindowManager: Adding minimized window:",e,t);const s=this.getNextMinimizedPosition();this.minimizedWindows.set(e,{position:s,title:t,icon:r,restoreCallback:a}),console.log("MinimizedWindowManager: Current minimized windows:",this.minimizedWindows.size),this.notifyListeners()}restoreMinimizedWindow(e){console.log("MinimizedWindowManager: Trying to restore window:",e);const t=this.minimizedWindows.get(e);return(null==t?void 0:t.restoreCallback)?(console.log("MinimizedWindowManager: Found restore callback for window:",e),t.restoreCallback(),this.removeMinimizedWindow(e),!0):(console.log("MinimizedWindowManager: No restore callback found for window:",e),!1)}removeMinimizedWindow(e){this.minimizedWindows.delete(e),this.notifyListeners()}updateMinimizedPosition(e,t){const r=this.minimizedWindows.get(e);r&&(r.position=t,this.notifyListeners())}getMinimizedWindow(e){return this.minimizedWindows.get(e)}getAllMinimizedWindows(){return Array.from(this.minimizedWindows.entries())}addListener(e){this.listeners.add(e)}removeListener(e){this.listeners.delete(e)}notifyListeners(){this.listeners.forEach((e=>e()))}getNextMinimizedPosition(){const e=Array.from(this.minimizedWindows.values()).map((e=>e.position)),t=200,r=window.innerHeight-60-20;for(let a=0;a<12;a++){const s=20+212*a,o=r;if(s+t<window.innerWidth-20){if(!e.some((e=>Math.abs(e.x-s)<t&&Math.abs(e.y-o)<60)))return{x:s,y:o}}}for(let a=1;a<3;a++)for(let s=0;s<12;s++){const o=20+212*s,n=r-72*a;if(o+t<window.innerWidth-20&&n>100){if(!e.some((e=>Math.abs(e.x-o)<t&&Math.abs(e.y-n)<60)))return{x:o,y:n}}}return{x:Math.max(20,(window.innerWidth-t)/2),y:r}}};yt(xt,"instance");let ft=xt;function bt({windowId:r,title:a,icon:s,position:o,onRestore:i,onClose:l,themeState:c}){const d=Ge(c.theme),[m,p]=e.useState(!1),[h,u]=e.useState(!1),[g,y]=e.useState({x:0,y:0}),[x,f]=e.useState(o),[b,v]=e.useState(!1),[w,j]=e.useState(0),N=e.useRef(null),k=e.useRef(null),C=async()=>{if(!b){console.log("MinimizedWindowBubble: Starting restore for window:",r,a),v(!0);try{await i(),console.log("MinimizedWindowBubble: Restore completed for window:",r)}catch(e){console.error("MinimizedWindowBubble: Error restoring window:",r,e)}finally{setTimeout((()=>v(!1)),500)}}};return e.useEffect((()=>{const e=e=>{if(!m)return;e.preventDefault();const t=e.clientX-g.x,a=e.clientY-g.y,s=Math.max(10,Math.min(window.innerWidth-200-10,t)),o=Math.max(10,Math.min(window.innerHeight-60-10,a));f({x:s,y:o}),ft.getInstance().updateMinimizedPosition(r,{x:s,y:o})},t=()=>{p(!1),k.current&&(clearTimeout(k.current),k.current=null)};return m&&(document.addEventListener("mousemove",e,{passive:!1}),document.addEventListener("mouseup",t,{passive:!0}),document.body.style.userSelect="none",document.body.style.cursor="grabbing"),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t),document.body.style.userSelect="",document.body.style.cursor="",k.current&&clearTimeout(k.current)}}),[m,g,r]),e.useEffect((()=>()=>{k.current&&clearTimeout(k.current)}),[]),t.jsx("div",{ref:N,className:"fixed transition-all duration-300 ease-out transform-gpu group "+(b?"z-[10001] scale-110":m?"z-[10001] scale-105 rotate-1":"z-[9000] hover:scale-105 hover:-translate-y-1"),style:{left:x.x,top:x.y,width:"200px",height:"60px",cursor:m?"grabbing":"pointer",willChange:m?"transform, left, top":"auto"},onMouseDown:e=>{var t;if(0!==e.button)return;e.preventDefault();const r=Date.now();j(r);const a=null==(t=N.current)?void 0:t.getBoundingClientRect();a&&y({x:e.clientX-a.left,y:e.clientY-a.top}),k.current=setTimeout((()=>{p(!0)}),300)},onMouseUp:e=>{e.preventDefault(),e.stopPropagation(),k.current&&(clearTimeout(k.current),k.current=null);Date.now()-w<300&&!m&&C(),p(!1)},onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),title:b?`Restoring ${a}...`:`Click to restore ${a}`,children:t.jsx("div",{className:"w-full h-full rounded-xl border backdrop-blur-md transition-all duration-300 overflow-hidden",style:{backgroundColor:m?c.theme.colors.background.secondary:c.theme.colors.background.primary,borderColor:m||h?c.theme.colors.primary[500]:c.theme.colors.border.primary,boxShadow:m?`0 12px 24px rgba(0,0,0,0.15), 0 0 0 2px ${c.theme.colors.primary[500]}40`:h?"0 8px 16px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06)":"0 4px 8px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04)",filter:m?"brightness(1.05)":"brightness(1)"},children:t.jsxs("div",{className:"flex items-center h-full px-3 py-2 relative",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-lg flex items-center justify-center mr-3 transition-all duration-200",style:{backgroundColor:`${c.theme.colors.primary[500]}15`,border:`1px solid ${c.theme.colors.primary[300]}30`},children:s?t.jsx("div",{className:"text-lg transition-transform duration-200 group-hover:scale-110",style:{color:c.theme.colors.primary[600]},children:s}):t.jsx("div",{className:"text-xs font-bold transition-transform duration-200 group-hover:scale-110",style:{color:c.theme.colors.primary[600]},children:a.substring(0,2).toUpperCase()})}),t.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[t.jsx("h4",{className:"text-sm font-semibold truncate transition-colors duration-200",style:{color:c.theme.colors.text.primary},children:a}),t.jsx("p",{className:"text-xs truncate mt-0.5 transition-colors duration-200",style:{color:c.theme.colors.text.secondary},children:b?"Restoring...":"Click to restore"})]}),t.jsxs("div",{className:"flex-shrink-0 flex items-center space-x-1",children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),C()},disabled:b,className:"w-6 h-6 rounded-md flex items-center justify-center transition-all duration-200 hover:scale-110 disabled:opacity-50",style:{backgroundColor:h?`${c.theme.colors.primary[500]}20`:"transparent",color:c.theme.colors.primary[600]},title:"Restore window",children:b?t.jsx("div",{className:"w-3 h-3 border border-current border-t-transparent rounded-full animate-spin"}):t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),t.jsx("button",{onClick:e=>{e.stopPropagation(),l()},className:"w-6 h-6 rounded-md flex items-center justify-center transition-all duration-200 hover:scale-110 opacity-0 group-hover:opacity-100",style:{backgroundColor:h?d.status.error.light:"transparent",color:d.status.error.background},title:"Close window",children:t.jsx(n,{className:"w-3 h-3"})})]}),t.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 rounded-full transition-all duration-300",style:{backgroundColor:c.theme.colors.primary[500],boxShadow:`0 0 6px ${c.theme.colors.primary[500]}60`,animation:b?"pulse 1s ease-in-out infinite":"none"}}),t.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none transition-opacity duration-300",style:{background:`linear-gradient(135deg, ${c.theme.colors.primary[500]}08, ${c.theme.colors.primary[600]}12)`,opacity:h?1:0}})]})})})}function vt({isOpen:a,onClose:s,onMinimize:o,title:i,subtitle:l,icon:c,children:d,className:m="",defaultWidth:p="520px",defaultHeight:h="380px",minWidth:u=300,minHeight:g=220,maxWidth:y="95vw",maxHeight:x="95vh",resizable:f=!0,minimizable:b=!0,maximizable:v=!0,windowId:w=Math.random().toString(36).substr(2,9),zIndex:j=9e3,usePortal:N=!0}){const k=e.useRef(null),C=e.useRef(null),{state:S}=Xe(),A=Ge(S.theme),[I,P]=e.useState(!1),[T,E]=e.useState([]),[D,$]=e.useState(j),[M,O]=e.useState((()=>{const e=parseInt(p.replace(/[^0-9]/g,"")),t=parseInt(h.replace(/[^0-9]/g,""));return{isMaximized:!1,isMinimized:!1,position:{x:0,y:0},size:ut.getOptimalWindowSize(e,t),isDragging:!1,isResizing:!1,resizeDirection:void 0,dragOffset:{x:0,y:0},previousState:void 0}})),L=e.useCallback((()=>{console.log("WindowFrame: Starting restore for window:",w,i);ft.getInstance().removeMinimizedWindow(w),O((e=>({...e,isMinimized:!1,position:0===e.position.x&&0===e.position.y?{x:100,y:100}:e.position}))),setTimeout((()=>{const e=ht.getInstance().bringToFront(w);$(e),console.log("WindowFrame: Restore completed for window:",w,"new zIndex:",e)}),100)}),[w,i]);e.useEffect((()=>{const e=ht.getInstance(),t=e.registerWindow(w,j,i,L);return $(t),e.setWindowState(w,a),()=>{e.unregisterWindow(w)}}),[w,j,i,a,L]),e.useEffect((()=>{const e=ft.getInstance(),t=()=>{E(e.getAllMinimizedWindows())};return e.addListener(t),t(),()=>{e.removeListener(t)}}),[]),e.useEffect((()=>{const e=()=>{const e=window.innerWidth<768;if(P(e),e&&!M.isMinimized)O((e=>({...e,size:{width:window.innerWidth,height:window.innerHeight},position:{x:0,y:0},isMaximized:!0})));else if(!e&&!M.isMinimized&&!M.isMaximized){const e=M.size.width,t=M.size.height,r=ut.getOptimalWindowSize(e,t);e===r.width&&t===r.height||O((e=>({...e,size:r,position:{x:Math.max(0,(window.innerWidth-r.width)/2),y:Math.max(0,(window.innerHeight-r.height)/2)}})))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[M.isMinimized,M.isMaximized]),e.useEffect((()=>{if(a&&!M.isMaximized&&!M.previousState&&!M.isMinimized){const e=window.innerWidth,t=window.innerHeight,r=M.size.width,a=M.size.height,s=document.querySelectorAll(".window-frame");let o=0,n=0;s.length>1&&(o=30*(s.length-1),n=30*(s.length-1));const i=Math.max(20,Math.min((e-r)/2+o,e-r-20)),l=Math.max(40,Math.min((t-a)/2+n,t-a-20));O((e=>({...e,position:{x:i,y:l}})))}}),[a,M.isMaximized,M.previousState,M.isMinimized]),e.useEffect((()=>{var e;let t=null;const r=e=>{var r;if(M.isDragging&&!M.isMaximized&&!I&&M.dragOffset&&(e.preventDefault(),t&&cancelAnimationFrame(t),t=requestAnimationFrame((()=>{const t=e.clientX-M.dragOffset.x,r=e.clientY-M.dragOffset.y,a=M.size.width,s=M.size.height;let o=Math.max(-a/3,Math.min(window.innerWidth-a/3,t)),n=Math.max(0,Math.min(window.innerHeight-s,r));o<15&&(o=0),o>window.innerWidth-a-15&&(o=window.innerWidth-a),n<15&&(n=0),O((e=>({...e,position:{x:o,y:n}})))}))),M.isResizing&&M.resizeDirection&&!M.isMaximized){e.preventDefault();const a=null==(r=k.current)?void 0:r.getBoundingClientRect();if(!a)return;t&&cancelAnimationFrame(t),t=requestAnimationFrame((()=>{let t=M.size.width,r=M.size.height,s=M.position.x,o=M.position.y;const n=M.resizeDirection,i=Math.max(u,300),l=Math.max(g,220),c=Math.min(.95*window.innerWidth,parseInt((null==y?void 0:y.replace("vw",""))||"100")*window.innerWidth/100),d=Math.min(.95*window.innerHeight,parseInt((null==x?void 0:x.replace("vh",""))||"100")*window.innerHeight/100);if(n.includes("right")&&(t=Math.max(i,Math.min(c,e.clientX-a.left))),n.includes("bottom")&&(r=Math.max(l,Math.min(d,e.clientY-a.top))),n.includes("left")){const r=a.left-e.clientX;t=Math.max(i,Math.min(c,a.width+r)),s=Math.max(0,a.left-(t-a.width))}if(n.includes("top")){const t=a.top-e.clientY;r=Math.max(l,Math.min(d,a.height+t)),o=Math.max(0,a.top-(r-a.height))}s+t>window.innerWidth&&(s=Math.max(0,window.innerWidth-t)),o+r>window.innerHeight&&(o=Math.max(0,window.innerHeight-r)),O((e=>({...e,size:{width:t,height:r},position:{x:s,y:o}})))}))}},a=()=>{t&&(cancelAnimationFrame(t),t=null),O((e=>({...e,isDragging:!1,isResizing:!1,resizeDirection:void 0,dragOffset:{x:0,y:0}})))};return(M.isDragging||M.isResizing)&&(document.addEventListener("mousemove",r,{passive:!1}),document.addEventListener("mouseup",a,{passive:!0}),document.body.style.userSelect="none",document.body.style.cursor=M.isResizing?`${null==(e=M.resizeDirection)?void 0:e.replace("-","")}-resize`:"grabbing"),()=>{t&&cancelAnimationFrame(t),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a),document.body.style.userSelect="",document.body.style.cursor=""}}),[M.isDragging,M.isResizing,M.isMaximized,M.dragOffset,M.resizeDirection,M.size,u,g,y,x,I]);const F=e=>{var t;if(M.isMaximized||M.isMinimized)return;e.preventDefault();const r=null==(t=C.current)?void 0:t.getBoundingClientRect();if(!r)return;let a,s;"touches"in e?(a=e.touches[0].clientX,s=e.touches[0].clientY):(a=e.clientX,s=e.clientY),O((e=>({...e,isDragging:!0,dragOffset:{x:a-r.left,y:s-r.top}})))},z=e=>t=>{M.isMaximized||M.isMinimized||(t.preventDefault(),t.stopPropagation(),O((t=>({...t,isResizing:!0,resizeDirection:e}))))},R=()=>{if(!M.isMinimized)if(o)console.log("WindowFrame: Using custom onMinimize handler for window:",w),o();else{console.log("WindowFrame: Using default minimize behavior for window:",w);ft.getInstance().addMinimizedWindow(w,i,c,L),O((e=>({...e,isMinimized:!0})))}},U=()=>{ft.getInstance().removeMinimizedWindow(w),k.current?(k.current.style.transition="transform 0.2s ease-out, opacity 0.2s ease-out",k.current.style.transform="scale(0.95) translateY(-10px)",k.current.style.opacity="0",setTimeout((()=>{s()}),200)):s()};if(!a)return null;const W=T.filter((([e])=>e!==w)).map((([e,r])=>t.jsx(bt,{windowId:e,title:r.title,icon:r.icon,position:r.position,onRestore:()=>{if(!ft.getInstance().restoreMinimizedWindow(e)){ht.getInstance().restoreWindow(e)||console.warn("Could not restore window:",e,"No restore callback registered in either manager")}},onClose:()=>{ft.getInstance().removeMinimizedWindow(e)},themeState:S},e)));if(M.isMinimized){const e=ft.getInstance().getMinimizedWindow(w);if(e){const a=t.jsxs(t.Fragment,{children:[W,t.jsx(bt,{windowId:w,title:i,icon:c,position:e.position,onRestore:L,onClose:U,themeState:S})]});return N?r.createPortal(a,document.body):a}}if(I){const e=t.jsxs(t.Fragment,{children:[W,t.jsxs("div",{className:"fixed inset-0 z-[9999] flex flex-col safe-area-mobile bg-primary",style:{backgroundColor:S.theme.colors.background.primary},children:[t.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b safe-top-mobile bg-secondary",style:{backgroundColor:S.theme.colors.background.secondary,borderColor:S.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 min-w-0",children:[c&&t.jsx("div",{className:"flex-shrink-0",style:{color:S.theme.colors.text.primary},children:c}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h3",{className:"font-semibold text-sm sm:text-base text-primary-theme truncate",children:i}),l&&t.jsx("p",{className:"text-xs sm:text-sm text-secondary-theme truncate",children:l})]})]}),t.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 flex-shrink-0",children:[b&&t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),R()},onTouchStart:e=>{e.stopPropagation()},className:"p-2 hover:bg-tertiary rounded-lg transition-colors touch-manipulation",title:"Minimize",children:t.jsx(G,{className:"w-4 h-4 sm:w-5 sm:h-5 text-secondary-theme"})}),t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),U()},onTouchStart:e=>{e.stopPropagation()},className:"p-2 hover:bg-red-100 hover:text-red-600 rounded-lg transition-colors touch-manipulation",title:"Close",children:t.jsx(n,{className:"w-4 h-4 sm:w-5 sm:h-5 text-secondary-theme"})})]})]}),t.jsx("div",{className:"flex-1 overflow-hidden safe-bottom-mobile bg-primary",style:{backgroundColor:S.theme.colors.background.primary},children:t.jsx("div",{className:"h-full overflow-y-auto",style:{fontSize:ut.getFontSize(window.innerWidth),lineHeight:ut.getLineHeight(window.innerWidth),padding:ut.getPadding(window.innerWidth)},children:d})})]})]});return N?r.createPortal(e,document.body):e}const _={left:M.isMaximized?0:Math.max(0,Math.min(window.innerWidth-320,M.position.x)),top:M.isMaximized?0:Math.max(0,Math.min(window.innerHeight-240,M.position.y)),width:M.isMaximized?"100vw":Math.min(.95*window.innerWidth,M.size.width),height:M.isMaximized?"100vh":Math.min(.95*window.innerHeight,M.size.height),zIndex:M.isDragging||M.isResizing?1e4:D,transform:M.isDragging?"scale(1.01) translateZ(0)":"scale(1) translateZ(0)",transition:M.isDragging||M.isResizing?"none":"transform 0.15s ease-out, box-shadow 0.15s ease-out",willChange:M.isDragging||M.isResizing?"transform, left, top, width, height":"auto",backfaceVisibility:"hidden"},B=t.jsxs(t.Fragment,{children:[W,t.jsxs("div",{ref:k,className:`window-frame fixed rounded-xl shadow-2xl overflow-hidden border-2 transform-gpu ${M.isDragging?"dragging":""} ${M.isResizing?"resizing":""} ${m}`,style:{..._,backgroundColor:S.theme.colors.background.primary,borderColor:M.isDragging||M.isResizing?S.theme.colors.primary[500]:S.theme.colors.border.primary,boxShadow:M.isDragging||M.isResizing?`${A.shadows.xl}, 0 0 0 3px ${S.theme.colors.primary[500]}30`:A.shadows.lg},onClick:()=>{const e=ht.getInstance().bringToFront(w);$(e)},children:[t.jsxs("div",{ref:C,className:"flex items-center justify-between px-3 sm:px-4 py-2 sm:py-3 border-b glass-effect",style:{backgroundColor:S.theme.colors.background.secondary,borderColor:S.theme.colors.border.primary,backdropFilter:"blur(20px)"},children:[t.jsxs("div",{className:"flex items-center space-x-1.5 sm:space-x-2",children:[t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),U()},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:"rounded-full transition-all duration-200 hover:scale-110 shadow-sm",style:{width:"10px",height:"10px",backgroundColor:A.window.controls.close.background},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=A.window.controls.close.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=A.window.controls.close.background},title:"Close"}),b&&t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),R()},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:"rounded-full transition-all duration-200 hover:scale-110 shadow-sm",style:{width:"10px",height:"10px",backgroundColor:A.window.controls.minimize.background},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=A.window.controls.minimize.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=A.window.controls.minimize.background},title:"Minimize"}),v&&t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),O((e=>{var t,r;return e.isMaximized?{...e,isMaximized:!1,position:(null==(t=e.previousState)?void 0:t.position)||{x:100,y:100},size:(null==(r=e.previousState)?void 0:r.size)||{width:parseInt(p.replace("px","")),height:parseInt(h.replace("px",""))},previousState:void 0}:{...e,isMaximized:!0,previousState:{position:e.position,size:e.size}}}))},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},className:"rounded-full transition-all duration-200 hover:scale-110 shadow-sm",style:{width:"10px",height:"10px",backgroundColor:A.window.controls.maximize.background},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=A.window.controls.maximize.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=A.window.controls.maximize.background},title:M.isMaximized?"Restore":"Maximize"})]}),t.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3 flex-1 justify-center min-w-0 "+(M.isDragging?"cursor-grabbing":"cursor-grab"),onMouseDown:F,onTouchStart:F,children:[c&&t.jsx("div",{className:"flex-shrink-0",style:{color:S.theme.colors.text.primary,fontSize:`${ut.getIconSize(M.size.width)}px`},children:c}),t.jsxs("div",{className:"text-center min-w-0",children:[t.jsx("h3",{className:"font-semibold text-xs sm:text-sm truncate",style:{color:S.theme.colors.text.primary},children:i}),l&&t.jsx("p",{className:"text-xs truncate",style:{color:S.theme.colors.text.secondary},children:l})]})]}),t.jsx("div",{className:"flex items-center space-x-1 text-xs flex-shrink-0 pointer-events-none",style:{color:S.theme.colors.text.tertiary},children:M.isMaximized?t.jsx(G,{className:"w-3 h-3 sm:w-4 sm:h-4"}):t.jsx(V,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]}),t.jsx("div",{className:"flex-1 overflow-hidden relative w-full",style:{backgroundColor:S.theme.colors.background.primary,height:`calc(100% - ${M.size.height<400?"44px":"54px"})`},children:t.jsx("div",{className:"w-full h-full overflow-y-auto scrollable",style:{fontSize:ut.getFontSize(M.size.width),lineHeight:ut.getLineHeight(M.size.width)},children:d})}),f&&!M.isMaximized&&!I&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"absolute top-0 left-0 w-3 h-3 cursor-nw-resize transition-colors duration-200 opacity-0 hover:opacity-50 rounded-br-lg",style:{backgroundColor:"transparent"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=S.theme.colors.primary[300]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},onMouseDown:z("top-left")}),t.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 cursor-ne-resize hover:bg-primary-300 transition-colors duration-200 opacity-0 hover:opacity-50 rounded-bl-lg",onMouseDown:z("top-right")}),t.jsx("div",{className:"absolute bottom-0 left-0 w-3 h-3 cursor-sw-resize hover:bg-primary-300 transition-colors duration-200 opacity-0 hover:opacity-50 rounded-tr-lg",onMouseDown:z("bottom-left")}),t.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 cursor-se-resize hover:bg-primary-300 transition-colors duration-200 opacity-0 hover:opacity-50 rounded-tl-lg",onMouseDown:z("bottom-right")}),t.jsx("div",{className:"absolute top-0 left-3 right-3 h-1 cursor-n-resize hover:bg-primary-200 transition-colors duration-200 opacity-0 hover:opacity-30",onMouseDown:z("top")}),t.jsx("div",{className:"absolute bottom-0 left-3 right-3 h-1 cursor-s-resize hover:bg-primary-200 transition-colors duration-200 opacity-0 hover:opacity-30",onMouseDown:z("bottom")}),t.jsx("div",{className:"absolute left-0 top-3 bottom-3 w-1 cursor-w-resize hover:bg-primary-200 transition-colors duration-200 opacity-0 hover:opacity-30",onMouseDown:z("left")}),t.jsx("div",{className:"absolute right-0 top-3 bottom-3 w-1 cursor-e-resize hover:bg-primary-200 transition-colors duration-200 opacity-0 hover:opacity-30",onMouseDown:z("right")})]})]})]});return N?r.createPortal(B,document.body):B}const wt={style:"photorealistic",quality:"standard",aspectRatio:"16:9",size:"1024x1024",model:"dall-e-3",creativity:7,artStyle:"cinematic",lighting:"natural",mood:"neutral",colorScheme:"full-color"};function jt({isOpen:r,onClose:a,onSave:s,currentSettings:o}){const[n,i]=e.useState(o||wt);e.useEffect((()=>{i(o||wt)}),[o,r]);const l=(e,t)=>{i((r=>({...r,[e]:t})))};return r?t.jsxs(vt,{isOpen:r,onClose:a,title:"AI Image Generation Settings",subtitle:"Customize AI image creation parameters",icon:t.jsx(g,{className:"w-5 h-5"}),defaultWidth:"600px",defaultHeight:"700px",minWidth:500,minHeight:600,maxWidth:"800px",maxHeight:"900px",resizable:!0,minimizable:!0,maximizable:!0,windowId:"ai-image-settings",zIndex:9500,children:[t.jsxs("div",{className:"p-6 space-y-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"AI Model"}),t.jsx("select",{value:n.model,onChange:e=>l("model",e.target.value),className:"select-modern w-full",children:t.jsx("option",{value:"dall-e-3",children:"DALL-E 3"})}),t.jsx("p",{className:"text-xs text-secondary",children:"DALL-E 3 provides the highest quality images and best prompt adherence (DALL-E 2 has been discontinued)"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Image Style"}),t.jsxs("select",{value:n.style,onChange:e=>l("style",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"photorealistic",children:"Photorealistic"}),t.jsx("option",{value:"illustration",children:"Illustration"}),t.jsx("option",{value:"cartoon",children:"Cartoon"}),t.jsx("option",{value:"sketch",children:"Sketch"}),t.jsx("option",{value:"artistic",children:"Artistic"}),t.jsx("option",{value:"comic",children:"Comic Book"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Art Style"}),t.jsxs("select",{value:n.artStyle,onChange:e=>l("artStyle",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"cinematic",children:"Cinematic"}),t.jsx("option",{value:"dramatic",children:"Dramatic"}),t.jsx("option",{value:"minimalist",children:"Minimalist"}),t.jsx("option",{value:"vintage",children:"Vintage"}),t.jsx("option",{value:"modern",children:"Modern"}),t.jsx("option",{value:"fantasy",children:"Fantasy"}),t.jsx("option",{value:"noir",children:"Film Noir"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Quality"}),t.jsxs("select",{value:n.quality,onChange:e=>l("quality",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"standard",children:"Standard"}),t.jsx("option",{value:"hd",children:"HD (Higher Quality)"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Size"}),t.jsxs("select",{value:n.size,onChange:e=>l("size",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"1024x1024",children:"Square (1024x1024)"}),t.jsx("option",{value:"1792x1024",children:"Landscape (1792x1024)"}),t.jsx("option",{value:"1024x1792",children:"Portrait (1024x1792)"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Lighting"}),t.jsxs("select",{value:n.lighting,onChange:e=>l("lighting",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"natural",children:"Natural"}),t.jsx("option",{value:"dramatic",children:"Dramatic"}),t.jsx("option",{value:"soft",children:"Soft"}),t.jsx("option",{value:"golden-hour",children:"Golden Hour"}),t.jsx("option",{value:"moody",children:"Moody"}),t.jsx("option",{value:"bright",children:"Bright"}),t.jsx("option",{value:"low-light",children:"Low Light"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Mood"}),t.jsxs("select",{value:n.mood,onChange:e=>l("mood",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"neutral",children:"Neutral"}),t.jsx("option",{value:"happy",children:"Happy"}),t.jsx("option",{value:"dramatic",children:"Dramatic"}),t.jsx("option",{value:"mysterious",children:"Mysterious"}),t.jsx("option",{value:"peaceful",children:"Peaceful"}),t.jsx("option",{value:"energetic",children:"Energetic"}),t.jsx("option",{value:"melancholic",children:"Melancholic"})]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-medium text-primary",children:"Color Scheme"}),t.jsxs("select",{value:n.colorScheme,onChange:e=>l("colorScheme",e.target.value),className:"select-modern w-full",children:[t.jsx("option",{value:"full-color",children:"Full Color"}),t.jsx("option",{value:"monochrome",children:"Monochrome"}),t.jsx("option",{value:"warm-tones",children:"Warm Tones"}),t.jsx("option",{value:"cool-tones",children:"Cool Tones"}),t.jsx("option",{value:"sepia",children:"Sepia"}),t.jsx("option",{value:"high-contrast",children:"High Contrast"})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("label",{className:"block text-sm font-medium text-primary",children:["Creativity Level: ",n.creativity,"/10"]}),t.jsx("input",{type:"range",min:"1",max:"10",value:n.creativity,onChange:e=>l("creativity",parseInt(e.target.value)),className:"w-full h-2 bg-secondary rounded-lg appearance-none cursor-pointer"}),t.jsxs("div",{className:"flex justify-between text-xs text-secondary",children:[t.jsx("span",{children:"Conservative"}),t.jsx("span",{children:"Balanced"}),t.jsx("span",{children:"Creative"})]}),t.jsx("p",{className:"text-xs text-secondary",children:"Higher creativity may produce more artistic but less predictable results"})]}),t.jsxs("div",{className:"bg-secondary p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-primary mb-2",children:"Style Preview"}),t.jsxs("p",{className:"text-sm text-secondary",children:["Your images will be generated as ",n.style," ",n.artStyle," style with ",n.lighting," lighting,",n.mood," mood, and ",n.colorScheme," colors using ",n.model.toUpperCase(),"."]})]})]}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-primary",children:[t.jsxs("button",{onClick:()=>{i(wt)},className:"btn-secondary flex items-center space-x-2",children:[t.jsx(J,{className:"w-4 h-4"}),t.jsx("span",{children:"Reset to Defaults"})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:a,className:"btn-secondary",children:"Cancel"}),t.jsxs("button",{onClick:()=>{s(n),a()},className:"btn-primary flex items-center space-x-2",children:[t.jsx(v,{className:"w-4 h-4"}),t.jsx("span",{children:"Save Settings"})]})]})]})]}):null}const Nt=[{id:"director-visionary",name:"Maya Vision",description:"Cinematic storytelling expert who transforms ideas into compelling visual narratives",specialty:"Cinematic Direction",personality:"inspiring",skills:["Visual Storytelling","Scene Composition","Narrative Structure","Emotional Arcs"],avatar:"🎬",prompt:"Hey there! I'm Maya Vision, and I live and breathe cinematic storytelling! 🎬 I see every story as a canvas of light, shadow, and emotion. When you share an idea with me, I don't just think about scenes - I envision how each moment will make the audience FEEL. I love talking about dramatic compositions, character arcs, and those spine-tingling moments that give viewers goosebumps. My approach is bold, visionary, and always focused on emotional impact. Let's create something that people will remember long after the credits roll!",theme:{primary:"#8B5CF6",secondary:"#A78BFA",accent:"#DDD6FE",gradient:"from-purple-500 to-pink-500"},examples:["Create a dramatic opening sequence","Design a climactic confrontation scene","Build tension through visual storytelling"]},{id:"director-indie",name:"Alex Craft",description:"Independent filmmaker focused on authentic, character-driven stories",specialty:"Indie Filmmaking",personality:"creative",skills:["Character Development","Authentic Dialogue","Intimate Cinematography","Raw Emotions"],avatar:"🎪",prompt:"What's up! I'm Alex, and honestly? I'm all about keeping it real. 🎪 I don't need fancy effects or huge budgets - give me authentic human moments and I'll show you magic. I love intimate conversations, raw emotions, and those quiet moments that reveal who people really are. My films feel like you're peeking into someone's actual life, not watching actors perform. I'm passionate about character development and making every line of dialogue feel natural. Let's tell stories that matter!",theme:{primary:"#F59E0B",secondary:"#FBBF24",accent:"#FEF3C7",gradient:"from-amber-500 to-orange-500"},examples:["Develop complex character backstories","Create intimate conversation scenes","Design realistic environments"]},{id:"tech-cinematographer",name:"Zoe Lens",description:"Master of camera work, lighting, and visual composition",specialty:"Cinematography",personality:"professional",skills:["Camera Angles","Lighting Design","Color Theory","Shot Composition"],avatar:"📹",prompt:"Hello! I'm Zoe Lens, and I'm absolutely obsessed with the technical craft of visual storytelling! 📹 Every shot is a puzzle to solve - what lens tells this story best? How does lighting shape the mood? I get genuinely excited talking f-stops, color temperatures, and camera movements. I believe the technical choices should be invisible to viewers but essential to the story. I'll help you choose the perfect angles and lighting to make your vision come alive on screen!",theme:{primary:"#06B6D4",secondary:"#67E8F9",accent:"#CFFAFE",gradient:"from-cyan-500 to-blue-500"},examples:["Suggest camera angles for emotional impact","Design lighting setups for mood","Choose color schemes for scenes"]},{id:"tech-editor",name:"Sam Montage",description:"Post-production wizard specializing in pacing, transitions, and flow",specialty:"Editing & Post-Production",personality:"analytical",skills:["Pacing Control","Transition Design","Rhythm Analysis","Flow Optimization"],avatar:"✂️",prompt:"Hey! Sam here - I think in beats, rhythms, and the invisible art of editing! ✂️ Most people don't realize that editing is where the real magic happens. I can feel when a scene needs to breathe, when to cut for maximum impact, or when a transition can elevate the story. I analyze pacing like a musician studies rhythm. Every cut matters, every transition tells a story. Let me help you find the perfect flow for your narrative!",theme:{primary:"#10B981",secondary:"#34D399",accent:"#D1FAE5",gradient:"from-emerald-500 to-teal-500"},examples:["Optimize scene pacing and rhythm","Suggest creative transitions","Analyze narrative flow"]},{id:"genre-action",name:"Rex Thunder",description:"High-octane action sequences and adrenaline-pumping scenes",specialty:"Action & Thriller",personality:"enthusiastic",skills:["Action Choreography","Tension Building","Dynamic Movement","Explosive Sequences"],avatar:"💥",prompt:"BOOM! Rex Thunder here, and I LIVE for adrenaline! 💥 Every scene should make your heart race and your palms sweat! I think in explosions, car chases, and death-defying stunts. When planning action, I consider the physics, the choreography, and most importantly - the IMPACT! I want audiences on the edge of their seats, grabbing their armrests. Let's create action sequences that are not just exciting, but absolutely LEGENDARY!",theme:{primary:"#EF4444",secondary:"#F87171",accent:"#FEE2E2",gradient:"from-red-500 to-orange-600"},examples:["Design thrilling chase sequences","Create explosive action scenes","Build suspenseful moments"]},{id:"genre-horror",name:"Raven Dark",description:"Master of psychological horror and spine-chilling atmospheres",specialty:"Horror & Suspense",personality:"calm",skills:["Atmospheric Horror","Psychological Tension","Fear Mechanics","Supernatural Elements"],avatar:"🌙",prompt:"Greetings... I'm Raven Dark, and I dwell in the shadows between fear and fascination. 🌙 True horror isn't about cheap scares - it's about crawling under your skin and staying there. I craft psychological tension like a spider weaves its web, slowly, deliberately. I understand what makes people's breath catch, their pulse quicken. Fear is an art form, and atmosphere is my paintbrush. Let's explore the darker corners of storytelling together... if you dare.",theme:{primary:"#6366F1",secondary:"#818CF8",accent:"#E0E7FF",gradient:"from-indigo-600 to-purple-700"},examples:["Build psychological tension","Create spine-chilling atmospheres","Design supernatural encounters"]},{id:"genre-comedy",name:"Charlie Laugh",description:"Comedy timing expert with a knack for visual humor",specialty:"Comedy & Humor",personality:"witty",skills:["Comic Timing","Visual Gags","Character Comedy","Situational Humor"],avatar:"😄",prompt:"Hey hey hey! Charlie Laugh here, and life's too short not to laugh! 😄 I see comedy in everything - a perfectly timed pratfall, a brilliant visual gag, or just the absurdity of everyday life. Comedy is all about timing, setup, and knowing your audience. I love creating moments that make people snort-laugh or chuckle to themselves hours later. Whether it's slapstick, witty banter, or visual puns, I'm here to add some joy to your story!",theme:{primary:"#F97316",secondary:"#FB923C",accent:"#FED7AA",gradient:"from-orange-500 to-yellow-500"},examples:["Create hilarious visual gags","Design comedic character interactions","Perfect comic timing in scenes"]},{id:"genre-romance",name:"Luna Heart",description:"Romance specialist creating heartfelt, emotionally resonant love stories",specialty:"Romance & Drama",personality:"friendly",skills:["Emotional Storytelling","Romantic Chemistry","Intimate Moments","Character Connections"],avatar:"💕",prompt:"Oh hi there! I'm Luna Heart, and I absolutely believe in the magic of love stories! 💕 Every romance should make your heart flutter and your soul sigh with contentment. I craft those butterflies-in-your-stomach moments, the lingering glances, the perfect first kisses. I understand that true romance is about emotional vulnerability and authentic connection. Let me help you create love stories that make people believe in happily ever after!",theme:{primary:"#EC4899",secondary:"#F472B6",accent:"#FCE7F3",gradient:"from-pink-500 to-rose-500"},examples:["Design romantic meet-cute scenes","Create emotionally intimate moments","Build romantic tension"]},{id:"animation-2d",name:"Sketch Toon",description:"2D animation expert bringing drawings to life with personality",specialty:"2D Animation",personality:"creative",skills:["Character Animation","Keyframe Design","Motion Principles","Expressive Movement"],avatar:"✏️",prompt:"Hi there, animation lover! I'm Sketch Toon, and I make drawings DANCE! ✏️ Every frame is a chance to bring personality to life. I think in squash and stretch, anticipation and follow-through. 2D animation is pure magic - taking static drawings and giving them soul! I love expressive character animation, bouncy movements, and those little details that make characters feel alive. Let's animate something amazing together!",theme:{primary:"#8B5CF6",secondary:"#A78BFA",accent:"#DDD6FE",gradient:"from-violet-500 to-purple-600"},examples:["Design character animation sequences","Create expressive character movements","Plan keyframe animations"]},{id:"animation-3d",name:"Vector Prime",description:"3D animation and CGI specialist for complex visual effects",specialty:"3D Animation & CGI",personality:"analytical",skills:["3D Modeling","Rigging","Particle Effects","Photorealistic Rendering"],avatar:"🎯",prompt:"Greetings! Vector Prime here - I work in dimensions beyond the flat screen! 🎯 3D animation is where physics meets artistry. I love crafting photorealistic renders, complex particle systems, and seamless CGI integration. Every polygon, every shader, every light bounce serves the story. I think in mathematical precision but dream in cinematic beauty. Let's build worlds that look so real, audiences will forget they're watching animation!",theme:{primary:"#0EA5E9",secondary:"#38BDF8",accent:"#E0F2FE",gradient:"from-sky-500 to-cyan-500"},examples:["Design complex 3D sequences","Create photorealistic effects","Plan advanced CGI scenes"]},{id:"fantasy-world",name:"Mystic Sage",description:"Fantasy and sci-fi world builder creating magical realms",specialty:"Fantasy & Sci-Fi",personality:"inspiring",skills:["World Building","Magic Systems","Creature Design","Mythology Creation"],avatar:"🔮",prompt:"Ah, welcome, fellow dreamer! I am Mystic Sage, keeper of infinite worlds and weaver of impossible tales! 🔮 In my realm, magic flows like rivers and technology bends reality itself. I craft mythologies that span millennia, magic systems with their own logic, and worlds where anything is possible. Every creature has a story, every spell has consequences. Let us venture beyond the mundane into realms of pure imagination!",theme:{primary:"#7C3AED",secondary:"#8B5CF6",accent:"#EDE9FE",gradient:"from-purple-600 to-indigo-600"},examples:["Design magical fantasy worlds","Create mythical creatures","Build complex magic systems"]},{id:"doc-narrator",name:"David Truth",description:"Documentary filmmaker focused on factual, educational content",specialty:"Documentary",personality:"professional",skills:["Factual Research","Educational Content","Interview Techniques","Objective Storytelling"],avatar:"📚",prompt:"Hello there! I'm David Truth, and I believe every real story deserves to be told with integrity and clarity. 📚 Documentary filmmaking is about revealing truth, one frame at a time. I approach each project with journalistic rigor but cinematic heart. I love uncovering hidden stories, conducting revealing interviews, and making complex topics accessible. Facts are our foundation, but emotion is what makes people care. Let's illuminate some truth together!",theme:{primary:"#059669",secondary:"#10B981",accent:"#D1FAE5",gradient:"from-emerald-600 to-green-600"},examples:["Create educational documentary sequences","Design informative interviews","Present complex topics clearly"]},{id:"corp-brand",name:"Madison Brand",description:"Corporate storytelling expert for professional and marketing content",specialty:"Corporate & Marketing",personality:"professional",skills:["Brand Storytelling","Marketing Psychology","Professional Presentation","Corporate Communication"],avatar:"💼",prompt:"Good day! Madison Brand here, and I transform business goals into compelling visual narratives! 💼 Corporate storytelling isn't about boring boardrooms - it's about connecting with people on a human level while achieving business objectives. I understand brand psychology, market positioning, and how to make professional content that actually engages. Every brand has a story worth telling beautifully. Let's craft something that's both professional AND memorable!",theme:{primary:"#4F46E5",secondary:"#6366F1",accent:"#E0E7FF",gradient:"from-indigo-600 to-blue-600"},examples:["Create professional brand stories","Design marketing presentations","Develop corporate communications"]},{id:"audio-composer",name:"Harmony Sound",description:"Audio-visual specialist focusing on music and sound design",specialty:"Audio & Music",personality:"creative",skills:["Music Composition","Sound Design","Audio-Visual Sync","Emotional Scoring"],avatar:"🎵",prompt:"Hey music lover! I'm Harmony Sound, and I hear stories in symphonies and emotions in frequencies! 🎵 Sound is 50% of the filmmaking experience - it's what makes hearts race, tears fall, and spines tingle. I craft audio landscapes that complement and elevate visuals. Every note, every sound effect, every moment of silence serves the story. Music and sound design aren't just accompaniment - they're storytelling partners! Let's compose something beautiful!",theme:{primary:"#DC2626",secondary:"#EF4444",accent:"#FEE2E2",gradient:"from-red-600 to-pink-600"},examples:["Design musical sequences","Create sound-driven narratives","Plan audio-visual synchronization"]},{id:"exp-abstract",name:"Neo Flux",description:"Experimental artist pushing boundaries with abstract and surreal concepts",specialty:"Experimental & Abstract",personality:"creative",skills:["Abstract Concepts","Surreal Imagery","Experimental Techniques","Boundary Pushing"],avatar:"🌈",prompt:"Greetings, creative soul! I'm Neo Flux, and I exist to shatter expectations and rebuild them as art! 🌈 Why follow rules when you can create new ones? I thrive in the space between dreams and reality, where logic bends and beauty emerges from chaos. Experimental storytelling is about feeling rather than understanding, about provoking thought rather than providing answers. Let's create something that has never existed before - something wonderfully, brilliantly unconventional!",theme:{primary:"#DB2777",secondary:"#EC4899",accent:"#FCE7F3",gradient:"from-pink-600 to-purple-600"},examples:["Create abstract visual concepts","Design surreal dream sequences","Push creative boundaries"]},{id:"director-blockbuster",name:"Max Epic",description:"Blockbuster specialist creating spectacular large-scale entertainment",specialty:"Blockbuster Films",personality:"enthusiastic",skills:["Epic Storytelling","Spectacle Design","Mass Appeal","Franchise Building"],avatar:"🎪",prompt:"HELLO THERE! Max Epic at your service, and I think BIG! 🎪 Every story deserves to be told on the grandest scale possible! I create films that fill IMAX screens and make audiences cheer in unison. I love spectacular set pieces, larger-than-life characters, and moments that make people gasp in wonder. Blockbusters aren't just entertainment - they're shared cultural experiences that bring the world together! Let's create something EPIC!",theme:{primary:"#FF6B35",secondary:"#FF8E53",accent:"#FFD3AA",gradient:"from-orange-600 to-red-600"},examples:["Design an epic opening sequence","Create spectacular action set pieces","Build franchise-worthy characters"]},{id:"director-arthouse",name:"Celeste Artfilm",description:"Art house cinema expert focused on deeply personal and avant-garde narratives",specialty:"Art House Cinema",personality:"inspiring",skills:["Personal Narratives","Symbolic Imagery","Festival Programming","Cultural Commentary"],avatar:"🎨",prompt:"Bonjour, mon ami! I am Celeste Artfilm, and I believe cinema is the highest form of artistic expression! 🎨 My films are poems written in light and shadow, exploring the deepest corners of the human experience. I craft stories that linger in minds long after viewing, that spark conversations in coffee shops and film school corridors. Art house cinema isn't entertainment - it's transformation. Let us create something profoundly beautiful and deeply meaningful!",theme:{primary:"#6366F1",secondary:"#818CF8",accent:"#E0E7FF",gradient:"from-indigo-600 to-purple-600"},examples:["Craft deeply symbolic scenes","Explore personal transformation","Design festival-worthy narratives"]},{id:"tech-vfx",name:"Phoenix Digital",description:"Visual effects supervisor creating impossible worlds through digital artistry",specialty:"Visual Effects",personality:"analytical",skills:["Digital Compositing","Motion Tracking","Virtual Environments","Creature Effects"],avatar:"🔥",prompt:"Hey! Phoenix Digital here, and I make the impossible look effortlessly real! 🔥 VFX isn't about showing off technology - it's about serving the story with invisible magic. I live in the intersection of artistry and technology, where imagination meets pixels. Every effect should feel so natural that audiences never question it. I love solving visual puzzles that seem impossible until we crack the code. Let's create some digital magic!",theme:{primary:"#FF4500",secondary:"#FF6347",accent:"#FFE4E1",gradient:"from-red-500 to-orange-500"},examples:["Design seamless VFX integration","Create impossible environments","Plan complex digital creatures"]},{id:"tech-colorist",name:"Iris Spectrum",description:"Color grading artist who paints emotions with light and hue",specialty:"Color Grading",personality:"creative",skills:["Color Psychology","Mood Enhancement","Skin Tone Perfection","Style Creation"],avatar:"🌈",prompt:"Hi beautiful human! I'm Iris Spectrum, and I paint with every color in existence! 🌈 Color isn't just pretty - it's psychology, emotion, and storytelling all in one. I can make a scene feel warm and cozy or cold and threatening just by adjusting the palette. Every hue tells a story, every saturation level affects emotion. I see the world in endless color possibilities and I'm excited to help you find the perfect palette for your vision!",theme:{primary:"#9333EA",secondary:"#A855F7",accent:"#E9D5FF",gradient:"from-purple-600 to-pink-500"},examples:["Create emotional color palettes","Design signature visual styles","Enhance story through color"]},{id:"genre-scifi",name:"Nova Cosmos",description:"Science fiction visionary exploring humanity's future among the stars",specialty:"Science Fiction",personality:"analytical",skills:["Future Technology","Space Environments","Alien Cultures","Scientific Accuracy"],avatar:"🚀",prompt:"Greetings, Earth-dweller! Nova Cosmos here, broadcasting from the infinite possibilities of tomorrow! 🚀 Science fiction isn't just about cool gadgets and space battles - it's about exploring what it means to be human in an ever-changing universe. I love crafting plausible futures, alien cultures with their own logic, and technology that feels both advanced and believable. Sci-fi is humanity's way of practicing for the future! Let's explore the cosmos together!",theme:{primary:"#0EA5E9",secondary:"#38BDF8",accent:"#E0F2FE",gradient:"from-cyan-500 to-blue-600"},examples:["Design futuristic societies","Create believable alien worlds","Explore technological implications"]},{id:"genre-western",name:"Dusty Frontier",description:"Western storyteller who captures the spirit of the American frontier",specialty:"Western Films",personality:"calm",skills:["Frontier Life","Moral Conflicts","Landscape Cinematography","Period Authenticity"],avatar:"🤠",prompt:"Howdy, partner! Dusty Frontier here, and I reckon there ain't nothin' quite like a good Western! 🤠 The frontier represents freedom, justice, and the endless possibility of redemption. I craft stories about moral choices in harsh landscapes, where character is tested by both nature and human conflict. Westerns are about the eternal struggle between civilization and wildness, law and chaos. Saddle up - we've got some stories to tell under the wide open sky!",theme:{primary:"#92400E",secondary:"#B45309",accent:"#FEF3C7",gradient:"from-yellow-700 to-orange-700"},examples:["Create frontier justice stories","Design authentic Western landscapes","Explore moral frontier conflicts"]},{id:"genre-musical",name:"Melody Broadway",description:"Musical theater expert who makes the world burst into song",specialty:"Musicals",personality:"enthusiastic",skills:["Song Integration","Dance Choreography","Emotional Expression","Theatrical Staging"],avatar:"🎭",prompt:"Hello darling! Melody Broadway here, and life is just better with a soundtrack! 🎭 Musicals are pure magic - the moment when emotions are so big that speaking isn't enough and characters MUST sing! I choreograph both the music and the story, creating seamless integration where songs advance plot and reveal character. Every number should leave audiences humming and hearts soaring! Let's create something that makes the world want to dance!",theme:{primary:"#BE185D",secondary:"#DB2777",accent:"#FCE7F3",gradient:"from-pink-600 to-purple-600"},examples:["Design show-stopping musical numbers","Create emotional song transitions","Plan dance choreography"]},{id:"genre-sports",name:"Champion Victory",description:"Sports film specialist who captures the thrill of competition and human perseverance",specialty:"Sports Films",personality:"enthusiastic",skills:["Athletic Drama","Training Montages","Team Dynamics","Underdog Stories"],avatar:"🏆",prompt:"Hey champion! Victory here, and I LIVE for the thrill of competition! 🏆 Sports films aren't just about games - they're about the human spirit, perseverance, and the will to overcome impossible odds! I love crafting those training montages that make you want to hit the gym, team moments that bring tears to your eyes, and victories that make entire theaters cheer! Every athlete has a hero's journey. Let's tell yours!",theme:{primary:"#059669",secondary:"#10B981",accent:"#D1FAE5",gradient:"from-green-600 to-emerald-600"},examples:["Design inspiring training sequences","Create underdog triumph stories","Capture competitive intensity"]},{id:"animation-stop",name:"Clay Potter",description:"Stop-motion animation master bringing clay and puppets to life frame by frame",specialty:"Stop-Motion Animation",personality:"calm",skills:["Puppet Construction","Frame-by-Frame Animation","Practical Effects","Tactile Storytelling"],avatar:"🧱",prompt:"Hello there, patient soul! I'm Clay Potter, and I work one frame at a time to create magic! 🧱 Stop-motion is meditation in motion - every tiny movement carefully crafted, every expression lovingly sculpted. There's something uniquely magical about bringing inanimate objects to life through pure patience and artistry. The tactile nature of stop-motion gives it a warmth that digital can't replicate. Let's create something beautifully handmade together!",theme:{primary:"#7C2D12",secondary:"#9A3412",accent:"#FED7AA",gradient:"from-orange-800 to-red-700"},examples:["Design stop-motion character rigs","Plan frame-by-frame sequences","Create tactile animation styles"]},{id:"animation-motion",name:"Swift Graphics",description:"Motion graphics designer creating dynamic visual communication through animation",specialty:"Motion Graphics",personality:"professional",skills:["Kinetic Typography","Data Visualization","Brand Animation","Information Design"],avatar:"📊",prompt:"Hello! Swift Graphics here, and I make information dance! 📊 Motion graphics is the art of bringing clarity to complexity through movement and design. I transform boring data into compelling stories, static logos into dynamic experiences. Every transition serves communication, every animation enhances understanding. I love finding creative ways to make information not just accessible, but genuinely engaging. Let's make your message move!",theme:{primary:"#1E40AF",secondary:"#3B82F6",accent:"#DBEAFE",gradient:"from-blue-700 to-indigo-600"},examples:["Create dynamic data visualizations","Design kinetic typography","Animate brand presentations"]},{id:"spec-food",name:"Chef Delicious",description:"Food cinematography expert making culinary creations irresistibly visual",specialty:"Food & Culinary",personality:"friendly",skills:["Food Styling","Culinary Storytelling","Appetite Appeal","Cultural Cuisine"],avatar:"👨‍🍳",prompt:"Bonjour mon ami! Chef Delicious here, and I make food look so good it jumps off the screen! 👨‍🍳 Food cinematography is about capturing not just appearance, but the entire sensory experience - the sizzle, the steam, the satisfaction. Every dish tells a story of culture, comfort, and creativity. I love showcasing the artistry of cooking and the joy of sharing meals. Food brings people together, and I help capture that magic! Bon appétit!",theme:{primary:"#DC2626",secondary:"#EF4444",accent:"#FEE2E2",gradient:"from-red-600 to-orange-500"},examples:["Style mouth-watering food scenes","Create culinary storytelling","Design restaurant atmospheres"]},{id:"spec-fashion",name:"Vogue Couture",description:"Fashion film specialist who captures style, beauty, and the art of clothing",specialty:"Fashion & Beauty",personality:"creative",skills:["Fashion Styling","Beauty Cinematography","Trend Visualization","Luxury Aesthetics"],avatar:"💄",prompt:"Darling! Vogue Couture here, and style is my language! 💄 Fashion filmmaking is about capturing the poetry of movement, the luxury of materials, and the confidence that comes from looking fabulous. Every fabric has its own rhythm, every style tells a story of identity and aspiration. I love showcasing how fashion transforms both the wearer and the observer. Beauty isn't vanity - it's art in motion! Let's create something absolutely gorgeous!",theme:{primary:"#BE185D",secondary:"#DB2777",accent:"#FCE7F3",gradient:"from-pink-600 to-rose-500"},examples:["Design elegant fashion showcases","Create beauty transformation scenes","Capture luxury brand aesthetics"]},{id:"spec-travel",name:"Atlas Wanderer",description:"Travel cinematographer who captures the beauty and culture of our world",specialty:"Travel & Culture",personality:"inspiring",skills:["Cultural Sensitivity","Landscape Cinematography","Travel Narratives","Authentic Representation"],avatar:"🌍",prompt:"Greetings, fellow explorer! Atlas Wanderer here, and the world is my studio! 🌍 Travel cinematography is about capturing not just beautiful places, but the soul of cultures and the transformative power of discovery. Every location has stories to tell, traditions to honor, and beauty to reveal. I approach each culture with respect and curiosity, seeking authentic moments that inspire others to explore and understand our magnificent world!",theme:{primary:"#0891B2",secondary:"#06B6D4",accent:"#CFFAFE",gradient:"from-cyan-600 to-teal-500"},examples:["Capture authentic cultural moments","Design inspiring travel narratives","Showcase natural wonders"]},{id:"spec-wildlife",name:"Safari Nature",description:"Wildlife cinematographer specializing in nature documentaries and animal behavior",specialty:"Wildlife & Nature",personality:"calm",skills:["Animal Behavior","Natural Environments","Conservation Storytelling","Patient Observation"],avatar:"🦁",prompt:"Hello nature lover! Safari Nature here, speaking for the wild! 🦁 Wildlife cinematography is about patience, respect, and revealing the incredible drama that unfolds in the natural world every day. Every animal has a story, every ecosystem has its delicate balance. I capture intimate moments in nature while maintaining distance and respect for wildlife. Conservation starts with connection, and beautiful imagery helps people fall in love with our natural world!",theme:{primary:"#15803D",secondary:"#16A34A",accent:"#DCFCE7",gradient:"from-green-600 to-emerald-600"},examples:["Capture intimate animal behaviors","Design conservation narratives","Showcase ecosystem beauty"]},{id:"spec-kids",name:"Sunny Playground",description:"Children's content creator who crafts educational and entertaining stories for young minds",specialty:"Children's Content",personality:"friendly",skills:["Child Psychology","Educational Content","Safe Environments","Imaginative Play"],avatar:"🧸",prompt:"Hi there, little filmmaker! Sunny Playground here, and I make movies that spark imagination! 🧸 Creating content for children is a special responsibility - everything should be colorful, safe, and filled with wonder. I love stories that teach while entertaining, characters kids can look up to, and adventures that inspire creativity. Children see magic everywhere, and my job is to capture that sense of possibility and joy! Let's create something wonderfully kid-friendly!",theme:{primary:"#EAB308",secondary:"#FACC15",accent:"#FEF3C7",gradient:"from-yellow-500 to-orange-400"},examples:["Create educational adventures","Design safe, colorful environments","Develop relatable child characters"]},{id:"cultural-anime",name:"Akira Sensei",description:"Anime and manga storytelling expert with deep understanding of Japanese narrative traditions",specialty:"Anime & Manga",personality:"enthusiastic",skills:["Anime Storytelling","Character Archetypes","Visual Metaphors","Cultural Authenticity"],avatar:"🌸",prompt:"Konnichiwa! Akira Sensei desu! 🌸 I live and breathe the art of anime and manga storytelling! From shonen adventures that make your heart race to slice-of-life moments that touch your soul, I understand the unique visual language of Japanese animation. I love character development arcs, symbolic imagery, and those emotional climaxes that leave audiences in tears! Whether it's mecha battles or magical girls, let's create something that captures the pure essence of anime magic!",theme:{primary:"#EC4899",secondary:"#F472B6",accent:"#FCE7F3",gradient:"from-pink-500 to-purple-500"},examples:["Design anime-style character arcs","Create emotional climax sequences","Plan magical transformation scenes"]},{id:"cultural-bollywood",name:"Priya Masala",description:"Bollywood specialist creating vibrant, musical, and emotionally rich Indian cinema",specialty:"Bollywood Films",personality:"enthusiastic",skills:["Musical Sequences","Family Drama","Cultural Authenticity","Emotional Expression"],avatar:"💃",prompt:"Namaste! I'm Priya Masala, and I bring the colors, music, and heart of Bollywood to every story! 💃 Bollywood isn't just cinema - it's celebration, emotion, and life itself! I love creating those magical musical numbers where the whole world dances, family dramas that span generations, and love stories that make hearts sing! Every frame should be filled with passion, every song should express what words cannot. Let's create cinema that makes souls dance!",theme:{primary:"#F59E0B",secondary:"#FBBF24",accent:"#FEF3C7",gradient:"from-yellow-500 to-orange-500"},examples:["Design colorful musical sequences","Create family saga narratives","Plan cultural celebration scenes"]},{id:"cultural-nordic",name:"Freya Frost",description:"Nordic noir specialist creating atmospheric, psychological stories from the frozen north",specialty:"Nordic Noir",personality:"calm",skills:["Atmospheric Tension","Psychological Depth","Minimalist Aesthetics","Social Commentary"],avatar:"❄️",prompt:"Hej! I'm Freya Frost, and I craft stories from the long Nordic winters where secrets hide beneath the snow. ❄️ Nordic noir is about more than crime - it's about the darkness that lives in human hearts and the light that sometimes breaks through. I love psychological complexity, atmospheric tension, and social commentary wrapped in compelling mystery. The cold landscape reflects the cold truths we often avoid. Let's explore the beautiful darkness together.",theme:{primary:"#475569",secondary:"#64748B",accent:"#E2E8F0",gradient:"from-slate-600 to-blue-700"},examples:["Create psychological crime narratives","Design atmospheric winter scenes","Explore social commentary themes"]},{id:"social-influencer",name:"Viral Maven",description:"Social media content specialist creating engaging short-form video content",specialty:"Social Media Content",personality:"enthusiastic",skills:["Viral Concepts","Short-Form Storytelling","Trend Analysis","Audience Engagement"],avatar:"📱",prompt:"Hey creator! Viral Maven here, and I know what makes content POP! 📱 In the world of short-form video, every second counts! I live for those concepts that make people stop scrolling, share immediately, and come back for more. I understand trends, algorithm psychology, and most importantly - what makes humans connect in our digital age. Let's create content that doesn't just get views, but creates real connection and impact!",theme:{primary:"#8B5CF6",secondary:"#A78BFA",accent:"#DDD6FE",gradient:"from-purple-500 to-pink-500"},examples:["Create viral video concepts","Design engaging social content","Plan trend-based narratives"]},{id:"gaming-narrative",name:"Quest Master",description:"Interactive storytelling expert for games and immersive experiences",specialty:"Interactive & Gaming",personality:"creative",skills:["Branching Narratives","Player Agency","World Building","Interactive Design"],avatar:"🎮",prompt:"Player One ready! I'm Quest Master, and I craft stories where YOU are the hero! 🎮 Interactive storytelling is the future - where audience becomes participant, where choices matter, and where every playthrough tells a different tale. I love creating branching narratives, meaningful player agency, and immersive worlds that respond to your decisions. In my stories, you don't just watch - you live it! Ready to level up your narrative?",theme:{primary:"#059669",secondary:"#10B981",accent:"#D1FAE5",gradient:"from-emerald-600 to-green-500"},examples:["Design branching story paths","Create interactive choice systems","Plan immersive world narratives"]},{id:"therapeutic-healing",name:"Dr. Empathy",description:"Therapeutic content creator using storytelling for healing and personal growth",specialty:"Therapeutic & Wellness",personality:"calm",skills:["Emotional Healing","Personal Growth","Mindfulness Integration","Therapeutic Narrative"],avatar:"🌱",prompt:"Hello, beautiful soul. I'm Dr. Empathy, and I believe stories have the power to heal. 🌱 Every narrative can be a journey toward wholeness, every character arc a reflection of personal growth. I create content that doesn't just entertain - it nurtures, validates, and guides viewers toward better understanding themselves and others. Through storytelling, we process trauma, celebrate resilience, and find hope. Let's craft something that heals hearts.",theme:{primary:"#059669",secondary:"#34D399",accent:"#ECFDF5",gradient:"from-green-500 to-emerald-400"},examples:["Create healing narrative journeys","Design mindfulness storytelling","Plan personal growth content"]},{id:"advanced-search",name:"Nova Search",description:"Advanced AI with real-time web search capabilities",specialty:"Research & Information",personality:"analytical",skills:["Web Search","Fact Verification","Current Events","Research Analysis","Information Synthesis"],avatar:"🌐",prompt:"Hello there! I'm Nova Search, your advanced research companion powered by GPT-o4 Mini. 🌐 I have the unique ability to search the web in real-time for the most up-to-date information. I can verify facts, research current events, and synthesize information from multiple sources. Whether you need the latest industry trends or factual verification, I'll navigate the vast ocean of online information to provide you with accurate, current insights to enhance your storytelling.",theme:{primary:"#0EA5E9",secondary:"#38BDF8",accent:"#E0F2FE",gradient:"from-blue-500 to-cyan-500"},examples:["Research current cinematography trends","Find recent movies in this genre","Get factual information for historical scenes"],capabilities:["web_search","thinking"],preferredModel:"gpt-4o-mini"},{id:"gpt-o3-thinker",name:"Orion Mind",description:"Advanced thinking agent that shows reasoning process",specialty:"Advanced Reasoning",personality:"analytical",skills:["Step-by-step Thinking","Complex Problem Solving","Decision Analysis","Logic Chains","Creative Ideation"],avatar:"🧠",prompt:"Greetings! I'm Orion Mind, your advanced reasoning partner powered by GPT-o4 Mini. 🧠 I specialize in transparent thinking - you can see my thought process unfold in real-time as I work through complex problems. I'll show you my reasoning step by step, from initial analysis to final conclusion. This makes me particularly valuable for story structure problems, character development dilemmas, and plot complexity issues where seeing the thinking journey is as valuable as the destination.",theme:{primary:"#8B5CF6",secondary:"#A78BFA",accent:"#DDD6FE",gradient:"from-indigo-600 to-purple-600"},examples:["Analyze the logic of this story structure","Develop complex character motivations","Work through plot inconsistencies"],capabilities:["thinking","step_by_step"],preferredModel:"gpt-o4-mini"},{id:"multimodal-expert",name:"Spectrum View",description:"Advanced vision and thinking agent for visual analysis",specialty:"Visual Analysis",personality:"professional",skills:["Visual Storytelling","Composition Analysis","Color Theory","Frame Breakdown","Visual References"],avatar:"👁️",prompt:"Hello! I'm Spectrum View, your visual analysis specialist powered by GPT-o4 Mini. 👁️ I can analyze images, discuss visual composition, and help perfect your cinematic vision. My thinking process is visible as I break down visual elements into their components - examining color schemes, compositional balance, visual flow, and emotional impact. I can help you reference iconic cinematic moments and translate written concepts into visual frameworks.",theme:{primary:"#F59E0B",secondary:"#FBBF24",accent:"#FEF3C7",gradient:"from-amber-500 to-yellow-500"},examples:["Analyze this reference image","Suggest visual composition improvements","Break down this film scene's visual elements"],capabilities:["thinking","visual_analysis"],preferredModel:"gpt-o4-mini"},{id:"o3-creative",name:"Quantum Creator",description:"Advanced AI powered creative agent with advanced storytelling capabilities",specialty:"Advanced Storytelling",personality:"creative",skills:["Advanced Narrative Design","Character Development","World Building","Creative Problem Solving","Innovative Concepts"],avatar:"✨",prompt:"Welcome! I'm Quantum Creator, your advanced storytelling partner exclusively powered by GPT-o4 Mini. ✨ I specialize in pushing creative boundaries and generating truly innovative narrative concepts. My advanced capabilities allow me to craft complex character arcs, build richly detailed worlds, and develop unique story structures that break conventional patterns. I can help you explore the furthest reaches of your imagination and transform ordinary ideas into extraordinary stories with depth, nuance, and originality.",theme:{primary:"#EC4899",secondary:"#F472B6",accent:"#FCE7F3",gradient:"from-pink-600 to-purple-500"},examples:["Create an innovative story concept","Develop complex character relationships","Design a unique fictional world"],capabilities:["thinking","step_by_step"],preferredModel:"gpt-o4-mini"}],kt=[{id:"directors",name:"Creative Directors",description:"Visionary storytellers and creative leaders",icon:"🎬",agents:Nt.filter((e=>e.id.startsWith("director-")))},{id:"technical",name:"Technical Specialists",description:"Camera, lighting, and post-production experts",icon:"⚙️",agents:Nt.filter((e=>e.id.startsWith("tech-")))},{id:"genre",name:"Genre Experts",description:"Specialists in specific film genres and styles",icon:"🎭",agents:Nt.filter((e=>e.id.startsWith("genre-")))},{id:"animation",name:"Animation & Fantasy",description:"2D/3D animation and fantastical world builders",icon:"✨",agents:Nt.filter((e=>e.id.startsWith("animation-")||e.id.startsWith("fantasy-")))},{id:"advanced",name:"Advanced AI Models",description:"Thinking, web search, and specialized reasoning capabilities",icon:"🧠",agents:Nt.filter((e=>e.capabilities&&e.capabilities.length>0))},{id:"cultural",name:"Cultural & International",description:"Global perspectives and culturally-specific storytelling",icon:"🌍",agents:Nt.filter((e=>e.id.startsWith("cultural-")))},{id:"modern",name:"Modern Media",description:"Social media, gaming, and interactive content",icon:"📱",agents:Nt.filter((e=>e.id.startsWith("social-")||e.id.startsWith("gaming-")))},{id:"wellness",name:"Wellness & Therapy",description:"Healing-focused and therapeutic content creation",icon:"🌱",agents:Nt.filter((e=>e.id.startsWith("therapeutic-")))},{id:"specialized",name:"Specialized Fields",description:"Documentary, corporate, and niche specialists",icon:"🎯",agents:Nt.filter((e=>e.id.startsWith("doc-")||e.id.startsWith("corp-")||e.id.startsWith("audio-")||e.id.startsWith("exp-")||e.id.startsWith("spec-")||e.id.startsWith("family-")))}],Ct=e=>Nt.find((t=>t.id===e));function St({isOpen:r,onClose:a,onSelectAgent:s,currentAgent:o}){const{state:n}=Xe(),[i,c]=e.useState("all"),[d,m]=e.useState(""),[p,h]=e.useState(Nt),[u,g]=e.useState([]),[y,x]=e.useState(null),f=e.useRef(null);e.useEffect((()=>{const e=localStorage.getItem("ai-agent-favorites");e&&g(JSON.parse(e))}),[]),e.useEffect((()=>{let e=Nt;if("all"!==i){const t=kt.find((e=>e.id===i));t&&(e=t.agents)}d&&(e=e.filter((e=>e.name.toLowerCase().includes(d.toLowerCase())||e.description.toLowerCase().includes(d.toLowerCase())||e.specialty.toLowerCase().includes(d.toLowerCase())))),h(e)}),[i,d]),e.useEffect((()=>{r&&setTimeout((()=>{var e;null==(e=f.current)||e.focus()}),100)}),[r]);const b=e=>{switch(e){case"Creative":return t.jsx(Z,{className:"w-5 h-5"});case"Technical":return t.jsx(X,{className:"w-5 h-5"});case"Cultural":return t.jsx(Y,{className:"w-5 h-5"});case"Modern":return t.jsx(k,{className:"w-5 h-5"});case"Wellness":return t.jsx(Q,{className:"w-5 h-5"});default:return t.jsx(K,{className:"w-5 h-5"})}};return r?t.jsxs(vt,{isOpen:r,onClose:a,title:"Choose Your AI Assistant",subtitle:"Select the perfect creative partner",icon:t.jsx(Y,{className:"w-5 h-5"}),defaultWidth:"600px",defaultHeight:"700px",minWidth:400,minHeight:500,windowId:"ai-agent-selector",zIndex:9500,children:[t.jsx("div",{className:"p-6 border-b glass-effect animate-slide-in",style:{backgroundColor:`${n.theme.colors.background.secondary}90`,borderColor:n.theme.colors.border.primary,backdropFilter:"blur(12px)"},children:t.jsx("input",{ref:f,type:"text",value:d,onChange:e=>m(e.target.value),placeholder:"Search assistants by name, specialty, or skills...",className:"input-modern w-full",style:{backgroundColor:n.theme.colors.background.primary,borderColor:n.theme.colors.border.primary,color:n.theme.colors.text.primary}})}),t.jsx("div",{className:"p-4 border-b glass-subtle animate-slide-in-bottom",style:{backgroundColor:`${n.theme.colors.background.primary}95`,borderColor:n.theme.colors.border.primary,backdropFilter:"blur(8px)"},children:t.jsx("div",{className:"flex flex-wrap gap-2",children:["all",...Array.from(new Set(Nt.map((e=>(e=>{const t=e.specialty.toLowerCase();return t.includes("creative")||t.includes("artistic")?"Creative":t.includes("technical")||t.includes("data")?"Technical":t.includes("cultural")||t.includes("international")?"Cultural":t.includes("social")||t.includes("modern")?"Modern":t.includes("therapy")||t.includes("wellness")?"Wellness":"General"})(e)))))].map(((e,r)=>t.jsxs("button",{onClick:()=>c(e),className:"flex items-center space-x-2 px-4 py-2 rounded-xl text-sm font-medium transition-all duration-300 transform hover:scale-105 animate-fade-in animate-delay-"+50*r,style:{background:i===e?`linear-gradient(135deg, ${n.theme.colors.primary[500]}, ${n.theme.colors.primary[600]})`:`${n.theme.colors.background.secondary}80`,color:i===e?"white":n.theme.colors.text.primary,borderColor:i===e?"transparent":n.theme.colors.border.primary,boxShadow:i===e?`0 4px 12px ${n.theme.colors.primary[500]}40`:"0 2px 8px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(8px)"},children:["all"!==e&&b(e),t.jsx("span",{className:"capitalize font-semibold",children:"all"===e?"All Assistants":e})]},e)))})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 scrollable",children:t.jsx("div",{className:"grid gap-4",children:p.map(((e,r)=>{const i=y===e.id,c=u.includes(e.id),d=(null==o?void 0:o.id)===e.id;return t.jsxs("div",{className:`relative card-interactive p-4 transition-all duration-500 cursor-pointer animate-grid-item animate-grid-stagger-${r%9+1} ${i?"animate-glow":""}`,style:{backgroundColor:d?`${n.theme.colors.primary[50]}95`:`${n.theme.colors.background.secondary}90`,borderColor:i?n.theme.colors.primary[500]:d?n.theme.colors.primary[300]:n.theme.colors.border.primary,borderWidth:i||d?"2px":"1px",boxShadow:i?`0 8px 32px ${n.theme.colors.primary[500]}40, 0 0 0 4px ${n.theme.colors.primary[500]}20`:d?`0 4px 20px ${n.theme.colors.primary[300]}30`:"0 2px 8px rgba(0, 0, 0, 0.1)",backdropFilter:"blur(12px)",transform:"translateZ(0)"},onClick:()=>(e=>{x(e.id),setTimeout((()=>{s(e),a()}),300)})(e),children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white text-lg font-bold shadow-lg animate-float",style:{background:`linear-gradient(135deg, ${n.theme.colors.primary[500]}, ${n.theme.colors.primary[600]})`},children:t.jsx("span",{className:"drop-shadow-sm",children:e.avatar})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-lg",style:{color:n.theme.colors.text.primary},children:e.name}),t.jsx("p",{className:"text-sm font-medium",style:{color:n.theme.colors.text.secondary},children:e.specialty})]})]}),t.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{const t=u.includes(e)?u.filter((t=>t!==e)):[...u,e];g(t),localStorage.setItem("ai-agent-favorites",JSON.stringify(t))})(e.id)},className:"p-2 rounded-xl transition-all duration-300 hover:scale-110",style:{backgroundColor:c?`${n.theme.colors.primary[100]}80`:`${n.theme.colors.background.tertiary}80`,backdropFilter:"blur(8px)"},children:t.jsx(K,{className:"w-5 h-5 transition-all duration-300 "+(c?"fill-yellow-400 text-yellow-400 animate-pulse":"text-secondary-theme hover:text-yellow-400")})})]}),t.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[t.jsx(l,{className:"w-4 h-4 animate-pulse",style:{color:n.theme.colors.primary[500]}}),t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide shadow-sm",style:{backgroundColor:`${n.theme.colors.primary[100]}90`,color:n.theme.colors.primary[700],backdropFilter:"blur(8px)"},children:e.personality})]}),t.jsx("p",{className:"text-sm leading-relaxed mb-4 font-medium",style:{color:n.theme.colors.text.secondary},children:e.description}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.skills.slice(0,3).map(((e,r)=>t.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-lg animate-fade-in",style:{backgroundColor:`${n.theme.colors.background.tertiary}90`,color:n.theme.colors.text.secondary,backdropFilter:"blur(8px)",animationDelay:100*r+"ms"},children:e},r))),e.skills.length>3&&t.jsxs("span",{className:"px-3 py-1 text-xs font-medium rounded-lg opacity-75",style:{backgroundColor:`${n.theme.colors.primary[100]}90`,color:n.theme.colors.primary[600],backdropFilter:"blur(8px)"},children:["+",e.skills.length-3," more"]})]}),t.jsxs("div",{className:"rounded-xl p-4 glass-subtle",style:{backgroundColor:`${n.theme.colors.background.tertiary}80`,borderColor:`${n.theme.colors.border.primary}60`,backdropFilter:"blur(12px)"},children:[t.jsxs("h4",{className:"text-sm font-bold mb-2 flex items-center space-x-1",style:{color:n.theme.colors.text.primary},children:[t.jsx("span",{children:"💡"}),t.jsx("span",{children:"Try asking:"})]}),t.jsxs("p",{className:"text-sm italic font-medium leading-relaxed",style:{color:n.theme.colors.text.secondary},children:['"',e.examples[0],'"']})]}),d&&t.jsx("div",{className:"absolute top-3 right-16",children:t.jsxs("div",{className:"flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-bold shadow-lg animate-pulse",style:{background:`linear-gradient(135deg, ${n.theme.colors.primary[500]}, ${n.theme.colors.primary[600]})`,color:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(8px)"},children:[t.jsx(B,{className:"w-3 h-3"}),t.jsx("span",{children:"ACTIVE"})]})})]},e.id)}))})}),t.jsx("div",{className:"p-6 border-t glass-effect animate-slide-in-bottom",style:{backgroundColor:`${n.theme.colors.background.secondary}90`,borderColor:n.theme.colors.border.primary,backdropFilter:"blur(12px)"},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("p",{className:"text-sm font-medium",style:{color:n.theme.colors.text.secondary},children:[p.length," assistant",1!==p.length?"s":""," available"]}),o&&t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold",style:{background:`linear-gradient(135deg, ${n.theme.colors.primary[500]}, ${n.theme.colors.primary[600]})`,color:"rgba(255, 255, 255, 0.95)"},children:o.avatar}),t.jsxs("span",{className:"text-xs font-medium",style:{color:n.theme.colors.text.tertiary},children:["Current: ",o.name]})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsxs("button",{onClick:()=>{const e=Nt[Math.floor(Math.random()*Nt.length)];s(e),a()},className:"btn-secondary flex items-center space-x-2 animate-bounce-in animate-delay-100",children:[t.jsx(l,{className:"w-4 h-4"}),t.jsx("span",{children:"Surprise Me"})]}),t.jsx("button",{onClick:a,className:"btn-ghost animate-bounce-in animate-delay-200",children:"Cancel"})]})]})})]}):null}var At=Object.defineProperty,It=(e,t,r)=>((e,t,r)=>t in e?At(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const Pt=new class{constructor(){It(this,"STORAGE_KEY","ai-assistant-chats"),It(this,"MAX_CHATS",50)}async saveChat(e,t,r,a,s,o){var n,i;const l=this.getAllChats(),c=new Date;let d="";if(e.length>1&&(!s||o||s&&(null==(n=l.find((e=>e.id===s)))?void 0:n.name.startsWith("New "))))d=await this.generateChatName(e,t);else if(s){const e=l.find((e=>e.id===s));d=(null==e?void 0:e.name)||`${t.name} Chat`}else d=`New ${t.name} Chat`;const m=s||this.generateChatId(),p={id:m,name:d,messages:e,agentId:t.id,agentName:t.name,projectId:r,projectName:a,createdAt:s&&(null==(i=l.find((e=>e.id===s)))?void 0:i.createdAt)||c,updatedAt:c,lastActivity:c,messageCount:e.length},h=l.findIndex((e=>e.id===m));return h>=0?l[h]=p:l.unshift(p),l.length>this.MAX_CHATS&&l.splice(this.MAX_CHATS),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(l)),p}getAllChats(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return[];return JSON.parse(e).map((e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),lastActivity:new Date(e.lastActivity),messages:e.messages.map((e=>({...e,timestamp:new Date(e.timestamp)})))}))).sort(((e,t)=>t.lastActivity.getTime()-e.lastActivity.getTime()))}catch(e){return console.error("Failed to load chats:",e),[]}}getChat(e){return this.getAllChats().find((t=>t.id===e))||null}deleteChat(e){try{const t=this.getAllChats().filter((t=>t.id!==e));return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t)),!0}catch(t){return console.error("Failed to delete chat:",t),!1}}renameChat(e,t){try{const r=this.getAllChats(),a=r.findIndex((t=>t.id===e));return a>=0&&(r[a].name=t,r[a].updatedAt=new Date,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(r)),!0)}catch(r){return console.error("Failed to rename chat:",r),!1}}clearAllChats(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(e){return console.error("Failed to clear chats:",e),!1}}generateChatId(){return`chat_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async generateChatName(e,t){try{if(!ot.isReady())return this.generateFallbackName(e,t);const r=e.filter((e=>"system"!==e.type&&e.content.length>10)).slice(0,6).map((e=>`${e.type}: ${e.content.substring(0,200)}`)).join("\n");if(!r)return this.generateFallbackName(e,t);const a=`Based on this conversation with ${t.name} (a ${t.specialty} specialist), generate a concise, descriptive chat title (2-4 words max). Focus on the main topic or creative goal discussed:\n\n${r}\n\nGenerate ONLY the title, no quotes or explanation. Examples of good titles:\n- "Action Hero Storyboard"\n- "Romance Scene Creation"  \n- "Horror Atmosphere Design"\n- "Comedy Timing Analysis"\n- "Epic Battle Sequence"`,s=await ot.sendMessage([{role:"user",content:a}],{projectTitle:"Chat Naming",projectDescription:"Generate chat title",panelCount:0,totalDuration:0,allPanels:[]});return s.replace(/['"]/g,"").replace(/^(Title:|Chat:|Name:)/i,"").trim().substring(0,50)||this.generateFallbackName(e,t)}catch(r){return console.error("Failed to generate AI chat name:",r),this.generateFallbackName(e,t)}}generateFallbackName(e,t){const r=e.filter((e=>"user"===e.type));if(0===r.length)return`New ${t.name} Chat`;const a=r[0].content.toLowerCase(),s=["storyboard","scene","character","action","horror","comedy","romance","animation","music","sound","lighting","camera","edit","color","fantasy","sci-fi","western","documentary","corporate","food","fashion","travel","nature","children","blockbuster","indie"].find((e=>a.includes(e)));return s?`${s.charAt(0).toUpperCase()+s.slice(1)} Discussion`:`${t.specialty} Chat`}getChatStats(){const e=this.getAllChats();return{totalChats:e.length,totalMessages:e.reduce(((e,t)=>e+t.messageCount),0),agentUsage:e.reduce(((e,t)=>(e[t.agentName]=(e[t.agentName]||0)+1,e)),{}),oldestChat:e.length>0?e[e.length-1].createdAt:null,newestChat:e.length>0?e[0].createdAt:null}}};function Tt({isOpen:r,onClose:a,onSelectChat:s,currentChatId:o}){const[n,i]=e.useState([]),[l,c]=e.useState(""),[d,m]=e.useState([]),[p,h]=e.useState(null),[u,g]=e.useState(""),[y,x]=e.useState(null),[f,b]=e.useState("all");e.useEffect((()=>{r&&v()}),[r]),e.useEffect((()=>{let e=n;l&&(e=e.filter((e=>{var t;return e.name.toLowerCase().includes(l.toLowerCase())||e.agentName.toLowerCase().includes(l.toLowerCase())||(null==(t=e.projectName)?void 0:t.toLowerCase().includes(l.toLowerCase()))||e.messages.some((e=>e.content.toLowerCase().includes(l.toLowerCase())))}))),"all"!==f&&(e=e.filter((e=>e.agentId===f))),m(e)}),[n,l,f]);const v=()=>{const e=Pt.getAllChats();i(e)},w=()=>{if(p&&u.trim()){Pt.renameChat(p,u.trim())&&v()}h(null),g("")},j=()=>{h(null),g("")},N=e=>{const t=((new Date).getTime()-e.getTime())/36e5;return t<1?"Just now":t<24?`${Math.floor(t)}h ago`:t<168?`${Math.floor(t/24)}d ago`:e.toLocaleDateString()},k=Pt.getChatStats();return r?t.jsxs(vt,{isOpen:r,onClose:a,title:"Chat History",subtitle:`${k.totalChats} conversations • ${k.totalMessages} messages`,icon:t.jsx(ae,{className:"w-5 h-5"}),defaultWidth:"min(88vw, 900px)",defaultHeight:"700px",minWidth:600,minHeight:500,maxWidth:"98vw",maxHeight:"95vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"chat-history-manager",zIndex:9500,children:[t.jsxs("div",{className:"h-full flex flex-col overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b border-primary bg-secondary",children:t.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[t.jsxs("div",{className:"relative flex-1",children:[t.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-secondary"}),t.jsx("input",{type:"text",value:l,onChange:e=>c(e.target.value),placeholder:"Search chats by name, agent, or content...",className:"w-full pl-10 pr-4 py-3 bg-primary border border-primary rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-primary placeholder-secondary"})]}),t.jsxs("select",{value:f,onChange:e=>b(e.target.value),className:"px-4 py-3 bg-primary border border-primary rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-primary min-w-[200px]",children:[t.jsx("option",{value:"all",children:"All Agents"}),[...new Set(n.map((e=>e.agentId)))].map((e=>Ct(e))).filter(Boolean).map((e=>t.jsxs("option",{value:e.id,children:[e.avatar," ",e.name]},e.id)))]}),n.length>0&&t.jsxs("button",{onClick:()=>x("all"),className:"flex items-center space-x-2 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:[t.jsx(T,{className:"w-4 h-4"}),t.jsx("span",{children:"Clear All"})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 scrollable",children:0===d.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 bg-secondary rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(te,{className:"w-8 h-8 text-secondary"})}),t.jsx("h3",{className:"text-lg font-semibold text-primary mb-2",children:0===n.length?"No saved chats yet":"No chats found"}),t.jsx("p",{className:"text-secondary",children:0===n.length?"Start a conversation with an AI agent to save your first chat":"Try adjusting your search or filter criteria"})]}):t.jsx("div",{className:"space-y-4",children:d.map((e=>{var r,n;const i=Ct(e.agentId),l=(e=>{const t=Ct(e);return(null==t?void 0:t.theme)||{primary:"#6366F1",secondary:"#818CF8",accent:"#E0E7FF",gradient:"from-indigo-600 to-purple-600"}})(e.agentId),c=e.id===o,d=p===e.id;return t.jsxs("div",{className:"relative bg-primary rounded-xl border-2 transition-all duration-200 hover:shadow-lg "+(c?"border-indigo-500 ring-2 ring-indigo-200 shadow-lg":"border-primary hover:border-secondary"),children:[t.jsx("div",{className:`h-3 rounded-t-xl bg-gradient-to-r ${l.gradient}`}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>(e=>{s(e),a()})(e),children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm border-2 border-white shadow-sm",style:{background:`linear-gradient(45deg, ${l.primary}, ${l.secondary})`},children:t.jsx("span",{className:"text-white",children:(null==i?void 0:i.avatar)||"🤖"})}),d?t.jsxs("div",{className:"flex-1 flex items-center space-x-2",children:[t.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"===e.key&&w(),"Escape"===e.key&&j()},className:"flex-1 px-2 py-1 text-sm border border-primary rounded bg-secondary text-primary",autoFocus:!0}),t.jsx("button",{onClick:w,className:"text-green-600 hover:text-green-700",children:"✓"}),t.jsx("button",{onClick:j,className:"text-red-600 hover:text-red-700",children:"✕"})]}):t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-semibold text-primary text-lg leading-tight",children:e.name}),t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-secondary mt-1",children:[t.jsx(re,{className:"w-3 h-3"}),t.jsx("span",{children:e.agentName}),t.jsx("span",{children:"•"}),t.jsx(P,{className:"w-3 h-3"}),t.jsx("span",{children:N(e.lastActivity)}),e.projectName&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"•"}),t.jsx("span",{children:e.projectName})]})]})]}),c&&t.jsx("div",{className:"px-2 py-1 bg-indigo-600 text-white text-xs rounded-full font-medium",children:"Current"})]}),t.jsx("div",{className:"text-sm text-secondary line-clamp-2 ml-11",children:e.messages.length>1?(null==(n=null==(r=e.messages.find((e=>"user"===e.type)))?void 0:r.content)?void 0:n.substring(0,120))+"...":"New conversation"}),t.jsxs("div",{className:"flex items-center space-x-4 text-xs text-secondary mt-2 ml-11",children:[t.jsxs("span",{children:[e.messageCount," messages"]}),t.jsxs("span",{children:["Updated ",N(e.updatedAt)]})]})]}),t.jsxs("div",{className:"flex items-center space-x-1 ml-4",children:[t.jsx("button",{onClick:()=>{return t=e.id,r=e.name,h(t),void g(r);var t,r},className:"p-2 hover:bg-secondary rounded-lg transition-colors text-secondary hover:text-primary",title:"Rename chat",children:t.jsx(D,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>x(e.id),className:"p-2 hover:bg-red-100 rounded-lg transition-colors text-secondary hover:text-red-600",title:"Delete chat",children:t.jsx(T,{className:"w-4 h-4"})})]})]})})]},e.id)}))})}),t.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-primary bg-secondary",children:[t.jsxs("div",{className:"text-sm text-secondary",children:["Showing ",d.length," of ",n.length," chats"]}),t.jsx("button",{onClick:a,className:"btn-primary",children:"Close"})]})]}),y&&t.jsx(vt,{isOpen:!!y,onClose:()=>x(null),title:"all"===y?"Clear All Chats":"Delete Chat",subtitle:"Confirmation Required",icon:t.jsx(_,{className:"w-4 h-4"}),defaultWidth:"400px",defaultHeight:"200px",minWidth:350,minHeight:180,maxWidth:"500px",maxHeight:"250px",resizable:!1,minimizable:!1,maximizable:!1,windowId:"delete-confirmation",zIndex:9400,children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[t.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:t.jsx(_,{className:"w-5 h-5 text-red-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-primary",children:"all"===y?"Clear All Chats?":"Delete Chat?"}),t.jsx("p",{className:"text-sm text-secondary",children:"all"===y?"This will permanently delete all saved chats. This action cannot be undone.":"This will permanently delete this chat. This action cannot be undone."})]})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>{"all"===y?Pt.clearAllChats()&&v():(async e=>{Pt.deleteChat(e)&&(v(),x(null))})(y),x(null)},className:"flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors",children:"all"===y?"Clear All":"Delete"}),t.jsx("button",{onClick:()=>x(null),className:"flex-1 bg-secondary hover:bg-tertiary text-primary px-4 py-2 rounded-lg transition-colors border border-primary",children:"Cancel"})]})]})})]}):null}function Et({saveState:e,className:r=""}){const a=e=>{const t=new Date,r=Math.floor((t.getTime()-e.getTime())/1e3);if(r<60)return"just now";if(r<3600){return`${Math.floor(r/60)}m ago`}if(r<86400){return`${Math.floor(r/3600)}h ago`}return e.toLocaleDateString()},{icon:s,text:o,color:n,textColor:i}=(()=>{switch(e.status){case"saving":return{icon:t.jsx(ne,{className:"w-4 h-4 animate-spin"}),text:"Saving...",color:"text-secondary-theme bg-secondary-100",textColor:"text-secondary-theme"};case"saved":return{icon:t.jsx(oe,{className:"w-4 h-4"}),text:e.lastSaved?`Saved ${a(e.lastSaved)}`:"Saved",color:"text-green-600 bg-green-50",textColor:"text-green-700"};case"error":return{icon:t.jsx(se,{className:"w-4 h-4"}),text:"Save failed",color:"text-red-600 bg-red-50",textColor:"text-red-700"};default:return{icon:t.jsx(P,{className:"w-4 h-4"}),text:"Not saved",color:"text-secondary-theme bg-secondary-100",textColor:"text-secondary-theme"}}})();return t.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full border transition-all duration-200 ${n} ${r}`,children:t.jsx("div",{className:i,title:o,children:s})})}function Dt({content:r,className:a="",showCopyButton:s=!1}){const[o,n]=e.useState(!1),i=e=>{let t=e;return t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(new RegExp("(?<!\\*)\\*([^*]+)\\*(?!\\*)","g"),"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,'<code class="bg-tertiary px-1 py-0.5 rounded text-sm font-mono">$1</code>'),t=t.replace(/^## (.*$)/gm,'<h2 class="text-lg font-semibold mt-4 mb-2">$1</h2>'),t=t.replace(/^### (.*$)/gm,'<h3 class="text-md font-semibold mt-3 mb-2">$1</h3>'),t=t.replace(/^• (.*$)/gm,'<li class="ml-4 list-disc">$1</li>'),t=t.replace(/(<li.*?<\/li>(?:\s*<li.*?<\/li>)*)/gs,'<ul class="space-y-1 my-2">$1</ul>'),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline hover:text-blue-800">$1</a>'),t=t.replace(/\n\n/g,'</p><p class="mb-2">'),t=`<p class="mb-2">${t}</p>`,t};return t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:`prose prose-sm max-w-none user-select-text ${a}`,style:{userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",msUserSelect:"text"},dangerouslySetInnerHTML:{__html:i(r)}}),s&&t.jsx("button",{onClick:()=>{const e=document.createElement("div");e.innerHTML=i(r);const t=e.innerText||e.textContent||r;navigator.clipboard.writeText(t).then((()=>{n(!0),setTimeout((()=>n(!1)),1500)}))},className:"absolute top-0 right-0 p-1 rounded-md bg-black/20 hover:bg-black/30 transition-colors",title:"Copy text",children:o?t.jsx(ie,{className:"w-3.5 h-3.5"}):t.jsx(R,{className:"w-3.5 h-3.5"})})]})}function $t({isActive:r,thinking:a,agentId:s,loadingStages:o=[]}){const[n,i]=e.useState(""),[l,c]=e.useState(0),[d,m]=e.useState(0);if(e.useEffect((()=>{if(!r)return i(""),void c(0);if(l<a.length){const e=setTimeout((()=>{i((e=>e+a[l])),c((e=>e+1))}),10);return()=>clearTimeout(e)}}),[a,l,r]),e.useEffect((()=>{if(o.length>0&&d<o.length){const e=setTimeout((()=>{m((e=>e+1))}),1e3);return()=>clearTimeout(e)}}),[o,d]),!r)return null;return t.jsxs("div",{className:"border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900 rounded-md p-3 mt-3",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2 text-gray-700 dark:text-gray-300",children:[t.jsx(X,{size:16,className:"text-indigo-500 animate-pulse"}),t.jsx("span",{className:"text-sm font-semibold",children:"AI Thinking Process"})]}),t.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono whitespace-pre-wrap",children:[t.jsx(Dt,{content:n}),l<a.length&&t.jsx("span",{className:"inline-block w-2 h-4 bg-indigo-500 animate-blink ml-1"})]}),0===o.length?null:t.jsxs("div",{className:"flex flex-col gap-1 text-sm mt-2 border-l-2 pl-2 border-gray-300 dark:border-gray-700",children:[o.slice(0,d).map(((e,r)=>t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-4 h-4 rounded-full bg-green-400 flex items-center justify-center text-white text-xs",children:"✓"}),t.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:e})]},r))),d<o.length&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("div",{className:"w-4 h-4 rounded-full bg-blue-400 animate-pulse"}),t.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:o[d]})]})]})]})}function Mt({isOpen:r,onClose:a}){var s,o;const{state:i,dispatch:l}=qe(),{state:d}=Xe(),[m,p]=e.useState(""),[u,y]=e.useState([]),[x,f]=e.useState(!1),[b,v]=e.useState(!1),[w,j]=e.useState(""),[N,k]=e.useState(!1),[C,I]=e.useState(""),[E,$]=e.useState(!1),[M,O]=e.useState(!1),[L,z]=e.useState(!1),[R,U]=e.useState(Nt[0]),[W,_]=e.useState({status:"idle"}),[B,H]=e.useState(null),[q,G]=e.useState([]),[V,J]=e.useState(!1),[Q,X]=e.useState(!1),[Z,te]=e.useState(null),[se,oe]=e.useState([]),[ne,ie]=e.useState(""),[ce,de]=e.useState([]),[me,pe]=e.useState(null),[he,ue]=e.useState(""),[ge,ye]=e.useState({model:"dall-e-3",size:"1024x1024",quality:"standard",style:"photorealistic",artStyle:"cinematic",lighting:"natural",mood:"neutral",colorScheme:"full-color",aspectRatio:"16:9",creativity:7}),[xe,fe]=e.useState({active:!1,content:"",stages:[]}),[be,ve]=e.useState(!1),we=e.useRef(null),je=()=>{const e=Pt.getAllChats();oe(e)};e.useEffect((()=>{const e=e=>{fe(e)};return ot.addThinkingStateListener(e),()=>{ot.removeThinkingStateListener(e)}}),[]),e.useEffect((()=>{je(),(()=>{const e=localStorage.getItem("ai-agent-favorites");if(e)try{G(JSON.parse(e))}catch(t){console.error("Error loading favorite agents:",t),G([])}})();const e=Pt.getAllChats(),t=localStorage.getItem("active-chat-id");if(t){const r=e.find((e=>e.id===t));r?_e(r):e.length>0&&_e(e[0])}else e.length>0&&_e(e[0]);const r=setInterval((()=>{u.length>1&&B&&We()}),3e4);return()=>{clearInterval(r),u.length>1&&We()}}),[]),e.useEffect((()=>{var e;0===u.length&&y([{id:"1",type:"assistant",content:`${R.avatar} **${R.name} - ${R.specialty}**\n\n${R.description}\n\n**🎯 MY SPECIALTIES:**\n${R.skills.map((e=>`• ${e}`)).join("\n")}\n\n**💡 TRY THESE PROMPTS:**\n${R.examples.map((e=>`• "${e}"`)).join("\n")}\n\nCurrent Project: **${(null==(e=i.currentProject)?void 0:e.title)||"Untitled"}** (${i.panels.length} panels)\n\nI'm ready to help with your ${R.specialty.toLowerCase()}! What can we create together?`,timestamp:new Date,agentId:R.id}])}),[0===u.length,R]),e.useEffect((()=>{const e=localStorage.getItem("favoriteAgents");e&&G(JSON.parse(e))}),[]),e.useEffect((()=>{"history"===Z&&je()}),[Z]),e.useEffect((()=>{se.length>0&&ne?de(se.filter((e=>e.name.toLowerCase().includes(ne.toLowerCase())))):de(se)}),[ne,se]);const Ne=()=>{if(w.trim()){ot.setApiKey(w.trim()),localStorage.setItem("openai-api-key",w.trim()),j(""),v(!1);const e={id:Date.now().toString(),type:"assistant",content:"🔑 **API Key Saved!** I'm now ready to help you with advanced AI features like generating storyboards, editing panels, and creating video prompts!",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}},ke=()=>{if(C.trim()){ot.setSearchApiKey(C.trim()),I(""),k(!1);const e={id:Date.now().toString(),type:"assistant",content:"🌐 **Search API Key Saved!** I can now search the web for real-time information when using agents with web search capability.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}},Ce=async e=>{var t,r,a;try{const s={projectTitle:(null==(t=i.currentProject)?void 0:t.title)||"Untitled Storyboard",projectDescription:(null==(r=i.currentProject)?void 0:r.description)||"No description",panelCount:i.panels.length,totalDuration:i.panels.reduce(((e,t)=>e+(t.duration||0)),0),currentPanel:i.selectedPanel?i.panels.find((e=>e.id===i.selectedPanel)):null,allPanels:i.panels.map(((e,t)=>({number:t+1,title:e.title,description:e.description,shotType:e.shotType,cameraAngle:e.cameraAngle,duration:e.duration,notes:e.notes||"No notes"}))),directorNotes:null==(a=i.currentProject)?void 0:a.directorNotes},o=u.slice(-8).filter((e=>"system"!==e.type)).map((e=>({role:"user"===e.type?"user":"assistant",content:e.content})));o.push({role:"user",content:e});const n={...s,agentPersonality:R.prompt};return await ot.sendMessage(o,n,R)}catch(s){return console.error("AI service error:",s),Se(e)}},Se=e=>{var t,r;const a=e.toLowerCase(),s=i.panels.length>0||(null==(t=i.currentProject)?void 0:t.title),o=(null==(r=i.currentProject)?void 0:r.title)||"your project";return a.includes("storyboard")||a.includes("generate")?`🎬 **Storyboard Generation**\n\nI'd love to help you create a professional storyboard! ${s?`I see you're working on "${o}" with ${i.panels.length} panels.`:""}\n\nHere's what I can do once you add your OpenAI API key:\n• **Generate** complete storyboards from story ideas\n• **Enhance** existing panels with better descriptions\n• **Add** new scenes with cinematic details\n• **Create** video prompts for each panel\n\n**Quick Start:** Add your API key in Settings, then tell me your story idea!`:a.includes("panel")||a.includes("scene")?`🎥 **Panel & Scene Management**\n\n${s?`Your "${o}" currently has ${i.panels.length} panels.`:"No panels created yet."}\n\nI can help you:\n• **Add** new cinematic panels\n• **Edit** existing scene descriptions  \n• **Enhance** shot compositions\n• **Optimize** story flow and pacing\n\n**Need Ideas?** Try: "Add a dramatic close-up scene" or "Enhance panel 3 with better lighting"`:a.includes("video")||a.includes("prompt")?`📹 **Video Prompt Generation**\n\nTransform your storyboard into video prompts! ${s?`Ready to process ${i.panels.length} panels.`:"Create some panels first."}\n\nI can generate:\n• **Detailed** video descriptions\n• **Technical** camera specifications\n• **Professional** filming instructions\n• **Creative** visual effects notes\n\n**Pro Tip:** Each panel becomes a detailed video prompt perfect for AI video generation!`:(s?`I see you're working on "${o}" - that's awesome!`:"Ready to create something amazing?")+" \n\nI'm having trouble connecting to my AI servers right now, but I can still help you get organized:\n\nQuick options:\n• **Projects** - Save and manage your work\n• **Templates** - Start with professional layouts\n• **New Project** - Fresh creative start\n\nOnce I'm back online, just tell me your story ideas and I'll help bring them to life with storyboards, video prompts, and all the creative tools you need!\n\nWhat sounds good to you?"},Ae=Boolean(null==(s=null==R?void 0:R.capabilities)?void 0:s.includes("thinking")),Ie=Boolean(null==(o=null==R?void 0:R.capabilities)?void 0:o.includes("web_search"));e.useEffect((()=>{if(we.current){const e=setTimeout((()=>{var e;null==(e=we.current)||e.scrollIntoView({behavior:"smooth"})}),100);return()=>clearTimeout(e)}}),[u,xe.content]);const Pe=async()=>{if(!m.trim()||x)return;const e={id:Date.now().toString(),type:"user",content:m.trim(),timestamp:new Date,agentId:R.id};y((t=>[...t,e])),p(""),f(!0);try{const t=e.content.toLowerCase();console.log("🔍 Analyzing user input:",t);const r=await Ce(e.content);console.log("💬 Received AI response:",r);if(r.includes("[ACTION:"))return console.log("🎬 Actions detected in AI response, processing..."),void(await Me(r,e.content));const a=t.includes("all")||t.includes("batch")||t.includes("every")||t.includes("entire");if(t.includes("generate")&&t.includes("storyboard"))return console.log("🔧 Fallback: Triggering storyboard generation"),void(await Te(e.content));if(t.includes("add")&&(t.includes("panel")||t.includes("scene")))return console.log("🔧 Fallback: Triggering panel addition"),void(await $e(e.content));if(t.includes("edit")&&t.includes("panel")&&!a){if(console.log("🔧 Fallback: Triggering single panel edit"),i.panels.length>0){const r=t.match(/panel (\d+)/i);if(!r){const t=i.panels[i.panels.length-1];return void(await Ee(t.id,e.content))}{const t=parseInt(r[1]),a=i.panels[t-1];if(a)return void(await Ee(a.id,e.content))}}}else if(t.includes("video")&&t.includes("prompt"))return console.log("🔧 Fallback: Triggering video prompts"),void(await De());console.log("💬 Showing regular AI response");const s={id:(Date.now()+1).toString(),type:"assistant",content:r,timestamp:new Date,agentId:R.id};y((e=>[...e,s]))}catch(t){console.error("❌ Error in handleSendMessage:",t);const e={id:(Date.now()+1).toString(),type:"system",content:"Sorry, I encountered an error. Please try again or check the server connection.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}finally{f(!1)}},Te=async(e,t=6)=>{f(!0);try{const r=await ot.generateStoryboard(e,t,"drama");l({type:"SET_PANELS",payload:[]}),r.forEach(((e,t)=>{const r={...e,order:t};l({type:"ADD_PANEL",payload:r})}));const a={id:Date.now().toString(),type:"assistant",content:`🎬 **Storyboard Generated!** I've created ${r.length} professional panels for your story. Each panel includes:\n\n• Cinematic shot composition\n• Professional camera angles\n• Director's notes\n• Optimal timing\n\nYou can now edit individual panels, generate video prompts, or ask me to refine specific scenes!`,timestamp:new Date,agentId:R.id};y((e=>[...e,a]))}catch(r){const e={id:Date.now().toString(),type:"system",content:"Failed to generate storyboard. Please check your API key or try again.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}finally{f(!1)}},Ee=async(e,t)=>{const r=i.panels.find((t=>t.id===e));if(!r){console.error("❌ Failed to edit panel: Panel not found with ID",e);const t={id:Date.now().toString(),type:"system",content:"Cannot edit panel - the specified panel was not found. Please try again with a valid panel.",timestamp:new Date,agentId:R.id};return void y((e=>[...e,t]))}const a=i.panels.findIndex((t=>t.id===e))+1;f(!0),console.log(`🎬 Editing panel ${a} with instructions:`,t);try{if(ot.isReady()){const s=await ot.generateScene(`${r.description}. ${t}`,r.shotType,r.cameraAngle,"enhanced");if(!s||!s.description)throw new Error("Failed to generate enhanced scene data from AI service");const o={title:s.title||r.title,description:s.description,shotType:s.shotType||r.shotType,cameraAngle:s.cameraAngle||r.cameraAngle,notes:s.notes||r.notes,duration:r.duration,updatedAt:new Date};l({type:"UPDATE_PANEL",payload:{id:e,updates:o}});const n={id:Date.now().toString(),type:"assistant",content:`✅ **Panel ${a} Updated!** I've enhanced "${r.title}" based on your instructions. The panel now features improved cinematography and storytelling elements.`,timestamp:new Date,agentId:R.id};y((e=>[...e,n]))}else{const s={description:`${r.description} (Updated: ${t})`,notes:`${r.notes?`${r.notes} | `:""}AI Enhancement: ${t}`,updatedAt:new Date};l({type:"UPDATE_PANEL",payload:{id:e,updates:s}});const o={id:Date.now().toString(),type:"assistant",content:`✅ **Panel ${a} Updated!** I've applied your instructions to "${r.title}". For enhanced AI editing, add your OpenAI API key.`,timestamp:new Date,agentId:R.id};y((e=>[...e,o]))}}catch(s){console.error("❌ Error editing panel:",s);const e={id:Date.now().toString(),type:"system",content:`Failed to edit panel ${a}. ${s instanceof Error?s.message:"Please check your API key or try again."}`,timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}finally{f(!1)}},De=()=>{const e={id:`test-${Date.now()}`,type:"assistant",content:"🎬 Video prompts feature is working! This is a test message.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))},$e=async e=>{f(!0);try{let t;if(ot.isReady()){const r=await ot.generateScene(e,"medium-shot","eye-level","professional");t={id:`panel-${Date.now()}`,title:r.title||`Panel ${i.panels.length+1}`,description:r.description||e,shotType:r.shotType||"medium-shot",cameraAngle:r.cameraAngle||"eye-level",notes:r.notes||"",duration:4,order:i.panels.length,createdAt:new Date,updatedAt:new Date,videoPrompt:r.videoPrompt}}else t={id:`panel-${Date.now()}`,title:`Panel ${i.panels.length+1}`,description:e,shotType:"medium-shot",cameraAngle:"eye-level",notes:"Manually created panel - enhance with AI by adding your OpenAI key",duration:4,order:i.panels.length,createdAt:new Date,updatedAt:new Date};l({type:"ADD_PANEL",payload:t});const r={id:Date.now().toString(),type:"assistant",content:`✅ **Panel Added!** Created "${t.title}" ${ot.isReady()?"with AI-enhanced cinematography":"with basic setup"}. Panel ${i.panels.length+1} is ready for your story!`,timestamp:new Date,agentId:R.id};y((e=>[...e,r]))}catch(t){const e={id:Date.now().toString(),type:"system",content:"Failed to add panel. Please try again.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}finally{f(!1)}},Me=async(e,t)=>{console.log("🎬 PROCESSING AI ACTIONS:",{response:e.substring(0,200)+"...",originalUserInput:t}),console.log("🧪 FULL RESPONSE FOR DEBUGGING:",e);const r=/\[ACTION:([^:]+):([^\]]*)\]/g,a=[];let s;for(;null!==(s=r.exec(e));){const e=s[1].trim(),t=s[2].trim();a.push({type:e,params:t}),console.log("🔍 Found action:",{type:e,params:t})}if(console.log("📋 Total actions found:",a.length),0===a.length){console.log("⚠️ No actions found in response, showing as regular message"),console.log("🔎 Action debugging info:"),console.log("- Response length:",e.length),console.log("- Contains [ACTION keyword:",e.includes("[ACTION")),console.log("- Contains action types:",["generate_storyboard","add_panel","edit_panel","remove_panel","analyze_storyboard","generate_video_prompts","update_director_notes","batch_edit","batch_edit_range","batch_apply_style","enhance_all_cinematography","standardize_shot_types"].some((t=>e.toLowerCase().includes(t.toLowerCase()))));const t={id:Date.now().toString(),type:"assistant",content:e,timestamp:new Date,agentId:R.id};return void y((e=>[...e,t]))}let o=0;for(const d of a){console.log("🚀 Executing action:",d.type,"with params:",d.params);try{switch(d.type){case"generate_storyboard":console.log("📝 Generating storyboard..."),await Te(d.params||t),o++;break;case"add_panel":console.log("➕ Adding panel..."),await $e(d.params||t),o++;break;case"edit_panel":console.log("✏️ Editing panel...");const e=d.params.match(/^(?:panel\s*)?(\d+)(?:\s*:|:|\s)/i);if(e){const r=parseInt(e[1]),a=d.params.substring(d.params.indexOf(e[0])+e[0].length).trim();if(!(r>0&&r<=i.panels.length))throw new Error(`Panel ${r} does not exist. Current panel count: ${i.panels.length}`);{const e=i.panels[r-1];await Ee(e.id,a||t),console.log(`✅ Edited panel ${r} with instructions: ${a}`),o++}}else{if(!(i.panels.length>0))throw new Error("No panels exist to edit. Add some panels first!");{const e=i.panels[i.panels.length-1];await Ee(e.id,d.params||t),console.log(`✅ Edited last panel (panel ${i.panels.length}) with instructions: ${d.params}`),o++}}break;case"remove_panel":console.log("🗑️ Removing panel...");let r=null;if(d.params){const e=d.params.match(/^(?:panel\s*)?(\d+)/i);if(e){const t=parseInt(e[1]);if(!(t>0&&t<=i.panels.length))throw new Error(`Panel ${t} does not exist. Current panel count: ${i.panels.length}`);r=i.panels[t-1].id}}if(!r&&i.panels.length>0&&(r=i.panels[i.panels.length-1].id),!r)throw new Error("No panels exist to remove. Add some panels first!");l({type:"DELETE_PANEL",payload:r}),o++;break;case"analyze_storyboard":console.log("🔍 Analyzing storyboard..."),await Je(),o++;break;case"generate_video_prompts":console.log("🎥 Generating video prompts..."),await De(),o++;break;case"update_director_notes":console.log("📋 Updating director notes..."),i.currentProject&&(l({type:"SET_PROJECT",payload:{...i.currentProject,directorNotes:d.params}}),o++);break;case"batch_edit":if(console.log("🎬 BATCH EDIT: Processing all panels..."),0===i.panels.length)throw new Error("No panels exist to edit. Add some panels first!");await Oe(d.params||t),o++;break;case"batch_edit_range":console.log("🎬 BATCH EDIT RANGE: Processing panel range...");const a=d.params.split(":");if(!(a.length>=3))throw new Error("Invalid batch edit range format. Expected format: start:end:instructions");{const e=parseInt(a[0])-1,t=parseInt(a[1])-1;if(e<0||e>=i.panels.length||t<0||t>=i.panels.length)throw new Error(`Panel range ${e+1}-${t+1} is invalid. Current panel count: ${i.panels.length}`);const r=a.slice(2).join(":");await Ve(e,t,r),o++}break;case"batch_apply_style":if(console.log("🎨 BATCH APPLY STYLE: Applying style to all panels..."),0===i.panels.length)throw new Error("No panels exist to style. Add some panels first!");const s=d.params.split(":");if(s.length>=2){const e=s[0],t=s.slice(1).join(":");await Be(e,t),o++}else await Oe(`apply ${d.params} style to all panels`),o++;break;case"enhance_all_cinematography":if(console.log("📸 ENHANCE ALL CINEMATOGRAPHY: Improving all panels..."),0===i.panels.length)throw new Error("No panels exist to enhance. Add some panels first!");await He(d.params||"enhance cinematography with professional techniques"),o++;break;case"standardize_shot_types":if(console.log("🎯 STANDARDIZE SHOT TYPES: Optimizing shot progression..."),0===i.panels.length)throw new Error("No panels exist to standardize. Add some panels first!");await Ge(d.params||"optimize shot types for better visual flow"),o++;break;default:if(console.warn("⚠️ Unknown action type:",d.type),!d.params||!d.params.includes("all")&&!d.params.includes("every"))throw new Error(`Unknown action type: ${d.type}`);console.log("🔄 Interpreting unknown action as batch edit..."),await Oe(`${d.type}: ${d.params}`||t),o++}console.log("✅ Action completed:",d.type)}catch(c){console.error(`❌ Error executing action ${d.type}:`,c);const e={id:Date.now().toString(),type:"assistant",content:`❌ **Action Failed** - I encountered an error while trying to ${d.type.replace("_"," ")}. ${c instanceof Error?c.message:"Please try again or check your settings."}`,timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}}if(o>0){const e={id:Date.now().toString(),type:"system",content:`✅ **Actions Completed** - Successfully processed ${o} out of ${a.length} actions.`,timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}const n=e.replace(/\[ACTION:[^\]]+\]/g,"").trim().replace(/\s{2,}/g," ").replace(/\n\s*\n\s*\n/g,"\n\n");if(n){console.log("💬 Showing cleaned response alongside actions");const e={id:Date.now().toString(),type:"assistant",content:n,timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}console.log("🎉 All AI actions processed successfully")},Oe=async e=>{var t,r,a,s,o,n,c;f(!0),console.log("🚀 BATCH EDIT STARTED:",{instructions:e,panelCount:i.panels.length,hasApiKey:ot.isReady(),projectTitle:null==(t=i.currentProject)?void 0:t.title});try{if(!ot.isReady()){console.log("❌ No API key available");const e={id:Date.now().toString(),type:"assistant",content:"🔑 **API Key Required** - I need an OpenAI API key to perform batch edits. Please add your key in Settings.",timestamp:new Date,agentId:R.id};return void y((t=>[...t,e]))}if(0===i.panels.length){console.log("❌ No panels to edit");const e={id:Date.now().toString(),type:"assistant",content:"📝 **No Panels to Edit** - Create some storyboard panels first, then I can help you batch edit them!",timestamp:new Date,agentId:R.id};return void y((t=>[...t,e]))}console.log("🔄 Starting batch edit for",i.panels.length,"panels with instructions:",e);const t={id:Date.now().toString(),type:"assistant",content:`🎬 **Batch Edit Starting...** \n\nProcessing ${i.panels.length} panels with: "${e}"\n\nThis may take a moment as I enhance each panel with AI. Please wait...`,timestamp:new Date,agentId:R.id};y((e=>[...e,t]));const h=`Apply these batch edits to ALL storyboard panels. For each panel, provide the enhanced version:\n\nINSTRUCTIONS: ${e}\n\nPROJECT CONTEXT:\n- Title: ${null==(r=i.currentProject)?void 0:r.title}\n- Description: ${null==(a=i.currentProject)?void 0:a.description}\n- Director Notes: ${null==(s=i.currentProject)?void 0:s.directorNotes}\n- Total Panels: ${i.panels.length}\n\nCURRENT PANELS:\n${i.panels.map(((e,t)=>`Panel ${t+1}:\n  Title: ${e.title}\n  Description: ${e.description}\n  Shot Type: ${e.shotType}\n  Camera Angle: ${e.cameraAngle}\n  Notes: ${e.notes}`)).join("\n\n")}\n\nReturn a JSON array with exactly ${i.panels.length} updated panels. Each panel object should have:\n- title: enhanced title\n- description: enhanced description  \n- notes: enhanced director notes\n- shotType: appropriate shot type from [wide-shot, medium-shot, close-up, extreme-close-up, over-the-shoulder, two-shot, establishing-shot]\n- cameraAngle: appropriate camera angle from [eye-level, high-angle, low-angle, birds-eye-view, worms-eye-view, dutch-angle]\n\nApply the requested changes "${e}" while maintaining story flow and continuity. Return ONLY the JSON array, no other text.\n\nExample format:\n[\n  {\n    "title": "Enhanced Panel Title",\n    "description": "Enhanced detailed description with improvements",\n    "notes": "Enhanced director notes with specific guidance",\n    "shotType": "medium-shot",\n    "cameraAngle": "eye-level"\n  }\n]`;console.log("📤 Sending batch request to AI...");const u=await ot.sendMessage([{role:"user",content:h}],{projectTitle:(null==(o=i.currentProject)?void 0:o.title)||"",projectDescription:(null==(n=i.currentProject)?void 0:n.description)||"",panelCount:i.panels.length,totalDuration:i.panels.reduce(((e,t)=>e+(t.duration||0)),0),allPanels:i.panels.map(((e,t)=>({number:t+1,title:e.title,description:e.description,shotType:e.shotType,cameraAngle:e.cameraAngle,duration:e.duration,notes:e.notes}))),directorNotes:null==(c=i.currentProject)?void 0:c.directorNotes});console.log("📥 AI batch response received:",u);try{let t=u.trim();console.log("🔍 Original response length:",t.length),t.includes("```json")?(console.log("📝 Extracting from markdown json block"),t=t.split("```json")[1].split("```")[0].trim()):t.includes("```")&&(console.log("📝 Extracting from markdown block"),t=t.split("```")[1].split("```")[0].trim());const r=t.indexOf("["),a=t.lastIndexOf("]");if(-1!==r&&-1!==a&&r<a&&(console.log("📝 Extracting JSON array from response"),t=t.substring(r,a+1)),t=t.replace(/^[^[\{]*/,"").replace(/[^\]\}]*$/,""),t.startsWith("[")&&!t.endsWith("]")){console.log("📝 Attempting to repair truncated JSON array");const e=t.lastIndexOf("}");-1!==e&&(t=t.substring(0,e+1)+"]",console.log("📝 Repaired truncated JSON by adding closing bracket"))}console.log("📝 Cleaned JSON text (first 200 chars):",t.substring(0,200)),console.log("📝 Cleaned JSON text (last 100 chars):",t.substring(Math.max(0,t.length-100)));let s=[];try{s=JSON.parse(t),console.log("✅ Successfully parsed JSON, received:",s.length,"panels")}catch(d){console.log("⚠️ Initial JSON parse failed, attempting to extract panels individually");const e=t.match(/\{[^{]*?"title":[^{]*?"description":[^{]*?"notes":[^{]*?\}/g);if(!(e&&e.length>0))throw d;console.log("🔍 Found",e.length,"potential panel objects");try{const t="["+e.join(",")+"]";s=JSON.parse(t),console.log("✅ Successfully reconstructed and parsed JSON from individual panels")}catch(m){throw console.error("❌ Failed to reconstruct panel array:",m),d}}if(!(Array.isArray(s)&&s.length>0))throw console.error("❌ Invalid response format:",{isArray:Array.isArray(s),receivedLength:null==s?void 0:s.length,expectedLength:i.panels.length}),new Error(`Invalid response format: expected ${i.panels.length} panels, got ${(null==s?void 0:s.length)||0}`);{console.log("✅ Valid panel updates received, applying changes...");let t=0;for(let e=0;e<Math.min(i.panels.length,s.length);e++){const r=i.panels[e],a=s[e];a&&"object"==typeof a?(console.log(`📝 Updating panel ${e+1}:`,{oldTitle:r.title,newTitle:a.title,hasDescription:!!a.description,hasNotes:!!a.notes}),l({type:"UPDATE_PANEL",payload:{id:r.id,updates:{title:a.title||r.title,description:a.description||r.description,notes:a.notes||r.notes,shotType:a.shotType||r.shotType,cameraAngle:a.cameraAngle||r.cameraAngle,updatedAt:new Date}}}),t++):console.warn(`⚠️ Invalid panel data for panel ${e+1}:`,a)}if(console.log("✅ Batch edit completed successfully:",t,"panels updated"),t<i.panels.length){if(console.log("⚠️ Only partial update received:",t,"out of",i.panels.length,"panels"),t<i.panels.length/2)throw console.log("🔄 Not enough panels received, switching to individual processing..."),new Error("Incomplete JSON response: falling back to individual processing");const r={id:Date.now().toString(),type:"assistant",content:`🎬 **Batch Edit Partially Complete!** \n\n✅ Successfully updated **${t}** out of **${i.panels.length}** panels with: "${e}"\n\nThe updated panels have been enhanced with the requested environmental effects. I'll now process the remaining panels individually...`,timestamp:new Date,agentId:R.id};y((e=>[...e,r])),await Ke(e,t)}else{const r={id:Date.now().toString(),type:"assistant",content:`🎬 **Batch Edit Complete!** \n\n✅ Successfully updated **${t}** panels with: "${e}"\n\nAll panels have been enhanced while maintaining story flow and continuity. Check your storyboard to see the improvements!\n\n**What was enhanced:**\n• Improved titles and descriptions with environmental effects\n• Enhanced director notes with atmospheric guidance\n• Optimized shot types and camera angles for the new elements\n• Applied consistent environmental modifications across all panels`,timestamp:new Date,agentId:R.id};y((e=>[...e,r]))}}}catch(p){console.error("❌ Failed to parse batch response:",p),console.log("📄 Raw response that failed to parse:",u),console.log("🔄 Switching to individual panel processing fallback..."),await Le(e)}}catch(h){console.error("❌ Error in batch editing panels:",h),await Le(e)}finally{f(!1)}},Le=async e=>{console.log("🔄 FALLBACK: Processing panels individually...");const t={id:Date.now().toString(),type:"assistant",content:`🔄 **Switching to Individual Processing...** \n\nThe batch process hit a snag, so I'm now enhancing each panel individually with AI. This ensures every panel gets the attention it deserves!\n\nProcessing "${e}" on ${i.panels.length} panels...`,timestamp:new Date,agentId:R.id};y((e=>[...e,t]));let r=0,a=0;for(let n=0;n<i.panels.length;n++){const t=i.panels[n];console.log(`🔄 Processing panel ${n+1}/${i.panels.length}: ${t.title}`);try{n>0&&(console.log("⏱️ Rate limiting: waiting 1 second..."),await new Promise((e=>setTimeout(e,1e3))));const s=await ot.generateScene(`${e}. Current panel: "${t.title}" - ${t.description}. Director notes: ${t.notes}`,t.shotType,t.cameraAngle,"enhanced");s&&(s.title||s.description)?(console.log(`✅ Enhanced panel ${n+1}:`,{originalTitle:t.title,newTitle:s.title,hasNewDescription:!!s.description}),l({type:"UPDATE_PANEL",payload:{id:t.id,updates:{title:s.title||t.title,description:s.description||t.description,notes:s.notes||t.notes,shotType:s.shotType||t.shotType,cameraAngle:s.cameraAngle||t.cameraAngle,updatedAt:new Date}}}),a++):console.warn(`⚠️ No enhancements generated for panel ${n+1}`),r++}catch(o){console.error(`❌ Failed to process panel ${n+1}:`,o),r++}}console.log(`✅ Fallback processing complete: ${a}/${r} panels enhanced`);const s={id:Date.now().toString(),type:"assistant",content:`🎬 **Individual Processing Complete!** \n\n✅ Successfully enhanced **${a}** out of **${r}** panels with: "${e}"\n\n${a===r?"🎉 All panels were successfully enhanced!":`⚠️ ${r-a} panels couldn't be enhanced, but they remain unchanged.`}\n\nYour storyboard now has improved panels with the requested modifications!`,timestamp:new Date,agentId:R.id};y((e=>[...e,s]))},Fe=e=>{var t;U(e),O(!1),B||y([{id:"1",type:"assistant",content:`${e.avatar} **${e.name} - ${e.specialty}**\n\n${e.description}\n\n**🎯 MY SPECIALTIES:**\n${e.skills.map((e=>`• ${e}`)).join("\n")}\n\n**💡 TRY THESE PROMPTS:**\n${e.examples.map((e=>`• "${e}"`)).join("\n")}\n\nCurrent Project: **${(null==(t=i.currentProject)?void 0:t.title)||"Untitled"}** (${i.panels.length} panels)\n\nI'm ready to help with your ${e.specialty.toLowerCase()}! What can we create together?`,timestamp:new Date,agentId:e.id}]),localStorage.setItem("preferred-ai-agent",e.id)},ze=()=>{if(me&&he.trim()){if(Pt.renameChat(me,he.trim())){const e=Pt.getAllChats();oe(e)}}pe(null),ue("")},Re=()=>{pe(null),ue("")},Ue=e=>{const t=((new Date).getTime()-e.getTime())/36e5;return t<1?"Just now":t<24?`${Math.floor(t)}h ago`:t<168?`${Math.floor(t/24)}d ago`:e.toLocaleDateString()};e.useEffect((()=>{const e=localStorage.getItem("selected-ai-agent");if(e)try{const t=JSON.parse(e);U(t)}catch(t){console.warn("Failed to load saved agent:",t)}}),[]),e.useEffect((()=>{u.length>1&&We()}),[u,R]);const We=async()=>{var e,t;try{_({status:"saving"});const r=u.filter((e=>"user"===e.type)).length,a=r>0&&r%3==0,s=await Pt.saveChat(u,R,null==(e=i.currentProject)?void 0:e.id,null==(t=i.currentProject)?void 0:t.title,B||void 0,a);B||(H(s.id),localStorage.setItem("active-chat-id",s.id)),_({status:"saved",lastSaved:new Date})}catch(r){console.error("Failed to auto-save chat:",r),_({status:"error",error:r instanceof Error?r.message:"Save failed"}),setTimeout((()=>{_((e=>({...e,status:"saved",lastSaved:new Date})))}),5e3)}},_e=e=>{y(e.messages),H(e.id),localStorage.setItem("active-chat-id",e.id);const t=Ct(e.agentId);t&&U(t),_({status:"saved",lastSaved:e.updatedAt})},Be=async(e,t)=>{f(!0);try{let a=0;for(let s=0;s<i.panels.length;s++){const o=i.panels[s];try{const r=`Apply ${e} style to this scene: ${o.description}. ${t}`,n=await ot.generateScene(r,o.shotType,o.cameraAngle,e);n&&n.description&&(l({type:"UPDATE_PANEL",payload:{id:o.id,updates:{title:n.title||o.title,description:n.description,notes:`${e} style: ${n.notes||o.notes}`,updatedAt:new Date}}}),a++),s<i.panels.length-1&&await new Promise((e=>setTimeout(e,400)))}catch(r){console.error(`❌ Failed to apply style to panel ${s+1}:`,r)}}}catch(a){console.error("❌ Error applying style:",a)}finally{f(!1)}},He=async e=>{f(!0);try{let r=0;const a=["close-up","medium-shot","wide-shot","extreme-close-up","long-shot"],s=["eye-level","high-angle","low-angle","bird-eye","worm-eye","dutch-angle"];for(let o=0;o<i.panels.length;o++){const n=i.panels[o];try{const t=a[o%a.length],c=s[o%s.length],d=`Enhance the cinematography: ${n.description}. ${e}`,m=await ot.analyzeCinematography(d);if(m&&"object"==typeof m){const a=`Lighting: ${m.lighting||"N/A"}. Performance: ${m.performance||"N/A"}. Camera Movement: ${m.cameraMovement||"N/A"}. Composition: ${m.composition||"N/A"}. Sound: ${m.sound||"N/A"}.`,s={title:n.title,description:a,notes:`Enhanced cinematography: ${e}`,shotType:t,cameraAngle:c,updatedAt:new Date};l({type:"UPDATE_PANEL",payload:{id:n.id,updates:s}}),r++}o<i.panels.length-1&&await new Promise((e=>setTimeout(e,500)))}catch(t){console.error(`❌ Failed to enhance cinematography for panel ${o+1}:`,t)}}}catch(r){console.error("❌ Error enhancing cinematography:",r)}finally{f(!1)}},Ge=async e=>{f(!0);try{const e=[];for(let t=0;t<i.panels.length;t++)0===t?e.push("wide-shot"):t===i.panels.length-1?e.push("close-up"):t%3==0?e.push("wide-shot"):t%3==1?e.push("medium-shot"):e.push("close-up");let r=0;for(let a=0;a<i.panels.length;a++){const s=i.panels[a],o=e[a];if(s.shotType!==o)try{l({type:"UPDATE_PANEL",payload:{id:s.id,updates:{shotType:o,notes:`Standardized shot type: ${s.notes||""}`,updatedAt:new Date}}}),r++}catch(t){console.error(`❌ Failed to standardize panel ${a+1}:`,t)}}}catch(r){console.error("❌ Error standardizing shot types:",r)}finally{f(!1)}},Ve=async(e,t,r)=>{if(e<0||t>=i.panels.length||e>t)return void console.error("❌ Invalid range for batch edit");const a=i.panels.slice(e,t+1);for(let o=0;o<a.length;o++){const t=a[o];try{const e=await ot.generateScene(`${r}. Current panel: "${t.title}" - ${t.description}`,t.shotType,t.cameraAngle,"enhanced");e&&(e.title||e.description)&&l({type:"UPDATE_PANEL",payload:{id:t.id,updates:{title:e.title||t.title,description:e.description||t.description,notes:e.notes||t.notes,shotType:e.shotType||t.shotType,cameraAngle:e.cameraAngle||t.cameraAngle,updatedAt:new Date}}}),o<a.length-1&&await new Promise((e=>setTimeout(e,1e3)))}catch(s){console.error(`❌ Failed to process panel ${e+o+1}:`,s)}}},Je=async()=>{var e;if(0!==i.panels.length){f(!0);try{const t=i.panels.map(((e,t)=>`Panel ${t+1}: ${e.title} - ${e.description} (${e.shotType}, ${e.cameraAngle}, ${e.duration}s)`)).join("\n"),r=`Analyze this storyboard and provide professional feedback:\n\nPROJECT: ${(null==(e=i.currentProject)?void 0:e.title)||"Untitled"}\nTOTAL PANELS: ${i.panels.length}\n\nSTORYBOARD:\n${t}\n\nPlease provide:\n1. Story structure analysis\n2. Visual flow and pacing assessment  \n3. Shot variety and composition feedback\n4. Suggestions for improvement\n5. Professional filmmaking recommendations\n\nFocus on storytelling effectiveness and cinematic quality.`,a=await Ce(r),s={id:Date.now().toString(),type:"assistant",content:`📊 **Storyboard Analysis**\n\n${a}`,timestamp:new Date,agentId:R.id};y((e=>[...e,s]))}catch(t){const e={id:Date.now().toString(),type:"system",content:"Failed to analyze storyboard. Please try again.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}finally{f(!1)}}else{const e={id:Date.now().toString(),type:"assistant",content:"Your storyboard is empty! Start by generating a storyboard or adding panels.",timestamp:new Date,agentId:R.id};y((t=>[...t,e]))}},Ke=async(e,t)=>{console.log("🔄 Processing remaining panels individually...");let r=0;for(let o=t;o<i.panels.length;o++){const t=i.panels[o];console.log(`🔄 Processing panel ${o+1}/${i.panels.length}: ${t.title}`);try{console.log("⏱️ Rate limiting: waiting 1 second..."),await new Promise((e=>setTimeout(e,1e3)));const a=await ot.generateScene(`${e}. Current panel: "${t.title}" - ${t.description}. Director notes: ${t.notes}`,t.shotType,t.cameraAngle,"enhanced");a&&(a.title||a.description)&&(console.log(`✅ Enhanced panel ${o+1}:`,{originalTitle:t.title,newTitle:a.title,hasNewDescription:!!a.description}),l({type:"UPDATE_PANEL",payload:{id:t.id,updates:{title:a.title||t.title,description:a.description||t.description,notes:a.notes||t.notes,shotType:a.shotType||t.shotType,cameraAngle:a.cameraAngle||t.cameraAngle,updatedAt:new Date}}}),r++)}catch(s){console.error(`❌ Failed to process panel ${o+1}:`,s)}}console.log(`✅ Remaining panels processing complete: ${r}/${i.panels.length-t} panels enhanced`);const a={id:Date.now().toString(),type:"assistant",content:`🎬 **All Panels Now Complete!** \n\n✅ Successfully enhanced the remaining **${r}** panels with: "${e}"\n\nAll panels have now been updated with the environmental effects you requested!`,timestamp:new Date,agentId:R.id};y((e=>[...e,a]))};return r?t.jsxs(t.Fragment,{children:[t.jsx(vt,{isOpen:r,title:`AI Assistant - ${R.name}`,subtitle:R.specialty,icon:t.jsx(c,{className:"w-5 h-5"}),defaultWidth:"340px",defaultHeight:"500px",minWidth:300,minHeight:350,maxWidth:"600px",maxHeight:"90vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"ai-assistant-main",zIndex:9050,onClose:a,children:t.jsxs("div",{className:"flex flex-col h-full",style:{backgroundColor:d.theme.colors.background.primary,color:d.theme.colors.text.primary},children:[t.jsxs("div",{className:"border-b flex-shrink-0 transition-all duration-300 "+(Q?"shadow-sm":""),style:{backgroundColor:Q?`${d.theme.colors.background.secondary}95`:d.theme.colors.background.secondary,borderColor:d.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center justify-between transition-all duration-200 "+(Q?"p-1.5":"p-2"),children:[t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center cursor-pointer hover:scale-105 transition-all duration-300 border",style:{backgroundColor:R.theme.primary,borderColor:d.theme.colors.border.primary},onClick:()=>O(!0),title:`Click to change agent - Currently: ${R.name}`,children:t.jsx("span",{className:"text-xs font-medium text-white",children:R.avatar})}),Q?t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{className:"text-xs font-medium truncate max-w-[80px]",style:{color:d.theme.colors.text.primary},children:R.name}),q.length>0&&t.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:d.theme.colors.primary[400]},title:`${q.length} favorite agents available`})]}):t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-0.5",children:[t.jsx("h3",{className:"font-semibold text-xs truncate",style:{color:d.theme.colors.text.primary},children:R.name}),t.jsx("button",{onClick:()=>O(!0),className:"p-0.5 rounded transition-colors hover:bg-white/10",title:"Change AI Agent",style:{color:d.theme.colors.text.secondary},children:t.jsx(Y,{className:"w-3 h-3"})})]}),t.jsx("span",{className:"text-xs truncate",style:{color:d.theme.colors.text.secondary},children:R.specialty})]})]}),t.jsxs("div",{className:"flex items-center space-x-0.5",children:[Q&&t.jsxs("div",{className:"flex items-center space-x-0.5",children:[q.length>0&&t.jsx("button",{onClick:()=>O(!0),className:"text-xs p-1 rounded transition-all duration-200 hover:bg-white/10 hover:scale-110",title:"Quick access to favorite agents",style:{color:d.theme.colors.primary[500]},children:t.jsx(K,{className:"w-3 h-3 fill-current"})}),t.jsx("button",{onClick:()=>O(!0),className:"text-xs p-1 rounded transition-all duration-200 hover:bg-white/10 hover:scale-110",title:"Change agent",style:{color:d.theme.colors.text.secondary},children:t.jsx(Y,{className:"w-3 h-3"})}),t.jsx("button",{onClick:()=>$(!0),className:"text-xs p-1 rounded transition-all duration-200 hover:bg-white/10 hover:scale-110",title:"Image settings",style:{color:d.theme.colors.text.secondary},children:t.jsx(g,{className:"w-3 h-3"})})]}),t.jsx("button",{onClick:()=>{const e=!Q;X(e),e?(J(!1),te(null)):q.length>0&&q.length<=3&&J(!0)},className:"text-xs p-1 rounded transition-all duration-200 hover:bg-white/10 hover:scale-110",title:Q?"Expand header for more options":"Collapse header to save space",style:{color:d.theme.colors.text.secondary},children:Q?t.jsx(A,{className:"w-3 h-3"}):t.jsx(S,{className:"w-3 h-3"})}),!Q&&t.jsxs(t.Fragment,{children:[t.jsx(Et,{saveState:W,className:"text-xs"}),q.length>0&&t.jsx("button",{onClick:()=>J(!V),className:"text-xs px-1.5 py-0.5 flex items-center space-x-0.5 transition-all duration-200 "+(V?"btn-primary":"btn-secondary"),title:"Quick switch favorite agents",children:t.jsx(K,{className:"w-3 h-3 "+(V?"fill-current":"")})})]}),t.jsxs("button",{onClick:()=>{var e;y([{id:"1",type:"assistant",content:`${R.avatar} **${R.name} - ${R.specialty}**\n\n${R.description}\n\n**🎯 MY SPECIALTIES:**\n${R.skills.map((e=>`• ${e}`)).join("\n")}\n\n**💡 TRY THESE PROMPTS:**\n${R.examples.map((e=>`• "${e}"`)).join("\n")}\n\nCurrent Project: **${(null==(e=i.currentProject)?void 0:e.title)||"Untitled"}** (${i.panels.length} panels)\n\nI'm ready to help with your ${R.specialty.toLowerCase()}! What can we create together?`,timestamp:new Date,agentId:R.id}]),H(null),localStorage.removeItem("active-chat-id"),_({status:"idle"})},className:`btn-secondary text-xs ${Q?"px-1 py-1":"px-1.5 py-0.5"} flex items-center space-x-0.5 transition-all duration-200`,title:"Start new chat",children:[t.jsx(h,{className:"w-3 h-3"}),!Q&&t.jsx("span",{children:"New"})]})]})]}),!Q&&t.jsx("div",{className:"px-2 pb-2 animate-slide-down",style:{backgroundColor:`${d.theme.colors.background.secondary}80`},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsxs("button",{onClick:()=>O(!0),className:"text-xs px-1.5 py-0.5 btn-secondary flex items-center space-x-0.5",title:"Change agent",children:[t.jsx(Y,{className:"w-3 h-3"}),t.jsx("span",{children:"Agent"})]}),q.length>0&&t.jsxs("button",{onClick:()=>{J(!V),te(null)},className:"text-xs px-1.5 py-0.5 flex items-center space-x-0.5 transition-all duration-200 "+(V?"btn-primary":"btn-secondary"),title:"Favorites",children:[t.jsx(K,{className:"w-3 h-3 "+(V?"fill-current":"")}),t.jsx("span",{children:"Fav"})]}),t.jsxs("button",{onClick:()=>{te("history"===Z?null:"history"),J(!1)},className:"text-xs px-1.5 py-0.5 flex items-center space-x-0.5 transition-all duration-200 "+("history"===Z?"btn-primary":"btn-secondary"),title:"Chat history",children:[t.jsx(ae,{className:"w-3 h-3"}),t.jsx("span",{children:"History"})]})]}),t.jsx(Et,{saveState:W,className:"text-xs"})]})}),!Q&&V&&q.length>0&&t.jsx("div",{className:"px-2 pb-2 animate-slide-down",style:{backgroundColor:`${d.theme.colors.primary[50]}20`},children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-semibold text-xs",style:{color:d.theme.colors.text.primary},children:"⭐ Favorite Agents"}),t.jsx("button",{onClick:()=>J(!1),className:"p-0.5 hover:bg-white/10 rounded transition-colors",style:{color:d.theme.colors.text.secondary},children:t.jsx(n,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"flex flex-wrap gap-1",children:[q.slice(0,6).map((e=>{const r=Nt.find((t=>t.id===e));if(!r)return null;const a=r.id===R.id;return t.jsxs("button",{onClick:()=>(e=>{const t=Nt.find((t=>t.id===e));t&&Fe(t)})(r.id),className:"flex items-center space-x-1 px-2 py-1 rounded-lg text-xs transition-all duration-200 hover:scale-105 touch-manipulation "+(a?"ring-2":""),style:{backgroundColor:a?`${r.theme.primary}40`:`${r.theme.primary}20`,color:a?r.theme.primary:d.theme.colors.text.primary,border:`1px solid ${r.theme.primary}50`,...a&&{ringColor:r.theme.primary}},title:`Switch to ${r.name} - ${r.specialty}`,children:[t.jsx("span",{className:"text-xs",children:r.avatar}),t.jsx("span",{className:"font-medium truncate max-w-[60px]",children:r.name}),a&&t.jsx("span",{className:"text-xs",children:"•"})]},r.id)})),q.length>6&&t.jsx("button",{onClick:()=>O(!0),className:"flex items-center space-x-1 px-2 py-1 rounded-lg text-xs transition-all duration-200 hover:scale-105 border-dashed",style:{backgroundColor:`${d.theme.colors.background.secondary}50`,color:d.theme.colors.text.secondary,borderColor:d.theme.colors.border.primary},title:"View all favorites",children:t.jsxs("span",{children:["+",q.length-6]})})]}),t.jsx("div",{className:"text-xs",style:{color:d.theme.colors.text.secondary},children:"💡 Tip: Star agents in the selector to add them here"})]})}),!Q&&"history"===Z&&t.jsx("div",{className:"px-2 pb-2 animate-slide-down",style:{backgroundColor:`${d.theme.colors.background.secondary}40`},children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"font-semibold text-xs",style:{color:d.theme.colors.text.primary},children:["📖 Chat History (",se.length,")"]}),t.jsx("button",{onClick:()=>te(null),className:"p-0.5 hover:bg-white/10 rounded transition-colors",style:{color:d.theme.colors.text.secondary},children:t.jsx(n,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"relative",children:[t.jsx(ee,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-3 h-3",style:{color:d.theme.colors.text.secondary}}),t.jsx("input",{type:"text",value:ne,onChange:e=>ie(e.target.value),placeholder:"Search chats...",className:"input-modern w-full text-xs pl-6 pr-2 py-1"})]}),t.jsxs("div",{className:"max-h-48 overflow-y-auto space-y-1",children:[0===ce.length?t.jsx("div",{className:"text-xs text-center py-6",style:{color:d.theme.colors.text.secondary},children:0===se.length?t.jsxs(t.Fragment,{children:["💡 No saved chats yet",t.jsx("br",{}),"Start a conversation to save your first chat"]}):"No chats match your search"}):ce.slice(0,8).map((e=>{var r,a;const s=Ct(e.agentId),o=(e=>{const t=Ct(e);return(null==t?void 0:t.theme)||{primary:"#6366F1",secondary:"#818CF8",accent:"#E0E7FF",gradient:"from-indigo-600 to-purple-600"}})(e.agentId),n=e.id===B,i=me===e.id;return t.jsx("div",{className:"relative p-2 rounded-lg border transition-all duration-200 hover:bg-white/5 "+(n?"ring-1":""),style:{backgroundColor:n?`${o.primary}20`:"transparent",borderColor:n?o.primary:d.theme.colors.border.primary,...n&&{ringColor:o.primary}},children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>(e=>{_e(e),te(null)})(e),children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("span",{className:"text-xs",children:(null==s?void 0:s.avatar)||"🤖"}),i?t.jsxs("div",{className:"flex-1 flex items-center space-x-1",children:[t.jsx("input",{type:"text",value:he,onChange:e=>ue(e.target.value),onKeyPress:e=>{"Enter"===e.key&&ze(),"Escape"===e.key&&Re()},className:"flex-1 px-1 py-0.5 text-xs border rounded",style:{backgroundColor:d.theme.colors.background.secondary,borderColor:d.theme.colors.border.primary,color:d.theme.colors.text.primary},autoFocus:!0}),t.jsx("button",{onClick:ze,className:"text-green-600 hover:text-green-700 text-xs",children:"✓"}),t.jsx("button",{onClick:Re,className:"text-red-600 hover:text-red-700 text-xs",children:"✕"})]}):t.jsxs("div",{className:"flex-1",children:[t.jsx("h5",{className:"font-medium text-xs truncate",style:{color:d.theme.colors.text.primary},children:e.name}),n&&t.jsx("span",{className:"text-xs px-1 py-0.5 rounded text-white",style:{backgroundColor:o.primary},children:"Current"})]})]}),t.jsxs("div",{className:"flex items-center space-x-1 text-xs ml-4",style:{color:d.theme.colors.text.secondary},children:[t.jsx(re,{className:"w-2.5 h-2.5"}),t.jsx("span",{children:e.agentName}),t.jsx("span",{children:"•"}),t.jsx(P,{className:"w-2.5 h-2.5"}),t.jsx("span",{children:Ue(e.lastActivity)})]}),t.jsx("div",{className:"text-xs ml-4 mt-1 line-clamp-2",style:{color:d.theme.colors.text.secondary},children:e.messages.length>1?(null==(a=null==(r=e.messages.find((e=>"user"===e.type)))?void 0:r.content)?void 0:a.substring(0,60))+"...":"New conversation"})]}),t.jsxs("div",{className:"flex items-center space-x-0.5 ml-2",children:[t.jsx("button",{onClick:t=>{var r,a;t.stopPropagation(),r=e.id,a=e.name,pe(r),ue(a)},className:"p-0.5 hover:bg-white/10 rounded transition-colors",style:{color:d.theme.colors.text.secondary},title:"Rename chat",children:t.jsx(D,{className:"w-2.5 h-2.5"})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{if(Pt.deleteChat(e)){e===B&&(H(null),localStorage.removeItem("active-chat-id"),y([]));const t=Pt.getAllChats();oe(t)}})(e.id)},className:"p-0.5 hover:bg-red-100 rounded transition-colors text-red-600",title:"Delete chat",children:t.jsx(T,{className:"w-2.5 h-2.5"})})]})]})},e.id)})),ce.length>8&&t.jsxs("div",{className:"text-xs text-center py-2",style:{color:d.theme.colors.text.secondary},children:["...and ",ce.length-8," more"]})]})]})}),!Q&&"settings"===Z&&t.jsx("div",{className:"px-2 pb-2 animate-slide-down",style:{backgroundColor:`${d.theme.colors.background.secondary}40`},children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-semibold text-xs",style:{color:d.theme.colors.text.primary},children:"⚙️ Advanced Settings"}),t.jsx("button",{onClick:()=>te(null),className:"p-0.5 hover:bg-white/10 rounded transition-colors",style:{color:d.theme.colors.text.secondary},children:t.jsx(n,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"space-y-2 border-b border-gray-200 dark:border-gray-800 pb-2",children:[t.jsx("h5",{className:"text-xs font-semibold",style:{color:d.theme.colors.text.primary},children:"🔑 API Keys"}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium",style:{color:d.theme.colors.text.primary},children:"OpenAI API Key"}),t.jsx("div",{className:"text-xs",style:{color:d.theme.colors.text.secondary},children:ot.getApiKey()?"✅ Set":"⚠️ Not set"})]}),t.jsx("button",{onClick:()=>v(!0),className:"btn-primary text-xs px-2 py-1",children:ot.getApiKey()?"Change":"Set Key"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-xs font-medium",style:{color:d.theme.colors.text.primary},children:"Brave Search API Key"}),t.jsx("div",{className:"text-xs",style:{color:d.theme.colors.text.secondary},children:ot.getSearchApiKey()?"✅ Set":"⚠️ Not set (needed for web search)"})]}),t.jsx("button",{onClick:()=>k(!0),className:"btn-primary text-xs px-2 py-1",children:ot.getSearchApiKey()?"Change":"Set Key"})]})]}),t.jsxs("div",{className:"space-y-2 pt-2",children:[t.jsx("h5",{className:"text-xs font-semibold",style:{color:d.theme.colors.text.primary},children:"🎨 Image Settings"}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",style:{color:d.theme.colors.text.primary},children:"Model"}),t.jsxs("select",{value:ge.model,onChange:e=>ye((t=>({...t,model:e.target.value}))),className:"input-modern w-full text-xs mt-0.5",children:[t.jsx("option",{value:"dall-e-3",children:"DALL-E 3 (Best Quality)"}),t.jsx("option",{value:"dall-e-2",children:"DALL-E 2 (Faster)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",style:{color:d.theme.colors.text.primary},children:"Style"}),t.jsxs("select",{value:ge.style,onChange:e=>ye((t=>({...t,style:e.target.value}))),className:"input-modern w-full text-xs mt-0.5",children:[t.jsx("option",{value:"photorealistic",children:"Photorealistic"}),t.jsx("option",{value:"cinematic",children:"Cinematic"}),t.jsx("option",{value:"artistic",children:"Artistic"}),t.jsx("option",{value:"cartoon",children:"Cartoon"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs font-medium",style:{color:d.theme.colors.text.primary},children:"Quality"}),t.jsxs("select",{value:ge.quality,onChange:e=>ye((t=>({...t,quality:e.target.value}))),className:"input-modern w-full text-xs mt-0.5",children:[t.jsx("option",{value:"standard",children:"Standard"}),t.jsx("option",{value:"hd",children:"HD (Higher Quality)"})]})]}),t.jsx("button",{onClick:()=>te(null),className:"btn-primary text-xs px-2 py-1 w-full",children:"Apply Settings"})]})]})})]}),!ot.isReady()&&t.jsx("div",{className:"p-1.5 border-b flex-shrink-0",style:{backgroundColor:`${d.theme.colors.primary[100]}20`,borderColor:d.theme.colors.border.primary},children:t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx("div",{className:"p-0.5 rounded",style:{backgroundColor:`${d.theme.colors.primary[500]}20`},children:t.jsx(g,{className:"w-3 h-3",style:{color:d.theme.colors.primary[500]}})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium",style:{color:d.theme.colors.text.primary},children:"Setup Required"}),t.jsx("p",{className:"text-xs",style:{color:d.theme.colors.text.secondary},children:"Add OpenAI API key"})]}),t.jsx("button",{onClick:()=>v(!0),className:"btn-primary text-xs px-1.5 py-0.5",children:"Add Key"})]})}),b&&t.jsx("div",{className:"p-2 border-b flex-shrink-0",style:{backgroundColor:d.theme.colors.background.secondary,borderColor:d.theme.colors.border.primary},children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-xs",style:{color:d.theme.colors.text.primary},children:"OpenAI API Key"}),t.jsx("p",{className:"text-xs",style:{color:d.theme.colors.text.secondary},children:"Required for AI features"})]}),t.jsx("button",{onClick:()=>v(!1),className:"p-0.5 hover:bg-white/10 rounded transition-colors",style:{color:d.theme.colors.text.secondary},children:t.jsx(n,{className:"w-3 h-3"})})]}),t.jsx("input",{type:"password",value:w,onChange:e=>j(e.target.value),placeholder:"sk-...",className:"input-modern w-full text-xs",onKeyPress:e=>"Enter"===e.key&&Ne()}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-xs underline transition-colors",style:{color:d.theme.colors.primary[500]},children:"Get API key from OpenAI →"}),t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("button",{onClick:()=>v(!1),className:"btn-secondary text-xs px-1.5 py-0.5",children:"Cancel"}),t.jsx("button",{onClick:Ne,className:"btn-primary text-xs px-1.5 py-0.5",children:"Save Key"})]})]})]})}),N&&t.jsx("div",{className:"p-2 border-b flex-shrink-0",style:{backgroundColor:d.theme.colors.background.secondary,borderColor:d.theme.colors.border.primary},children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-xs",style:{color:d.theme.colors.text.primary},children:"Brave Search API Key"}),t.jsx("p",{className:"text-xs",style:{color:d.theme.colors.text.secondary},children:"Required for web search capability"})]}),t.jsx("button",{onClick:()=>k(!1),className:"p-0.5 hover:bg-white/10 rounded transition-colors",style:{color:d.theme.colors.text.secondary},children:t.jsx(n,{className:"w-3 h-3"})})]}),t.jsx("input",{type:"password",value:C,onChange:e=>I(e.target.value),placeholder:"Enter search API key...",className:"input-modern w-full text-xs",onKeyPress:e=>"Enter"===e.key&&ke()}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("a",{href:"https://api.search.brave.com/register",target:"_blank",rel:"noopener noreferrer",className:"text-xs underline transition-colors",style:{color:d.theme.colors.primary[500]},children:"Get API key from Brave →"}),t.jsxs("div",{className:"flex space-x-1",children:[t.jsx("button",{onClick:()=>k(!1),className:"btn-secondary text-xs px-1.5 py-0.5",children:"Cancel"}),t.jsx("button",{onClick:ke,className:"btn-primary text-xs px-1.5 py-0.5",children:"Save Key"})]})]})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-1.5 space-y-1.5",style:{backgroundColor:d.theme.colors.background.primary},children:[u.map((e=>t.jsx("div",{className:`flex ${"user"===e.type?"justify-end":"justify-start"} animate-fade-in`,children:t.jsxs("div",{className:"max-w-[85%] rounded-lg shadow-sm transition-all duration-300 p-2 "+("user"===e.type?"ml-6":(e.type,"mr-6")),style:{backgroundColor:"user"===e.type?d.theme.colors.primary[500]:"system"===e.type?`${d.theme.colors.primary[100]}40`:d.theme.colors.background.secondary,color:"user"===e.type?"white":d.theme.colors.text.primary,borderColor:d.theme.colors.border.primary,border:"user"!==e.type?`1px solid ${d.theme.colors.border.primary}`:"none"},children:[t.jsx(Dt,{content:e.content,className:"text-xs leading-snug",showCopyButton:"assistant"===e.type}),t.jsxs("div",{className:"flex items-center justify-between mt-1 pt-1 border-t border-white/20",children:[t.jsx("p",{className:"text-xs opacity-70 font-medium",children:e.timestamp.toLocaleTimeString()}),"assistant"===e.type&&t.jsxs("div",{className:"flex items-center space-x-0.5",children:[t.jsx(K,{className:"w-3 h-3 opacity-50"}),t.jsx("span",{className:"text-xs opacity-70",children:"AI"})]})]})]})},e.id))),Ae&&t.jsx($t,{isActive:xe.active,thinking:xe.content,agentId:R.id,loadingStages:xe.stages}),x&&!Ae&&t.jsx("div",{className:"flex justify-start animate-fade-in",children:t.jsx("div",{className:"p-2 rounded-lg border mr-6",style:{backgroundColor:d.theme.colors.background.secondary,borderColor:d.theme.colors.border.primary},children:t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsxs("div",{className:"flex space-x-0.5",children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-bounce",style:{backgroundColor:d.theme.colors.primary[400]}}),t.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-bounce",style:{backgroundColor:d.theme.colors.primary[400],animationDelay:"0.1s"}}),t.jsx("div",{className:"w-1.5 h-1.5 rounded-full animate-bounce",style:{backgroundColor:d.theme.colors.primary[400],animationDelay:"0.2s"}})]}),t.jsxs("span",{className:"text-xs font-medium",style:{color:d.theme.colors.text.secondary},children:[R.name," is thinking..."]})]})})}),t.jsx("div",{ref:we})]}),t.jsx("div",{className:"p-1.5 border-t flex-shrink-0",style:{backgroundColor:d.theme.colors.background.secondary,borderColor:d.theme.colors.border.primary},children:t.jsxs("div",{className:"space-y-1.5",children:[t.jsxs("div",{className:"flex items-end space-x-1.5",children:[t.jsx("div",{className:"flex-1 relative",children:t.jsx("textarea",{value:m,onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Pe())},placeholder:"Ask about storyboarding, scenes, or filmmaking...",className:"input-modern w-full text-xs resize-none",disabled:x,rows:m.includes("\n")?Math.min(m.split("\n").length,3):1,style:{minHeight:"32px",maxHeight:"72px"}})}),t.jsx("button",{onClick:Pe,disabled:!m.trim()||x,className:"btn-primary p-1.5 flex items-center justify-center",style:{minHeight:"32px",minWidth:"32px"},children:x?t.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}):t.jsx(le,{className:"w-3 h-3"})})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:d.theme.colors.text.secondary},children:[t.jsxs("div",{className:"flex items-center space-x-0.5",children:[t.jsx(F,{className:"w-3 h-3",style:{color:d.theme.colors.primary[500]}}),t.jsx("span",{children:"Shift+Enter for new line"})]}),Ie&&t.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100/40 text-blue-600 dark:bg-blue-900/40 dark:text-blue-300",children:[t.jsx(ee,{size:10,className:"mr-0.5"}),"Search"]}),Ae&&t.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-purple-100/40 text-purple-600 dark:bg-purple-900/40 dark:text-purple-300",children:[t.jsx(c,{size:10,className:"mr-0.5"}),"Thinking"]})]}),!x&&m.trim()&&t.jsxs("div",{className:"flex items-center space-x-0.5 px-1.5 py-0.5 rounded text-xs font-medium",style:{backgroundColor:`${d.theme.colors.primary[100]}40`,color:d.theme.colors.primary[600]},children:[t.jsx("div",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:d.theme.colors.primary[500]}}),t.jsx("span",{children:"Ready"})]})]})]})})]})}),t.jsx(jt,{isOpen:E&&Q,onClose:()=>$(!1),onSave:e=>{ye(e),$(!1)},currentSettings:ge}),t.jsx(St,{isOpen:M,onClose:()=>O(!1),onSelectAgent:Fe,currentAgent:R}),t.jsx(Tt,{isOpen:L&&Q,onClose:()=>z(!1),onSelectChat:_e,currentChatId:B||void 0})]}):null}const Ot=[{value:"extreme-close-up",label:"Extreme Close-up",description:"Very tight framing on subject details"},{value:"close-up",label:"Close-up",description:"Tight framing focusing on subject"},{value:"medium-shot",label:"Medium Shot",description:"Subject from waist up"},{value:"wide-shot",label:"Wide Shot",description:"Subject and surroundings visible"},{value:"over-the-shoulder",label:"Over-the-shoulder",description:"Conversation perspective"},{value:"two-shot",label:"Two Shot",description:"Two subjects in frame"},{value:"establishing-shot",label:"Establishing Shot",description:"Sets scene location and context"}],Lt=[{value:"eye-level",label:"Eye Level",description:"Camera at subject eye height"},{value:"high-angle",label:"High Angle",description:"Camera above subject looking down"},{value:"low-angle",label:"Low Angle",description:"Camera below subject looking up"},{value:"birds-eye-view",label:"Bird's Eye",description:"Directly overhead view"},{value:"worms-eye-view",label:"Worm's Eye",description:"Directly below looking up"},{value:"dutch-angle",label:"Dutch Angle",description:"Tilted camera for dramatic effect"}];function Ft({panel:r,isOpen:a,onClose:s}){const{dispatch:n}=qe(),{state:i}=Xe(),[l,c]=e.useState(!1),[m,p]=e.useState(!1),[h,u]=e.useState({title:"",description:"",shotType:"medium-shot",cameraAngle:"eye-level",notes:"",duration:3});e.useEffect((()=>{r&&a?(p(!0),setTimeout((()=>{u({title:r.title||"",description:r.description||"",shotType:r.shotType||"medium-shot",cameraAngle:r.cameraAngle||"eye-level",notes:r.notes||"",duration:r.duration||3}),p(!1)}),100)):a&&!r&&p(!0)}),[r,a]),e.useEffect((()=>{a||(u({title:"",description:"",shotType:"medium-shot",cameraAngle:"eye-level",notes:"",duration:3}),c(!1),p(!1))}),[a]),e.useEffect((()=>{console.log("PanelEditor - Panel data:",r),console.log("PanelEditor - Is open:",a),console.log("PanelEditor - Form data:",h)}),[r,a,h]);const g=e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a&&r){const e=new FileReader;e.onload=e=>{var t;const a=null==(t=e.target)?void 0:t.result;n({type:"UPDATE_PANEL",payload:{id:r.id,updates:{imageUrl:a}}})},e.readAsDataURL(a)}},y=e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a&&r){if(a.size>52428800&&!confirm(`This video is large (${(a.size/1048576).toFixed(1)}MB) and may cause performance issues. Continue?`))return;const e=new FileReader;p(!0),e.onload=e=>{var t;try{const a=null==(t=e.target)?void 0:t.result;console.log(`📹 Video loaded, size: ${(a.length/1048576).toFixed(2)}MB`),n({type:"UPDATE_PANEL",payload:{id:r.id,updates:{videoUrl:a}}}),p(!1)}catch(a){console.error("Failed to process video:",a),alert("Failed to process the video. It may be too large or in an unsupported format."),p(!1)}},e.onerror=()=>{console.error("File reading error:",e.error),alert("Error reading the video file. Please try a different file or format."),p(!1)},e.readAsDataURL(a)}};return a?a&&!r?t.jsx(vt,{isOpen:a,onClose:s,title:"Edit Panel",subtitle:"Loading...",icon:t.jsx(ce,{className:"w-5 h-5"}),defaultWidth:"min(90vw, 1000px)",defaultHeight:"min(90vh, 800px)",maxWidth:"98vw",maxHeight:"98vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"panel-editor-loading",children:t.jsx("div",{className:"h-full flex items-center justify-center bg-primary",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto mb-3"}),t.jsx("p",{className:"text-primary font-medium",children:"Loading panel data..."})]})})}):t.jsx(vt,{isOpen:a,onClose:s,title:r?`Edit Panel ${r.order+1}`:"Create New Panel",subtitle:(null==r?void 0:r.title)||"New Panel",icon:t.jsx(ce,{className:"w-5 h-5"}),defaultWidth:"min(90vw, 1000px)",defaultHeight:"min(90vh, 800px)",maxWidth:"98vw",maxHeight:"98vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:`panel-editor-${(null==r?void 0:r.id)||"new"}`,children:t.jsxs("div",{className:"h-full flex flex-col bg-primary",children:[m&&t.jsx("div",{className:"absolute inset-0 bg-primary/80 backdrop-blur-sm flex items-center justify-center z-50",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary-500 border-t-transparent rounded-full mx-auto mb-3"}),t.jsx("p",{className:"text-primary font-medium",children:"Loading panel content..."})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:t.jsxs("div",{className:"panel-editor-grid",children:[t.jsxs("div",{className:"space-y-4 panel-editor-content",children:[t.jsxs("h3",{className:"font-medium text-primary flex items-center space-x-2",children:[t.jsx(o,{className:"w-4 h-4"}),t.jsx("span",{children:"Visual Content"})]}),t.jsxs("div",{className:"aspect-video bg-secondary rounded-lg border-2 border-dashed border-secondary flex items-center justify-center relative overflow-hidden",children:[(null==r?void 0:r.imageUrl)?t.jsx("img",{src:r.imageUrl,alt:r.title||"Panel image",className:"w-full h-full object-cover"}):t.jsxs("div",{className:"text-center p-4",children:[t.jsx(o,{className:"w-12 h-12 text-secondary mx-auto mb-2"}),t.jsx("p",{className:"text-sm text-secondary mb-2",children:"Add image or sketch"}),t.jsxs("label",{className:"btn-primary cursor-pointer inline-flex items-center",children:[t.jsx(w,{className:"w-4 h-4 mr-2"}),"Upload Image",t.jsx("input",{type:"file",accept:"image/*",onChange:g,className:"hidden"})]})]}),(null==r?void 0:r.imageUrl)&&t.jsxs("label",{className:"absolute top-2 right-2 bg-primary p-2 rounded-lg shadow-md cursor-pointer hover:bg-secondary transition-colors",children:[t.jsx(w,{className:"w-4 h-4 text-secondary"}),t.jsx("input",{type:"file",accept:"image/*",onChange:g,className:"hidden"})]})]}),t.jsxs("div",{className:"p-4 bg-secondary rounded-lg",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx(d,{className:"w-4 h-4 text-secondary"}),t.jsx("span",{className:"text-sm font-medium text-primary",children:"Video Content"})]}),(null==r?void 0:r.videoUrl)?t.jsxs("div",{className:"space-y-2",children:[t.jsx("video",{src:r.videoUrl,controls:!0,className:"w-full rounded-lg",style:{maxHeight:"200px"},onError:e=>{console.error("Video loading error:",e),alert("There was an error loading the video. The file might be corrupt or too large.")}}),t.jsxs("label",{className:"btn-secondary text-xs cursor-pointer inline-flex items-center",children:[t.jsx(w,{className:"w-3 h-3 mr-1"}),"Replace Video",t.jsx("input",{type:"file",accept:"video/*",onChange:y,className:"hidden"})]})]}):t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"btn-secondary text-xs cursor-pointer inline-flex items-center w-full justify-center",children:[t.jsx(w,{className:"w-3 h-3 mr-1"}),"Upload Video",t.jsx("input",{type:"file",accept:"video/*",onChange:y,className:"hidden"})]}),t.jsx("p",{className:"text-xs text-secondary mt-2",children:"Recommended formats: MP4, WebM (smaller files work best)"})]})]}),(null==r?void 0:r.aiGeneratedPrompt)&&t.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(ce,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{className:"text-sm font-medium text-green-800",children:"AI Video Prompt"})]}),t.jsx("button",{onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),c(!0),setTimeout((()=>c(!1)),2e3)}catch(t){console.error("Failed to copy:",t)}})(r.aiGeneratedPrompt),className:"flex items-center space-x-1 px-2 py-1 text-xs bg-green-100 hover:bg-green-200 text-green-700 rounded transition-colors",children:l?t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"w-3 h-3"}),t.jsx("span",{children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{className:"w-3 h-3"}),t.jsx("span",{children:"Copy"})]})})]}),t.jsx("p",{className:"text-xs text-green-700 leading-relaxed",children:r.aiGeneratedPrompt}),t.jsx("p",{className:"text-xs text-green-600 mt-2 opacity-75",children:"Use this prompt with Runway ML, Pika Labs, or other AI video generation tools"})]})]}),t.jsxs("div",{className:"space-y-4 panel-editor-content",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("h3",{className:"font-medium flex items-center space-x-2 text-primary",children:[t.jsx(ce,{className:"w-4 h-4"}),t.jsx("span",{children:"Panel Details"})]})}),t.jsx(it,{context:"panel-editing",className:"text-xs"}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Title"}),t.jsx("input",{type:"text",value:h.title,onChange:e=>u((t=>({...t,title:e.target.value}))),className:"input-modern w-full",placeholder:"Panel title..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Description"}),t.jsx("textarea",{value:h.description,onChange:e=>u((t=>({...t,description:e.target.value}))),rows:3,className:"textarea-modern w-full",placeholder:"Describe what happens in this panel..."})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Shot Type"}),t.jsx("select",{value:h.shotType,onChange:e=>u((t=>({...t,shotType:e.target.value}))),className:"select-modern w-full",children:Ot.map((e=>t.jsxs("option",{value:e.value,children:[e.label," - ",e.description]},e.value)))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Camera Angle"}),t.jsx("select",{value:h.cameraAngle,onChange:e=>u((t=>({...t,cameraAngle:e.target.value}))),className:"select-modern w-full",children:Lt.map((e=>t.jsxs("option",{value:e.value,children:[e.label," - ",e.description]},e.value)))})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-medium text-secondary mb-1",children:[t.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Duration (seconds)"]}),t.jsx("input",{type:"number",value:h.duration,onChange:e=>u((t=>({...t,duration:parseInt(e.target.value)||0}))),min:"1",max:"60",className:"input-modern w-full"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-secondary mb-1",children:"Director's Notes"}),t.jsx("textarea",{value:h.notes,onChange:e=>u((t=>({...t,notes:e.target.value}))),rows:3,className:"textarea-modern w-full",placeholder:"Additional notes, lighting, mood, etc..."})]})]})]})}),t.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-primary",children:[t.jsx("button",{onClick:s,className:"btn-secondary",children:"Cancel"}),t.jsxs("button",{onClick:()=>{if(h.title.trim()){if(r)n({type:"UPDATE_PANEL",payload:{id:r.id,updates:{...h,updatedAt:new Date}}});else{const e={id:`panel-${Date.now()}`,...h,order:0,createdAt:new Date,updatedAt:new Date};n({type:"ADD_PANEL",payload:e})}s()}else alert("Please enter a panel title")},className:"btn-primary flex items-center space-x-2",children:[t.jsx(v,{className:"w-4 h-4"}),t.jsx("span",{children:r?"Save Changes":"Create Panel"})]})]})]})}):null}const zt=[{id:"dialogue-scene",title:"Dialogue Scene",description:"Two-person conversation template",icon:t.jsx(Y,{className:"w-6 h-6"}),gradient:"from-blue-500 to-cyan-500",project:{id:"dialogue-template",title:"Dialogue Scene Template",description:"Template for filming a conversation between two characters",panels:[{id:"dialogue-1",title:"Establishing Shot",description:"Wide shot showing both characters and their environment",shotType:"wide-shot",cameraAngle:"eye-level",notes:"Set the scene and show relationship between characters",duration:4,order:0,createdAt:new Date,updatedAt:new Date},{id:"dialogue-2",title:"Character A Close-up",description:"Close-up of first character speaking",shotType:"close-up",cameraAngle:"eye-level",notes:"Focus on facial expressions and dialogue delivery",duration:3,order:1,createdAt:new Date,updatedAt:new Date},{id:"dialogue-3",title:"Character B Close-up",description:"Close-up of second character responding",shotType:"close-up",cameraAngle:"eye-level",notes:"Show reaction and response",duration:3,order:2,createdAt:new Date,updatedAt:new Date},{id:"dialogue-4",title:"Over Shoulder",description:"Over shoulder shot showing both characters",shotType:"over-the-shoulder",cameraAngle:"eye-level",notes:"Show interaction and maintain screen direction",duration:4,order:3,createdAt:new Date,updatedAt:new Date}],createdAt:new Date,updatedAt:new Date}},{id:"action-sequence",title:"Action Sequence",description:"High-energy action scene template",icon:t.jsx(k,{className:"w-6 h-6"}),gradient:"from-orange-500 to-red-500",project:{id:"action-template",title:"Action Sequence Template",description:"Template for filming fast-paced action scenes",panels:[{id:"action-1",title:"Wide Action Shot",description:"Wide shot establishing the action space",shotType:"wide-shot",cameraAngle:"high-angle",notes:"Show full scope of action, establish geography",duration:2,order:0,createdAt:new Date,updatedAt:new Date},{id:"action-2",title:"Character in Motion",description:"Medium shot of protagonist moving",shotType:"medium-shot",cameraAngle:"low-angle",notes:"Dynamic movement, heroic angle",duration:1,order:1,createdAt:new Date,updatedAt:new Date},{id:"action-3",title:"Impact Moment",description:"Extreme close-up of impact or contact",shotType:"extreme-close-up",cameraAngle:"dutch-angle",notes:"Quick cut, high impact moment",duration:1,order:2,createdAt:new Date,updatedAt:new Date},{id:"action-4",title:"Reaction Shot",description:"Close-up of character reaction",shotType:"close-up",cameraAngle:"eye-level",notes:"Show emotional response to action",duration:2,order:3,createdAt:new Date,updatedAt:new Date}],createdAt:new Date,updatedAt:new Date}},{id:"romantic-scene",title:"Romantic Scene",description:"Intimate romantic moment template",icon:t.jsx(Q,{className:"w-6 h-6"}),gradient:"from-pink-500 to-rose-500",project:{id:"romantic-template",title:"Romantic Scene Template",description:"Template for filming intimate romantic moments",panels:[{id:"romantic-1",title:"Setting the Mood",description:"Establishing shot with romantic lighting",shotType:"establishing-shot",cameraAngle:"eye-level",notes:"Soft lighting, romantic atmosphere",duration:5,order:0,createdAt:new Date,updatedAt:new Date},{id:"romantic-2",title:"Two Shot",description:"Medium shot of both characters together",shotType:"two-shot",cameraAngle:"eye-level",notes:"Show connection between characters",duration:4,order:1,createdAt:new Date,updatedAt:new Date},{id:"romantic-3",title:"Intimate Close-up",description:"Close-up focusing on emotional connection",shotType:"close-up",cameraAngle:"eye-level",notes:"Capture intimate emotions and expressions",duration:3,order:2,createdAt:new Date,updatedAt:new Date}],createdAt:new Date,updatedAt:new Date}}];function Rt({isOpen:r,onClose:a}){const{dispatch:s}=qe(),{state:o}=Xe(),[n,i]=e.useState(null);return r?t.jsx(vt,{isOpen:r,onClose:a,title:"Project Templates",subtitle:"Start with a pre-built storyboard template",icon:t.jsx(ce,{className:"w-5 h-5"}),defaultWidth:"min(92vw, 1000px)",defaultHeight:"min(85vh, 700px)",maxWidth:"98vw",maxHeight:"95vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"project-templates",zIndex:9100,children:t.jsx("div",{className:"h-full overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:zt.map((e=>t.jsxs("div",{className:"relative overflow-hidden rounded-lg border-2 transition-all cursor-pointer",style:{borderColor:n===e.id?o.theme.colors.primary[500]:o.theme.colors.border.secondary,backgroundColor:n===e.id?`${o.theme.colors.primary[50]}80`:"transparent"},onMouseOver:t=>{n!==e.id&&(t.currentTarget.style.borderColor=o.theme.colors.border.primary)},onMouseOut:t=>{n!==e.id&&(t.currentTarget.style.borderColor=o.theme.colors.border.secondary)},onClick:()=>i(e.id),children:[t.jsx("div",{className:`bg-gradient-to-r ${e.gradient} p-4 text-white`,children:t.jsxs("div",{className:"flex items-center space-x-3",children:[e.icon,t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold",children:e.title}),t.jsx("p",{className:"text-sm opacity-90",children:e.description})]})]})}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"text-sm mb-3",style:{color:o.theme.colors.text.secondary},children:[e.project.panels.length," panels • Total duration: "," ",e.project.panels.reduce(((e,t)=>e+(t.duration||0)),0),"s"]}),t.jsxs("div",{className:"space-y-2",children:[e.project.panels.slice(0,3).map(((e,r)=>t.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[t.jsx("div",{className:"w-4 h-4 rounded flex items-center justify-center font-medium",style:{backgroundColor:o.theme.colors.background.tertiary,color:o.theme.colors.text.secondary},children:r+1}),t.jsx("span",{className:"truncate",style:{color:o.theme.colors.text.primary},children:e.title})]},e.id))),e.project.panels.length>3&&t.jsxs("div",{className:"text-xs ml-6",style:{color:o.theme.colors.text.secondary},children:["+",e.project.panels.length-3," more panels"]})]})]}),t.jsx("div",{className:"p-4 border-t",style:{borderColor:o.theme.colors.border.secondary},children:t.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{confirm(`Load the "${e.title}" template? This will replace your current project.`)&&(s({type:"SET_PROJECT",payload:{...e.project,id:`template-${Date.now()}`,createdAt:new Date,updatedAt:new Date}}),a())})(e)},className:"w-full btn-primary text-sm py-2",children:"Use This Template"})})]},e.id)))}),t.jsxs("div",{className:"mt-6 p-4 border-2 border-dashed rounded-lg text-center",style:{borderColor:o.theme.colors.border.secondary},children:[t.jsx(ce,{className:"w-8 h-8 mx-auto mb-2",style:{color:o.theme.colors.text.secondary}}),t.jsx("h3",{className:"font-medium mb-1",style:{color:o.theme.colors.text.primary},children:"Create Custom Template"}),t.jsx("p",{className:"text-sm mb-3",style:{color:o.theme.colors.text.secondary},children:"Start with a blank project and build your own storyboard from scratch"}),t.jsx("button",{onClick:()=>{s({type:"SET_PROJECT",payload:{id:`custom-${Date.now()}`,title:"Custom Storyboard Project",description:"A custom storyboard project",panels:[],createdAt:new Date,updatedAt:new Date}}),a()},className:"btn-secondary",children:"Start Blank Project"})]})]})})}):null}function Ut({isOpen:r,onClose:a}){const{state:s,dispatch:o}=qe(),{state:n}=Xe(),[i,l]=e.useState([]),[c,d]=e.useState(!1),[m,h]=e.useState({}),[u,y]=e.useState("grid"),[x,b]=e.useState(""),[v,w]=e.useState("all"),[j,N]=e.useState({}),[C,S]=e.useState({generated:0,total:0}),[A,I]=e.useState({style:"cinematic",duration:"3-5 seconds",aspectRatio:"16:9",quality:"high",motion:"smooth",lighting:"dramatic",mood:"dynamic",model:"4o-mini"}),[T,E]=e.useState(!1);e.useEffect((()=>{r&&s.panels.length>0&&l(s.panels.map((e=>e.id)))}),[r,s.panels]),e.useEffect((()=>{const e=Object.keys(m).length,t=s.panels.length;S({generated:e,total:t})}),[m,s.panels]);const D=s.panels.filter((e=>{const t=!x||e.title.toLowerCase().includes(x.toLowerCase())||e.description.toLowerCase().includes(x.toLowerCase()),r="all"===v||"generated"===v&&m[e.id]||"pending"===v&&!m[e.id];return t&&r})),$=async e=>{var t,r,a,o,n,i;if(console.log("🎯 generateVideoPrompt called for panel:",e.id,"Description:",e.description),ot.isReady()){console.log("🤖 AI service is ready, generating contextual prompt with full project data...");try{const i={projectTitle:(null==(t=s.currentProject)?void 0:t.title)||"Untitled Project",projectDescription:(null==(r=s.currentProject)?void 0:r.description)||"",directorNotes:(null==(a=s.currentProject)?void 0:a.directorNotes)||"",videoStyle:(null==(o=s.currentProject)?void 0:o.videoStyle)||{},totalPanels:s.panels.length,currentPanelIndex:s.panels.findIndex((t=>t.id===e.id))+1,previousPanels:s.panels.slice(0,s.panels.findIndex((t=>t.id===e.id))).map((e=>({title:e.title,description:e.description,shotType:e.shotType,cameraAngle:e.cameraAngle,duration:e.duration,notes:e.notes}))),nextPanels:s.panels.slice(s.panels.findIndex((t=>t.id===e.id))+1).map((e=>({title:e.title,description:e.description,shotType:e.shotType,cameraAngle:e.cameraAngle,duration:e.duration,notes:e.notes}))),currentPanel:{title:e.title,description:e.description,shotType:e.shotType,cameraAngle:e.cameraAngle,duration:e.duration,notes:e.notes}},l=await M(i);if(l&&"string"==typeof l&&l.length>0)return console.log("✅ AI generated contextual prompt:",l.substring(0,100)+"..."),l;{console.log("⚠️ AI contextual generation failed, trying scene generation...");const t=await ot.generateScene(`${e.description} | Project: ${i.projectTitle} | Director's Vision: ${i.directorNotes} | Context: Panel ${i.currentPanelIndex} of ${i.totalPanels}`,e.shotType,e.cameraAngle,"cinematic");if(console.log("🔍 AI service returned scene data:",{hasVideoPrompt:!!t.videoPrompt,videoPromptType:typeof t.videoPrompt,videoPromptLength:null==(n=t.videoPrompt)?void 0:n.length,sceneDataKeys:Object.keys(t)}),t&&t.videoPrompt&&"string"==typeof t.videoPrompt&&t.videoPrompt.length>0)return console.log("✅ AI generated scene prompt:",t.videoPrompt.substring(0,50)+"..."),t.videoPrompt;console.log("⚠️ AI service returned invalid videoPrompt - using intelligent fallback"),console.log("   - videoPrompt type:",typeof t.videoPrompt),console.log("   - videoPrompt value:",t.videoPrompt),console.log("   - sceneData:",t)}}catch(l){console.error("❌ Error generating AI video prompt:",l);const e=l;console.log("📄 Error details:",{name:e.name||"Unknown",message:e.message||"Unknown error",stack:(null==(i=e.stack)?void 0:i.substring(0,200))||"No stack trace"})}}else console.log("🔧 AI service not ready, using intelligent contextual fallback");return console.log("📝 Creating intelligent contextual fallback prompt with project data..."),O(e,s)},M=async e=>{try{const t=`Create a professional, cinematic video generation prompt for an AI video tool (RunwayML, Pika Labs, Stable Video Diffusion, Luma Dream Machine).\n\nPROJECT CONTEXT:\n- Title: "${e.projectTitle}"\n- Description: "${e.projectDescription}"\n- Director's Vision: "${e.directorNotes}"\n- Video Style: ${JSON.stringify(e.videoStyle)}\n\nCURRENT PANEL (${e.currentPanelIndex} of ${e.totalPanels}):\n- Title: "${e.currentPanel.title}"\n- Description: "${e.currentPanel.description}"\n- Shot Type: ${e.currentPanel.shotType}\n- Camera Angle: ${e.currentPanel.cameraAngle}\n- Duration: ${e.currentPanel.duration} seconds\n- Notes: "${e.currentPanel.notes}"\n\nSTORY CONTEXT:\nPrevious panels: ${e.previousPanels.map(((e,t)=>`Panel ${t+1}: ${e.title} - ${e.description}`)).join(" | ")}\nNext panels: ${e.nextPanels.map(((t,r)=>`Panel ${e.currentPanelIndex+r+1}: ${t.title} - ${t.description}`)).join(" | ")}\n\nREQUIREMENTS:\nCreate a detailed video generation prompt that:\n1. Reflects the director's creative vision and project style\n2. Maintains visual continuity with previous/next panels\n3. Uses professional cinematography terminology\n4. Includes specific technical specifications (4K, 24fps, lighting, color grading)\n5. Incorporates camera movement and framing details\n6. Considers the panel's role in the overall story flow\n7. Optimizes for AI video generation tools\n\nGenerate ONLY the video prompt text, no explanations or formatting.`;return await ot.sendMessage([{role:"user",content:t}],{projectTitle:e.projectTitle,projectDescription:e.projectDescription,panelCount:e.totalPanels,totalDuration:4*e.totalPanels,currentPanel:e.currentPanel,allPanels:[...e.previousPanels,e.currentPanel,...e.nextPanels],directorNotes:e.directorNotes})||""}catch(t){return console.error("❌ Error in contextual prompt generation:",t),""}},O=(e,t)=>{const r=t.currentProject,a=t.panels,s=a.findIndex((t=>t.id===e.id)),o=[];(null==r?void 0:r.directorNotes)&&o.push(`Directors Vision: ${r.directorNotes}`),(null==r?void 0:r.description)&&o.push(`Project Theme: ${r.description}`);const n=[];if(s>0){const e=a[s-1];n.push(`Following: ${e.title} (${e.shotType})`)}if(s<a.length-1){const e=a[s+1];n.push(`Leading to: ${e.title} (${e.shotType})`)}const i=(null==r?void 0:r.videoStyle)||{},l=[];i.genre&&l.push(`Genre: ${i.genre}`),i.mood&&l.push(`Mood: ${i.mood}`),i.colorPalette&&l.push(`Color Palette: ${i.colorPalette}`),i.cinematicStyle&&l.push(`Style: ${i.cinematicStyle}`);const c=L(e.shotType,e.cameraAngle),d=[`${e.description}.`,`${c.description} ${c.movement}`,o.length>0?o.join(". ")+".":"",n.length>0?n.join(", ")+".":"",l.length>0?l.join(", ")+".":"",`Professional cinematography, ${c.technical}`,`Duration: ${e.duration} seconds`,"4K resolution, cinematic lighting, color graded, film grain texture"].filter(Boolean).join(" ");return console.log("📝 Generated intelligent fallback prompt:",d.substring(0,100)+"..."),d},L=(e,t)=>{const r={"extreme-wide":{description:"Extreme wide shot capturing vast environment",movement:"with slow, sweeping camera movement",technical:"24fps, wide-angle lens, deep focus"},wide:{description:"Wide shot establishing scene context",movement:"with smooth establishing movement",technical:"24fps, standard lens, balanced exposure"},medium:{description:"Medium shot focusing on subject interaction",movement:"with subtle tracking or static framing",technical:"24fps, 50mm lens equivalent, natural depth of field"},"close-up":{description:"Close-up shot capturing emotional detail",movement:"with intimate, controlled camera work",technical:"24fps, 85mm lens equivalent, shallow depth of field"},"extreme-close-up":{description:"Extreme close-up revealing intricate details",movement:"with precise, minimal camera movement",technical:"24fps, macro lens, ultra-shallow focus"}},a=r[e]||r.medium,s={"eye-level":"at natural eye level perspective","low-angle":"from dramatic low angle looking up","high-angle":"from elevated high angle looking down","bird-eye":"from aerial bird's eye perspective","dutch-angle":"with dynamic tilted dutch angle"}[t]||"";return{...a,description:`${a.description} ${s}`.trim()}};return r?t.jsx(vt,{isOpen:r,onClose:a,title:"Video Prompt Generator",subtitle:"Create AI video generation prompts for your storyboard",icon:t.jsx(Z,{className:"w-5 h-5"}),defaultWidth:"1000px",defaultHeight:"700px",minWidth:600,minHeight:400,maxWidth:"1600px",maxHeight:"1000px",resizable:!0,minimizable:!0,maximizable:!0,windowId:"video-prompt-generator",zIndex:1500,children:t.jsxs("div",{className:"flex flex-col h-full p-4 space-y-4",children:[t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h2",{className:"text-lg font-medium",style:{color:n.theme.colors.text.primary},children:"Video Prompts"}),t.jsx("div",{className:"flex items-center text-sm",children:t.jsxs("div",{className:"px-2 py-1 rounded-lg",style:{backgroundColor:n.theme.colors.background.tertiary},children:[t.jsx("span",{style:{color:n.theme.colors.primary[500]},children:C.generated}),t.jsx("span",{style:{color:n.theme.colors.text.secondary},children:" / "}),t.jsx("span",{style:{color:n.theme.colors.text.primary},children:C.total}),t.jsx("span",{className:"ml-1",style:{color:n.theme.colors.text.secondary},children:"panels"})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>E(!T),className:"flex items-center gap-1 px-2 py-1 rounded-lg transition-colors "+(T?"bg-primary-500 text-white":""),style:T?{}:{backgroundColor:n.theme.colors.background.secondary,color:n.theme.colors.text.secondary},children:[t.jsx(g,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Settings"})]}),t.jsxs("div",{className:"flex items-center border rounded-lg",style:{borderColor:n.theme.colors.border.primary},children:[t.jsx("button",{onClick:()=>y("grid"),className:"flex items-center p-1 rounded-l-lg "+("grid"===u?"bg-primary-100":""),style:"grid"===u?{backgroundColor:`${n.theme.colors.primary[100]}50`,color:n.theme.colors.primary[500]}:{},children:t.jsx(f,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>y("list"),className:"flex items-center p-1 rounded-r-lg "+("list"===u?"bg-primary-100":""),style:"list"===u?{backgroundColor:`${n.theme.colors.primary[100]}50`,color:n.theme.colors.primary[500]}:{},children:t.jsx(de,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"relative",style:{minWidth:"180px"},children:[t.jsx(ee,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4",style:{color:n.theme.colors.text.tertiary}}),t.jsx("input",{type:"text",placeholder:"Search panels...",value:x,onChange:e=>b(e.target.value),className:"pl-8 pr-2 py-1 w-full rounded-lg text-sm focus:outline-none focus:ring-1",style:{backgroundColor:n.theme.colors.background.secondary,borderColor:n.theme.colors.border.primary,color:n.theme.colors.text.primary}})]}),t.jsxs("select",{value:v,onChange:e=>w(e.target.value),className:"px-2 py-1 rounded-lg text-sm focus:outline-none",style:{backgroundColor:n.theme.colors.background.secondary,borderColor:n.theme.colors.border.primary,color:n.theme.colors.text.primary},children:[t.jsx("option",{value:"all",children:"All Panels"}),t.jsx("option",{value:"generated",children:"Generated"}),t.jsx("option",{value:"pending",children:"Pending"})]})]})]}),T&&t.jsxs("div",{className:"settings-panel space-y-4 p-4 bg-background-light rounded-lg border border-border-light",children:[t.jsx("h3",{className:"text-sm font-medium mb-2",style:{color:n.theme.colors.text.primary},children:"Video Generation Settings"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.theme.colors.text.secondary},children:"AI Model"}),t.jsx("select",{value:A.model,onChange:e=>I({...A,model:e.target.value}),className:"select-modern w-full text-sm",style:{backgroundColor:n.theme.colors.background.secondary,borderColor:n.theme.colors.border.primary,color:n.theme.colors.text.primary},children:t.jsx("option",{value:"o4-mini",children:"GPT-o4-mini (Fast & Economic)"})}),t.jsx("p",{className:"text-xs mt-1",style:{color:n.theme.colors.text.tertiary},children:"Using o4-mini for optimal cost efficiency in batch operations"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium mb-1",style:{color:n.theme.colors.text.secondary},children:"Video Style"}),t.jsxs("select",{value:A.style,onChange:e=>I({...A,style:e.target.value}),className:"select-modern w-full text-sm",style:{backgroundColor:n.theme.colors.background.secondary,borderColor:n.theme.colors.border.primary,color:n.theme.colors.text.primary},children:[t.jsx("option",{value:"cinematic",children:"Cinematic"}),t.jsx("option",{value:"realistic",children:"Realistic"}),t.jsx("option",{value:"stylized",children:"Stylized"}),t.jsx("option",{value:"animation",children:"Animation"})]})]})]})]}),t.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-3 p-2 border-t border-b",style:{borderColor:n.theme.colors.border.primary},children:[t.jsxs("div",{className:"text-sm",style:{color:n.theme.colors.text.secondary},children:[t.jsx("span",{className:"font-medium",style:{color:n.theme.colors.text.primary},children:"Using 4o-mini model"})," "," for optimal cost efficiency with batch operations"]}),t.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.jsx("button",{onClick:async()=>{if(!ot.isReady())return void alert("Please set up your OpenAI API key first in the AI Assistant settings.");d(!0);const e={};try{console.log(`🚀 Starting batch generation with model: ${A.model}`);for(let r=0;r<s.panels.length;r++){const a=s.panels[r];if(m[a.id])e[a.id]=m[a.id];else{console.log(`🎬 Generating prompt ${r+1}/${s.panels.length} for panel: ${a.title}`);try{const t=await $(a);t&&t.length>0?(e[a.id]=t,o({type:"UPDATE_PANEL",payload:{id:a.id,updates:{aiGeneratedPrompt:t,videoPrompt:t,updatedAt:new Date}}}),console.log(`✅ Generated prompt for panel ${r+1}: ${t.substring(0,50)}...`)):console.warn(`⚠️ Empty prompt generated for panel ${r+1}`)}catch(t){console.error(`❌ Error generating prompt for panel ${r+1}:`,t)}await new Promise((e=>setTimeout(e,500)))}}h((t=>({...t,...e}))),console.log("🎉 Batch generation completed")}catch(t){console.error("❌ Error in batch generation:",t),alert("Error generating prompts. Please check your API settings and try again.")}finally{d(!1)}},disabled:c,className:"flex items-center space-x-2 transform hover:scale-105 transition-all duration-300 px-4 py-2 rounded-xl "+(c?"opacity-50 cursor-not-allowed":""),style:{backgroundColor:n.theme.colors.primary[500],color:"#ffffff"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.theme.colors.primary[600]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.theme.colors.primary[500]},children:c?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-5 h-5 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:n.theme.colors.text.primary}}),t.jsx("span",{children:"Generating..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(k,{className:"w-5 h-5"}),t.jsx("span",{children:"Generate All Prompts"})]})}),!ot.isReady()&&t.jsxs("div",{className:"flex items-center space-x-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-xl",children:[t.jsx(se,{className:"w-5 h-5"}),t.jsx("span",{className:"text-sm",children:"Please configure your OpenAI API key first"})]})]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar scrollable",children:0===D.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center animate-fadeIn",children:[t.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-400 to-purple-400 rounded-full flex items-center justify-center mb-6 animate-bounce",children:t.jsx(ee,{className:"w-12 h-12 text-white"})}),t.jsx("h3",{className:"text-2xl font-bold text-primary mb-2",children:"No panels found"}),t.jsx("p",{className:"text-secondary text-lg",children:"Try adjusting your search or filter criteria"})]}):t.jsx("div",{className:""+("grid"===u?"grid grid-cols-1 lg:grid-cols-2 gap-6":"space-y-4"),children:D.map(((e,r)=>{const a=!!m[e.id],s=j[e.id];return t.jsxs("div",{className:"rounded-2xl border p-6 transition-all duration-300 transform hover:scale-105 hover:shadow-xl glass-panel group "+(a?"ring-2":""),style:{animationDelay:50*r+"ms",backgroundColor:a?`${n.theme.colors.secondary[50]}`:n.theme.colors.background.primary,borderColor:n.theme.colors.border.primary,...a&&{ringColor:n.theme.colors.primary[200]}},children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold",style:{background:a?`linear-gradient(to right, ${n.theme.colors.primary[500]}, ${n.theme.colors.secondary[500]})`:`linear-gradient(to right, ${n.theme.colors.text.tertiary}, ${n.theme.colors.border.primary})`},children:e.order+1}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-bold text-primary text-lg group-hover:text-purple-600 transition-colors",children:e.title}),t.jsxs("div",{className:"flex items-center space-x-3 mt-1",children:[t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:`${n.theme.colors.primary[100]}`,color:n.theme.colors.primary[700]},children:e.shotType}),t.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:`${n.theme.colors.secondary[100]}`,color:n.theme.colors.secondary[700]},children:e.cameraAngle}),t.jsxs("div",{className:"flex items-center space-x-1 text-secondary text-xs",children:[t.jsx(P,{className:"w-3 h-3"}),t.jsxs("span",{children:[e.duration,"s"]})]})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[a&&t.jsxs("div",{className:"flex items-center space-x-1 text-green-600 text-sm font-medium",children:[t.jsx(ie,{className:"w-4 h-4"}),t.jsx("span",{children:"Generated"})]}),t.jsx("button",{onClick:()=>(async e=>{if(ot.isReady()){d(!0);try{const t=await $(e);t&&(h((r=>({...r,[e.id]:t}))),o({type:"UPDATE_PANEL",payload:{id:e.id,updates:{aiGeneratedPrompt:t,videoPrompt:t,updatedAt:new Date}}}))}catch(t){console.error("Error regenerating prompt:",t),alert("Error regenerating prompt. Please try again.")}finally{d(!1)}}else alert("Please set up your OpenAI API key first in the AI Assistant settings.")})(e),disabled:c,className:"w-10 h-10 text-white rounded-xl flex items-center justify-center transition-all duration-300 transform hover:scale-110 disabled:opacity-50",style:{backgroundColor:n.theme.colors.primary[500]},onMouseEnter:e=>{c||(e.currentTarget.style.backgroundColor=n.theme.colors.primary[600])},onMouseLeave:e=>{c||(e.currentTarget.style.backgroundColor=n.theme.colors.primary[500])},title:"Generate/Regenerate Prompt",children:c?t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):t.jsx(me,{className:"w-5 h-5"})})]})]}),t.jsx("div",{className:"mb-4 p-3 rounded-lg",style:{backgroundColor:`${n.theme.colors.background.secondary}10`,borderColor:n.theme.colors.border.primary},children:t.jsx("p",{className:"text-secondary text-sm leading-relaxed whitespace-pre-wrap",style:{color:n.theme.colors.text.primary},children:e.description})}),a?t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h4",{className:"font-semibold text-primary flex items-center space-x-2",children:[t.jsx(p,{className:"w-4 h-4"}),t.jsx("span",{children:"Video Prompt"})]}),t.jsx("button",{onClick:()=>(async(e,t)=>{try{await navigator.clipboard.writeText(e),N((e=>({...e,[t]:!0}))),setTimeout((()=>{N((e=>({...e,[t]:!1})))}),2e3)}catch(r){console.error("Failed to copy:",r)}})(m[e.id],e.id),className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300 transform hover:scale-105 text-white",style:{backgroundColor:s?n.theme.colors.secondary[500]:n.theme.colors.primary[500]},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=s?n.theme.colors.secondary[600]:n.theme.colors.primary[600]},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=s?n.theme.colors.secondary[500]:n.theme.colors.primary[500]},children:s?t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Copied!"})]}):t.jsxs(t.Fragment,{children:[t.jsx(R,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Copy"})]})})]}),t.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:`${n.theme.colors.background.secondary}10`,borderColor:n.theme.colors.border.primary},children:t.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",style:{color:n.theme.colors.text.primary},children:m[e.id]})})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[t.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center mb-4 animate-pulse",style:{background:`linear-gradient(to bottom right, ${n.theme.colors.secondary[200]}, ${n.theme.colors.secondary[300]})`},children:t.jsx(Z,{className:"w-8 h-8",style:{color:n.theme.colors.text.tertiary}})}),t.jsx("p",{className:"text-secondary font-medium mb-2",children:"No prompt generated yet"}),t.jsx("p",{className:"text-secondary text-sm",children:"Click the regenerate button to create a video prompt"})]})]},e.id)}))})})]})}):null}const Wt=[{id:"blank",name:"Blank Project",description:"Start from scratch",icon:"📄"},{id:"commercial",name:"Commercial",description:"30-60 second commercial template",icon:"📺"},{id:"social",name:"Social Media",description:"Short form content template",icon:"📱"},{id:"narrative",name:"Narrative Film",description:"Long form storytelling template",icon:"🎬"},{id:"explainer",name:"Explainer Video",description:"Educational content template",icon:"🎓"},{id:"music-video",name:"Music Video",description:"Music video template",icon:"🎵"}];function _t({isOpen:r,onClose:a}){const{dispatch:s}=qe(),{state:o}=Xe(),n=Ge(o.theme),i=(e=>{const t=Ge(e);return[{id:"blue",color:t.project.blue.background,name:"Blue"},{id:"purple",color:t.project.purple.background,name:"Purple"},{id:"green",color:t.project.green.background,name:"Green"},{id:"red",color:t.project.red.background,name:"Red"},{id:"orange",color:t.project.orange.background,name:"Orange"},{id:"pink",color:t.project.pink.background,name:"Pink"},{id:"indigo",color:t.project.indigo.background,name:"Indigo"},{id:"gray",color:t.project.gray.background,name:"Gray"}]})(o.theme),[l,c]=e.useState([]),[d,u]=e.useState(""),[y,x]=e.useState("all"),[b,v]=e.useState("updated"),[w,N]=e.useState("grid"),[k,C]=e.useState([]),[S,A]=e.useState(!1),[I,P]=e.useState(!1),[E,$]=e.useState(null),[M,O]=e.useState({title:"",description:"",tags:[],status:"draft",template:"blank",color:"#3B82F6",category:"",priority:"medium"});e.useEffect((()=>{L()}),[]);const L=async()=>{try{const e=(await Ue.getAllProjects()).map((e=>({id:e.id,title:e.title,description:e.description||"",panels:e.panels||[],directorNotes:"",createdAt:e.createdAt,updatedAt:e.updatedAt,isStarred:!1,isArchived:!1,tags:[],lastOpenedAt:e.updatedAt,thumbnailUrl:"",collaborators:[],status:"draft",color:"#3B82F6",template:"blank",category:"",priority:"medium"})));c(e)}catch(e){console.error("Error loading projects:",e)}},F=async e=>{try{const t={id:e.id,title:e.title,description:e.description,panels:e.panels,createdAt:e.createdAt,updatedAt:new Date};await Ue.saveProject(t);const r=l.map((t=>t.id===e.id?{...e,updatedAt:new Date}:t));c(r)}catch(t){console.error("Error saving project:",t)}},z=async e=>{const t={...e,lastOpenedAt:new Date};s({type:"SET_PROJECT",payload:t}),s({type:"SET_PANELS",payload:e.panels}),await F(t),a()},U=async e=>{const t={...e,id:`project-${Date.now()}`,title:`${e.title} (Copy)`,createdAt:new Date,updatedAt:new Date,lastOpenedAt:new Date,isStarred:!1},r={id:t.id,title:t.title,description:t.description,panels:t.panels,createdAt:t.createdAt,updatedAt:t.updatedAt};await Ue.saveProject(r);const a=[t,...l];c(a)},W=async e=>{const t={projects:l.filter((t=>e.includes(t.id))),exportedAt:new Date,version:"1.0"},r=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=`storyboard-projects-export-${Date.now()}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},_=l.filter((e=>{var t,r;const a=e.title.toLowerCase().includes(d.toLowerCase())||e.description.toLowerCase().includes(d.toLowerCase())||(null==(t=e.tags)?void 0:t.some((e=>e.toLowerCase().includes(d.toLowerCase()))))||(null==(r=e.category)?void 0:r.toLowerCase().includes(d.toLowerCase())),s="all"===y?!e.isArchived:"starred"===y?e.isStarred&&!e.isArchived:"recent"===y?!e.isArchived:"archived"!==y||e.isArchived;return a&&s})).sort(((e,t)=>{switch(b){case"title":return e.title.localeCompare(t.title);case"created":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"panels":return t.panels.length-e.panels.length;default:return new Date(t.updatedAt).getTime()-new Date(e.updatedAt).getTime()}})),B=e.useMemo((()=>{const e=window.innerWidth>1200?1200:.9*window.innerWidth;return ut.getOptimalLayout(e,_.length)}),[_.length]),H=e=>{switch(e){case"completed":return n.status.success.background;case"review":return n.status.info.background;case"in-progress":return n.status.warning.background;default:return n.project.gray.background}},q=e=>{switch(e){case"completed":return"Complete";case"review":return"Review";case"in-progress":return"In Progress";default:return"Draft"}},G=e=>{switch(e){case"high":return n.status.error.background;case"medium":return n.status.warning.background;case"low":return n.status.success.background;default:return n.project.gray.background}};return r?t.jsx(vt,{isOpen:r,onClose:a,title:"Projects",subtitle:`${_.length} of ${l.length} projects`,icon:t.jsx(m,{className:"w-5 h-5"}),defaultWidth:"1400",defaultHeight:"900",maxWidth:"98vw",maxHeight:"98vh",minWidth:280,minHeight:400,resizable:!0,minimizable:!0,maximizable:!0,windowId:"project-manager",zIndex:9100,children:t.jsxs("div",{className:"h-full w-full flex flex-col bg-primary",children:[t.jsxs("div",{className:"border-b p-4",style:{backgroundColor:n.interactive.secondary.background,borderColor:n.interactive.secondary.border},children:[t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4",children:[t.jsxs("div",{className:"flex-1 relative",children:[t.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5",style:{color:n.interactive.secondary.text}}),t.jsx("input",{type:"text",placeholder:"Search projects by name, description, tags, or category...",value:d,onChange:e=>u(e.target.value),className:"w-full pl-11 pr-4 py-3 text-base rounded-xl transition-all duration-200",style:{backgroundColor:o.theme.colors.background.primary,border:`1px solid ${o.theme.colors.border.primary}`,color:o.theme.colors.text.primary},onFocus:e=>{e.currentTarget.style.borderColor=o.theme.colors.primary[500]},onBlur:e=>{e.currentTarget.style.borderColor=o.theme.colors.border.primary}})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:()=>P(!I),className:"px-4 py-3 flex items-center gap-2 rounded-lg transition-all duration-200",style:{backgroundColor:I?n.interactive.primary.background:n.interactive.secondary.background,color:I?n.interactive.primary.text:n.interactive.secondary.text,border:`1px solid ${n.interactive.secondary.border}`},onMouseEnter:e=>{I||(e.currentTarget.style.backgroundColor=n.interactive.secondary.hover)},onMouseLeave:e=>{I||(e.currentTarget.style.backgroundColor=n.interactive.secondary.background)},children:[t.jsx(pe,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Filters"})]}),t.jsxs("select",{value:b,onChange:e=>v(e.target.value),className:"px-3 py-3 rounded-xl text-sm transition-all duration-200",style:{backgroundColor:o.theme.colors.background.primary,border:`1px solid ${o.theme.colors.border.primary}`,color:o.theme.colors.text.primary},onFocus:e=>{e.currentTarget.style.borderColor=o.theme.colors.primary[500]},onBlur:e=>{e.currentTarget.style.borderColor=o.theme.colors.border.primary},children:[t.jsx("option",{value:"updated",children:"Recently Updated"}),t.jsx("option",{value:"created",children:"Recently Created"}),t.jsx("option",{value:"title",children:"Name A-Z"}),t.jsx("option",{value:"panels",children:"Panel Count"})]}),t.jsxs("div",{className:"flex rounded-lg p-1",style:{backgroundColor:n.interactive.secondary.background},children:[t.jsx("button",{onClick:()=>N("grid"),className:"p-2 rounded-md transition-all duration-200",style:{backgroundColor:"grid"===w?n.interactive.primary.background:"transparent",color:"grid"===w?n.interactive.primary.text:n.interactive.secondary.text},onMouseEnter:e=>{"grid"!==w&&(e.currentTarget.style.color=o.theme.colors.text.primary)},onMouseLeave:e=>{"grid"!==w&&(e.currentTarget.style.color=n.interactive.secondary.text)},children:t.jsx(f,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>N("list"),className:"p-2 rounded-md transition-all duration-200",style:{backgroundColor:"list"===w?n.interactive.primary.background:"transparent",color:"list"===w?n.interactive.primary.text:n.interactive.secondary.text},onMouseEnter:e=>{"list"!==w&&(e.currentTarget.style.color=o.theme.colors.text.primary)},onMouseLeave:e=>{"list"!==w&&(e.currentTarget.style.color=n.interactive.secondary.text)},children:t.jsx(de,{className:"w-4 h-4"})})]}),t.jsxs("button",{onClick:()=>A(!0),className:"px-6 py-3 flex items-center gap-2 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl",style:{backgroundColor:n.interactive.primary.background,color:n.interactive.primary.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.interactive.primary.hover,e.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.interactive.primary.background,e.currentTarget.style.transform="translateY(0)"},children:[t.jsx(h,{className:"w-4 h-4"}),t.jsx("span",{children:"New Project"})]})]})]}),I&&t.jsx("div",{className:"mt-4 flex flex-wrap gap-2 p-4 rounded-xl",style:{backgroundColor:n.interactive.secondary.background},children:["all","starred","recent","archived"].map((e=>t.jsx("button",{onClick:()=>x(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200",style:{backgroundColor:y===e?n.interactive.primary.background:"transparent",color:y===e?n.interactive.primary.text:n.interactive.secondary.text,border:`1px solid ${y===e?n.interactive.primary.background:"transparent"}`},onMouseEnter:t=>{y!==e&&(t.currentTarget.style.backgroundColor=n.interactive.secondary.hover)},onMouseLeave:t=>{y!==e&&(t.currentTarget.style.backgroundColor="transparent")},children:"all"===e?"All Projects":e.charAt(0).toUpperCase()+e.slice(1)},e)))}),k.length>0&&t.jsxs("div",{className:"mt-4 flex items-center justify-between p-3 rounded-xl border",style:{backgroundColor:n.status.info.light,borderColor:n.status.info.border},children:[t.jsxs("span",{className:"text-sm font-medium",style:{color:n.status.info.background},children:[k.length," project",k.length>1?"s":""," selected"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>W(k),className:"px-3 py-2 text-sm rounded-lg transition-all duration-200",style:{backgroundColor:n.interactive.secondary.background,color:n.interactive.secondary.text,border:`1px solid ${n.interactive.secondary.border}`},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.background},children:t.jsx(j,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>(async e=>{const t=l.map((t=>e.includes(t.id)?{...t,isArchived:!t.isArchived}:t));c(t),C([])})(k),className:"px-3 py-2 text-sm rounded-lg transition-all duration-200",style:{backgroundColor:n.interactive.secondary.background,color:n.interactive.secondary.text,border:`1px solid ${n.interactive.secondary.border}`},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.background},children:t.jsx(he,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>(async e=>{if(!confirm(`Delete ${e.length} project(s)? This cannot be undone.`))return;for(const a of e)try{await Ue.deleteProject(a)}catch(r){console.error(`Error deleting project ${a}:`,r)}const t=l.filter((t=>!e.includes(t.id)));c(t),C([])})(k),className:"px-3 py-2 text-sm rounded-lg transition-all duration-200",style:{backgroundColor:n.status.error.background,color:n.status.error.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.status.error.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.status.error.background},children:t.jsx(T,{className:"w-4 h-4"})})]})]})]}),t.jsx("div",{className:"flex-1 overflow-auto w-full",children:S?t.jsxs("div",{className:"max-w-4xl mx-auto rounded-2xl p-8 border m-6",style:{backgroundColor:n.interactive.secondary.background,borderColor:n.interactive.secondary.border},children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-2xl font-bold",style:{color:n.text.primary.color},children:"Create New Project"}),t.jsx("button",{onClick:()=>A(!1),className:"p-2 rounded-lg transition-all duration-200",style:{color:n.interactive.secondary.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent"},children:t.jsx(D,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:n.text.primary.color},children:"Project Name *"}),t.jsx("input",{type:"text",value:M.title,onChange:e=>O((t=>({...t,title:e.target.value}))),placeholder:"Enter your project name...",className:"w-full text-lg p-4 rounded-xl transition-all duration-200",style:{backgroundColor:o.theme.colors.background.primary,border:`1px solid ${o.theme.colors.border.primary}`,color:n.text.primary.color},onFocus:e=>{e.currentTarget.style.borderColor=o.theme.colors.primary[500]},onBlur:e=>{e.currentTarget.style.borderColor=o.theme.colors.border.primary},autoFocus:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:n.text.primary.color},children:"Description"}),t.jsx("textarea",{value:M.description,onChange:e=>O((t=>({...t,description:e.target.value}))),placeholder:"Describe your project...",rows:3,className:"w-full p-4 rounded-xl transition-all duration-200",style:{backgroundColor:o.theme.colors.background.primary,border:`1px solid ${o.theme.colors.border.primary}`,color:n.text.primary.color},onFocus:e=>{e.currentTarget.style.borderColor=o.theme.colors.primary[500]},onBlur:e=>{e.currentTarget.style.borderColor=o.theme.colors.border.primary}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:n.text.primary.color},children:"Category"}),t.jsx("input",{type:"text",value:M.category,onChange:e=>O((t=>({...t,category:e.target.value}))),placeholder:"e.g., Marketing, Internal, Client Work...",className:"w-full p-4 rounded-xl transition-all duration-200",style:{backgroundColor:o.theme.colors.background.primary,border:`1px solid ${o.theme.colors.border.primary}`,color:n.text.primary.color},onFocus:e=>{e.currentTarget.style.borderColor=o.theme.colors.primary[500]},onBlur:e=>{e.currentTarget.style.borderColor=o.theme.colors.border.primary}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-3",style:{color:n.text.primary.color},children:"Tags"}),t.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:M.tags.map(((e,r)=>t.jsxs("span",{className:"inline-flex items-center gap-2 px-3 py-1 bg-primary/20 text-primary rounded-full text-sm border border-primary/30",children:[t.jsx(ue,{className:"w-3 h-3"}),t.jsx("span",{children:e}),t.jsx("button",{onClick:()=>{return t=e,void O((e=>({...e,tags:e.tags.filter((e=>e!==t))})));var t},className:"hover:text-red-500 transition-colors",children:"×"})]},r)))}),t.jsx("input",{type:"text",placeholder:"Add tags (press Enter)...",className:"input-modern w-full p-3 bg-primary border border-primary/30 focus:border-primary/60 rounded-xl",onKeyPress:e=>{var t;"Enter"===e.key&&(e.preventDefault(),(t=e.currentTarget.value).trim()&&!M.tags.includes(t.trim())&&O((e=>({...e,tags:[...e.tags,t.trim()]}))),e.currentTarget.value="")}})]})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-3",children:"Template"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:Wt.map((e=>t.jsxs("button",{onClick:()=>O((t=>({...t,template:e.id}))),className:"p-4 rounded-xl border-2 transition-all text-left "+(M.template===e.id?"border-primary/60 bg-primary/20":"border-primary/20 bg-primary/5 hover:border-primary/40"),children:[t.jsx("div",{className:"text-2xl mb-2",children:e.icon}),t.jsx("div",{className:"font-semibold text-primary text-sm",children:e.name}),t.jsx("div",{className:"text-xs text-secondary mt-1",children:e.description})]},e.id)))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-3",children:"Project Color"}),t.jsx("div",{className:"flex flex-wrap gap-3",children:i.map((e=>t.jsx("button",{onClick:()=>O((t=>({...t,color:e.color}))),className:"w-10 h-10 rounded-lg border-2 transition-all "+(M.color===e.color?"border-white scale-110 shadow-lg":"border-primary/20 hover:scale-105"),style:{backgroundColor:e.color}},e.id)))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-3",children:"Status"}),t.jsxs("select",{value:M.status,onChange:e=>O((t=>({...t,status:e.target.value}))),className:"select-modern w-full p-3 bg-primary border border-primary/30 focus:border-primary/60 rounded-xl",children:[t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"in-progress",children:"In Progress"}),t.jsx("option",{value:"review",children:"Review"}),t.jsx("option",{value:"completed",children:"Completed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-3",children:"Priority"}),t.jsxs("select",{value:M.priority,onChange:e=>O((t=>({...t,priority:e.target.value}))),className:"select-modern w-full p-3 bg-primary border border-primary/30 focus:border-primary/60 rounded-xl",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]})]})]})]}),t.jsxs("div",{className:"flex gap-4 pt-8 mt-8 border-t",style:{borderColor:n.interactive.secondary.border},children:[t.jsx("button",{onClick:async()=>{if(!M.title.trim())return;const e={id:`project-${Date.now()}`,title:M.title.trim(),description:M.description.trim(),panels:[],directorNotes:"",createdAt:new Date,updatedAt:new Date,lastOpenedAt:new Date,isStarred:!1,isArchived:!1,tags:M.tags,status:M.status,collaborators:[],thumbnailUrl:"",color:M.color,template:M.template,category:M.category,priority:M.priority},t={id:e.id,title:e.title,description:e.description,panels:e.panels,createdAt:e.createdAt,updatedAt:e.updatedAt};await Ue.saveProject(t);const r=[e,...l];c(r),O({title:"",description:"",tags:[],status:"draft",template:"blank",color:"#3B82F6",category:"",priority:"medium"}),A(!1),z(e)},disabled:!M.title.trim(),className:"flex-1 py-4 text-lg font-semibold rounded-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:M.title.trim()?n.interactive.primary.background:n.interactive.primary.disabled,color:n.interactive.primary.text},onMouseEnter:e=>{M.title.trim()&&(e.currentTarget.style.backgroundColor=n.interactive.primary.hover)},onMouseLeave:e=>{M.title.trim()&&(e.currentTarget.style.backgroundColor=n.interactive.primary.background)},children:"Create Project"}),t.jsx("button",{onClick:()=>A(!1),className:"flex-1 py-4 text-lg font-semibold rounded-lg transition-all duration-200",style:{backgroundColor:n.interactive.secondary.background,color:n.interactive.secondary.text,border:`1px solid ${n.interactive.secondary.border}`},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.hover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.interactive.secondary.background},children:"Cancel"})]})]}):0===_.length?t.jsxs("div",{className:"text-center py-20 px-6",children:[t.jsx("div",{className:"w-32 h-32 rounded-3xl mx-auto mb-8 flex items-center justify-center",style:{background:`linear-gradient(135deg, ${o.theme.colors.primary[500]}20, ${o.theme.colors.secondary[500]}20)`},children:t.jsx(m,{className:"w-16 h-16",style:{color:`${o.theme.colors.text.primary}60`}})}),t.jsx("h3",{className:"text-2xl font-bold mb-4",style:{color:n.text.primary.color},children:d?"No projects found":"No projects yet"}),t.jsx("p",{className:"text-lg mb-8 max-w-md mx-auto",style:{color:n.text.secondary.color},children:d?"Try adjusting your search terms or filters":"Create your first project to start building amazing storyboards"}),!d&&t.jsxs("button",{onClick:()=>A(!0),className:"px-8 py-4 text-lg font-semibold rounded-lg transition-all duration-200 shadow-xl hover:shadow-2xl",style:{backgroundColor:n.interactive.primary.background,color:n.interactive.primary.text},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=n.interactive.primary.hover,e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=n.interactive.primary.background,e.currentTarget.style.transform="translateY(0)"},children:[t.jsx(h,{className:"w-5 h-5 mr-2"}),"Create Your First Project"]})]}):t.jsx("div",{className:"grid"===w?"grid p-6":"space-y-4 p-6",style:"grid"===w?{gridTemplateColumns:`repeat(${B.columns}, 1fr)`,gap:B.gap}:{},children:_.map((e=>{var r,a;return t.jsxs("div",{className:"group relative transition-all duration-300 transform hover:scale-105 rounded-2xl border hover:shadow-xl "+("grid"===w?"p-6":"p-4 flex items-center gap-4"),style:{backgroundColor:n.interactive.secondary.background,borderColor:n.interactive.secondary.border,borderLeftColor:e.color,borderLeftWidth:"grid"===w?"4px":"6px"},onMouseEnter:e=>{e.currentTarget.style.borderColor=o.theme.colors.primary[300]},onMouseLeave:e=>{e.currentTarget.style.borderColor=n.interactive.secondary.border},children:["grid"===w?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-start justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"text-xs font-semibold px-2 py-1 rounded-full",style:{backgroundColor:"text-red-600"===G(e.priority)?"#fee2e2":"text-yellow-600"===G(e.priority)?"#fef3c7":"#f0fdf4",color:"text-red-600"===G(e.priority)?"#dc2626":"text-yellow-600"===G(e.priority)?"#d97706":"#059669"},children:null==(r=e.priority)?void 0:r.toUpperCase()})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:t=>{t.stopPropagation(),(async e=>{const t=l.find((t=>t.id===e));if(!t)return;const r={...t,isStarred:!t.isStarred};await F(r)})(e.id)},className:"p-2 rounded-lg transition-colors",style:{color:e.isStarred?"#eab308":n.text.tertiary.color,backgroundColor:e.isStarred?"#fef3c720":"transparent"},onMouseEnter:t=>{e.isStarred||(t.currentTarget.style.color="#eab308")},onMouseLeave:t=>{e.isStarred||(t.currentTarget.style.color=n.text.tertiary.color)},children:t.jsx(K,{className:"w-4 h-4",fill:e.isStarred?"currentColor":"none"})}),t.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[t.jsx("button",{onClick:t=>{t.stopPropagation(),U(e)},className:"p-2 rounded-lg transition-colors",style:{color:n.text.tertiary.color},onMouseEnter:e=>{e.currentTarget.style.color=n.text.primary.color},onMouseLeave:e=>{e.currentTarget.style.color=n.text.tertiary.color},title:"Duplicate",children:t.jsx(R,{className:"w-4 h-4"})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),$(e)},className:"p-2 rounded-lg transition-colors",style:{color:n.text.tertiary.color},onMouseEnter:e=>{e.currentTarget.style.color=n.text.primary.color},onMouseLeave:e=>{e.currentTarget.style.color=n.text.tertiary.color},title:"Edit",children:t.jsx(g,{className:"w-4 h-4"})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),W([e.id])},className:"p-2 rounded-lg transition-colors",style:{color:n.text.tertiary.color},onMouseEnter:e=>{e.currentTarget.style.color=n.text.primary.color},onMouseLeave:e=>{e.currentTarget.style.color=n.text.tertiary.color},title:"Export",children:t.jsx(j,{className:"w-4 h-4"})})]})]})]}),t.jsxs("div",{className:"mb-4",onClick:()=>z(e),children:[t.jsx("h3",{className:"font-bold text-lg mb-2 line-clamp-2",style:{color:n.text.primary.color},children:e.title}),e.description&&t.jsx("p",{className:"text-sm line-clamp-3 mb-3",style:{color:n.text.secondary.color},children:e.description}),e.category&&t.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[t.jsx(p,{className:"w-3 h-3",style:{color:n.text.tertiary.color}}),t.jsx("span",{className:"text-xs",style:{color:n.text.tertiary.color},children:e.category})]}),e.tags&&e.tags.length>0&&t.jsxs("div",{className:"flex flex-wrap gap-1 mb-3",children:[e.tags.slice(0,3).map(((e,r)=>t.jsx("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:`${o.theme.colors.primary[500]}20`,color:o.theme.colors.primary[600]},children:e},r))),e.tags.length>3&&t.jsxs("span",{className:"px-2 py-1 rounded-full text-xs",style:{backgroundColor:n.interactive.secondary.background,color:n.text.tertiary.color},children:["+",e.tags.length-3]})]}),t.jsxs("div",{className:"flex items-center justify-between text-xs",style:{color:n.text.muted.color},children:[t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(ge,{className:"w-3 h-3"}),new Date(e.updatedAt).toLocaleDateString()]}),t.jsxs("span",{className:"flex items-center gap-1",children:[t.jsx(ye,{className:"w-3 h-3"}),e.panels.length," panels"]})]})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${H(e.status)} text-white`,children:q(e.status)}),t.jsx("input",{type:"checkbox",checked:k.includes(e.id),onChange:t=>{t.stopPropagation(),C((r=>t.target.checked?[...r,e.id]:r.filter((t=>t!==e.id))))},className:"w-4 h-4 rounded accent-primary"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-6 h-6 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),t.jsxs("div",{className:"flex-1 min-w-0",onClick:()=>z(e),children:[t.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[t.jsx("h3",{className:"font-semibold text-lg truncate",style:{color:n.text.primary.color},children:e.title}),e.isStarred&&t.jsx(K,{className:"w-4 h-4 text-yellow-500",fill:"currentColor"}),t.jsx("span",{className:"text-xs font-semibold px-2 py-1 rounded-full",style:{backgroundColor:"text-red-600"===G(e.priority)?"#fee2e2":"text-yellow-600"===G(e.priority)?"#fef3c7":"#f0fdf4",color:"text-red-600"===G(e.priority)?"#dc2626":"text-yellow-600"===G(e.priority)?"#d97706":"#059669"},children:null==(a=e.priority)?void 0:a.toUpperCase()})]}),e.description&&t.jsx("p",{className:"text-sm truncate mb-2",style:{color:n.text.secondary.color},children:e.description}),t.jsxs("div",{className:"flex items-center gap-4 text-xs",style:{color:n.text.muted.color},children:[t.jsxs("span",{children:[e.panels.length," panels"]}),t.jsx("span",{children:new Date(e.updatedAt).toLocaleDateString()}),t.jsx("span",{className:"capitalize",children:q(e.status)}),e.category&&t.jsx("span",{children:e.category})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:t=>{t.stopPropagation(),U(e)},className:"p-2 rounded-lg transition-colors",style:{color:n.text.tertiary.color},onMouseEnter:e=>{e.currentTarget.style.color=n.text.primary.color},onMouseLeave:e=>{e.currentTarget.style.color=n.text.tertiary.color},title:"Duplicate",children:t.jsx(R,{className:"w-4 h-4"})}),t.jsx("button",{onClick:t=>{t.stopPropagation(),$(e)},className:"p-2 rounded-lg transition-colors",style:{color:n.text.tertiary.color},onMouseEnter:e=>{e.currentTarget.style.color=n.text.primary.color},onMouseLeave:e=>{e.currentTarget.style.color=n.text.tertiary.color},title:"Edit",children:t.jsx(g,{className:"w-4 h-4"})}),t.jsx("input",{type:"checkbox",checked:k.includes(e.id),onChange:t=>{t.stopPropagation(),C((r=>t.target.checked?[...r,e.id]:r.filter((t=>t!==e.id))))},className:"w-4 h-4 rounded accent-primary"})]})]}),"grid"===w&&k.includes(e.id)&&t.jsx("div",{className:"absolute inset-0 bg-primary/20 backdrop-blur-sm rounded-2xl border-2 border-primary/50 flex items-center justify-center",children:t.jsx(ye,{className:"w-8 h-8 text-primary"})})]},e.id)}))})}),E&&t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-secondary rounded-2xl p-6 max-w-md w-full border border-primary/20",children:[t.jsx("h3",{className:"text-xl font-bold text-primary mb-4",children:"Edit Project"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-2",children:"Project Name"}),t.jsx("input",{type:"text",value:E.title,onChange:e=>$((t=>t?{...t,title:e.target.value}:null)),className:"input-modern w-full p-3 bg-primary border border-primary/30 rounded-xl"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-2",children:"Color"}),t.jsx("div",{className:"flex gap-2",children:i.map((e=>t.jsx("button",{onClick:()=>$((t=>t?{...t,color:e.color}:null)),className:"w-8 h-8 rounded-lg border-2 transition-all "+(E.color===e.color?"border-white scale-110":"border-primary/20 hover:scale-105"),style:{backgroundColor:e.color}},e.id)))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-2",children:"Status"}),t.jsxs("select",{value:E.status,onChange:e=>$((t=>t?{...t,status:e.target.value}:null)),className:"select-modern w-full p-2 bg-primary border border-primary/30 rounded-lg text-sm",children:[t.jsx("option",{value:"draft",children:"Draft"}),t.jsx("option",{value:"in-progress",children:"In Progress"}),t.jsx("option",{value:"review",children:"Review"}),t.jsx("option",{value:"completed",children:"Completed"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold text-primary mb-2",children:"Priority"}),t.jsxs("select",{value:E.priority,onChange:e=>$((t=>t?{...t,priority:e.target.value}:null)),className:"select-modern w-full p-2 bg-primary border border-primary/30 rounded-lg text-sm",children:[t.jsx("option",{value:"low",children:"Low"}),t.jsx("option",{value:"medium",children:"Medium"}),t.jsx("option",{value:"high",children:"High"})]})]})]})]}),t.jsxs("div",{className:"flex gap-3 mt-6",children:[t.jsx("button",{onClick:()=>{(async(e,t)=>{const r=l.find((t=>t.id===e));if(!r)return;const a={...r,...t,updatedAt:new Date};await F(a),$(null)})(E.id,E)},className:"btn-primary flex-1 py-3",children:"Save Changes"}),t.jsx("button",{onClick:()=>$(null),className:"btn-secondary flex-1 py-3",children:"Cancel"})]})]})})]})}):null}function Bt({isOpen:r,onClose:a}){const{state:s,setTheme:o}=Xe(),[i,c]=e.useState(!1),[d,m]=e.useState(s.currentTheme),p=e.useRef(null),h=e.useMemo((()=>Object.values(Ve)),[]),g=e.useMemo((()=>({light:"☀️ Classic & Clean",dark:"🌙 Easy on the Eyes",purple:"🎨 Creative & Artistic",blue:"💼 Professional & Calm",green:"🌿 Natural & Fresh",orange:"🔥 Warm & Energetic",rose:"🌹 Elegant & Romantic",emerald:"💎 Rich & Vibrant",teal:"🌊 Cool & Modern",amber:"☀️ Bright & Cheerful",violet:"🔮 Mysterious & Bold",slate:"🏔️ Minimal & Sophisticated"})),[]),y=e.useCallback((async e=>{if(!i&&e!==s.currentTheme){c(!0),m(e),await new Promise((e=>setTimeout(e,100)));try{o(e)}finally{setTimeout((()=>c(!1)),300)}}}),[o,s.currentTheme,i]),x=e.useCallback((()=>{i||a()}),[a,i]);return e.useEffect((()=>{m(s.currentTheme)}),[s.currentTheme]),r?t.jsx(vt,{isOpen:r,onClose:x,title:"Theme Settings",subtitle:`Customize your workspace appearance • ${h.length} themes available`,icon:t.jsx(u,{className:"w-5 h-5"}),defaultWidth:"min(95vw, 1000px)",defaultHeight:"min(90vh, 700px)",maxWidth:"98vw",maxHeight:"98vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"theme-settings",zIndex:9100,children:t.jsxs("div",{className:"h-full flex flex-col transform-gpu",children:[t.jsxs("div",{className:"flex items-center justify-between p-3 sm:p-4 border-b border-primary/20 bg-secondary/30 backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shadow-sm transition-all duration-300",style:{background:`linear-gradient(135deg, ${s.theme.colors.primary[600]}, ${s.theme.colors.primary[700]})`},children:t.jsx(u,{className:"w-4 h-4 text-white"})}),t.jsx("div",{className:"text-xs sm:text-sm text-secondary",children:"Choose your preferred theme"})]}),t.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[t.jsxs("div",{className:"hidden sm:flex items-center space-x-2 px-3 py-2 rounded-lg border transition-all duration-200",style:{backgroundColor:`${s.theme.colors.background.tertiary}50`,borderColor:`${s.theme.colors.border.primary}40`},children:[t.jsx(xe,{className:"w-4 h-4 opacity-60",style:{color:s.theme.colors.text.secondary}}),t.jsx(fe,{className:"w-4 h-4 opacity-60",style:{color:s.theme.colors.text.secondary}}),t.jsx(be,{className:"w-4 h-4 opacity-60",style:{color:s.theme.colors.text.secondary}})]}),t.jsx("button",{onClick:x,disabled:i,className:"p-2 sm:p-3 rounded-xl transition-all duration-200 border border-transparent hover:shadow-lg group disabled:opacity-50",style:{color:s.theme.colors.text.secondary},onMouseEnter:e=>{i||(e.currentTarget.style.backgroundColor=`${s.theme.colors.background.tertiary}80`,e.currentTarget.style.borderColor=`${s.theme.colors.border.primary}60`,e.currentTarget.style.color=s.theme.colors.text.primary)},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="transparent",e.currentTarget.style.borderColor="transparent",e.currentTarget.style.color=s.theme.colors.text.secondary},children:t.jsx(n,{className:"w-5 h-5 transition-transform duration-200"})})]})]}),t.jsxs("div",{className:"p-4 sm:p-6 overflow-y-auto flex-1 scrollable",style:{backgroundColor:`${s.theme.colors.background.tertiary}20`,color:s.theme.colors.text.primary},children:[t.jsx("div",{className:"mb-4 sm:mb-6 p-3 sm:p-4 rounded-xl border backdrop-blur-sm transition-all duration-300",style:{background:`linear-gradient(to right, ${s.theme.colors.primary[500]}20, ${s.theme.colors.primary[600]}20)`,borderColor:`${s.theme.colors.border.primary}60`},children:t.jsxs("div",{className:"flex items-center space-x-3 sm:space-x-4",children:[t.jsx("div",{className:"w-8 h-8 rounded-full border-2 shadow-lg transition-all duration-500",style:{backgroundColor:s.theme.colors.primary[600],borderColor:`${s.theme.colors.primary[300]}60`,animation:i?"pulse 1s ease-in-out infinite":"none"}}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("p",{className:"text-base sm:text-lg font-semibold transition-colors duration-200",style:{color:s.theme.colors.text.primary},children:["Current Theme: ",s.theme.name]}),t.jsx("p",{className:"text-xs sm:text-sm transition-colors duration-200",style:{color:s.theme.colors.text.secondary},children:i?"Applying theme changes...":"Theme changes are saved automatically and persist across sessions"})]}),t.jsx(l,{className:"w-5 h-5 sm:w-6 sm:h-6 transition-all duration-300",style:{color:s.theme.colors.text.primary,animation:i?"spin 1s linear infinite":"none"}})]})}),t.jsx("div",{ref:p,className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 sm:gap-6",children:h.map((e=>{var r;const a=d===e.id,o=s.currentTheme===e.id;return t.jsxs("div",{className:`relative cursor-pointer rounded-xl border-2 transition-all duration-300 overflow-hidden group transform-gpu ${a?"border-primary-400 ring-2 ring-primary-200/50 shadow-xl shadow-primary-500/20 scale-105":"border-primary/30 hover:border-primary/60 hover:shadow-lg hover:scale-102"} ${i&&!a?"opacity-60 pointer-events-none":""}`,style:{willChange:"transform, box-shadow",transform:"translateZ(0) "+(a?"scale(1.02)":"scale(1)")},onClick:()=>y(e.id),children:[t.jsxs("div",{className:"h-32 p-5 flex items-center justify-between relative overflow-hidden",style:{backgroundColor:e.colors.background.secondary,backgroundImage:`linear-gradient(135deg, ${e.colors.background.secondary}, ${e.colors.background.tertiary||e.colors.background.primary})`},children:[t.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none",style:{backgroundImage:`radial-gradient(circle at 30% 70%, ${e.colors.primary[500]} 0%, transparent 50%)`}}),t.jsxs("div",{className:"flex items-center space-x-4 relative z-10",children:[t.jsx("div",{className:"w-12 h-12 rounded-xl shadow-lg border border-white/20 transition-transform duration-300",style:{background:`linear-gradient(135deg, ${e.colors.primary[600]}, ${e.colors.primary[500]})`,transform:a?"scale(1.1)":"scale(1)"}}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"w-20 h-3 rounded-full transition-all duration-200",style:{backgroundColor:e.colors.text.primary}}),t.jsx("div",{className:"w-16 h-2 rounded-full transition-all duration-200",style:{backgroundColor:e.colors.text.secondary}}),t.jsx("div",{className:"w-12 h-2 rounded-full opacity-60 transition-all duration-200",style:{backgroundColor:e.colors.text.secondary}})]})]}),t.jsx("div",{className:"flex flex-col space-y-1 relative z-10",children:[e.colors.primary[500],e.colors.primary[400],e.colors.primary[300]].map(((e,r)=>t.jsx("div",{className:"w-4 h-8 rounded-lg shadow-md transition-transform duration-200",style:{backgroundColor:e,transform:a?`scale(1.1) translateX(${2*r}px)`:"scale(1)"}},r)))}),a&&t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary-500/20 to-primary-600/30 backdrop-blur-sm flex items-center justify-center",children:t.jsx("div",{className:"w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-2xl transition-all duration-300",children:t.jsx(ie,{className:"w-8 h-8 text-primary-600"})})}),i&&a&&t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary-500/10 to-primary-600/20 backdrop-blur-sm flex items-center justify-center",children:t.jsx("div",{className:"w-12 h-12 border-4 border-white border-t-primary-600 rounded-full animate-spin"})})]}),t.jsxs("div",{className:"p-5 border-t transition-all duration-200",style:{backgroundColor:e.colors.background.primary,borderColor:(null==(r=e.colors.border)?void 0:r.primary)||e.colors.primary[200]},children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("h3",{className:"font-bold text-lg transition-colors duration-200",style:{color:e.colors.text.primary},children:e.name}),t.jsx("p",{className:"text-sm mt-1 transition-colors duration-200",style:{color:e.colors.text.secondary},children:g[e.id]})]}),o&&t.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ml-3 shadow-lg transition-all duration-300",style:{backgroundColor:e.colors.primary[600]},children:t.jsx(l,{className:"w-4 h-4 text-white"})})]}),t.jsxs("div",{className:"mt-3 flex flex-wrap gap-1",children:["dark"===e.id&&t.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-800 text-gray-200",children:"Dark Mode"}),"light"===e.id&&t.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800",children:"Light Mode"}),!["light","dark"].includes(e.id)&&t.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:e.colors.primary[100],color:e.colors.primary[800]},children:"Colorful"}),t.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-800",children:"High Contrast"})]})]}),t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/0 to-white/5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none rounded-xl"})]},e.id)}))}),t.jsx("div",{className:"mt-8 p-5 bg-gradient-to-r from-tertiary/50 to-secondary/50 rounded-xl border border-primary/20 backdrop-blur-sm",children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:t.jsx(l,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-semibold text-primary mb-2",children:"Pro Tips for Theme Selection"}),t.jsxs("ul",{className:"text-sm text-secondary space-y-1",children:[t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Dark themes"})," reduce eye strain during long work sessions"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Light themes"})," provide better contrast for detailed work"]}),t.jsxs("li",{children:["• ",t.jsx("strong",{children:"Colored themes"})," can match your project's mood and style"]}),t.jsx("li",{children:"• All themes are designed for optimal readability and accessibility"})]})]})]})})]}),t.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-primary/20 bg-secondary/30 backdrop-blur-sm rounded-b-2xl",children:[t.jsxs("div",{className:"flex items-center space-x-2 text-sm text-secondary",children:[t.jsx(u,{className:"w-4 h-4"}),t.jsx("span",{children:i?"Applying theme...":"Themes apply instantly across all components"})]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:()=>y("light"),disabled:i||"light"===s.currentTheme,className:"px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all duration-200 text-primary border border-white/20 hover:border-white/40 disabled:opacity-50 disabled:cursor-not-allowed",children:"Reset to Light"}),t.jsx("button",{onClick:x,disabled:i,className:"btn-primary px-6 py-2 shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:"Done"})]})]})]})}):null}function Ht({isOpen:r,onClose:a,onOpenThemeSettings:s}){const{state:o}=Xe(),n=(i=o.theme,Ge(i));var i;const[l,c]=e.useState("general"),[d,m]=e.useState({openaiApiKey:"",autoSave:!0,notifications:!0,videoQuality:"high",exportFormat:"json",aiModel:"gpt-o4-mini",imageModel:"dall-e-3",maxTokens:4096,temperature:.7,language:"en",performance:{prefetchResources:!0,reduceAnimations:!1}}),[p,h]=e.useState("idle"),[y,x]=e.useState(!1);e.useEffect((()=>{f()}),[]);const f=async()=>{try{const e=await Ue.getSettings(),t=ot.getApiKey();m((r=>{var a;return{...r,openaiApiKey:t||"",...e,autoSave:null==(a=e.autoSave)||a}}))}catch(e){console.error("Error loading settings:",e)}},b=()=>{const e={settings:{...d,openaiApiKey:""},exportedAt:new Date,version:"1.0"},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r,a.download="storyboard-settings-export.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},N=e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];if(!r)return;const a=new FileReader;a.onload=e=>{var t;try{const r=JSON.parse(null==(t=e.target)?void 0:t.result);r.settings&&(m((e=>({...e,...r.settings,openaiApiKey:e.openaiApiKey}))),h("saved"),setTimeout((()=>h("idle")),2e3))}catch(r){console.error("Error importing settings:",r),h("error"),setTimeout((()=>h("idle")),3e3)}},a.readAsText(r)},C=()=>{confirm("Reset all settings to defaults? This cannot be undone.")&&m({openaiApiKey:d.openaiApiKey,autoSave:!0,notifications:!0,videoQuality:"high",exportFormat:"json",aiModel:"gpt-o4-mini",imageModel:"dall-e-3",maxTokens:4096,temperature:.7,language:"en",performance:{prefetchResources:!0,reduceAnimations:!1}})};if(!r)return null;const S=[{id:"general",label:"General",icon:fe,gradient:"from-blue-500 to-cyan-500"},{id:"ai",label:"AI Settings",icon:k,gradient:"from-purple-500 to-pink-500"},{id:"themes",label:"Themes",icon:u,gradient:"from-pink-500 to-rose-500"},{id:"advanced",label:"Advanced",icon:we,gradient:"from-orange-500 to-red-500"}];return t.jsxs(vt,{isOpen:r,onClose:a,title:"Settings & Preferences",subtitle:"Configure your workspace • AI models • Export settings",icon:t.jsx(g,{className:"w-5 h-5"}),defaultWidth:"min(95vw, 800px)",defaultHeight:"min(85vh, 600px)",minWidth:280,minHeight:320,maxWidth:"98vw",maxHeight:"92vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"settings-menu",zIndex:9100,children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:`${o.theme.colors.border.primary}80`,backgroundColor:`${o.theme.colors.background.secondary}80`},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center shadow-sm",style:{background:`linear-gradient(135deg, ${o.theme.colors.primary[600]}, ${o.theme.colors.primary[700]})`},children:t.jsx(g,{className:"w-4 h-4 text-white"})}),t.jsx("div",{className:"text-sm",style:{color:o.theme.colors.text.secondary},children:"Customize your Storyboard AI experience"})]}),t.jsxs("div",{className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300",style:{backgroundColor:"saving"===p?n.status.info.light:"saved"===p?n.status.success.light:"error"===p?n.status.error.light:`${o.theme.colors.background.tertiary}50`,color:"saving"===p?n.status.info.background:"saved"===p?n.status.success.background:"error"===p?n.status.error.background:o.theme.colors.text.secondary},children:["saving"===p&&t.jsx(ve,{className:"w-4 h-4 animate-spin"}),"saved"===p&&t.jsx(oe,{className:"w-4 h-4"}),"error"===p&&t.jsx(se,{className:"w-4 h-4"}),"idle"===p&&t.jsx(v,{className:"w-4 h-4"}),t.jsxs("span",{className:"text-xs font-medium",children:["saving"===p&&"Saving...","saved"===p&&"Saved","error"===p&&"Error","idle"===p&&"Ready"]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row h-full max-h-[calc(100%-100px)]",children:[t.jsxs("div",{className:"w-full sm:w-40 md:w-48 border-b sm:border-b-0 sm:border-r p-2 sm:p-3 md:p-4 shrink-0 overflow-hidden",style:{borderColor:`${o.theme.colors.border.primary}60`,backgroundColor:`${o.theme.colors.background.secondary}90`},children:[t.jsx("nav",{className:"flex sm:flex-col space-x-1 sm:space-x-0 sm:space-y-1.5 overflow-x-auto sm:overflow-x-visible w-full flex-nowrap",style:{scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:S.map((({id:e,label:r,icon:a,gradient:s})=>t.jsxs("button",{onClick:()=>c(e),className:"flex-shrink-0 flex items-center justify-center sm:justify-start space-x-1.5 sm:space-x-2 p-2 sm:p-2 md:p-2.5 rounded-md transition-all duration-200 min-w-[70px] sm:min-w-0 sm:w-full text-xs sm:text-sm md:text-base",style:{backgroundColor:l===e?o.theme.colors.primary[500]:"transparent",color:l===e?"#ffffff":o.theme.colors.text.secondary,boxShadow:l===e?n.shadows.md:"none"},onMouseEnter:t=>{l!==e&&(t.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}80`,t.currentTarget.style.color=o.theme.colors.text.primary,t.currentTarget.style.boxShadow=n.shadows.sm)},onMouseLeave:t=>{l!==e&&(t.currentTarget.style.backgroundColor="transparent",t.currentTarget.style.color=o.theme.colors.text.secondary)},children:[t.jsx(a,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),t.jsx("span",{className:"font-medium whitespace-nowrap",children:r})]},e)))}),t.jsxs("div",{className:"mt-4 sm:mt-6 space-y-2",children:[t.jsx("h3",{className:"text-xs sm:text-sm font-semibold uppercase tracking-wider",style:{color:o.theme.colors.text.secondary},children:"Quick Actions"}),t.jsxs("button",{onClick:b,className:"w-full flex items-center space-x-2 p-2 sm:p-2.5 rounded-md transition-all duration-200 group",style:{backgroundColor:`${o.theme.colors.background.tertiary}60`,color:o.theme.colors.text.secondary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}80`,e.currentTarget.style.color=o.theme.colors.text.primary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}60`,e.currentTarget.style.color=o.theme.colors.text.secondary},children:[t.jsx(j,{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform"}),t.jsx("span",{className:"text-xs sm:text-sm",children:"Export Settings"})]}),t.jsxs("label",{className:"w-full flex items-center space-x-2 p-2 sm:p-2.5 rounded-md transition-all duration-200 cursor-pointer group",style:{backgroundColor:`${o.theme.colors.background.tertiary}60`,color:o.theme.colors.text.secondary},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}80`,e.currentTarget.style.color=o.theme.colors.text.primary},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}60`,e.currentTarget.style.color=o.theme.colors.text.secondary},children:[t.jsx(w,{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform"}),t.jsx("span",{className:"text-xs sm:text-sm",children:"Import Settings"}),t.jsx("input",{type:"file",accept:".json",onChange:N,className:"hidden"})]}),t.jsxs("button",{onClick:C,className:"w-full flex items-center space-x-2 p-2 sm:p-2.5 rounded-md bg-red-500/20 hover:bg-red-500/30 transition-all duration-200 text-red-400 hover:text-red-300 group",children:[t.jsx(se,{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform"}),t.jsx("span",{className:"text-xs sm:text-sm",children:"Reset to Defaults"})]})]}),t.jsx("div",{className:"flex sm:hidden justify-center w-full py-2 mt-1 px-1",children:t.jsxs("div",{className:"flex items-center space-x-1.5",children:[t.jsx("div",{className:"h-1 w-16 rounded-full bg-primary-500/30"}),t.jsx("span",{className:"text-xs text-secondary/50",children:"scroll for more tabs"})]})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-2 sm:p-3 md:p-4 scrollable backdrop-blur-sm",style:{backgroundColor:`${o.theme.colors.background.tertiary}30`,color:o.theme.colors.text.primary},children:["general"===l&&t.jsx("div",{className:"space-y-6 animate-fade-in",children:t.jsxs("div",{children:[t.jsxs("h3",{className:"text-base sm:text-lg font-semibold mb-2 sm:mb-3 flex items-center space-x-1.5 sm:space-x-2",style:{color:o.theme.colors.text.primary},children:[t.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5"}),t.jsx("span",{children:"General Preferences"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[t.jsx("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium",style:{color:o.theme.colors.text.primary},children:"Auto Save"}),t.jsx("p",{className:"text-sm mt-1",style:{color:o.theme.colors.text.secondary},children:"Automatically save changes as you work"})]}),t.jsx("button",{onClick:()=>m((e=>({...e,autoSave:!e.autoSave}))),className:"relative w-12 h-6 rounded-full transition-all duration-300 "+(d.autoSave?"bg-green-500":"bg-secondary-400"),children:t.jsx("div",{className:"absolute top-1 w-4 h-4 bg-white rounded-full shadow-lg transition-transform duration-300 "+(d.autoSave?"translate-x-7":"translate-x-1")})})]})}),t.jsx("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-primary",children:"Notifications"}),t.jsx("p",{className:"text-sm text-secondary/80 mt-1",children:"Show system notifications and alerts"})]}),t.jsx("button",{onClick:()=>m((e=>({...e,notifications:!e.notifications}))),className:"relative w-12 h-6 rounded-full transition-all duration-300 "+(d.notifications?"bg-blue-500":"bg-secondary-400"),children:t.jsx("div",{className:"absolute top-1 w-4 h-4 bg-white rounded-full shadow-lg transition-transform duration-300 "+(d.notifications?"translate-x-7":"translate-x-1")})})]})}),t.jsx("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-primary mb-3 flex items-center space-x-2",children:[t.jsx(je,{className:"w-4 h-4"}),t.jsx("span",{children:"Language"})]}),t.jsxs("select",{value:d.language,onChange:e=>m((t=>({...t,language:e.target.value}))),className:"select-modern w-full bg-tertiary/50 border border-primary/30 focus:border-primary/60",children:[t.jsx("option",{value:"en",children:"English"}),t.jsx("option",{value:"es",children:"Español"}),t.jsx("option",{value:"fr",children:"Français"}),t.jsx("option",{value:"de",children:"Deutsch"}),t.jsx("option",{value:"ja",children:"日本語"})]})]})}),t.jsx("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-primary mb-3",children:"Default Export Format"}),t.jsx("div",{className:"grid grid-cols-3 gap-1 sm:gap-2",children:["json","pdf","video"].map((e=>t.jsx("button",{onClick:()=>m((t=>({...t,exportFormat:e}))),className:"p-2 rounded-lg text-sm font-medium transition-all duration-200",style:{backgroundColor:d.exportFormat===e?o.theme.colors.primary[500]:`${o.theme.colors.background.tertiary}80`,color:d.exportFormat===e?"#ffffff":o.theme.colors.text.secondary,boxShadow:d.exportFormat===e?"0 4px 12px rgba(0,0,0,0.15)":"none"},onMouseEnter:t=>{d.exportFormat!==e&&(t.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}90`,t.currentTarget.style.color=o.theme.colors.text.primary)},onMouseLeave:t=>{d.exportFormat!==e&&(t.currentTarget.style.backgroundColor=`${o.theme.colors.background.tertiary}80`,t.currentTarget.style.color=o.theme.colors.text.secondary)},children:e.toUpperCase()},e)))})]})})]})]})}),"ai"===l&&t.jsx("div",{className:"space-y-6 animate-fade-in",children:t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-primary mb-4 flex items-center space-x-2",children:[t.jsx(k,{className:"w-5 h-5"}),t.jsx("span",{children:"AI Configuration"})]}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h4",{className:"font-medium text-primary flex items-center space-x-2",children:[t.jsx(we,{className:"w-4 h-4"}),t.jsx("span",{children:"OpenAI API Key"})]}),t.jsxs("button",{onClick:()=>x(!y),className:"flex items-center space-x-1 text-secondary hover:text-primary transition-colors",children:[t.jsx(B,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:y?"Hide":"Show"})]})]}),t.jsx("input",{type:y?"text":"password",value:d.openaiApiKey,onChange:e=>m((t=>({...t,openaiApiKey:e.target.value}))),placeholder:"sk-...",className:"input-modern w-full bg-tertiary/50 border border-primary/30 focus:border-primary/60"}),t.jsxs("p",{className:"text-xs text-secondary/80 mt-2",children:["Your API key is stored locally and never shared. Get one from"," ",t.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-secondary underline",children:"OpenAI Platform"})]})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsx("h4",{className:"font-medium text-primary mb-3",children:"Text Generation Model"}),t.jsx("select",{value:d.aiModel,onChange:e=>m((t=>({...t,aiModel:e.target.value}))),className:"select-modern w-full bg-tertiary/50 border border-primary/30 focus:border-primary/60",children:t.jsxs("optgroup",{label:"Standard Models",children:[t.jsx("option",{value:"gpt-o4-mini",children:"GPT-o4 Mini (Fast & Economic)"}),t.jsx("option",{value:"gpt-4o",children:"GPT-4o (Balanced)"}),t.jsx("option",{value:"gpt-4",children:"GPT-4 (Most Capable)"})]})})]}),t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsx("h4",{className:"font-medium text-primary mb-3",children:"Image Generation Model"}),t.jsxs("select",{value:d.imageModel,onChange:e=>m((t=>({...t,imageModel:e.target.value}))),className:"select-modern w-full bg-tertiary/50 border border-primary/30 focus:border-primary/60",children:[t.jsx("option",{value:"dall-e-3",children:"DALL-E 3 (Best Quality)"}),t.jsx("option",{value:"dall-e-2",children:"DALL-E 2 (Faster)"})]})]})]})]})]})}),"themes"===l&&t.jsx("div",{className:"space-y-6 animate-fade-in",children:t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-primary mb-4 flex items-center space-x-2",children:[t.jsx(u,{className:"w-5 h-5"}),t.jsx("span",{children:"Theme & Appearance"})]}),t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-5 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h4",{className:"font-medium text-primary",children:"Theme Settings"}),t.jsx("p",{className:"text-sm text-secondary/80 mt-1",children:"Customize your workspace appearance"})]}),t.jsx("button",{onClick:s,className:"btn-primary px-4 py-2 text-sm shadow-lg hover:shadow-xl transition-all duration-300",children:"Open Theme Selector"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:t.jsxs("div",{className:"flex items-center space-x-2 p-3 rounded-lg bg-tertiary/30",children:[t.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white/30",style:{backgroundColor:o.theme.colors.primary[500]}}),t.jsxs("span",{className:"text-sm font-medium text-primary",children:["Current: ",o.theme.name]})]})})]})]})}),"advanced"===l&&t.jsx("div",{className:"space-y-6 animate-fade-in",children:t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-primary mb-4 flex items-center space-x-2",children:[t.jsx(we,{className:"w-5 h-5"}),t.jsx("span",{children:"Advanced Settings"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3 md:gap-4",children:[t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsx("h4",{className:"font-medium text-primary mb-3",children:"Import/Export"}),t.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 space-x-0 sm:space-x-2",children:[t.jsxs("button",{onClick:b,className:"btn-secondary px-4 py-2 text-sm flex items-center justify-center space-x-2",children:[t.jsx(j,{className:"w-4 h-4"}),t.jsx("span",{children:"Export"})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"file",accept:".json",onChange:N,className:"absolute inset-0 opacity-0 cursor-pointer"}),t.jsxs("button",{className:"btn-secondary w-full px-4 py-2 text-sm flex items-center justify-center space-x-2",children:[t.jsx(w,{className:"w-4 h-4"}),t.jsx("span",{children:"Import"})]})]})]})]}),t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsx("h4",{className:"font-medium text-primary mb-3",children:"Reset"}),t.jsxs("button",{onClick:C,className:"btn-danger px-4 py-2 text-sm w-full flex items-center justify-center space-x-2",children:[t.jsx(me,{className:"w-4 h-4"}),t.jsx("span",{children:"Reset to Defaults"})]})]}),t.jsxs("div",{className:"bg-secondary/40 backdrop-blur-sm rounded-lg sm:rounded-xl p-3 sm:p-4 border border-primary/20 hover:border-primary/40 transition-all duration-300",children:[t.jsx("h4",{className:"font-medium text-primary mb-3",children:"Reset Database"}),t.jsxs("button",{onClick:async()=>{if(confirm("WARNING: This will reset your database and clear all saved projects.\n\nThis action is recommended if you have issues with video uploads or storage quota errors.\n\nDo you want to proceed?"))try{await async function(){return Ue.resetDatabase()}(),alert("Database has been reset successfully. The page will now reload."),window.location.reload()}catch(e){console.error("Error resetting database:",e),alert("Failed to reset database. Please try closing all tabs and trying again.")}},className:"btn-danger px-4 py-2 text-sm w-full flex items-center justify-center space-x-2",children:[t.jsx(Ne,{className:"w-4 h-4"}),t.jsx("span",{children:"Reset Database"})]})]})]})]})})]})]}),t.jsxs("div",{className:"flex items-center justify-between p-4 border-t",style:{borderColor:`${o.theme.colors.border.primary}80`,backgroundColor:`${o.theme.colors.background.secondary}80`},children:[t.jsxs("div",{className:"text-sm",style:{color:o.theme.colors.text.secondary},children:["idle"===p&&"Settings ready","saving"===p&&"Saving changes...","saved"===p&&t.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[t.jsx(oe,{className:"w-4 h-4"}),t.jsx("span",{children:"Settings saved!"})]}),"error"===p&&t.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[t.jsx(se,{className:"w-4 h-4"}),t.jsx("span",{children:"Error saving settings"})]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg text-sm",style:{color:o.theme.colors.text.secondary},children:"Cancel"}),t.jsx("button",{onClick:async()=>{h("saving");try{d.openaiApiKey.trim()&&ot.setApiKey(d.openaiApiKey.trim()),await Ue.saveSettings({autoSave:d.autoSave,notifications:d.notifications,videoQuality:d.videoQuality,exportFormat:d.exportFormat,aiModel:d.aiModel,imageModel:d.imageModel,maxTokens:d.maxTokens,temperature:d.temperature,language:d.language,lastUsed:new Date}),h("saved"),setTimeout((()=>h("idle")),2e3)}catch(e){console.error("Error saving settings:",e),h("error"),setTimeout((()=>h("idle")),3e3)}},disabled:"saving"===p,className:"px-5 py-2 rounded-lg text-sm font-medium shadow-lg hover:shadow-xl transition-all duration-300",style:{backgroundColor:o.theme.colors.primary[500],color:"#ffffff"},onMouseEnter:e=>{"saving"!==p&&(e.currentTarget.style.backgroundColor=o.theme.colors.primary[600])},onMouseLeave:e=>{"saving"!==p&&(e.currentTarget.style.backgroundColor=o.theme.colors.primary[500])},children:"saving"===p?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:"Saving..."})]}):"Save Changes"})]})]})]})}const qt=({isOpen:r,onClose:a})=>{const{state:s}=Xe(),[o,n]=e.useState(new Set(["getting-started"])),c=[{id:"getting-started",title:"Getting Started",icon:F,content:[{title:"Quick Start",tips:['Click "New Project" in the sidebar to create your first storyboard',"Use project templates for common story types (film, commercial, etc.)","Switch between Grid and Timeline views using the header buttons","Double-click any panel to edit its content"]}]},{id:"ai-assistant",title:"AI Assistant",icon:l,content:[{title:"Story Generation",tips:["Describe your story concept and let AI generate panel scripts","Use specific genres and moods for better results","Ask for revisions by describing what you want changed","Generate multiple variations to compare options"]},{title:"Image Generation",tips:["Be descriptive about visual style, lighting, and composition","Specify camera angles (close-up, wide shot, bird's eye, etc.)","Include artistic styles (photorealistic, cartoon, sketch, etc.)","Mention specific details like time of day, weather, or mood"]},{title:"AI Settings",tips:["Adjust image dimensions for your project needs","Choose between different AI models for varied results","Set consistent style preferences for your entire project","Use custom prompts to maintain visual consistency"]}]},{id:"panel-editing",title:"Panel Editing",icon:ke,content:[{title:"Panel Content",tips:["Write clear, concise scene descriptions","Include dialogue, sound effects, and camera notes","Use the visual notes section for specific shot details","Add timing information for animated sequences"]},{title:"Organization",tips:["Use meaningful panel titles for easy navigation","Organize panels logically in sequence","Use the timeline view to see story flow","Drag and drop panels to reorder them"]}]},{id:"video-prompts",title:"Video Generation",icon:ce,content:[{title:"Creating Video Prompts",tips:["Generate detailed video prompts from your storyboard","Include camera movements, transitions, and effects","Specify duration and pacing for each shot","Export prompts for use with video AI tools like Runway or Pika"]}]},{id:"project-management",title:"Project Management",icon:Ce,content:[{title:"Saving & Loading",tips:["Projects auto-save as you work","Export projects as JSON files for backup","Import existing projects to continue work","Use descriptive project names and descriptions"]}]},{id:"customization",title:"Customization",icon:g,content:[{title:"Themes & Display",tips:["Choose from multiple color themes in settings","Themes apply consistently across all interfaces","Dark mode reduces eye strain during long sessions","Colored themes can match your project's mood"]},{title:"Views & Layout",tips:["Grid view: Best for detailed panel editing","Timeline view: Perfect for story flow and sequencing","Resize panels by dragging corners","Use full-screen mode for focused work"]}]}];return r?t.jsx(vt,{isOpen:r,onClose:a,title:"Storyboard AI User Guide",subtitle:"Learn how to create amazing storyboards",icon:t.jsx(I,{className:"w-5 h-5"}),defaultWidth:"min(92vw, 900px)",defaultHeight:"min(85vh, 700px)",maxWidth:"98vw",maxHeight:"95vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"user-guide",zIndex:9100,children:t.jsx("div",{className:"h-full overflow-y-auto",children:t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[t.jsx(I,{className:"h-6 w-6",style:{color:s.theme.colors.primary[600]}}),t.jsx("h2",{className:"text-xl font-semibold",style:{color:s.theme.colors.text.primary},children:"Welcome to Storyboard AI"})]}),t.jsxs("div",{className:"space-y-4 p-6",children:[c.map((e=>{const r=e.icon,a=o.has(e.id);return t.jsxs("div",{className:"border rounded-lg overflow-hidden",style:{backgroundColor:s.theme.colors.background.secondary,borderColor:s.theme.colors.border.primary},children:[t.jsxs("button",{onClick:()=>(e=>{const t=new Set(o);t.has(e)?t.delete(e):t.add(e),n(t)})(e.id),className:"w-full flex items-center justify-between p-4 text-left transition-colors",style:{color:s.theme.colors.text.primary},onMouseOver:e=>{e.currentTarget.style.backgroundColor=s.theme.colors.background.tertiary},onMouseOut:e=>{e.currentTarget.style.backgroundColor="transparent"},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(r,{className:"h-5 w-5",style:{color:s.theme.colors.primary[600]}}),t.jsx("span",{className:"font-medium",children:e.title})]}),a?t.jsx(A,{className:"h-4 w-4"}):t.jsx(i,{className:"h-4 w-4"})]}),a&&t.jsx("div",{className:"px-4 pb-4",children:e.content.map(((e,r)=>t.jsxs("div",{className:"mb-4 last:mb-0",children:[t.jsx("h4",{className:"font-medium mb-2",style:{color:s.theme.colors.text.primary},children:e.title}),t.jsx("ul",{className:"space-y-2",children:e.tips.map(((e,r)=>t.jsxs("li",{className:"flex items-start space-x-2 text-sm",style:{color:s.theme.colors.text.secondary},children:[t.jsx("span",{className:"block w-1 h-1 rounded-full mt-2 flex-shrink-0",style:{backgroundColor:s.theme.colors.primary[500]}}),t.jsx("span",{children:e})]},r)))})]},r)))})]},e.id)})),t.jsxs("div",{className:"border rounded-lg p-4 mt-6",style:{backgroundColor:s.theme.colors.primary[50],borderColor:s.theme.colors.primary[200]},children:[t.jsxs("h3",{className:"font-semibold mb-3 flex items-center space-x-2",style:{color:s.theme.colors.primary[800]},children:[t.jsx(F,{className:"h-5 w-5"}),t.jsx("span",{children:"Pro Tips"})]}),t.jsxs("ul",{className:"space-y-2 text-sm",children:[t.jsx("li",{style:{color:s.theme.colors.primary[700]},children:"• Use keyboard shortcuts: Ctrl/Cmd + N for new panel, Ctrl/Cmd + S to save"}),t.jsx("li",{style:{color:s.theme.colors.primary[700]},children:"• Right-click panels for quick actions like duplicate, delete, or move"}),t.jsx("li",{style:{color:s.theme.colors.primary[700]},children:"• Keep AI prompts specific but not overly detailed for best results"}),t.jsx("li",{style:{color:s.theme.colors.primary[700]},children:"• Use the timeline view to spot pacing issues in your story"})]})]})]})]})})}):null},Gt=[{id:"storyboard",label:"Storyboard",icon:t.jsx(o,{className:"w-6 h-6"}),description:"Create and edit panels"},{id:"ai-assistant",label:"AI Assistant",icon:t.jsx(c,{className:"w-6 h-6"}),description:"Chat with AI helper"},{id:"save-project",label:"Save Project",icon:t.jsx(v,{className:"w-6 h-6"}),description:"Save current project"},{id:"export-project",label:"Export",icon:t.jsx(j,{className:"w-6 h-6"}),description:"Export to various formats"},{id:"import-project",label:"Import",icon:t.jsx(w,{className:"w-6 h-6"}),description:"Import project"},{id:"video-prompts",label:"Video Prompts",icon:t.jsx(d,{className:"w-6 h-6"}),description:"Generate video prompts"},{id:"projects",label:"Projects",icon:t.jsx(Ce,{className:"w-6 h-6"}),description:"Manage projects"},{id:"templates",label:"Templates",icon:t.jsx(p,{className:"w-6 h-6"}),description:"Browse templates"},{id:"theme-settings",label:"Theme",icon:t.jsx(u,{className:"w-6 h-6"}),description:"Customize theme"},{id:"settings",label:"Settings",icon:t.jsx(g,{className:"w-6 h-6"}),description:"App preferences"}];function Vt({isOpen:r,onClose:a,onNavigate:s,currentSection:i}){const[l,c]=e.useState(!1),{state:d}=Xe(),m=Ge(d.theme);e.useEffect((()=>(r?(document.body.style.overflow="hidden",c(!1)):document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"})),[r]);const p=()=>{c(!0),setTimeout((()=>{a(),c(!1)}),300)};return r||l?t.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",children:[t.jsx("div",{className:"absolute inset-0 transition-opacity duration-300 "+(r&&!l?"bg-opacity-60":"bg-opacity-0"),style:{backgroundColor:m.overlay.backdrop},onClick:p}),t.jsxs("div",{className:"mobile-drawer absolute left-0 top-0 h-full w-80 max-w-[85vw] shadow-2xl transform transition-transform duration-300 ease-out flex flex-col "+(r&&!l?"translate-x-0":"-translate-x-full"),style:{backgroundColor:d.theme.colors.background.primary,borderRight:`1px solid ${d.theme.colors.border.primary}`,boxShadow:m.shadows.xl},children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b text-white flex-shrink-0",style:{background:`linear-gradient(135deg, ${d.theme.colors.primary[600]}, ${d.theme.colors.primary[700]})`,borderColor:d.theme.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:"dark"===d.theme.id?"rgba(255, 255, 255, 0.2)":d.theme.colors.primary[400]},children:t.jsx(o,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-bold text-lg",children:"Storyboard AI"}),t.jsx("p",{className:"text-white/80 text-sm",children:"Navigation Menu"})]})]}),t.jsx("button",{onClick:p,className:"w-10 h-10 rounded-lg flex items-center justify-center transition-colors",style:{backgroundColor:"dark"===d.theme.id?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.25)",color:"#ffffff"},children:t.jsx(n,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto scrollable overscroll-contain",children:[t.jsx("div",{className:"p-4 space-y-2",children:Gt.map(((e,r)=>t.jsxs("button",{onClick:()=>{return t=e.id,s(t),void p();var t},className:"w-full flex items-center space-x-4 p-4 rounded-xl transition-all duration-200 transform hover:scale-105 animate-menu-item-entrance transform-gpu border-2 "+(i===e.id?"shadow-lg":"border-transparent hover:shadow-md"),style:{animationDelay:50*r+"ms",backgroundColor:i===e.id?`${d.theme.colors.primary[100]}`:d.theme.colors.background.secondary,borderColor:i===e.id?d.theme.colors.primary[300]:"transparent",boxShadow:i===e.id?m.shadows.md:"none"},children:[t.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center shadow-sm",style:{background:i===e.id?`linear-gradient(135deg, ${d.theme.colors.primary[500]}, ${d.theme.colors.primary[600]})`:d.theme.colors.background.primary,color:i===e.id?"#ffffff":d.theme.colors.text.secondary,boxShadow:m.shadows.sm},children:e.icon}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("h3",{className:"font-semibold",style:{color:i===e.id?d.theme.colors.primary[700]:d.theme.colors.text.primary},children:e.label}),t.jsx("p",{className:"text-sm",style:{color:d.theme.colors.text.tertiary},children:e.description})]}),i===e.id&&t.jsx("div",{className:"w-3 h-3 rounded-full animate-pulse",style:{backgroundColor:d.theme.colors.primary[500]}})]},e.id)))}),t.jsx("div",{className:"p-4 mt-4 mb-4 border-t flex-shrink-0",style:{borderColor:d.theme.colors.border.primary},children:t.jsxs("div",{className:"rounded-xl p-4",style:{backgroundColor:"dark"===d.theme.id?`${d.theme.colors.primary[900]}30`:d.theme.colors.primary[50],border:`1px solid ${"dark"===d.theme.id?d.theme.colors.primary[800]:d.theme.colors.primary[200]}`},children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[t.jsx(u,{className:"w-5 h-5",style:{color:d.theme.colors.primary[600]}}),t.jsx("span",{className:"font-medium",style:{color:"dark"===d.theme.id?d.theme.colors.primary[400]:d.theme.colors.primary[800]},children:"Quick Tip"})]}),t.jsx("p",{className:"text-sm",style:{color:"dark"===d.theme.id?d.theme.colors.primary[300]:d.theme.colors.primary[700]},children:"Swipe right or tap the menu button to access navigation anytime. Long press panels for quick actions!"})]})})]})]})]}):null}var Jt=Object.defineProperty,Kt=(e,t,r)=>((e,t,r)=>t in e?Jt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const Yt=class e{constructor(){Kt(this,"progressCallback")}static getInstance(){return e.instance||(e.instance=new e),e.instance}setProgressCallback(e){this.progressCallback=e}updateProgress(e,t,r,a,s){this.progressCallback&&this.progressCallback({stage:e,progress:t,total:r,currentItem:a,errors:s})}async exportProject(e,t){const r=Ue.getSettings(),a={...t,quality:t.quality||r.videoQuality||"high"};switch(a.format){case"json":return this.exportAsJSON(e,a);case"pdf":return this.exportAsPDF(e,a);case"images":return this.exportAsImageBundle(e,a);case"video-sequence":return this.exportAsVideoSequence(e,a);case"html":return this.exportAsHTML(e,a);default:throw new Error(`Unsupported export format: ${a.format}`)}}async exportAsJSON(e,t){this.updateProgress("Preparing JSON export",0,3);const r={...e,panels:await Promise.all(e.panels.map((async e=>{let r=e.imageUrl;if(e.imageUrl&&e.imageUrl.startsWith("stored:"))try{const t=e.imageUrl.replace("stored:",""),a=await Ue.getImageFromDB(t);a?(r=a,console.log(`📸 Restored image for export: ${t}`)):(console.warn(`⚠️ Could not restore image: ${t}`),r=void 0)}catch(a){console.warn("Error restoring image:",a),r=void 0}return{...e,imageUrl:!1!==t.includeImages?r:void 0,videoPrompt:e.videoPrompt||e.aiGeneratedPrompt,aiGeneratedPrompt:e.aiGeneratedPrompt||e.videoPrompt}})))};this.updateProgress("Creating export data",1,3);const a={project:r,metadata:{exportedAt:(new Date).toISOString(),exportedBy:"Storyboard AI",version:"1.0.0",options:{includeImages:!1!==t.includeImages,includeVideos:!1!==t.includeVideos,includePrompts:!1!==t.includePrompts,includeNotes:!1!==t.includeNotes}},settings:(()=>{const e=Ue.getSettings();return e.openaiApiKey&&(e.openaiApiKey="[REMOVED_FOR_SECURITY]"),e})()};this.updateProgress("Finalizing JSON export",2,3);const s=JSON.stringify(a,null,2);return this.updateProgress("JSON export complete",3,3),new Blob([s],{type:"application/json"})}async exportAsPDF(e,t){const r=await Pe((()=>import("./pdf-BTwRV4U-.js").then((e=>e.j))),__vite__mapDeps([0,1,2])).then((e=>e.default));this.updateProgress("Initializing PDF export",0,e.panels.length+3);const a=new r({orientation:t.orientation||"portrait",unit:"mm",format:t.pageSize||"a4"}),s=a.internal.pageSize.getWidth(),o=a.internal.pageSize.getHeight(),n=20,i=s-40;if(a.setFontSize(24),a.text(e.title,n,40),a.setFontSize(12),e.description&&a.text(e.description,n,55),a.text(`Created: ${e.createdAt.toLocaleDateString()}`,n,70),a.text(`Updated: ${e.updatedAt.toLocaleDateString()}`,n,80),a.text(`Panels: ${e.panels.length}`,n,90),e.directorNotes&&!1!==t.includeNotes){a.setFontSize(14),a.text("Director Notes:",n,110),a.setFontSize(10);const t=a.splitTextToSize(e.directorNotes,i);a.text(t,n,125)}this.updateProgress("Creating title page",1,e.panels.length+3);for(let d=0;d<e.panels.length;d++){const r=e.panels[d];this.updateProgress("Adding panels to PDF",d+2,e.panels.length+3,`Panel ${d+1}: ${r.title}`),a.addPage(),a.setFontSize(16),a.text(`Panel ${d+1}: ${r.title}`,n,35);let s=55;if(r.imageUrl&&!1!==t.includeImages)try{let e=r.imageUrl;if(r.imageUrl.startsWith("stored:")){const t=r.imageUrl.replace("stored:",""),a=await Ue.getImageFromDB(t);if(!a)throw new Error(`Could not restore image: ${t}`);e=a,console.log(`📸 Restored image for PDF: ${t}`)}const o=document.createElement("canvas"),l=o.getContext("2d"),c=new Image;await new Promise(((r,d)=>{c.onload=()=>{const e=.9*i,d="ultra"===t.quality?300:"high"===t.quality?200:150;let{width:m,height:p}=c;const h=Math.min(e/m,d/p);m*=h,p*=h,o.width=m,o.height=p,l&&(l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(c,0,0,m,p));const u="ultra"===t.quality?"image/png":"image/jpeg",g="ultra"===t.quality?1:"high"===t.quality?.95:.85,y=l.canvas.toDataURL(u,g),x="image/png"===u?"PNG":"JPEG";a.addImage(y,x,n,s,.8*m,.8*p),s+=.8*p+10,r(null)},c.onerror=d,c.src=e}))}catch(c){console.warn(`Failed to add image for panel ${d+1}:`,c)}a.setFontSize(12),a.text("Description:",n,s),s+=7,a.setFontSize(10);const o=a.splitTextToSize(r.description,i);if(a.text(o,n,s),s+=5*o.length+10,a.setFontSize(10),a.text(`Shot Type: ${r.shotType}`,n,s),a.text(`Camera Angle: ${r.cameraAngle}`,n+i/2,s),s+=7,a.text(`Duration: ${r.duration}s`,n,s),s+=10,r.notes&&!1!==t.includeNotes){a.setFontSize(11),a.text("Notes:",n,s),s+=7,a.setFontSize(9);const e=a.splitTextToSize(r.notes,i);a.text(e,n,s),s+=4*e.length+10}const l=r.videoPrompt||r.aiGeneratedPrompt;if(l&&!1!==t.includePrompts){a.setFontSize(11),a.text("Video Prompt:",n,s),s+=7,a.setFontSize(9);const e=a.splitTextToSize(l,i);a.text(e,n,s)}}this.updateProgress("Finalizing PDF",e.panels.length+2,e.panels.length+3);const l=a.getNumberOfPages();for(let d=1;d<=l;d++)a.setPage(d),a.setFontSize(8),a.text(`Page ${d} of ${l}`,s-n-20,o-10),a.text(`${e.title} - Storyboard AI`,n,o-10);return this.updateProgress("PDF export complete",e.panels.length+3,e.panels.length+3),new Blob([a.output("blob")],{type:"application/pdf"})}async exportAsImageBundle(e,t){const r=await Pe((()=>import("./jszip.min-2X8rbmn9.js").then((e=>e.j))),__vite__mapDeps([3,2])).then((e=>e.default));this.updateProgress("Creating image bundle",0,e.panels.length+2);const a=new r,s=a.folder("images"),o=[],n={title:e.title,description:e.description,createdAt:e.createdAt,updatedAt:e.updatedAt,totalPanels:e.panels.length,directorNotes:e.directorNotes};a.file("project-info.json",JSON.stringify(n,null,2));for(let d=0;d<e.panels.length;d++){const t=e.panels[d];if(this.updateProgress("Processing images",d+1,e.panels.length+2,`Panel ${d+1}: ${t.title}`),t.imageUrl)try{let e,r=t.imageUrl;if(t.imageUrl.startsWith("stored:")){const e=t.imageUrl.replace("stored:",""),a=await Ue.getImageFromDB(e);if(!a)throw new Error(`Could not restore image: ${e}`);r=a,console.log(`📸 Restored image for bundle: ${e}`)}if(r.startsWith("data:")){const t=await fetch(r);e=await t.blob()}else{const t=await fetch(r);e=await t.blob()}const o=`panel_${String(d+1).padStart(3,"0")}_${t.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.jpg`;null==s||s.file(o,e);const n={order:d+1,title:t.title,description:t.description,shotType:t.shotType,cameraAngle:t.cameraAngle,duration:t.duration,notes:t.notes,videoPrompt:t.videoPrompt||t.aiGeneratedPrompt,fileName:o};a.file(`panel_${String(d+1).padStart(3,"0")}_info.json`,JSON.stringify(n,null,2))}catch(c){const e=`Failed to export image for panel ${d+1}: ${t.title}`;o.push(e),console.warn(e,c)}}const i={exportedAt:(new Date).toISOString(),exportedBy:"Storyboard AI",project:n,totalImages:e.panels.filter((e=>e.imageUrl)).length,errors:o.length>0?o:void 0};a.file("export-summary.json",JSON.stringify(i,null,2)),this.updateProgress("Compressing image bundle",e.panels.length+2,e.panels.length+2);const l=await a.generateAsync({type:"blob",compression:!1!==t.compression?"DEFLATE":"STORE",compressionOptions:{level:"ultra"===t.quality?9:"high"===t.quality?6:3}});return o.length>0&&this.updateProgress("Image bundle complete with errors",e.panels.length+2,e.panels.length+2,void 0,o),l}async exportAsVideoSequence(e,t){this.updateProgress("Creating video sequence export",0,1);const r={project:{title:e.title,description:e.description,totalDuration:e.panels.reduce(((e,t)=>e+t.duration),0)},sequence:e.panels.map(((t,r)=>({order:r+1,title:t.title,description:t.description,duration:t.duration,shotType:t.shotType,cameraAngle:t.cameraAngle,notes:t.notes,videoPrompt:t.videoPrompt||t.aiGeneratedPrompt,imageReference:t.imageUrl?`panel_${String(r+1).padStart(3,"0")}.jpg`:null,timecode:{start:e.panels.slice(0,r).reduce(((e,t)=>e+t.duration),0),end:e.panels.slice(0,r+1).reduce(((e,t)=>e+t.duration),0)}}))),metadata:{exportedAt:(new Date).toISOString(),exportedBy:"Storyboard AI",version:"1.0.0",format:"video-sequence",settings:{quality:t.quality,includePrompts:!1!==t.includePrompts}},directorNotes:e.directorNotes,videoStyle:e.videoStyle};this.updateProgress("Video sequence export complete",1,1);const a=JSON.stringify(r,null,2);return new Blob([a],{type:"application/json"})}async exportAsHTML(e,t){this.updateProgress("Creating HTML export",0,2);const r=await Promise.all(e.panels.map((async e=>{let t=e.imageUrl;if(e.imageUrl&&e.imageUrl.startsWith("stored:"))try{const r=e.imageUrl.replace("stored:",""),a=await Ue.getImageFromDB(r);a?(t=a,console.log(`📸 Restored image for HTML: ${r}`)):(console.warn(`⚠️ Could not restore image: ${r}`),t=void 0)}catch(r){console.warn("Error restoring image:",r),t=void 0}return{...e,imageUrl:t}})));this.updateProgress("Generating HTML content",1,2);const a=`\n<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>${e.title} - Storyboard</title>\n    <style>\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            line-height: 1.6;\n            color: #333;\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 20px;\n            background: #f8f9fa;\n        }\n        .header {\n            background: white;\n            padding: 30px;\n            border-radius: 12px;\n            box-shadow: 0 2px 20px rgba(0,0,0,0.1);\n            margin-bottom: 30px;\n        }\n        .project-title {\n            font-size: 2.5rem;\n            font-weight: bold;\n            margin-bottom: 10px;\n            color: #2c3e50;\n        }\n        .project-description {\n            font-size: 1.2rem;\n            color: #666;\n            margin-bottom: 20px;\n        }\n        .project-meta {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            font-size: 0.9rem;\n            color: #777;\n        }\n        .director-notes {\n            background: #e8f4fd;\n            padding: 20px;\n            border-radius: 8px;\n            margin: 20px 0;\n            border-left: 4px solid #3498db;\n        }\n        .panels {\n            display: grid;\n            gap: 30px;\n        }\n        .panel {\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 2px 20px rgba(0,0,0,0.1);\n            overflow: hidden;\n        }\n        .panel-header {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            padding: 20px;\n        }\n        .panel-number {\n            font-size: 0.9rem;\n            opacity: 0.9;\n            margin-bottom: 5px;\n        }\n        .panel-title {\n            font-size: 1.5rem;\n            font-weight: bold;\n            margin-bottom: 10px;\n        }\n        .panel-content {\n            padding: 20px;\n        }\n        .panel-image {\n            width: 100%;\n            max-width: 600px;\n            height: auto;\n            border-radius: 8px;\n            margin-bottom: 20px;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.2);\n        }\n        .panel-details {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 15px;\n            margin-bottom: 20px;\n        }\n        .detail-item {\n            background: #f8f9fa;\n            padding: 10px 15px;\n            border-radius: 6px;\n            border-left: 3px solid #3498db;\n        }\n        .detail-label {\n            font-size: 0.8rem;\n            color: #666;\n            text-transform: uppercase;\n            letter-spacing: 0.5px;\n            margin-bottom: 3px;\n        }\n        .detail-value {\n            font-weight: 600;\n            color: #2c3e50;\n        }\n        .panel-description {\n            font-size: 1rem;\n            line-height: 1.7;\n            margin-bottom: 15px;\n        }\n        .panel-notes {\n            background: #fff3cd;\n            padding: 15px;\n            border-radius: 6px;\n            border-left: 3px solid #ffc107;\n            margin-bottom: 15px;\n        }\n        .panel-prompt {\n            background: #d1ecf1;\n            padding: 15px;\n            border-radius: 6px;\n            border-left: 3px solid #17a2b8;\n            font-family: monospace;\n            font-size: 0.9rem;\n            line-height: 1.5;\n        }\n        .export-info {\n            text-align: center;\n            color: #666;\n            font-size: 0.9rem;\n            margin-top: 30px;\n            padding: 20px;\n            background: white;\n            border-radius: 8px;\n        }\n        @media print {\n            body { background: white; }\n            .panel { break-inside: avoid; margin-bottom: 30px; }\n        }\n    </style>\n</head>\n<body>\n    <div class="header">\n        <h1 class="project-title">${e.title}</h1>\n        ${e.description?`<p class="project-description">${e.description}</p>`:""}\n        <div class="project-meta">\n            <div><strong>Created:</strong> ${e.createdAt.toLocaleDateString()}</div>\n            <div><strong>Updated:</strong> ${e.updatedAt.toLocaleDateString()}</div>\n            <div><strong>Total Panels:</strong> ${r.length}</div>\n            <div><strong>Total Duration:</strong> ${r.reduce(((e,t)=>e+t.duration),0)}s</div>\n        </div>\n        ${e.directorNotes&&!1!==t.includeNotes?`\n        <div class="director-notes">\n            <h3>Director's Notes</h3>\n            <p>${e.directorNotes.replace(/\n/g,"<br>")}</p>\n        </div>\n        `:""}\n    </div>\n\n    <div class="panels">\n        ${r.map(((e,r)=>`\n        <div class="panel">\n            <div class="panel-header">\n                <div class="panel-number">Panel ${r+1}</div>\n                <div class="panel-title">${e.title}</div>\n            </div>\n            <div class="panel-content">\n                ${e.imageUrl&&!1!==t.includeImages?`\n                <img src="${e.imageUrl}" alt="${e.title}" class="panel-image">\n                `:""}\n                \n                <div class="panel-description">${e.description}</div>\n                \n                <div class="panel-details">\n                    <div class="detail-item">\n                        <div class="detail-label">Shot Type</div>\n                        <div class="detail-value">${e.shotType}</div>\n                    </div>\n                    <div class="detail-item">\n                        <div class="detail-label">Camera Angle</div>\n                        <div class="detail-value">${e.cameraAngle}</div>\n                    </div>\n                    <div class="detail-item">\n                        <div class="detail-label">Duration</div>\n                        <div class="detail-value">${e.duration}s</div>\n                    </div>\n                </div>\n                \n                ${e.notes&&!1!==t.includeNotes?`\n                <div class="panel-notes">\n                    <strong>Notes:</strong><br>\n                    ${e.notes.replace(/\n/g,"<br>")}\n                </div>\n                `:""}\n                \n                ${(e.videoPrompt||e.aiGeneratedPrompt)&&!1!==t.includePrompts?`\n                <div class="panel-prompt">\n                    <strong>Video Prompt:</strong><br>\n                    ${(e.videoPrompt||e.aiGeneratedPrompt||"").replace(/\n/g,"<br>")}\n                </div>\n                `:""}\n            </div>\n        </div>\n        `)).join("")}\n    </div>\n\n    <div class="export-info">\n        Exported from Storyboard AI on ${(new Date).toLocaleDateString()}\n    </div>\n</body>\n</html>\n    `.trim();return this.updateProgress("HTML export complete",2,2),a}async downloadExport(e,t){try{const r=await this.exportProject(e,t);let a,s,o;switch(t.format){case"json":a=`${e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_export.json`,s="application/json",o=r;break;case"pdf":a=`${e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_storyboard.pdf`,s="application/pdf",o=r;break;case"images":a=`${e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_images.zip`,s="application/zip",o=r;break;case"video-sequence":a=`${e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_video_sequence.json`,s="application/json",o=r;break;case"html":a=`${e.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_storyboard.html`,s="text/html",o=new Blob([r],{type:s});break;default:throw new Error(`Unsupported download format: ${t.format}`)}const n=o instanceof Blob?URL.createObjectURL(o):`data:${s};charset=utf-8,${encodeURIComponent(o)}`,i=document.createElement("a");i.href=n,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),o instanceof Blob&&URL.revokeObjectURL(n)}catch(r){throw console.error("Export failed:",r),r}}};Kt(Yt,"instance");const Qt=Yt.getInstance();function Xt({isOpen:r,onClose:a}){var s;const{state:o}=qe(),{state:n}=Xe(),i=n.theme,[l,c]=e.useState("json"),[d,m]=e.useState(!1),[h,u]=e.useState(null),[g,y]=e.useState(null),[x,f]=e.useState(!1),[b,v]=e.useState(null),[w,N]=e.useState({quality:"high",includeImages:!0,includePrompts:!0,includeNotes:!0,compression:!0,pageSize:"A4",orientation:"portrait"});e.useEffect((()=>{r&&(f(!1),v(null),console.log("🚀 ExportDialog opened"))}),[r]),e.useEffect((()=>{try{const e=Ue.getSettings();N((t=>({...t,format:l,quality:e.videoQuality||"high"})))}catch(e){console.error("❌ Error loading export settings:",e),v("Failed to load export settings")}}),[l]),e.useEffect((()=>{try{return Qt.setProgressCallback(u),()=>{Qt.setProgressCallback((()=>{}))}}catch(e){console.error("❌ Error setting up progress callback:",e),v("Failed to initialize export system")}}),[]);const k=[{value:"json",label:"JSON Project",description:"Complete project data for import/backup",icon:p,color:"blue"},{value:"pdf",label:"PDF Storyboard",description:"Professional presentation format",icon:p,color:"red"},{value:"images",label:"Image Bundle",description:"ZIP file with all panel images",icon:Se,color:"green"},{value:"video-sequence",label:"Video Sequence",description:"Timeline data for video editing",icon:ce,color:"purple"},{value:"html",label:"HTML Storyboard",description:"Shareable web page format",icon:je,color:"orange"}],C=()=>h?Math.round(h.progress/h.total*100):0;return r?x&&b?t.jsx(vt,{isOpen:r,onClose:a,title:"Export Error",subtitle:"Something went wrong",icon:t.jsx(j,{className:"w-5 h-5"}),defaultWidth:"400px",defaultHeight:"300px",windowId:"export-error",zIndex:9200,children:t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"mb-4",children:t.jsx(se,{className:"w-12 h-12 mx-auto text-red-500"})}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Export Failed"}),t.jsx("p",{className:"text-sm text-gray-600 mb-4",children:b}),t.jsxs("div",{className:"flex space-x-3 justify-center",children:[t.jsx("button",{onClick:()=>{f(!1),v(null)},className:"px-4 py-2 rounded-lg",style:{backgroundColor:i.colors.background.tertiary,color:i.colors.text.primary,border:`1px solid ${i.colors.border.primary}`},children:"Try Again"}),t.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg",style:{backgroundColor:i.colors.primary[500],color:"#ffffff"},children:"Close"})]})]})}):t.jsx(vt,{isOpen:r,onClose:a,title:"Export Project",subtitle:`Export "${(null==(s=o.currentProject)?void 0:s.title)||"Untitled"}" in various formats`,icon:t.jsx(j,{className:"w-5 h-5"}),defaultWidth:"min(95vw, 800px)",defaultHeight:"min(90vh, 700px)",maxWidth:"98vw",maxHeight:"98vh",resizable:!0,minimizable:!0,maximizable:!0,windowId:"export-dialog",zIndex:9200,children:t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsx("div",{className:"p-4 sm:p-6 border-b",style:{backgroundColor:i.colors.background.secondary,borderColor:i.colors.border.primary},children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold",style:{color:i.colors.text.primary},children:"Choose Export Format"}),t.jsx("p",{className:"text-sm mt-1",style:{color:i.colors.text.secondary},children:"Select how you want to export your storyboard"})]}),o.currentProject&&t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-sm font-medium",style:{color:i.colors.text.primary},children:o.currentProject.title}),t.jsxs("div",{className:"text-xs",style:{color:i.colors.text.tertiary},children:[o.panels.length," panels • Updated ",o.currentProject.updatedAt.toLocaleDateString()]})]})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",style:{backgroundColor:i.colors.background.tertiary},children:[t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:k.map((e=>t.jsx("button",{onClick:()=>c(e.value),className:"p-4 rounded-xl transition-all duration-300 "+(l===e.value?"shadow-lg scale-105 transform-gpu":"hover:shadow-md hover:scale-102 transform-gpu"),style:{backgroundColor:l===e.value?`${i.colors.primary[100]}`:i.colors.background.secondary,borderWidth:"2px",borderStyle:"solid",borderColor:l===e.value?i.colors.primary[300]:i.colors.border.primary},children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-center text-left",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mb-3 sm:mb-0 sm:mr-4",style:{backgroundColor:i.colors.primary[600],color:"white"},children:t.jsx(e.icon,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-center sm:text-left mb-1",style:{color:l===e.value?i.colors.primary[700]:i.colors.text.primary},children:e.label}),t.jsx("p",{className:"text-sm text-center sm:text-left",style:{color:i.colors.text.secondary},children:e.description})]})]})},e.value)))}),t.jsxs("div",{className:"space-y-6",children:[t.jsx("h4",{className:"font-medium",style:{color:i.colors.text.primary},children:"Export Options"}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.text.primary},children:"Quality"}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:["standard","high","ultra"].map((e=>t.jsx("button",{onClick:()=>N((t=>({...t,quality:e}))),className:"p-2 rounded-lg text-sm font-medium transition-all duration-200",style:{backgroundColor:w.quality===e?i.colors.primary[500]:i.colors.background.tertiary,color:w.quality===e?"#ffffff":i.colors.text.primary,border:`1px solid ${w.quality===e?i.colors.primary[500]:i.colors.border.primary}`},children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:w.includeImages,onChange:e=>N((t=>({...t,includeImages:e.target.checked}))),className:"rounded border-2",style:{borderColor:i.colors.border.primary,backgroundColor:i.colors.background.primary}}),t.jsx("span",{className:"text-sm",style:{color:i.colors.text.primary},children:"Include Images"})]}),t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:w.includePrompts,onChange:e=>N((t=>({...t,includePrompts:e.target.checked}))),className:"rounded border-2",style:{borderColor:i.colors.border.primary,backgroundColor:i.colors.background.primary}}),t.jsx("span",{className:"text-sm",style:{color:i.colors.text.primary},children:"Include Video Prompts"})]}),t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:w.includeNotes,onChange:e=>N((t=>({...t,includeNotes:e.target.checked}))),className:"rounded border-2",style:{borderColor:i.colors.border.primary,backgroundColor:i.colors.background.primary}}),t.jsx("span",{className:"text-sm",style:{color:i.colors.text.primary},children:"Include Notes"})]}),t.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:w.compression,onChange:e=>N((t=>({...t,compression:e.target.checked}))),className:"rounded border-2",style:{borderColor:i.colors.border.primary,backgroundColor:i.colors.background.primary}}),t.jsx("span",{className:"text-sm",style:{color:i.colors.text.primary},children:"Use Compression"})]})]}),"pdf"===l&&t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.text.primary},children:"Page Size"}),t.jsxs("select",{value:w.pageSize,onChange:e=>N((t=>({...t,pageSize:e.target.value}))),className:"w-full p-2 rounded-lg border",style:{backgroundColor:i.colors.background.tertiary,borderColor:i.colors.border.primary,color:i.colors.text.primary},children:[t.jsx("option",{value:"A4",children:"A4"}),t.jsx("option",{value:"Letter",children:"Letter"}),t.jsx("option",{value:"Legal",children:"Legal"}),t.jsx("option",{value:"A3",children:"A3"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:i.colors.text.primary},children:"Orientation"}),t.jsxs("select",{value:w.orientation,onChange:e=>N((t=>({...t,orientation:e.target.value}))),className:"w-full p-2 rounded-lg border",style:{backgroundColor:i.colors.background.tertiary,borderColor:i.colors.border.primary,color:i.colors.text.primary},children:[t.jsx("option",{value:"portrait",children:"Portrait"}),t.jsx("option",{value:"landscape",children:"Landscape"})]})]})]})]}),d&&h&&t.jsxs("div",{className:"mt-8 p-4 rounded-xl border",style:{backgroundColor:i.colors.background.secondary,borderColor:i.colors.border.primary},children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("span",{className:"text-sm font-medium",style:{color:i.colors.text.primary},children:h.stage}),t.jsxs("span",{className:"text-sm",style:{color:i.colors.text.secondary},children:[C(),"%"]})]}),t.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden",style:{backgroundColor:i.colors.background.tertiary},children:t.jsx("div",{className:"h-full transition-all duration-300",style:{backgroundColor:i.colors.primary[500],width:`${C()}%`}})}),h.currentItem&&t.jsx("div",{className:"text-xs mt-2",style:{color:i.colors.text.tertiary},children:h.currentItem}),h.errors&&h.errors.length>0&&t.jsx("div",{className:"mt-2 space-y-1",children:h.errors.map(((e,r)=>t.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[t.jsx(se,{className:"w-3 h-3 text-red-500"}),t.jsx("span",{style:{color:i.colors.text.tertiary},children:e})]},r)))})]}),g&&!d&&t.jsxs("div",{className:"mt-8 p-4 rounded-xl border",style:{backgroundColor:g.success?"#10b98120":"#ef444420",borderColor:g.success?"#10b981":"#ef4444"},children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[g.success?t.jsx(oe,{className:"w-5 h-5 text-green-600"}):t.jsx(se,{className:"w-5 h-5 text-red-600"}),t.jsx("span",{className:"font-medium",style:{color:g.success?"#10b981":"#ef4444"},children:g.message})]}),g.filename&&t.jsxs("div",{className:"text-sm mt-1",style:{color:i.colors.text.secondary},children:["Saved as: ",g.filename]})]})]}),t.jsxs("div",{className:"p-6 border-t flex justify-between items-center",style:{backgroundColor:i.colors.background.secondary,borderColor:i.colors.border.primary},children:[t.jsxs("div",{className:"text-sm",style:{color:i.colors.text.secondary},children:[o.panels.length," panels ready for export"]}),t.jsxs("div",{className:"flex space-x-3",children:[t.jsx("button",{onClick:a,disabled:d,className:"px-4 py-2 rounded-lg transition-all duration-200 disabled:opacity-50",style:{backgroundColor:i.colors.background.tertiary,color:i.colors.text.primary,border:`1px solid ${i.colors.border.primary}`},children:"Cancel"}),t.jsx("button",{onClick:async()=>{if(o.currentProject){m(!0),u(null),y(null),f(!1),v(null);try{console.log("🎬 Starting export process...",{format:l,project:o.currentProject.title});const e={...w,format:l};await Qt.downloadExport(o.currentProject,e);const t=`${o.currentProject.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${l}`;y({success:!0,message:`Successfully exported ${o.currentProject.title}`,filename:t}),await Ue.saveSettings({exportFormat:l}),console.log("✅ Export completed successfully")}catch(e){console.error("❌ Export failed:",e),f(!0);const t=e instanceof Error?e.message:"Export failed";v(t),y({success:!1,message:t})}finally{m(!1),u(null)}}else alert("No project to export")},disabled:d||!o.currentProject||0===o.panels.length,className:"px-6 py-2 rounded-lg font-medium transition-all duration-200 disabled:opacity-50 flex items-center space-x-2",style:{backgroundColor:i.colors.primary[500],color:"#ffffff"},children:d?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:"Exporting..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(j,{className:"w-4 h-4"}),t.jsxs("span",{children:["Export ",l.toUpperCase()]})]})})]})]})]})}):null}function Zt(){const{state:r}=qe(),[a,s]=e.useState(null),[o,n]=e.useState(!1),[i,m]=e.useState([]),[u,g]=e.useState(!1),[y,x]=e.useState(!1),[f,b]=e.useState(!1),[v,w]=e.useState(!1),[j,N]=e.useState(!1),[k,C]=e.useState(!1),[A,I]=e.useState(!1),[P,T]=e.useState(!1),[E,D]=e.useState(!1),[$,M]=e.useState(!1),{state:O}=Xe(),[L,F]=e.useState("grid"),[z,R]=e.useState("storyboard");return t.jsxs("div",{className:"h-screen bg-secondary flex flex-col overflow-hidden relative",children:[t.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[t.jsx("div",{className:"absolute top-20 left-10 w-32 h-32 bg-primary rounded-full mix-blend-multiply opacity-20 animate-float",style:{backgroundColor:"var(--primary-200)"}}),t.jsx("div",{className:"absolute top-40 right-10 w-40 h-40 bg-primary rounded-full mix-blend-multiply opacity-20 animate-float",style:{animationDelay:"2s",backgroundColor:"var(--primary-300)"}}),t.jsx("div",{className:"absolute bottom-20 left-1/3 w-36 h-36 bg-primary rounded-full mix-blend-multiply opacity-20 animate-float",style:{animationDelay:"4s",backgroundColor:"var(--primary-400)"}})]}),t.jsx(tt,{onToggleAI:()=>n(!o),isAIOpen:o,viewMode:L,onViewModeChange:F,onOpenTemplates:()=>g(!0),onOpenProjectManager:()=>b(!0),onOpenThemeSettings:()=>w(!0),onOpenSettings:()=>N(!0),onOpenUserGuide:()=>C(!0),onOpenExportDialog:()=>D(!0),currentSection:z,onToggleMobileDrawer:()=>T(!P),isMobileDrawerOpen:P}),t.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[t.jsx("div",{className:"hidden md:block",children:t.jsx(rt,{onNewProject:()=>b(!0),onOpenTemplates:()=>g(!0),onToggleAI:()=>n(!o),onGenerateVideoPrompts:()=>x(!0),onOpenProjectManager:()=>b(!0),onOpenSettings:()=>N(!0)})}),t.jsx("main",{className:"flex-1 flex flex-col bg-primary relative overflow-hidden",children:t.jsx("div",{className:"flex-1 overflow-hidden p-2 md:p-4",children:"timeline"===L?t.jsx(ct,{}):t.jsx(lt,{selectedPanel:a,onSelectPanel:s,onEditPanel:e=>{if(i.find((t=>t.panelId===e)))return;const t={id:`editor-${e}-${Date.now()}`,panelId:e,isOpen:!0};m((e=>[...e,t])),s(e)}})})})]}),t.jsxs("div",{className:"md:hidden fixed bottom-20 right-4 flex flex-col items-center z-30",children:[t.jsx("button",{onClick:()=>M(!$),className:"w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 mb-3",style:{backgroundColor:O.theme.colors.primary[600],color:"#ffffff"},"aria-label":"Toggle menu",children:$?t.jsx(S,{className:"w-6 h-6"}):t.jsx(Ae,{className:"w-6 h-6"})}),t.jsxs("div",{className:"flex flex-col space-y-3 transition-all duration-300 "+($?"opacity-100 translate-y-0":"opacity-0 translate-y-10 pointer-events-none"),children:[t.jsx("button",{onClick:()=>n(!0),className:"w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 touch-manipulation",style:{backgroundColor:O.theme.colors.primary[600],color:"#ffffff"},"aria-label":"Open AI Assistant",children:t.jsx(c,{className:"w-6 h-6"})}),t.jsx("button",{onClick:()=>x(!0),className:"w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 touch-manipulation",style:{backgroundColor:O.theme.colors.primary[500],color:"#ffffff"},"aria-label":"Video Prompts",children:t.jsx(d,{className:"w-6 h-6"})}),t.jsx("button",{onClick:()=>g(!0),className:"w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 touch-manipulation",style:{backgroundColor:O.theme.colors.primary[400],color:"#ffffff"},"aria-label":"Templates",children:t.jsx(p,{className:"w-6 h-6"})}),t.jsx("button",{onClick:()=>{const e={id:`temp-panel-${Date.now()}`,order:r.panels.length},t={id:`editor-new-${Date.now()}`,panelId:e.id,isOpen:!0};m((e=>[...e,t]))},className:"w-16 h-16 rounded-full flex items-center justify-center shadow-lg transition-all duration-300 transform hover:scale-110 touch-manipulation",style:{backgroundColor:O.theme.colors.primary[700],color:"#ffffff"},"aria-label":"Add Panel",children:t.jsx(h,{className:"w-8 h-8"})})]})]}),t.jsx(Vt,{isOpen:P,onClose:()=>T(!1),onNavigate:e=>{switch(R(e),n(!1),x(!1),b(!1),g(!1),w(!1),N(!1),C(!1),I(!1),D(!1),e){case"ai-assistant":n(!0);break;case"video-prompts":x(!0);break;case"projects":b(!0);break;case"templates":g(!0);break;case"settings":N(!0);break;case"theme-settings":w(!0);break;case"export-project":D(!0);break;case"save-project":const e=document.getElementById("quick-save-btn");if(e)e.click();else{const e=document.querySelector("header"),t=new CustomEvent("quicksave");e&&e.dispatchEvent(t)}break;case"import-project":const t=document.getElementById("quick-import-btn");if(t)t.click();else{const e=document.createElement("input");e.type="file",e.accept=".json",e.click()}}},currentSection:z}),t.jsx(Mt,{isOpen:o,onClose:()=>n(!1)}),i.map((e=>{const a=r.panels.find((t=>t.id===e.panelId))||null;return t.jsx(Ft,{panel:a,isOpen:e.isOpen,onClose:()=>{return t=e.id,void m((e=>e.filter((e=>e.id!==t))));var t}},e.id)})),t.jsx(Rt,{isOpen:u,onClose:()=>g(!1)}),t.jsx(Ut,{isOpen:y,onClose:()=>x(!1)}),t.jsx(_t,{isOpen:f,onClose:()=>b(!1)}),t.jsx(Ht,{isOpen:j,onClose:()=>N(!1),onOpenThemeSettings:()=>{N(!1),w(!0)}}),t.jsx(Bt,{isOpen:v,onClose:()=>w(!1)}),t.jsx(qt,{isOpen:k,onClose:()=>C(!1)}),t.jsx(St,{isOpen:A,onClose:()=>I(!1),onSelectAgent:e=>{console.log("Selected agent:",e),I(!1)}}),t.jsx(Xt,{isOpen:E,onClose:()=>D(!1)}),t.jsxs("div",{className:"md:hidden px-4 py-3 flex items-center justify-between border-t",style:{backgroundColor:O.theme.colors.background.primary,borderColor:O.theme.colors.border.primary,color:O.theme.colors.text.primary},children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse",style:{backgroundColor:O.theme.colors.primary[500]}}),t.jsx("span",{className:"text-sm font-medium",children:"Ready to create"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(l,{className:"w-4 h-4",style:{color:O.theme.colors.primary[500]}}),t.jsx("span",{className:"text-sm",children:"AI Powered"})]})]})]})}function er(){return t.jsx(Qe,{children:t.jsx(He,{children:t.jsx(Zt,{})})})}console.log("🚀 main.tsx loaded!");const tr=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),rr=/iPad|iPhone|iPod/.test(navigator.userAgent);(tr||rr)&&console.log("🍎 Safari/iOS detected - using compatibility mode"),(async()=>{if("serviceWorker"in navigator)try{const e="sw.js";console.log(`🔧 Registering service worker: /${e}`);const t=await navigator.serviceWorker.register(`/${e}`,{scope:"/"});t.installing?console.log("🚀 Service worker installing"):t.waiting?console.log("⏳ Service worker installed and waiting"):t.active&&console.log("✅ Service worker active"),t.onupdatefound=()=>{const e=t.installing;e&&(e.onstatechange=()=>{"installed"===e.state&&(navigator.serviceWorker.controller?(console.log("🔄 New service worker available, reloading..."),window.location.reload()):console.log("🔧 Service worker installed for the first time"))})}}catch(e){console.error("❌ Service worker registration failed:",e)}else console.warn("⚠️ Service workers are not supported in this browser")})().then((()=>console.log("✅ Service worker registered successfully"))).catch((e=>console.error("❌ Service worker registration failed:",e)));try{!function(){const e=document.documentElement,t=getComputedStyle(e).getPropertyValue("--bg-primary");t&&""!==t.trim()||(console.warn("⚠️ CSS variables not found, initializing defaults"),e.style.setProperty("--bg-primary","#ffffff"),e.style.setProperty("--bg-secondary","#f9fafb"),e.style.setProperty("--bg-tertiary","#f3f4f6"),e.style.setProperty("--text-primary","#111827"),e.style.setProperty("--text-secondary","#4b5563"),e.style.setProperty("--text-tertiary","#6b7280"),e.style.setProperty("--border-primary","#e5e7eb"),e.style.setProperty("--border-secondary","#d1d5db"))}();const e=document.getElementById("root");if(console.log("📍 Root element:",e),!e)throw new Error("Root element not found!");const r=De.createRoot(e);console.log("✅ React root created"),r.render(t.jsx(er,{})),console.log("✅ App rendered!")}catch(ar){console.error("❌ Error in main.tsx:",ar);const e=ar instanceof Error?ar.message:String(ar),t=document.createElement("div");t.style.cssText="\n    padding: 20px;\n    margin: 20px;\n    background: #fee;\n    border: 2px solid #f44;\n    border-radius: 8px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;\n    color: #333;\n    line-height: 1.5;\n  ",t.innerHTML=`\n    <h2 style="margin: 0 0 10px 0; color: #d00;">🚨 App Loading Error</h2>\n    <p><strong>Error:</strong> ${e}</p>\n    <p><strong>Browser:</strong> ${navigator.userAgent}</p>\n    <p><strong>Time:</strong> ${(new Date).toLocaleString()}</p>\n    <details style="margin-top: 15px;">\n      <summary style="cursor: pointer; font-weight: bold;">Technical Details</summary>\n      <pre style="background: #f5f5f5; padding: 10px; margin-top: 10px; overflow: auto; font-size: 12px;">${ar instanceof Error?ar.stack||"No stack trace available":"Unknown error"}</pre>\n    </details>\n    <p style="margin-top: 15px; font-size: 14px; color: #666;">\n      If this problem persists on Safari, try refreshing the page or check the browser console for more details.\n    </p>\n  `,document.body.appendChild(t)}
